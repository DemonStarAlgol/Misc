<html>
<head>
  <title>CTFshow Misc 9（33-36）</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/605894 (zh-CN, DDL); Windows/6.1.1 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="2610"/>
<h1>CTFshow Misc 9（33-36）</h1>
<h2><a href="https://DemonStarAlgol.github.io/Misc/">[无关链接]</a></h2>

<div>
<span><div><span style="font-weight: bold;">33 超级玛丽</span></div><div>题目描述：超级玛丽，通关就给flag</div><div><br/></div><div>下载得到nes格式文件，显然是FC/NES的游戏ROM。查看一下ROM大小：</div><div><img src="CTFshow Misc 9（33-36）_files/Image.png" type="image/png" data-filename="Image.png"/></div><div>大小为40976字节。众所周知《Super Mario Bro.》的卡带是64KB，《Super Mario Bros. 3》的卡带是128KB。而美版《Super Mario Bros. 2》（日版《Super Mario Bros. USA》）的改版过于少见。从而判断该ROM是《Super Mario Bro.》，也就是大家最熟悉的一代。（其实找个模拟器运行一下就行了，但我懒得下模拟器。）</div><div><br/></div><div>结合题目描述，出题人应该是修改了ROM，把flag写在游戏通关画面Princess Peach的那段台词里。那么接下来只需要掏出ROM编辑工具SMB Utility：</div><div><img src="CTFshow Misc 9（33-36）_files/Image [1].png" type="image/png" data-filename="Image.png"/></div><div>然后打开这个改版ROM：</div><div><img src="CTFshow Misc 9（33-36）_files/Image [2].png" type="image/png" data-filename="Image.png"/></div><div>工具-编辑文本：</div><div><img src="CTFshow Misc 9（33-36）_files/Image [3].png" type="image/png" data-filename="Image.png"/></div><div>找到通关画面（也就是原版的World 8-4过关后见到Princess Peach的画面）中的文字：</div><div><img src="CTFshow Misc 9（33-36）_files/Image [4].png" type="image/png" data-filename="Image.png"/></div><div>然后依次查看：</div><div><img src="CTFshow Misc 9（33-36）_files/Image [5].png" type="image/png" data-filename="Image.png"/></div><div><img src="CTFshow Misc 9（33-36）_files/Image [6].png" type="image/png" data-filename="Image.png"/></div><div><img src="CTFshow Misc 9（33-36）_files/Image [7].png" type="image/png" data-filename="Image.png"/></div><div><img src="CTFshow Misc 9（33-36）_files/Image [8].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div>flag：flag{SUPERDALAO}</div><div><br/></div><div><span style="font-weight: bold;">34 魂斗罗 游戏flag 终结篇</span></div><div><br/></div><div>下载得到nes格式文件，结合题目描述，应该是FC/NES版《魂斗罗》的ROM。虽然FC/NES上其实有多作《魂斗罗》游戏（例如续作《超级魂斗罗（スーパー魂斗羅）》，但从国内知名度来看，应该是1988年移植到FC平台的第一作。那么接下来就掏出FC《魂斗罗》初代的ROM编辑器ContraDirector：</div><div><img src="CTFshow Misc 9（33-36）_files/Image [9].png" type="image/png" data-filename="Image.png"/></div><div>然后打开ROM：</div><div><img src="CTFshow Misc 9（33-36）_files/Image [10].png" type="image/png" data-filename="Image.png"/></div><div>由于初代《魂斗罗》里几乎没有什么文字，所以先看一下地图。注意到第8关（也就是最后一关）的地图：</div><div><img src="CTFshow Misc 9（33-36）_files/Image [11].png" type="image/png" data-filename="Image.png"/></div><div>有很明显的flag字样。继续往后看：</div><div><img src="CTFshow Misc 9（33-36）_files/Image [12].png" type="image/png" data-filename="Image.png"/></div><div><img src="CTFshow Misc 9（33-36）_files/Image [13].png" type="image/png" data-filename="Image.png"/></div><div>依次记录得到flag。</div><div><br/></div><div>flag：flag{上上下下左右左右baba}</div><div><br/></div><div><span style="font-weight: bold;">35 Base一条龙</span></div><div><br/></div><div>下载得到txt格式文件：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>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</div></div><div>base64转码，在开头发现Rar!，将其转码为rar格式文件：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# cat base.txt | base64 -d &gt; 1.rar</div></div><div>解压得到steg.txt：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>YidceGU1XHg4ZVx4YmJceGU1XHhiOVx4YjRceGU0XHhiYlx4OGFceGU2XHg5N1x4YTVceGU2XHhhZFx4YTRceGU5XHg5N1x4YThceGU0XHhiOFx4YWRcclxuJ2==</div><div>YidceGU2XHg5OFx4YTBceGU2XHg5N1x4YTVceGU4XHg4ZFx4YjdceGU4XHg4YVx4YjFceGU1XHg4OFx4YWJceGU2XHhhMFx4YjdceGU3XHhiYVx4YTJcclxuJ4==</div><div>YidceGU5XHhhM1x4OWVceGU2XHhiNVx4ODFceGU3XHg5Ylx4YjRceGU0XHhiOFx4OGJceGU0XHhiOFx4ODlceGU1XHg4ZFx4ODNceGU1XHhiMFx4YmFcclxuJ3==</div><div>YidceGU0XHhiYVx4YmFceGU3XHg5NFx4OWZceGU5XHg5NVx4YmZceGU2XHg4MVx4YThceGU2XHhiMFx4YjRceGU5XHg5NVx4YmZceGU0XHhiOFx4OWNcclxuJ0==</div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">……（后略）</span></div></div><div>对于多行base64编码，且较多行末尾有=号的情况，很容易想到base64隐写。其特征是部分末尾带=的行，base64解码后重新编码，尾部字符会与原来的密文不同，测试发现第一行就符合这一特征。使用现成的base64隐写解密脚本：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>import re</div><div>import base64</div><div><br/></div><div>b64chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'</div><div><br/></div><div>f = open('steg.txt','r')</div><div>base64str = f.readline()</div><div><br/></div><div>pattern2 = r'(\S)==$'</div><div>pattern1 = r'(\S)=$'</div><div><br/></div><div>binstring = ''</div><div><br/></div><div>while(base64str):</div><div>    if re.compile(pattern2).findall(base64str):</div><div>        mstr = re.compile(pattern2).findall(base64str)[0]</div><div>        mbin = bin(b64chars.find(mstr))</div><div>        mbin2 = mbin[0:2] + mbin[2:].zfill(6)</div><div>        stegobin = mbin2[-4:]</div><div>        binstring += stegobin</div><div>    elif re.compile(pattern1).findall(base64str):</div><div>        mstr = re.compile(pattern1).findall(base64str)[0]</div><div>        mbin = bin(b64chars.find(mstr))</div><div>        mbin2 = mbin[0:2] + mbin[2:].zfill(6)</div><div>        stegobin = mbin2[-2:]</div><div>        binstring += stegobin</div><div>    base64str = f.readline()</div><div>for i in range(0,len(binstring),8):</div><div>    print(chr(int(binstring[i:i+8],2)),end='')</div></div><div>输出结果：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>https://www.lanzous.com/i9zuwhi base16/32/58/64/85/91/92</div></div><div><br/></div><div>访问该网址，下载并解压得到BaseAllInOne.txt。根据提示将其不断base解码，手动解码几次后发现编码层数可能较多，且多种base编码混合使用，也没有规律。尝试用正则表达式判断base类型并循环解码：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>import base64</div><div>import base58</div><div>import base91</div><div>import py3base92</div><div>import re</div><div><br/></div><div><br/></div><div>s = open('C:/Users/Administrator/Desktop/BaseAllInOne.txt', 'rb').read()</div><div>base16_dic = r'^[A-F0-9=]*$'</div><div>base32_dic = r'^[A-Z2-7=]*$'</div><div>base58_dic = r'^[1-9A-HJ-NP-Za-km-z]*$'</div><div>base64_dic = r'^[A-Za-z0-9/+=]*$'</div><div>base85_dic = r'^[0-9A-Za-z!#\$%&amp;\(\)\*\+-;&lt;=&gt;\?@\^_`\{\|\}~]*$'</div><div>base91_dic = r'^[0-9A-Za-z!#\$%&amp;\(\)\*\+,\./:;&lt;=&gt;\?@\[\]\^_`\{\|\}~&quot;]*$'</div><div>base92_dic = r'^[A-Za-z0-9!#\$%&amp;\(\)\*\+,\./:;&lt;=&gt;\?@\[\]\^_`\{\|\}~&quot; ]*$'</div><div><br/></div><div>n = 0</div><div>while True:</div><div>    n += 1</div><div>    t = s.decode()</div><div>    print(s)</div><div>    if 'flag{' in t:</div><div>        break</div><div>    elif re.match(base16_dic, t):</div><div>        s = base64.b16decode(s)</div><div>        print(str(n) + ' base16')</div><div>    elif re.match(base32_dic, t):</div><div>        s = base64.b32decode(s)</div><div>        print(str(n) + ' base32')</div><div>    elif re.match(base58_dic, t):</div><div>        s = base58.b58decode(s)</div><div>        print(str(n) + ' base58')</div><div>    elif re.match(base64_dic, t):</div><div>        s = base64.b64decode(s)</div><div>        print(str(n) + ' base64')</div><div>    elif re.match(base85_dic, t):</div><div>        s = base64.b85decode(s)</div><div>        print(str(n) + ' base85')</div><div>    elif re.match(base91_dic, t):</div><div>        s = base91.decode(t)</div><div>        print(str(n) + ' base91')</div><div>    else:</div><div>        s = py3base92.decode(t).encode('utf-8')</div><div>        print(str(n) + ' base92')</div></div><div>运行到第36次循环报错，输出报错前几个循环的结果：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>35 base85</div><div>b'TkVLTFdUQVpvUlNda1ZXRUpAZVldTltgJCQhLCAgGSknPjc='</div><div>36 base64</div><div>b&quot;NEKLWTAZoRS]kVWEJ@eY]N[`$$!,  \x19)'&gt;7&quot;</div></div><div>注意到第35次解码的结果被作为base64编码解码后出现了ASCII不可打印字符，也即最后一段正确的解码结果是：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>TkVLTFdUQVpvUlNda1ZXRUpAZVldTltgJCQhLCAgGSknPjc=</div></div><div>符合base64编码格式，猜测可能是特定字符串经过了另一重加密（从而生成了ASCII不可打印字符\x19）后，再进行base64编码。假设这段特定字符串就是flag，将flag格式的前五位和base64解码结果的前五位进行对比：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>import base64</div><div><br/></div><div>s = b'TkVLTFdUQVpvUlNda1ZXRUpAZVldTltgJCQhLCAgGSknPjc='</div><div>r = base64.b64decode(s)</div><div>f = b'flag{'</div><div><br/></div><div>for i in range(5):</div><div>    print(r[i] + f[i], end = ' ')</div><div>print('')</div><div><br/></div><div>for i in range(5):</div><div>    print(r[i] - f[i], end = ' ')</div><div>print('')</div><div><br/></div><div>for i in range(5):</div><div>    print(r[i] ^ f[i], end = ' ')</div></div><div>输出结果：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>180 177 172 179 210</div><div>-24 -39 -22 -27 -36</div><div>40 41 42 43 44</div></div><div>得出结论，最后一步的加密方式是flag每一位依次异或40、41、42……后再进行base64编码。解密脚本：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>import base64</div><div><br/></div><div>s = b'TkVLTFdUQVpvUlNda1ZXRUpAZVldTltgJCQhLCAgGSknPjc='</div><div>r = base64.b64decode(s)</div><div><br/></div><div>for i in range(len(r)):</div><div>    print(chr(r[i] ^ (40 + i)), end = '')</div></div><div>输出结果：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>flag{you_can_carry_base_decode_now}</div></div><div><br/></div><div>flag：flag{you_can_carry_base_decode_now}</div><div><br/></div><div><span style="font-weight: bold;">32 听说你喜欢爆破</span></div><div>hint: md5爆破的第一位是i（只需爆破后6位），链接只包含小写字母和数字</div><div><br/></div><div>下载得到zip格式文件：</div><div><img src="CTFshow Misc 9（33-36）_files/Image [14].png" type="image/png" data-filename="Image.png"/></div><div>解压得到guess.jpg，根据文件名猜测是Outguess隐写，注释提示密码为8位日期数字。写Python脚本，生成日期字典后进行爆破，注意要将脚本、guess.jpg和res目录放在同一目录下运行：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div># OGBrute.py</div><div>import os</div><div>import pandas</div><div>from datetime import datetime</div><div><br/></div><div>beginDate = '18810101'</div><div>endDate = '19001231'</div><div>dic = [datetime.strftime(x, '%Y%m%d') for x in list(pandas.date_range(start =  beginDate, end = endDate))]</div><div>dic = dic[::-1]</div><div><br/></div><div>for p in dic:</div><div>    out = './res/' + p</div><div>    cmd = 'outguess -k ' + p + ' -r guess.jpg ' + out</div><div>    os.system(cmd)</div><div>    o = open(out, 'rb').read()</div><div>    if len(o) == 0:</div><div>        os.system('rm ' + out)</div></div><div>运行后会将所有范围内的日期作为密码，分别对guess.jpg进行Outguess隐写提取。由于不知道隐写内容到底是什么，所以本次判断所有提取结果的大小，若不为0即保存，然后手动查看文件内容。密码日期范围从2001-2020年开始，若爆破结果中无有效信息，再以20年为单位逐次向前移动。最终密码日期范围选取为1881-1900年之间时，发现以18961210为密码的隐写提取结果为有效信息：</div><div><img src="CTFshow Misc 9（33-36）_files/Image [15].png" type="image/png" data-filename="Image.png"/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>https://www.lanzous.com/ia38dcb</div></div><div><br/></div><div>访问该网址，下载并解压得到crc.png，这是一个1x1大小的PNG图片，但大小有177KB，很显然宽高被修改过（在Linux下查看也能得到同样的结论）。爆破其正确的宽度和高度：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>import zlib</div><div>import struct</div><div><br/></div><div># 同时爆破宽度和高度</div><div>filename = 'C:/Users/Administrator/Desktop/crc.png'</div><div>with open(filename, 'rb') as f:</div><div>    all_b = f.read()</div><div>    crc32key = int(all_b[29:33].hex(), 16)</div><div>    data = bytearray(all_b[12:29])</div><div>    n = 4095</div><div>    for w in range(n):</div><div>        width = bytearray(struct.pack('&gt;i', w))</div><div>        for h in range(n):</div><div>            height = bytearray(struct.pack('&gt;i', h))</div><div>            for x in range(4):</div><div>                data[x+4] = width[x]</div><div>                data[x+8] = height[x]</div><div>            crc32result = zlib.crc32(data)</div><div>            if crc32result == crc32key:</div><div>                print(&quot;宽为：&quot;, end = '')</div><div>                print(width, end = ' ')</div><div>                print(int.from_bytes(width, byteorder='big'))</div><div>                print(&quot;高为：&quot;, end = '')</div><div>                print(height, end = ' ')</div><div>                print(int.from_bytes(height, byteorder='big'))</div></div><div>输出结果：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>宽为：bytearray(b'\x00\x00\x02\xd0') 720</div><div>高为：bytearray(b'\x00\x00\x02\xbd') 701</div></div><div>在十六进制编辑器里修改图片的宽高，得到图片：</div><div><img src="CTFshow Misc 9（33-36）_files/crc.png" type="image/png" data-filename="crc.png"/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>md5('https://www.lanzous.com/???????', 16) - 'fd7e8e47cd47f001'</div></div><div><br/></div><div>分析一下这行字符串，给出了一个网址，其中七位是未知的（题目追加了提示，第一位是i，且全部为小写字母和数字），同时给出了其16位md5值，需要对网址进行爆破。</div><div>注意到这个网址和前一步得到的网址相同，都是兰奏云的，同时根据常识知道，套娃题的出题步骤和解题步骤是相反的。也就是说，出题人必须先把下一步的文件上传兰奏云，得到这一网址，才能制作这张图片，然后将其宽高修改后再上传兰奏云。换言之，需爆破的网址，其上传时间必然在上一步的网址之前。</div><div>另一方面，随便找几个兰奏云的文件下载地址（ctfshow的Misc分类里很多附件下载地址就是），可以大致发现网址最后的7位小写字母+数字基本上是单调递增的。例如<a href="https://www.lanzous.com/i9gwsxi">这个2月18日上传的文件</a>是i9xxxxxx，而<a href="https://www.lanzous.com/ia38dcb">本题上一步3月9日上传的文件</a>是iaxxxxx。考虑到出题时两步之间不会相差太久，可以先尝试固定前几位来爆破以节省时间，甚至可以考虑从ia38dcb开始反过来往前爆破：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>import hashlib</div><div><br/></div><div>def nto36(n):</div><div>    loop = '0123456789abcdefghijklmnopqrstuvwxyz'</div><div>    a = ''</div><div>    while n != 0:</div><div>        a += loop[n % 36]</div><div>        n = n // 36</div><div>    return a[::-1]</div><div><br/></div><div>def nexturl(s):</div><div>    n = int(s, 36)</div><div>    s = str(nto36(n - 1))</div><div>    return s</div><div><br/></div><div>url = 'https://www.lanzous.com/'</div><div>s = 'ia38dcb'</div><div>while True:</div><div>    m = hashlib.md5()</div><div>    m.update((url + s).encode('utf-8'))</div><div>    if m.hexdigest()[8:-8] == 'fd7e8e47cd47f001':</div><div>        print(url + s)</div><div>        break</div><div>    else:</div><div>        s = nexturl(s)</div></div><div>爆破耗时大约1秒，说明追加的提示其实是不需要的。输出结果：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>https://www.lanzous.com/ia35tmj</div></div><div><br/></div><div>下载得到Blasting it.zip，是个加密压缩包：</div><div><img src="CTFshow Misc 9（33-36）_files/Image [16].png" type="image/png" data-filename="Image.png"/></div><div>注意到注释栏下方的滚动条，发现注释中包含了空格和Tab组成的空白字符，尝试将其分别转为0和1：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>请开始你的表演</div><div>01110010011011110110001101101011011110010110111101110101</div></div><div>二进制ASCII转码一下：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>rockyou</div></div><div>指的应该是Kali自带的rockyou.txt密码字典，用该字典对压缩包进行爆破：</div><div><img src="CTFshow Misc 9（33-36）_files/Image [17].png" type="image/png" data-filename="Image.png"/></div><div>得到密码为darkdumymohamed0351409575，解压得到4num.xlsx文件。Windows下打开是空白窗口（可能是我的Office版本问题），LibreOffice打开提示需要密码：</div><div><img src="CTFshow Misc 9（33-36）_files/Image [18].png" type="image/png" data-filename="Image.png"/></div><div>从文件名判断密码是4位数字，用<span style="color: unset; font-family: unset; font-size: unset;">Accent OFFICE Password Recovery爆破密码：</span></div><div><img src="CTFshow Misc 9（33-36）_files/Image [19].png" type="image/png" data-filename="Image.png"/></div><div>得到密码6765，打开文档得到flag：</div><div><img src="CTFshow Misc 9（33-36）_files/Image [20].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div>flag：flag{y0u_4re_4_geniu5}</div><div><br/></div></span>
</div></body></html> 