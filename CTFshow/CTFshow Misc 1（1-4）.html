<html>
<head>
  <title>CTFshow Misc 1（1-4）</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/605894 (zh-CN, DDL); Windows/6.1.1 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="2199"/>
<h1>CTFshow Misc 1（1-4）</h1>
<h2><a href="https://DemonStarAlgol.github.io/Misc/">[无关链接]</a></h2>

<div>
<span><div><span style="font-weight: bold;">1 杂项签到</span></div><div><br/></div><div>下载得到zip格式文件，内含加密的flag.txt，目录名提示“忘记密码了”：</div><div><img src="CTFshow Misc 1（1-4）_files/Image.png" type="image/png" data-filename="Image.png"/></div><div>实际为伪加密，ZipCenOp处理：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>D:\CTFToolkit-v1.1.0\暴力破解\ZipCenOp&gt;java -jar ZipCenOp.jar r download.zip</div><div>success 2 flag(s) found</div></div><div>然后直接解压得到flag。</div><div><br/></div><div>flag：flag{79ddfa61bda03defa7bfd8d702a656e4}</div><div><br/></div><div><span style="font-weight: bold;">2 misc2</span></div><div><br/></div><div>下载得到无后缀名文件file，在Linux下用file命令查看文件类型：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# file file</div><div>file: DOS/MBR boot sector, code offset 0x4e+2, OEM-ID &quot;CTF.SHOW&quot;, root entries 224, sectors 2880 (volumes &lt;=32 MB), sectors/FAT 9, sectors/track 18, sectors 2880 (volumes &gt; 32 MB), serial number 0xffffffff, label: &quot;flagnothere&quot;, FAT (12 bit by descriptor+sectors), followed by FAT</div></div><div>十六进制编辑器打开，查看磁盘头：</div><div><img src="CTFshow Misc 1（1-4）_files/Image [1].png" type="image/png" data-filename="Image.png"/></div><div>1.44MB软盘使用的FAT文件系统通常为FAT12，根据<a href="https://zhuanlan.zhihu.com/p/121807427">FAT12的MBR引导记录结构</a>，第54字节开始的8位应固定为FAT12。而该文件中被修改成了FAT11，需要进行修复。</div><div><br/></div><div>修复完成后，新建虚拟机并载入该软盘镜像：</div><div><img src="CTFshow Misc 1（1-4）_files/Image [2].png" type="image/png" data-filename="Image.png"/></div><div>启动虚拟机得到flag：</div><div><img src="CTFshow Misc 1（1-4）_files/Image [3].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div>flag：flag{ctfshow}</div><div><br/></div><div><span style="font-weight: bold;">3 miscx</span></div><div><br/></div><div>下载得到rar格式文件。内含两个加密压缩的txt文件和未加密misc1.zip：</div><div><img src="CTFshow Misc 1（1-4）_files/Image [4].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div>先看misc1.zip，内含加密的music.doc和未加密的misc.png：</div><div><img src="CTFshow Misc 1（1-4）_files/Image [5].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div>misc.png：</div><div><img src="CTFshow Misc 1（1-4）_files/Image [6].png" type="image/png" data-filename="Image.png"/></div><div>十六进制编辑器打开，文件尾后有额外数据：</div><div><img src="CTFshow Misc 1（1-4）_files/Image [7].png" type="image/png" data-filename="Image.png"/></div><div>但这是误导信息，music.doc的解压密码实际是图片上的数字2020（也可以暴力破解）。解压得到music.doc，内容为：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>♭‖♭‖‖♯♭♭♬‖♩♫‖♬∮♭♭¶♭‖♯‖¶♭♭‖∮‖‖♭‖§♭‖♬♪♭♯§‖‖♯‖‖♬‖‖♪‖‖♪‖¶§‖‖♬♭♯‖♭♯♪‖‖∮‖♬§♭‖‖‖♩♪‖‖♬♭♭♬‖♩♪‖♩¶‖♩♪‖♩♬‖¶§‖‖♩‖¶♫♭♭♩‖♬♯‖♬§♭‖♭‖♩¶‖‖∮♭♭♬‖‖♭‖♫§‖¶♫‖♩∮♭♭§‖♭§‖♭§§=</div></div><div>根据特征判断出是使用<a href="https://www.qqxiuzi.cn/bianma/wenbenjiami.php?s=yinyue">这个在线加密工具</a>加密的，解密得到：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>U2FsdGVkX1/eK2855m8HM4cTq8Fquqtm6QDbcUu4F1yQpA==</div></div><div>这是base64编码形式的密文，直接解码结果为 Salted__ 开头的乱码。注意到最初的rar格式压缩包注释：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>2020快乐！</div><div>rat？or？</div></div><div>第一行的2020与解压密码有关，第二行很可能也是加密方式或密钥的提示，联想到Rabbit加密。以2020为密钥解密得到：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>welcome_to_payhelp</div></div><div>这是misc2.rar中hint.txt的解压密码。</div><div><br/></div><div>查看hint.txt，内容为：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>VmpKMFUxTXhXWGxVV0dob1RUSjRVVll3V2t0aFJscDBZMGhLYTAxWGVIaFZiRkpUWWtaYVZWSnJXbFpOVjJoeVZYcEdZVkpzVG5KVWJHaHBWa1ZWZDFkV1ZtRmtNRFZYVjJ4c2FWSlVWbFJVVnpWdVRXeFZlV1ZHVGxSaVZrWTBXVlJPYzFWR1pFZFRiVGxYWW01Q1dGcEdXbE5UUjBZMlVXMTBWMWRGU2xkV1ZtUXdVekpGZUZOWWJHaFRSVFZWV1d0YVMxTXhjRVZUYTFwc1ZteHdlRlp0ZERCV01VcFlaRE53V0Zac2NIWldSekZMVW1zeFdWSnNTbWxXUjNodlZtMXdUMkl5Vm5OaVNGWnBVbXh3YzFac1VrZFNiRlY0WVVkMFZXSlZXbmxWYlRWUFZsWlplbEZyWkZSaVJrcFFWV3hGYkUwd1VXeE5NRkVsTTBRJTNE</div></div><div>base64解码6次，且每次都要将末尾的%3D进行URL转码为=，得到：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>welcome_to_2020%0Aflag%20is%20coming...%0Athe%20key%20is%20hello%202020%21</div></div><div>URL转码：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>welcome_to_2020</div><div>flag is coming...</div><div>the key is hello 2020!</div></div><div>从而flag.txt的解压密码为：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>hello 2020!</div></div><div>解压得到flag。</div><div><br/></div><div>flag：flag{g00d_f0r_y0u}</div><div><br/></div><div><span style="font-weight: bold;">4 misc50</span></div><div><br/></div><div>下载得到png格式文件。十六进制编辑器打开，文件尾后有额外数据：</div><div><img src="CTFshow Misc 1（1-4）_files/Image [8].png" type="image/png" data-filename="Image.png"/></div><div>同时注意到文件尾块IEND前还有tEXt块：</div><div><img src="CTFshow Misc 1（1-4）_files/Image [9].png" type="image/png" data-filename="Image.png"/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>Sk5DVlM2Mk1NRjVIU1gyTk1GWEgyQ1E9Cg==</div></div><div>base64解码得到：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>JNCVS62MMF5HSX2NMFXH2CQ=</div></div><div>base32解码得到：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>KEY{Lazy_Man}</div></div><div><br/></div><div>用foremost分离png图片，得到zip格式压缩包，解压得到fbi.rar：</div><div><img src="CTFshow Misc 1（1-4）_files/Image [10].png" type="image/png" data-filename="Image.png"/></div><div>注释内容为：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>GEZDGNBVGYFA====</div></div><div>base32解码得到：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>123456</div></div><div>再次解压得到flag.zip，内含加密压缩的thienc.txt。尝试后发现解压密码就是上面得到的123456。</div><div><br/></div><div>解压得到10.3M大的txt文件，内容为：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>30783337307837613078626330786166307832373078316330783030783430783462307862653078346430783162307830307866333078313430783030783030783030783030783030783732307830307830307830307830</div><div>……（后略）</div></div><div>很明显是十六进制ASCII码，开头部分转码得到：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>0x370x7a0xbc0xaf0x270x1c0x00x40x4b0xbe0x4d0x1b0x00xf30x140x00x00x00x00x00x720x00x00x00x00x00x00x00x4d0x480x4a0x270xa0xc50x720x610xe10x990xab0x4d0x990x270x890x780x8c0xd00x2b0xaa0x1e0xf00x7d0x6d0x390xf50xc50x530x23</div><div>……（后略）</div></div><div>是大量十六进制数字，但并不全在ASCII可打印字符范围内，且位数既有1位也有2位。注意到37 7A BC AF是7z格式压缩文件的文件头，将十六进制数字对应转为字节后保存成7z格式文件：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>f = open('C:/Users/Administrator/Desktop/thienc.txt').read()</div><div><br/></div><div>f1 = ''</div><div>for i in range(0, len(f), 2):</div><div>    n = int(f[i:i+2], 16)</div><div>    f1 += chr(n)</div><div><br/></div><div>f1 = f1.split('0x')[1:]</div><div>f2 = b''</div><div>for i in f1:</div><div>    f2 += bytes.fromhex(i.zfill(2))</div><div><br/></div><div>f3 = open('C:/Users/Administrator/Desktop/1.7z', 'wb')</div><div>f3.write(f2)</div></div><div>得到加密的7z格式压缩包，密码是之前已经得到的KEY{Lazy_Man}。</div><div><br/></div><div>解压得到secenc.txt：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>SkpGRVFSS1JLSkpVNFNaVklKS1VLVVpTSkpHRVVSQ0ZKNUtWVVUySEpKQ1ZNUktTSU5ERVVOS01JVkxVMlUyTUpKR</div><div>……（中略）</div><div>VT1NTQ0pOTEVPVktESkpFRktQSjVIVTZUMlBJPQ==</div></div><div>明显是base64编码，尝试将其开头部分解码：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>JJFEQRKRKJJU4SZVIJKUKUZSJJGEURCFJ5KVUU2HJJCVMRKSINDEUNKMIVLU2U2M</div></div><div>明显是base32编码。继续解码发现这段字符串经过了多重的base64和base32混合编码。循环用正则表达式匹配判断编码类型然后解码：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>import base64</div><div>import re</div><div><br/></div><div>f = open('C:/Users/Administrator/Desktop/secenc.txt').read().encode('utf-8')</div><div><br/></div><div>while True:</div><div>    if re.match('^[2-7A-Z=]+$', f.decode('utf-8')):</div><div>        f = base64.b32decode(f)</div><div>    elif re.match('^[0-9a-zA-Z+/=]+$', f.decode('utf-8')):</div><div>        f = base64.b64decode(f)</div><div>    else:</div><div>        print(f.decode('utf-8'))</div><div>        break</div></div><div>输出结果：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>..... ..... ..!?! !.?.. ..... ..... ?.?!. ?.... ..... ..... !.!.! .!.!.</div><div>?.... ...!? !!.?! !!!!! ?.?!. ?!!!! !.?.. ..... !?!!. ?.... ..?.? !.?..</div><div>..!.! .!.!. !.?.. ..... !?!!. ?!!!! !!?.? !.?!! !!!.? ..... ..... .....</div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">……（中略） </span></div><div>....! ?!!.? ..... .?.?! .?... .!.!. !.!.! .?... ....! ?!!.? !!!!! !?.?!</div><div>.?!!! !!.?. ..... .!?!! .?... ...?. ?!.?. ...!. !.... ...!. ?.... ...!?</div><div>!!.?. ..... ?.?!. ?.... ..... .!.?.</div></div><div>明显是简化形式的Ook!，在线工具运行得到：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>+++++ +++++ [-&gt;++ +++++ +++&lt;] &gt;++.+ +++++ .&lt;+++ [-&gt;-- -&lt;]&gt;- -.+++ +++.&lt;</div><div>++++[ -&gt;+++ +&lt;]&gt;+ +++.&lt; +++++ +[-&gt;- ----- &lt;]&gt;.&lt; +++[- &gt;+++&lt; ]&gt;+++ ++.++</div><div>+++++ .---- ----- .&lt;+++ ++++[ -&gt;--- ----&lt; ]&gt;--. &lt;++++ +++[- &gt;++++ +++&lt;]</div><div>&gt;++++ +++++ +++.- ----- --.-- ----. &lt;++++ [-&gt;++ ++&lt;]&gt; +++++ .&lt;+++ +++[-</div><div>&gt;---- --&lt;]&gt; -.&lt;++ ++[-&gt; ++++&lt; ]&gt;.++ ++.&lt;+ ++[-&gt; ---&lt;] &gt;---- --.&lt;+ +++[-</div><div>&gt;++++ &lt;]&gt;++ .---- ---.&lt; +++++ +[-&gt;- ----- &lt;]&gt;-- ----- -.&lt;++ +++++ [-&gt;++</div><div>+++++ &lt;]&gt;++ ++.++ +++++ .++++ ++++. &lt;++++ +++++ [-&gt;-- ----- --&lt;]&gt; -----</div><div>.&lt;+++ +++++ +[-&gt;+ +++++ +++&lt;] &gt;++++ +++++ ++.&lt;</div></div><div>明显是Brainfuck，运行得到：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>flag{Welc0me_tO_cTf_3how!}</div></div><div><br/></div><div>flag：flag{Welc0me_tO_cTf_3how!}</div></span>
</div></body></html> 