<html>
<head>
  <title>CTFshow Misc 7（25-28）</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/605894 (zh-CN, DDL); Windows/6.1.1 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="2394"/>
<h1>CTFshow Misc 7（25-28）</h1>
<h2><a href="https://DemonStarAlgol.github.io/Misc/">[无关链接]</a></h2>

<div>
<span><div><span style="font-weight: bold;">25 stega4_STEGA</span></div><div><br/></div><div>下载得到0.png和1.png。图片内容相似，用Stegsolve的Image Combiner功能查看：</div><div><img src="CTFshow Misc 7（25-28）_files/Image.png" type="image/png" data-filename="Image.png" width="928"/></div><div>在XOR、SUB等模式下均有间断的像素点组成的横向线条图案，这是盲水印的特征。利用脚本提取盲水印信息：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop/blind-watermark-python3/BlindWaterMark# python bwm.py decode 1.png 0.png flag.png</div><div>image&lt;1.png&gt; + image(encoded)&lt;0.png&gt; -&gt; watermark&lt;flag.png&gt;</div></div><div>得到盲水印图片：</div><div><img src="CTFshow Misc 7（25-28）_files/flag.png" type="image/png" data-filename="flag.png" width="907"/></div><div><br/></div><div>flag：flag{ha_ha_ha}</div><div><br/></div><div><span style="font-weight: bold;">26 红包题第八弹</span></div><div><br/></div><div>下载得到zip格式文件：</div><div><img src="CTFshow Misc 7（25-28）_files/Image [1].png" type="image/png" data-filename="Image.png" width="1064"/></div><div><br/></div><div>先看未加密的mima.png：</div><div><img src="CTFshow Misc 7（25-28）_files/mima.png" type="image/png" data-filename="mima.png" width="752"/></div><div>十六进制编辑器打开，在文件尾后找到提示，kobe code：</div><div><img src="CTFshow Misc 7（25-28）_files/Image [2].png" type="image/png" data-filename="Image.png" width="834"/></div><div>搜索找到密码表：</div><div><img src="CTFshow Misc 7（25-28）_files/v2-3a5180a0533422bb7d74310843510b65_720w.jpg" type="image/jpeg" data-filename="v2-3a5180a0533422bb7d74310843510b65_720w.jpg" width="390"/></div><div>对应得到解压密码：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>OAEBEYTKNRBANB</div></div><div>解压得到NBA.mp4。</div><div><br/></div><div>直接打开NBA.mp4报错，十六进制编辑器查看：</div><div><img src="CTFshow Misc 7（25-28）_files/Image [3].png" type="image/png" data-filename="Image.png" width="815"/></div><div>从<a href="https://en.wikipedia.org/wiki/List_of_file_signatures">List of file signatures</a>页面查找到mp4格式的文件头为00 00 00 18 66 74 79 70 69 73 6F 6D，对比可以发现，除了第4字节不一致，其他字节的的十六进制高位和低位均被反转了。<span style="font-size: unset; color: unset; font-family: unset;">尝试将NBA.mp4每个字节的高低位互换：</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>f = open('C:/Users/Administrator/Desktop/NBA.mp4', 'rb').read()</div><div>o = open('C:/Users/Administrator/Desktop/out.mp4', 'ab')</div><div><br/></div><div>for i in range(len(f)):</div><div>    n = int(str(hex(f[i]))[2:].zfill(2)[::-1], 16).to_bytes(1, 'big')</div><div>    o.write(n)</div></div><div>运行得到out.mp4，打开观看视频，会发现2:47-2:48左右画面有不自然闪烁，用播放器的逐帧步进功能找到该帧：</div><div><img src="CTFshow Misc 7（25-28）_files/Image [4].png" type="image/png" data-filename="Image.png" width="688"/></div><div>扫描二维码得到flag。</div><div><br/></div><div>flag：flag{I_l0v3_pl4ying_b4sk3tb4ll}</div><div><br/></div><div><span style="font-weight: bold;">27 杂项9</span></div><div><br/></div><div>下载得到png格式文件：</div><div><img src="CTFshow Misc 7（25-28）_files/Image [5].png" type="image/png" data-filename="Image.png" width="530"/></div><div>十六进制编辑器查看，文件尾后发现了另一个PNG文件头：</div><div><img src="CTFshow Misc 7（25-28）_files/Image [6].png" type="image/png" data-filename="Image.png" width="816"/></div><div>尝试用foremost分解，得到了9张同样大小的png图片：</div><div><img src="CTFshow Misc 7（25-28）_files/Image [7].png" type="image/png" data-filename="Image.png" width="788"/></div><div><br/></div><div>将9张图片按顺序拼接起来，可以得到一个看似有规律的图形（已放大）：</div><div><img src="CTFshow Misc 7（25-28）_files/res2.png" type="image/png" data-filename="res2.png" width="270"/></div><div>用Stegsolve查看该图像可以发现，其R/G/B plane 7处的数据是完全一致的：</div><div><img src="CTFshow Misc 7（25-28）_files/Image [8].png" type="image/png" data-filename="Image.png" width="291"/></div><div>如果把四角的空白视为缺失的定位符，那么与汉信码非常相似：</div><div><img src="CTFshow Misc 7（25-28）_files/20200511221624463.png" type="image/png" data-filename="20200511221624463.png" width="1121"/></div><div>提取<span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-family: 微软雅黑; font-variant-caps: normal; font-variant-ligatures: normal;">R/G/B plane 7处的图像，反色后修复定位符，得到完整的汉信码：</span></div><div><img src="CTFshow Misc 7（25-28）_files/Image [9].png" type="image/png" data-filename="Image.png" width="270"/></div><div>用中国编码手机APP扫描得到flag：</div><div><img src="CTFshow Misc 7（25-28）_files/Image [10].png" type="image/png" data-filename="Image.png" width="1015"/></div><div><br/></div><div>flag：flag{4ab1507d-d195-4d30-87c0-a0d85a77d953}</div><div><br/></div><div><span style="font-weight: bold;">28 文本隐写</span></div><div><br/></div><div>下载得到docx格式文件，打开提示错误：</div><div><img src="CTFshow Misc 7（25-28）_files/Image [11].png" type="image/png" data-filename="Image.png" width="599"/></div><div>众所周知docx的本质是zip，将其作为压缩包打开：</div><div><img src="CTFshow Misc 7（25-28）_files/Image [12].png" type="image/png" data-filename="Image.png" width="983"/></div><div>在/word/document.xml中找到可疑字符串：</div><div><img src="CTFshow Misc 7（25-28）_files/Image [13].png" type="image/png" data-filename="Image.png" width="1310"/></div><div><br/></div><div>另一种做法，新建一个docx文档，作为压缩包打开后，将document.xml替换进去：</div><div><img src="CTFshow Misc 7（25-28）_files/Image [14].png" type="image/png" data-filename="Image.png" width="983"/></div><div>即可正常用Microsoft Word打开文档：</div><div><img src="CTFshow Misc 7（25-28）_files/Image [15].png" type="image/png" data-filename="Image.png" width="1072"/></div><div>全选-右键-字体-取消“隐藏”，也可以得到同一段字符串：</div><div><img src="CTFshow Misc 7（25-28）_files/Image [16].png" type="image/png" data-filename="Image.png" width="1072"/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>,，，,，，，，,，，,,，，,,，，,,，，,,，，，,,，，,，，,,，,，,,，，，,，,,,，，,,,,,，，，，,,,,,，，,,，，,,，，,，,,,,，，，,,，,,，，,,,,,,,,，,，,</div></div><div><br/></div><div>观察这段字符串，仅由半角逗号和全角逗号两种字符组成，字符数为104，能被8整除。尝试将半角逗号替换为0，全角逗号替换为1，得到：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>01101111011001100110011001110011011001010011101000110000011110000011001100110100001110010011000000001010</div></div><div>二进制ASCII转码：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>offse:0x3490</div></div><div>十六进制编辑器打开最初的docx文档，找到0x3490位置：</div><div><img src="CTFshow Misc 7（25-28）_files/Image [17].png" type="image/png" data-filename="Image.png"/></div><div>首先注意到上方有一段base32密文：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>NNSXSORRGTSL3DPHTKCOPOVP42K3BZNNS4======</div></div><div>解码得到：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>key:14位的纯数字</div></div><div>然后继续看0x3490开始的数据，从后面的docProps、app.xml和50 4B 03 04数据块头可以看出，这也是一个docx文档的数据，但zip文件头被改为了00 00 00 00。将0x3490字节开始的数据提取后，修复文件头为50 4B 03 04：</div><div><img src="CTFshow Misc 7（25-28）_files/Image [18].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div>保存为docx格式文档，打开：</div><div><img src="CTFshow Misc 7（25-28）_files/Image [19].png" type="image/png" data-filename="Image.png"/></div><div>尝试编辑，提示文档受保护：</div><div><img src="CTFshow Misc 7（25-28）_files/Image [20].png" type="image/png" data-filename="Image.png"/></div><div>仍然解压后直接查看/word/document.xml：</div><div><img src="CTFshow Misc 7（25-28）_files/Image [21].png" type="image/png" data-filename="Image.png"/></div><div>发现一段base64密文：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>RmxhZyU3QnNob3dfY3RmX3Rzd19jYyU3RA==</div></div><div>解码得到：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>Flag%7Bshow_ctf_tsw_cc%7D</div></div><div>URL转码：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>Flag{show_ctf_tsw_cc}</div></div><div><br/></div><div>flag：Flag{show_ctf_tsw_cc}</div></span>
</div></body></html> 