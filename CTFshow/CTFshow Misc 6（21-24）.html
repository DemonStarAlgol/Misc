<html>
<head>
  <title>CTFshow Misc 6（21-24）</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/605894 (zh-CN, DDL); Windows/6.1.1 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="2360"/>
<h1>CTFshow Misc 6（21-24）</h1>
<h2><a href="https://DemonStarAlgol.github.io/Misc/">[无关链接]</a></h2>

<div>
<span><div><span style="font-weight: bold;">21 misc8</span></div><div><br/></div><div>下载得到flagnothere.jpg和org.zip，后者是个加密压缩包：</div><div><img src="CTFshow Misc 6（21-24）_files/Image.png" type="image/png" data-filename="Image.png"/></div><div>注意到压缩包内也有flagnothere.jpg，且文件大小相同。尝试进行明文破解：</div><div><img src="CTFshow Misc 6（21-24）_files/Image [1].png" type="image/png" data-filename="Image.png"/></div><div>得到密码为 56tygh 。解压得到flag.png：</div><div><img src="CTFshow Misc 6（21-24）_files/flag.png" type="image/png" data-filename="flag.png"/></div><div>扫码得到flag。</div><div><br/></div><div>flag：flag{ctf_show_ok}</div><div><br/></div><div><span style="font-weight: bold;">22 红包题第五弹</span></div><div><br/></div><div>下载得到zip格式文件：</div><div><img src="CTFshow Misc 6（21-24）_files/Image [2].png" type="image/png" data-filename="Image.png"/></div><div>解压得到mp3文件，尝试常见音频隐写方法，暂时没有找到线索。分离出mp3封面图片后，尝试常见图片隐写方法，也找不到线索。回头看zip文件，十六进制编辑器查看：</div><div><img src="CTFshow Misc 6（21-24）_files/Image [3].png" type="image/png" data-filename="Image.png"/></div><div>注意到zip格式的文件尾后又出现了zip格式文件头，后面紧接着jpg格式的文件头，文件末端的字节也是jpg格式的文件尾。将这段数据提取后保存为jpg格式图片：</div><div><img src="CTFshow Misc 6（21-24）_files/1.jpg" type="image/jpeg" data-filename="1.jpg"/></div><div>Stegsolve打开，在Red Plane 0处发现了奇怪的小方块，猜测是某种隐写工具的痕迹：</div><div><img src="CTFshow Misc 6（21-24）_files/Image [4].png" type="image/png" data-filename="Image.png"/></div><div>尝试后发现是Steghide，但密码未知，需要爆破。脚本如下：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div># -*- coding: utf8 -*-</div><div>#author:pcat</div><div>#http://pcat.cnblogs.com</div><div>from subprocess import *</div><div><br/></div><div>def foo():</div><div>    stegoFile='1.jpg' # 带有隐写信息的图片</div><div>    extractFile='hide.txt' # 输出文件名</div><div>    passFile='password.txt' # 密码字典，需要自己准备</div><div><br/></div><div>    errors=['could not extract','steghide --help','Syntax error']</div><div>    cmdFormat='steghide extract -sf &quot;%s&quot; -xf &quot;%s&quot; -p &quot;%s&quot;'</div><div>    f=open(passFile,'r')</div><div><br/></div><div>    for line in f.readlines():</div><div>        cmd=cmdFormat %(stegoFile,extractFile,line.strip())</div><div>        p=Popen(cmd,shell=True,stdout=PIPE,stderr=STDOUT)</div><div>        content=unicode(p.stdout.read(),'gbk')</div><div>        for err in errors:</div><div>            if err in content:</div><div>                break</div><div>        else:</div><div>            print content,</div><div>            print 'the passphrase is %s' %(line.strip())</div><div>            f.close()</div><div>            return</div><div><br/></div><div>if __name__ == '__main__':</div><div>    foo()</div><div>    print 'ok'</div><div>    pass</div></div><div>运行结果：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# python SHbrute.py</div><div>wrote extracted data to &quot;hide.txt&quot;.</div><div>the passphrase is 123456</div><div>ok</div></div><div>隐写密码为123456，同时隐写信息被提取到同一目录下的hide.txt中：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>aHR0cHM6Ly93d3cubGFuem91cy5jb20vaTlkcGp4ZQ==</div></div><div>base64解码：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>https://www.lanzous.com/i9dpjxe</div></div><div><br/></div><div>访问该URL，下载得到red5.zip。解压得到flag.txt：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>5b303a305d283235352c203235352c20323535295b303a315d283136302c203136302c20313630295b303a325d283136302c203136302c20313630295b303a335d283136302c203136302c20313630295b303a345d283136302c203136302c20313630295b303a355d2831</div><div>……（后略）</div></div><div>十六进制ASCII转码：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>[0:0](255, 255, 255)[0:1](160, 160, 160)[0:2](160, 160, 160)[0:3](160, 160, 160)[0:4](160, 160, 160)[0:5](160, 160, 160)[0:6](160, 160, 160)[0:7](160, 160, 160)[0:8](160, 160, 160)[0:9](160, 160, 160)[0:10](160, 160, 160)[0:11](160, 160, 160)[0:12](160, 160, 160)[0:13](160, 160, 160)[0:14](160, 160, 160)[0:15](160, 160, 160)[0:16](160, 160, 160)[0:17](160, 160, 160)[0:18](160, 160, 160)[0:19](160, 160, 160)[0:20](160, 160, 160)[0:21](160, 160, 160)[0:22](160, 160, 160)[0:23](160, 160, 160)[0:24](160, 160, 160)[0:25](160, 160, 160)[0:26](160, 160, 160)[0:27](160, 160, 160)[0:28](160, 160, 160)[0:29](160, 160, 160)[0:30](160, 160, 160)[0:31](160, 160, 160)[0:32](160, 160, 160)[0:33](160, 160, 160)[0:34](160, 160, 160)[0:35](160, 160, 160)[0:36](165, 165, 165)[0:37](187, 187, 187)[0:38](192, 192, 192)[0:39](165, 165, 165)[0:40](160, 160, 160)[0:41](160, 160, 160)[0:42](160, 160, 160)[0:43](160, 160, 160)[0:44](160, 160, 160)[0:45](160, 160, 160)[0:46](160, 160, 160)[0:47](160, 160, 160)[0:48](160, 160, 160)[0:49](160, 160, 160)[0:50](160, 160, 160)[0:51](160, 160, 160)[0:52](160, 160, 160)[0:53](160, 160, 160)[0:54](160, 160, 160)[0:55](160, 160, 160)[0:56](160, 160, 160)[0:57](160, 160, 160)[0:58](160, 160, 160)[0:59](160, 160, 160)[0:60](160, 160, 160)[0:61](160, 160, 160)[0:62](160, 160, 160)[0:63](160, 160, 160)[0:64](160, 160, 160)[0:65](160, 160, 160)[0:66](160, 160, 160)[0:67](160, 160, 160)[0:68](160, 160, 160)[0:69](160, 160, 160)[0:70](160, 160, 160)[0:71](160, 160, 160)[0:72](255, 255, 255)[0:73](255, 255, 255)[1:0](255, 255, 255)</div><div>……（后略）</div></div><div>观察规律，每个单元可以视为[x:y](a, b, c)的形式。其中x取值范围0-71，y取值范围0-73，abc均为0-255。猜测x和y是坐标，abc是对应像素点的RGB值。写Python脚本绘图：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>from PIL import Image</div><div><br/></div><div>f = open('C:/Users/Administrator/Desktop/flag.txt').read()</div><div>f = f.split(')')[:-1]</div><div>img = Image.new('RGB', (72, 74))</div><div><br/></div><div>for i in f:</div><div>    x = int(i.split(':')[0][1:])</div><div>    y = int(i.split(':')[1].split(']')[0])</div><div>    r = int(i.split('(')[1].split(',')[0])</div><div>    g = int(i.split(', ')[1])</div><div>    b = int(i.split(', ')[2])</div><div>    img.putpixel((x, y), (r, g, b))</div><div>img.save('C:/Users/Administrator/Desktop/flag.png')</div></div><div>输出结果：</div><div><img src="CTFshow Misc 6（21-24）_files/flag [1].png" type="image/png" data-filename="flag.png"/></div><div>拼接处理得到二维码：</div><div><img src="CTFshow Misc 6（21-24）_files/flag2.png" type="image/png" data-filename="flag2.png"/></div><div>扫码得到flag。</div><div><br/></div><div>flag：flag{ctf_show_fight}</div><div><br/></div><div><span style="font-weight: bold;">23 stega2</span></div><div><br/></div><div>下载得到png格式文件，在Linux下查看显示CRC错误，Windows下可正常显示，说明图片高度被修改。爆破正确高度：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>import struct</div><div>import binascii</div><div>from Crypto.Util.number import bytes_to_long</div><div><br/></div><div>img = open('C:/Users/Administrator/Desktop/flag.png', 'rb').read()</div><div><br/></div><div>for i in range(0xFFFF):</div><div>    stream = img[12:20] + struct.pack('&gt;i', i) + img[24:29]</div><div>    crc = binascii.crc32(stream)</div><div>    if crc == bytes_to_long(img[29:33]):</div><div>        print(hex(i))</div></div><div>输出结果：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>0x1ce</div></div><div>在十六进制编辑器中修改图片高度，得到：</div><div><img src="CTFshow Misc 6（21-24）_files/flag [2].png" type="image/png" data-filename="flag.png"/></div><div><br/></div><div>flag：flag{na yi nian wo ye bian cheng le guang}</div><div><br/></div><div><b>24 stega3</b></div><div><br/></div><div>下载得到rar格式文件，内含一张jpg格式图片：</div><div><img src="CTFshow Misc 6（21-24）_files/Image [5].png" type="image/png" data-filename="Image.png"/></div><div>但图片本身并未发现任何可疑信息，回头重新从rar格式压缩包上寻找线索。容易想到NTFS流隐写，用7-Zip打开rar压缩包，发现了NTFS流隐写信息：</div><div><img src="CTFshow Misc 6（21-24）_files/Image [6].png" type="image/png" data-filename="Image.png"/></div><div>打开a.jpg:flag1.txt得到flag。</div><div><br/></div><div>flag：flag{ntfs_is_so_cool}</div></span>
</div></body></html> 