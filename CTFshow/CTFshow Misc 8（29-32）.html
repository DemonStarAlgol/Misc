<html>
<head>
  <title>CTFshow Misc 8（29-32）</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/605894 (zh-CN, DDL); Windows/6.1.1 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="2494"/>
<h1>CTFshow Misc 8（29-32）</h1>
<h2><a href="https://DemonStarAlgol.github.io/Misc/">[无关链接]</a></h2>

<div>
<span><div><span style="font-weight: bold;">29 misc21</span></div><div>题目描述：猜猜flag藏在哪里了？</div><div><br/></div><div>下载得到jpg格式文件。尝试常见隐写方式，无线索；尝试在无密码的情况下用各类隐写工具提取，无结果。考虑带密码情况下的隐写工具提取，根据题目描述里的“猜”字，先尝试outguess，用弱密码字典爆破。脚本如下：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>import os</div><div><br/></div><div>f = open('password.txt','r+').readlines()</div><div>for line in f:</div><div>    p = line.replace('\n', '')</div><div>    out = './res/' + p</div><div>    cmd = 'outguess -k ' + p + ' -r taolu.jpg ' + out</div><div>    os.system(cmd)</div><div>    o = open(out, 'rb').read()</div><div>    if b'flag{' in o:</div><div>        print('txt: ' + p)</div><div>        os.rename(out, out + '.txt')</div><div>        break</div><div>    o = open(out, 'rb').read()[0:4]</div><div>    if o == b'\x50\x4b\x03\x04':</div><div>        print('zip: ' + p)</div><div>        os.rename(out, out + '.zip')</div><div>        break</div><div>    if o == b'\x52\x61\x72\x21':</div><div>        print('rar: ' + p)</div><div>        os.rename(out, out + '.rar')</div><div>        break</div><div>    if o == b'\x89\x50\x4e\x47':</div><div>        print('png: ' + p)</div><div>        os.rename(out, out + '.png')</div><div>        break</div><div>    if o[0:3] == b'\xff\xd8\xff':</div><div>        print('jpg: ' + p)</div><div>        os.rename(out, out + '.jpg')</div><div>        break</div><div>    os.system('rm ' + out)</div></div><div>将以上脚本和附件图片、密码字典放在同一目录下，建立res目录后运行脚本：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# python3 OGbrute.py</div><div>Reading taolu.jpg....</div><div>Extracting usable bits:   64185 bits</div><div>Steg retrieve: seed: 3271, len: 3602</div><div>Reading taolu.jpg....</div><div>Extracting usable bits:   64185 bits</div><div>Steg retrieve: seed: 26562, len: 1968</div><div><br/></div><div>……（中略）</div><div><br/></div><div>Reading taolu.jpg....</div><div>Extracting usable bits:   64185 bits</div><div>Steg retrieve: seed: 175, len: 221</div><div>zip: 123456</div></div><div>即隐写密码为123456，提取结果是zip压缩包：</div><div><img src="CTFshow Misc 8（29-32）_files/Image.png" type="image/png" data-filename="Image.png"/></div><div>非伪加密，尝试密码字典爆破也没有结果。十六进制编辑器打开：</div><div><img src="CTFshow Misc 8（29-32）_files/Image [1].png" type="image/png" data-filename="Image.png"/></div><div>文件尾部有额外数据，且由09、0A、0D和20四种字节组成，分别对应Tab、\r、\n和空格。复制到支持显示空格与Tab的文本编辑器中：</div><div><img src="CTFshow Misc 8（29-32）_files/Image [2].png" type="image/png" data-filename="Image.png"/></div><div>很可能是摩斯电码，以Tab为长音，空格为短音，转码得到：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>CTFGOOD</div></div><div>以此为密码解压zip压缩包得到flag。</div><div><br/></div><div>flag：flag{023032132-asdasdasd-ljklkz}</div><div><br/></div><div><span style="font-weight: bold;">30 misc22</span></div><div>题目描述：这游戏真好玩，水晶不玩到7.93十亿，都不好意思跟人打招呼！<span style="font-size: unset; color: unset; font-family: unset;">提示：shift快捷键在新手教程里有说明</span></div><div><br/></div><div>下载得到zip格式文件：</div><div><img src="CTFshow Misc 8（29-32）_files/Image [3].png" type="image/png" data-filename="Image.png"/></div><div>注释里提示bin文件是游戏存档，并给出了游戏地址。进入游戏，发现是个建设类塔防游戏：</div><div><img src="CTFshow Misc 8（29-32）_files/Image [4].png" type="image/png" data-filename="Image.png"/></div><div>进行新手教程，注意到Shift键的作用是同时操作所有同类设施。此外设施是可以出售的：</div><div><img src="CTFshow Misc 8（29-32）_files/Image [5].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div>完成新手教程了解基本操作后，载入题目附件给出的存档：</div><div><img src="CTFshow Misc 8（29-32）_files/Image [6].png" type="image/png" data-filename="Image.png"/></div><div>由于该游戏中没有找到可以输入文本的地方，隐藏信息基本上只能靠自己建造设置的位置和形状。但从小地图可以看到，设施数量非常多，难以找到携带flag信息的特定构造。结合题目提示，容易想到需要靠Shift键将干扰项全部卖出：</div><div><img src="CTFshow Misc 8（29-32）_files/Image [7].png" type="image/png" data-filename="Image.png"/></div><div>尝试卖掉部分设施，事实上只要卖掉所有<span style="font-weight: bold;">城墙</span>就能在小地图上大致看出flag形状：</div><div><img src="CTFshow Misc 8（29-32）_files/Image [8].png" type="image/png" data-filename="Image.png"/></div><div>这样一来就可以看出flag是由<span style="font-weight: bold;">运输器</span>排列成的，配合小地图卖掉其他所有设备：</div><div><img src="CTFshow Misc 8（29-32）_files/Image [9].png" type="image/png" data-filename="Image.png"/></div><div>就可以从小地图上清晰地看到flag了。</div><div><br/></div><div>flag：flag{Tower_Defense_Is_Funny}</div><div><br/></div><div><span style="font-weight: bold;">31 stega12</span></div><div><br/></div><div>下载得到png格式文件，十六进制编辑器查看：</div><div><img src="CTFshow Misc 8（29-32）_files/Image [10].png" type="image/png" data-filename="Image.png"/></div><div>从010Editor的模板结果看到，该图片中有fcTL和fdAT等块。更清晰的结果可以通过TweakPNG看到：</div><div><img src="CTFshow Misc 8（29-32）_files/Image [11].png" type="image/png" data-filename="Image.png"/></div><div>fcTL和fdAT块都是APNG的专有块，分别是帧控制和帧数据。</div><div><br/></div><div>换言之，该PNG图片实际是APNG动画。用Chrome等浏览器打开，图片会自动播放到最后一帧停止：</div><div><img src="CTFshow Misc 8（29-32）_files/Image [12].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div>flag：flag{letmeseesee}</div><div><br/></div><div><span style="font-weight: bold;">32 stega5</span></div><div><br/></div><div>下载得到png格式文件。Stegsolve打开，在Red Plane 1处发现二维码：</div><div><img src="CTFshow Misc 8（29-32）_files/Image [13].png" type="image/png" data-filename="Image.png"/></div><div>扫码得到：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>03F30D0A79CB05586300000000000000000100000040000000730D0000006400008400005A000064010053280200000063000000000300000016000000430000007378000000640100640200640300640400640500640600640700640300640800640900640A00640600640B00640A00640700640800640C00640C00640D00640E00640900640F006716007D00006410007D0100781E007C0000445D16007D02007C01007400007C0200830100377D0100715500577C010047486400005328110000004E6966000000696C00000069610000006967000000697B000000693300000069380000006935000000693700000069300000006932000000693400000069310000006965000000697D000000740000000028010000007403000000636872280300000074030000007374727404000000666C6167740100000069280000000028000000007304000000312E7079520300000001000000730A0000000001480106010D0114014E280100000052030000002800000000280000000028000000007304000000312E707974080000003C6D6F64756C653E010000007300000000</div></div><div>注意到文件头03 F3 0D 0A，这是pyc文件的文件头。在十六进制编辑器中将这段数据保存为pyc文件，然后反编译：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>C:\Users\Administrator\Desktop&gt;uncompyle6 -o 1.py 1.pyc</div><div>1.pyc --</div><div># Successfully decompiled file</div></div><div>反编译结果：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>def flag():</div><div>    str = [</div><div>     102, 108, 97, 103, 123, 51, 56, 97, 53, 55, 48, 51, 50, 48, 56, 53, 52, 52, 49, 101, 55, 125]</div><div>    flag = ''</div><div>    for i in str:</div><div>        flag += chr(i)</div><div><br/></div><div>    print flag</div></div><div>Python2运行函数flag()，或直接将str中的数字进行十进制ASCII转码得到flag。</div><div><br/></div><div>flag：flag{38a57032085441e7}</div></span>
</div></body></html> 