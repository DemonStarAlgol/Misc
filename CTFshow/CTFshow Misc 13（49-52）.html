<html>
<head>
  <title>CTFshow Misc 13（49-52）</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/605894 (zh-CN, DDL); Windows/6.1.1 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="2872"/>
<h1>CTFshow Misc 13（49-52）</h1>
<h2><a href="https://DemonStarAlgol.github.io/Misc/">[无关链接]</a></h2>

<div>
<span><div><span style="font-weight: bold;">49 BabyMisc</span></div><div><br/></div><div>下载得到zip格式文件，内含加密的flag.png：</div><div><img src="CTFshow Misc 13（49-52）_files/Image.png" type="image/png" data-filename="Image.png"/></div><div>根据注释提示，密码是不大于一千万的6位数字，因此这应该是一个十六进制数字，其中A-F六个数字有大小写两种可能性。可以用Python生成不大于10000000的十六进制整数字典后再用工具进行爆破：</div><div><img src="CTFshow Misc 13（49-52）_files/Image [1].png" type="image/png" data-filename="Image.png"/></div><div>得到密码为5b8d7f，解压得到flag.png。</div><div><br/></div><div>查看flag.png，Linux下提示CRC错误，Windows下查看显示大量不规则色块：</div><div><img src="CTFshow Misc 13（49-52）_files/Image [2].png" type="image/png" data-filename="Image.png"/></div><div>说明图像宽度被修改过（也可能是宽度和高度都被修改过），用Python脚本爆破正确的宽度和高度：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>import zlib</div><div>import struct</div><div><br/></div><div># 同时爆破宽度和高度</div><div>filename = 'C:/Users/Administrator/Desktop/flag.png'</div><div>with open(filename, 'rb') as f:</div><div>    all_b = f.read()</div><div>    crc32key = int(all_b[29:33].hex(), 16)</div><div>    data = bytearray(all_b[12:29])</div><div>    n = 4095</div><div>    for w in range(n):</div><div>        width = bytearray(struct.pack('&gt;i', w))</div><div>        for h in range(n):</div><div>            height = bytearray(struct.pack('&gt;i', h))</div><div>            for x in range(4):</div><div>                data[x+4] = width[x]</div><div>                data[x+8] = height[x]</div><div>            crc32result = zlib.crc32(data)</div><div>            if crc32result == crc32key:</div><div>                print(&quot;宽为：&quot;, end = '')</div><div>                print(width, end = ' ')</div><div>                print(int.from_bytes(width, byteorder='big'))</div><div>                print(&quot;高为：&quot;, end = '')</div><div>                print(height, end = ' ')</div><div>                print(int.from_bytes(height, byteorder='big'))</div></div><div>输出结果：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>宽为：bytearray(b'\x00\x00\x03\xe8') 1000</div><div>高为：bytearray(b'\x00\x00\x01\xf4') 500</div></div><div>在十六进制编辑器中修改图片宽度为1000(0x3e8)，得到修复完成的图片：</div><div><img src="CTFshow Misc 13（49-52）_files/flag1.png" type="image/png" data-filename="flag1.png"/></div><div><br/></div><div>flag：flag{33818f5d4588644fcbd62f804a6e0035}</div><div><br/></div><div><span style="font-weight: bold;">50 小喇叭开始广播啦</span></div><div>题目描述：互联时代的你们也一起来体验一下无线电广播的乐趣吧，拿好大家的小板凳一起来听孙敬修爷爷讲故事。<span style="font-size: unset; color: unset; font-family: unset;">不过因为调频模块损坏，所以本次广播使用PM（相位调制）技术实现，请各位拿着调频收音机的小伙伴自行解决吧，哈哈哈。</span></div><div><span style="font-size: unset;"><br/></span></div><div><span style="font-size: unset;">做不来，告辞！</span></div><div>以下是出题人给的解题脚本：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>import numpy as np</div><div><br/></div><div>fl = [float(x) for x in open('C:/Users/Administrator/Desktop/f.txt').read().split()]</div><div>npl = np.array(fl)</div><div>window = 20*31</div><div>strx = ''</div><div>for i in range(0, len(fl), window):</div><div>    fa = np.angle(np.fft.fft(fl[i : i+window])[: window//2])</div><div>    if fa[20] &gt; 0 :</div><div>        strx += '1'</div><div>    else:</div><div>        strx += '0'</div><div>print(''.join([chr(int(strx[i : i+8], 2)) for i in range(0, len(strx), 8)]))</div></div><div><br/></div><div>flag：flag{4fee119fbdf9ae1ae470e4f638507cb1}</div><div><br/></div><div><span style="font-weight: bold;">51 麻辣兔头</span></div><div>题目描述：从前有一个皇帝，特别喜欢吃麻辣兔头，于是给帝国科学院写了一封信，内容是：<span style="font-size: unset; color: unset; font-family: unset;">gmcj{hirniu wcur yzwkozttz}</span></div><div><span style="font-size: unset;"><br/></span></div><div>密文已经有类似flag格式，对比gmcj和flag：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>for i in range(4):</div><div>    print(ord('gmcj'[i]) - ord('flag'[i]), end = ' ')</div></div><div>输出：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>1 1 2 3</div></div><div>可以看出是斐波那契数列的前4位，斐波那契数列又名兔子数列，与题目名称也对得上。也即密文是明文每个字符分别向后移位的结果，移位位数是斐波那契数列的对应项。由于密文均为小写字母，可以联想到移位时也应限制在小写字母范围内：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>import string</div><div><br/></div><div>cipher = 'gmcjhirniuwcuryzwkozttz'</div><div>f = [1, 1]</div><div>for i in range(2, len(cipher)):</div><div>    f += [f[i-2] + f[i-1]]</div><div>print(f)</div><div><br/></div><div>dic = string.ascii_lowercase</div><div>plaintext = ''</div><div>for i in range(len(cipher)):</div><div>    plaintext += dic[(dic.find(cipher[i]) - f[i]) % 26]</div><div>print(plaintext)</div></div><div>输出结果：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>flagcaesarlovemalatutou</div></div><div>即：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>flag{caesar love malatutou}</div></div><div>根据题目说明，flag是 caesar love malatutou 的MD5值，即f45131721edc83c35d02d933cf0b3a41。</div><div><br/></div><div>flag：flag{f45131721edc83c35d02d933cf0b3a41}</div><div><br/></div><div><span style="font-weight: bold;">52 呵呵</span></div><div><br/></div><div>下载得到py格式文件：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>import base64</div><div><br/></div><div>m='''They camefirst for the Communists,</div><div>and I didn't speak upbecause I wasn't a Communist.</div><div>Then they came for the Jews,</div><div>and I didn't speak upbecause I wasn't a Jew.</div><div>Then they came for the trade unionists,</div><div>and I didn't speak upbecause I wasn't a trade unionist.</div><div>Then they came for the Catholics,</div><div>and I didn't speak upbecause I was a Protestant.</div><div>Then they came for me,</div><div>but by that timeno one was left to speak up.'''.encode()</div><div><br/></div><div>def hehe(strx=&quot;&quot;):</div><div>    ret = &quot;&quot;</div><div>    '''</div><div>    这里做了啥骚操作就需要你自己猜啦，哈哈哈哈哈^_^</div><div>    '''</div><div>    return ret;</div><div>print(hehe(base64.b64encode(m).decode()))</div><div>#ETsovHYqBD8oAnobx6JtAn0bRSIlAHYWy78gwD4kx6IaOZksynJtHHYpzDIfQ6Jtx6YoBDhtwCYrADMswCMoRVptw7Uayrw9RTVtJ70gyCEfzCM9OtkFzTEfRSIlACptB7UgAHYny6RtwTsoRVkow6NhXnUfAXYQRTIkAT5mwXYaxTEszbY8xTQoB7U8x7FtHHY6BCMfQ6JtBHYPACxfXoIlAD5twTsovHYqBD8oRTAexrY9zTFtwSQsATFtwD4ky74kx6IaOZksynJtHHYpzDIfQ6Jtx6YoBDhtwCYrADMswCMoRVptw7Uayrw9RTVtwSQsATFtwD4ky74kx6JfXoIlAD5twTsovHYqBD8oRTAexrY9zTFtJ7U9zT0hzDMaOZksynJtHHYpzDIfQ6Jtx6YoBDhtwCYrADMswCMoRVptw7UaRTVtFSQewTEawTUfwX5PETsoyrY9zTE4RTMsyDFtAn0bRT8oOZkrwCJtBmptwTsswXY9zD8oyn1ty74oRSwsxbYhADA9RSIeRSMdADUiRSEdOt==</div><div>flag='flag{这就不能直接告诉你了}'.encode()</div><div>print(hehe(base64.b64encode(flag).decode()))</div><div>#AncsA6gsATN7LDAqBGZdMTFbAWAoNapcAqAsBqwoMqtaMnFdMC9=</div></div><div>阅读代码，给出了m的明文和m的base64编码经过hehe函数处理后的结果，需要分析hehe函数进行的操作。</div><div><br/></div><div>生成m的base64编码并与hehe函数处理后的结果进行对比：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div># 未呵呵</div><div>VGhleSBjYW1lZmlyc3QgZm9yIHRoZSBDb21tdW5pc3RzLAphbmQg<font color="#FF0000">SS</font>BkaWRuJ3Qgc3BlYWsgdXBiZWNhdXNlIEkgd2Fzbid0IGEgQ29tbXVuaXN0LgpUaGVuIHRoZXkgY2FtZSBmb3IgdGhlIEpld3MsCmFuZCBJIGRpZG4ndCBzcGVhayB1cGJlY2F1c2UgSSB3YXNuJ3QgYSBKZXcuClRoZW4gdGhleSBjYW1lIGZvciB0aGUgdHJhZGUgdW5pb25pc3RzLAphbmQgSSBkaWRuJ3Qgc3BlYWsgdXBiZWNhdXNlIEkgd2Fzbid0IGEgdHJhZGUgdW5pb25pc3QuClRoZW4gdGhleSBjYW1lIGZvciB0aGUgQ2F0aG9saWNzLAphbmQgSSBkaWRuJ3Qgc3BlYWsgdXBiZWNhdXNlIEkgd2FzIGEgUHJvdGVzdGFudC4KVGhlbiB0aGV5IGNhbWUgZm9yIG1lLApidXQgYnkgdGhhdCB0aW1lbm8gb25lIHdhcyBs<font color="#FF0000">ZWZ0IHRvIHNwZWF</font>rIHVwLg==</div><div><br/></div><div># 已呵呵</div><div>ETsovHYqBD8oAnobx6JtAn0bRSIlAHYWy78gwD4kx6IaOZksynJt<font color="#FF0000">HH</font>YpzDIfQ6Jtx6YoBDhtwCYrADMswCMoRVptw7Uayrw9RTVtJ70gyCEfzCM9OtkFzTEfRSIlACptB7UgAHYny6RtwTsoRVkow6NhXnUfAXYQRTIkAT5mwXYaxTEszbY8xTQoB7U8x7FtHHY6BCMfQ6JtBHYPACxfXoIlAD5twTsovHYqBD8oRTAexrY9zTFtwSQsATFtwD4ky74kx6IaOZksynJtHHYpzDIfQ6Jtx6YoBDhtwCYrADMswCMoRVptw7Uayrw9RTVtwSQsATFtwD4ky74kx6JfXoIlAD5twTsovHYqBD8oRTAexrY9zTFtJ7U9zT0hzDMaOZksynJtHHYpzDIfQ6Jtx6YoBDhtwCYrADMswCMoRVptw7UaRTVtFSQewTEawTUfwX5PETsoyrY9zTE4RTMsyDFtAn0bRT8oOZkrwCJtBmptwTsswXY9zD8oyn1ty74oRSwsxbYh<font color="#FF0000">ADA9RSIeRSMdAD</font>UiRSEdOt==</div></div><div>发现规律：</div><div>1、大写字母对应大写字母，小写字母对应小写字母，数字对应数字；</div><div>2、同样的字母（不区分大小写）对应同样的字母，例如Ww对应Dd，数字同理；</div><div>3、对应关系是可逆的，例如W对应D，D对应W，0对应9，9对应0；</div><div>进一步观察发现：</div><div>4、对应关系是字母和数字列表中的对称关系，例如第一个字母A对应最后一个字母Z。</div><div>写脚本验证：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>import string</div><div><br/></div><div><br/></div><div>a = 'VGhleSBjYW1lZmlyc3QgZm9yIHRoZSBDb21tdW5pc3RzLAphbmQgSSBkaWRuJ3Qgc3BlYWsgdXBiZWNhdXNlIEkgd2Fzbid0IGEgQ29tbXVuaXN0LgpUaGVuIHRoZXkgY2FtZSBmb3IgdGhlIEpld3MsCmFuZCBJIGRpZG4ndCBzcGVhayB1cGJlY2F1c2UgSSB3YXNuJ3QgYSBKZXcuClRoZW4gdGhleSBjYW1lIGZvciB0aGUgdHJhZGUgdW5pb25pc3RzLAphbmQgSSBkaWRuJ3Qgc3BlYWsgdXBiZWNhdXNlIEkgd2Fzbid0IGEgdHJhZGUgdW5pb25pc3QuClRoZW4gdGhleSBjYW1lIGZvciB0aGUgQ2F0aG9saWNzLAphbmQgSSBkaWRuJ3Qgc3BlYWsgdXBiZWNhdXNlIEkgd2FzIGEgUHJvdGVzdGFudC4KVGhlbiB0aGV5IGNhbWUgZm9yIG1lLApidXQgYnkgdGhhdCB0aW1lbm8gb25lIHdhcyBsZWZ0IHRvIHNwZWFrIHVwLg=='</div><div>b = 'ETsovHYqBD8oAnobx6JtAn0bRSIlAHYWy78gwD4kx6IaOZksynJtHHYpzDIfQ6Jtx6YoBDhtwCYrADMswCMoRVptw7Uayrw9RTVtJ70gyCEfzCM9OtkFzTEfRSIlACptB7UgAHYny6RtwTsoRVkow6NhXnUfAXYQRTIkAT5mwXYaxTEszbY8xTQoB7U8x7FtHHY6BCMfQ6JtBHYPACxfXoIlAD5twTsovHYqBD8oRTAexrY9zTFtwSQsATFtwD4ky74kx6IaOZksynJtHHYpzDIfQ6Jtx6YoBDhtwCYrADMswCMoRVptw7Uayrw9RTVtwSQsATFtwD4ky74kx6JfXoIlAD5twTsovHYqBD8oRTAexrY9zTFtJ7U9zT0hzDMaOZksynJtHHYpzDIfQ6Jtx6YoBDhtwCYrADMswCMoRVptw7UaRTVtFSQewTEawTUfwX5PETsoyrY9zTE4RTMsyDFtAn0bRT8oOZkrwCJtBmptwTsswXY9zD8oyn1ty74oRSwsxbYhADA9RSIeRSMdADUiRSEdOt=='</div><div><br/></div><div>def hehegetou(s):</div><div>    res = ''</div><div>    for i in s:</div><div>        if i in string.ascii_lowercase:</div><div>            d = string.ascii_lowercase</div><div>            res += d[25 - d.find(i)]</div><div>        elif i in string.ascii_uppercase:</div><div>            d = string.ascii_uppercase</div><div>            res += d[25 - d.find(i)]</div><div>        elif i in string.digits:</div><div>            d = string.digits</div><div>            res += d[9 - d.find(i)]</div><div>        else:</div><div>            res += i</div><div>    return(res)</div><div><br/></div><div>print(hehegetou(a) == b)</div></div><div>输出结果：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>True</div></div><div>根据对应操作的可逆性，只需要把hehe的结果再hehe一遍就可以得到原始字符串，据此可以得到flag：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>import base64</div><div><br/></div><div>c = 'AncsA6gsATN7LDAqBGZdMTFbAWAoNapcAqAsBqwoMqtaMnFdMC9='</div><div>print(base64.b64decode(hehegetou(c).encode('ascii')))</div></div><div>输出结果：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>b'flag{adc69fca004e2d6e391f6ab7e6836e05}'</div></div><div><br/></div><div>flag：flag{adc69fca004e2d6e391f6ab7e6836e05}</div></span>
</div></body></html> 