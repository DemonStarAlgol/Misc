<html>
<head>
  <title>BUUCTF Misc 64（301-304）</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/605894 (zh-CN, DDL); Windows/6.1.1 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="2548"/>
<h1>BUUCTF Misc 64（301-304）</h1>
<h2><a href="https://DemonStarAlgol.github.io/Misc/">[无关链接]</a></h2>

<div>
<span><div><span style="font-weight: bold;">301 [羊城杯 2020]image_rar</span></div><div><br/></div><div>下载得到mp4格式文件，直接观看视频没有发现线索。尝试十六进制编辑器查看，010Editor的模板功能提示有未知类型的文件块，实际上也就是文件尾后有额外数据：</div><div><img src="BUUCTF Misc 64（301-304）_files/Image.png" type="image/png" data-filename="Image.png"/></div><div>拖到文件末尾，注意到cache_pic/999.jpg和50 4B 05 06等特征，很明显这是一个zip压缩包：</div><div><img src="BUUCTF Misc 64（301-304）_files/Image [1].png" type="image/png" data-filename="Image.png"/></div><div>搜索50 4B 03 04，定位到第一个查找结果，这里就是上述压缩包的文件头：</div><div><img src="BUUCTF Misc 64（301-304）_files/Image [2].png" type="image/png" data-filename="Image.png"/></div><div>手动提取得到zip压缩包。提示压缩包密码为6位，前两位为GW，但这个压缩包并没有加密，先记下来：</div><div><img src="BUUCTF Misc 64（301-304）_files/Image [3].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div>解压得到cache_pic文件夹，内含6573张jpg格式图片，内容是《Bad Apple》视频的帧。注意到65.jpg格式损坏无法显示：</div><div><img src="BUUCTF Misc 64（301-304）_files/Image [4].png" type="image/png" data-filename="Image.png"/></div><div>十六进制编辑器查看65.jpg，很明显是被修改了文件头的RAR压缩包：</div><div><img src="BUUCTF Misc 64（301-304）_files/Image [5].png" type="image/png" data-filename="Image.png"/></div><div>修复文件头为Rar!，打开发现需要密码：</div><div><img src="BUUCTF Misc 64（301-304）_files/Image [6].png" type="image/png" data-filename="Image.png"/></div><div>联想到zip压缩包注释中的提示，可以用掩码爆破的方式破解压缩包。但由于RAR版本的问题，ARCHPR对该压缩包无效。搜索发现可以提取RAR压缩包的hash值然后用hashcat进行爆破。首先在Kali下用rar2john提取hash值：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# rar2john 65.rar</div><div>65.rar:$rar5$16$a2dce3925af59efb2df9851dbfc24fb1$15$bb005ea8f91bf0356c8dddcfa41ac4cb$8$62293dc5e26e9e7f</div></div><div>接着在Windows下（主要是物理机有GPU加速）用hashcat进行掩码爆破：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>D:\CTFToolkit-v1.1.0\密码工具\hashcat-6.1.1&gt;hashcat.exe -m 13000 -a 3 $rar5$16$a2dce3925af59efb2df9851dbfc24fb1$15$bb005ea8f91bf0356c8dddcfa41ac4cb$8$62293dc5e26e9e7f GW?a?a?a?a</div></div><div>然后视电脑配置不同等待一小时到一个世纪不等，爆破结束得到密码：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>GW5!3#</div></div><div>解压得到无扩展名的flag文件，十六进制编辑器查看：</div><div><img src="BUUCTF Misc 64（301-304）_files/Image [7].png" type="image/png" data-filename="Image.png"/></div><div>明显是PNG格式，修改扩展名得到图片：</div><div><img src="BUUCTF Misc 64（301-304）_files/flag.png" type="image/png" data-filename="flag.png"/></div><div><br/></div><div>flag：GWHT{R3fresh_1s_so_Cool}</div><div><br/></div><div>2021.3.14 举办的VNCTF 2021题目，比赛后上交的WP比较简略，以下是赛后重新整理的解题笔记。序号接着前面的往下写，顺序是我比赛时做题的顺序，以题目名为准。</div><div><br/></div><div><span style="font-weight: bold;">302 [VNCTF 2021]interesting_fishing</span></div><div><br/></div><div>下载得到bin格式文件和注释.txt，先看后者：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>crazyman_army是某安全公司的研究人员</div><div>这天他的其邮箱里发现了一封奇怪的邮件</div><div>你能帮助他找到其隐藏的信息吗</div><div><br/></div><div>注意:</div><div>附件是第一部分的flag</div><div>图片是第二部分的flag</div><div>最后flag为 第一部分+第二部分</div><div><br/></div><div>hint:powershell解码后的字符可能存在不可读的情况 那并不是解码错误</div></div><div>十六进制编辑器查看bin文件，发现实质为文本：</div><div><img src="BUUCTF Misc 64（301-304）_files/Image [8].png" type="image/png" data-filename="Image.png"/></div><div>注意到X-QQ-FEAT等标签及大量base64格式编码，说明这是一个邮件文件。扩展名改为eml后通过QQ邮箱发给自己：</div><div><img src="BUUCTF Misc 64（301-304）_files/Image [9].png" type="image/png" data-filename="Image.png"/></div><div>然后点击“预览”：</div><div><img src="BUUCTF Misc 64（301-304）_files/Image [10].png" type="image/png" data-filename="Image.png"/></div><div>邮件里还有<a href="https://vnctf-213-1257061123.cos.ap-nanjing.myqcloud.com/ThisIsSecret.jpg">一张图片</a>和一个附件myproject.rar。结合注释，分别包含两部分flag。</div><div><br/></div><div>先看图片，下载后注意到文件名是ThisIsSecret。用OurSecret提取隐写信息：</div><div><img src="BUUCTF Misc 64（301-304）_files/Image [11].png" type="image/png" data-filename="Image.png"/></div><div>得到2.txt，内容为：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>_fr0m_l@z@RuS}</div></div><div>顺带一提，OurSecret的隐写信息是经过某种加密/编码后直接以额外字节数据形式附加在文件尾之后的，十六进制编辑器可以很明显地看到痕迹。若今后有文件在文件尾后附带无法识别的额外字节数据，可以考虑OurSecret。</div><div><br/></div><div>再看附件myproject.rar，下载后解压，得到giveyouflag文件夹：</div><div><img src="BUUCTF Misc 64（301-304）_files/Image [12].png" type="image/png" data-filename="Image.png"/></div><div>看起来似乎是个Visual Studio工程目录。联想到注释中提到的powershell，搜索关键词，找到giveyourflag.vcxproj：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>&lt;Command&gt;powershell -exec bypass -w hi&quot;dd&quot;en -f x64\Debug\Browse.VC.db&lt;/Command&gt;</div></div><div>继续找到 x64\Debug\Browse.VC.db ，注意这是一个系统隐藏文件，默认情况下不显示，需要在文件夹选项中设置。当然也可以用其他办法绕过，比如Everything搜索一下之类的。打开该文件：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>$encodestring = &quot;（一大段base64编码，略）&quot;</div><div>$bytes  = [System.Convert]::FromBase64String($string);</div><div>$decoded = [System.Text.Encoding]::UTF8.GetString($bytes);</div><div>echo $decoded</div></div><div>可以看出大致内容是将base64编码先进行base64解码，再进行UTF8转码。那么先base64解码：</div><div><img src="BUUCTF Misc 64（301-304）_files/Image [13].png" type="image/png" data-filename="Image.png"/></div><div>每隔一位去掉不可打印字符后，得到 \u-xxxxx? 的编码形式。直接Unicode转码得到的是无意义的汉字，猜测可能编码形式需要进一步转换。注意到所有的五位数字 xxxxx 都与65535很接近，且差值似乎均在ASCII可打印字符的编码范围内。进一步尝试可以得知，正确的解码方式是用65536减去五位数字，再ASCII转码：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>import base64</div><div><br/></div><div>a = 'XAB1AC0ANgA1ADQAMwAyAD8AXAB1AC0ANgA1ADQAMgAwAD8AXAB1AC0ANgA1ADQAMgAwAD8AXAB1AC0ANgA1ADQAMgA0AD8AXAB1AC0ANgA1ADQAMgAxAD8AXAB1AC0ANgA1ADQANwA4AD8AXAB1AC0ANgA1ADQAOAA5AD8AXAB1AC0ANgA1ADQAOAA5AD8AXAB1AC0ANgA1ADQAMQA4AD8AXAB1AC0ANgA1ADQAMgA2AD8AXAB1AC0ANgA1ADQAMwA3AD8AXAB1AC0ANgA1ADQAMgAwAD8AXAB1AC0ANgA1ADQAMwA0AD8AXAB1AC0ANgA1ADQAOQAxAD8AXAB1AC0ANgA1ADQAOAA2AD8AXAB1AC0ANgA1ADQAOAA3AD8AXAB1AC0ANgA1ADQAOAA1AD8AXAB1AC0ANgA1ADQAOQAxAD8AXAB1AC0ANgA1ADQAOAA3AD8AXAB1AC0ANgA1ADQAOAA2AD8AXAB1AC0ANgA1ADQAOAAzAD8AXAB1AC0ANgA1ADQAOAAxAD8AXAB1AC0ANgA1ADQAOAA4AD8AXAB1AC0ANgA1ADQAOAAyAD8AXAB1AC0ANgA1ADQAOAA3AD8AXAB1AC0ANgA1ADQAOAA3AD8AXAB1AC0ANgA1ADQAOAA2AD8AXAB1AC0ANgA1ADQAOAA1AD8AXAB1AC0ANgA1ADQAOQAwAD8AXAB1AC0ANgA1ADQAMwA3AD8AXAB1AC0ANgA1ADQAMgA1AD8AXAB1AC0ANgA1ADQAMgAxAD8AXAB1AC0ANgA1ADQAOQAwAD8AXAB1AC0ANgA1ADQAMwA5AD8AXAB1AC0ANgA1ADQAMgA0AD8AXAB1AC0ANgA1ADQAOQAxAD8AXAB1AC0ANgA1ADQAMgA2AD8AXAB1AC0ANgA1ADQAMwA5AD8AXAB1AC0ANgA1ADQAMgA2AD8AXAB1AC0ANgA1ADQAMwAwAD8AXAB1AC0ANgA1ADQAMwAxAD8AXAB1AC0ANgA1ADQAMgA2AD8AXAB1AC0ANgA1ADQAMwAzAD8AXAB1AC0ANgA1ADQAOQAwAD8AXAB1AC0ANgA1ADQAMgA3AD8AXAB1AC0ANgA1ADQAMQA1AD8AXAB1AC0ANgA1ADQAMgAzAD8AXAB1AC0ANgA1ADQAMwA3AD8AXAB1AC0ANgA1ADQAMgA4AD8AXAB1AC0ANgA1ADQAMgA1AD8AXAB1AC0ANgA1ADQAMQA5AD8AXAB1AC0ANgA1ADQAMwA2AD8AXAB1AC0ANgA1ADQAOQAwAD8AXAB1AC0ANgA1ADQAMwA3AD8AXAB1AC0ANgA1ADQAMgA1AD8AXAB1AC0ANgA1ADQAMgA3AD8AXAB1AC0ANgA1ADQAOAA5AD8AXAB1AC0ANgA1ADQANQA2AD8AXAB1AC0ANgA1ADQAMQA1AD8AXAB1AC0ANgA1ADQAMgA1AD8AXAB1AC0ANgA1ADQAMgA2AD8AXAB1AC0ANgA1ADQAMwAzAD8AXAB1AC0ANgA1ADQAMQA1AD8AXAB1AC0ANgA1ADQAMwA5AD8AXAB1AC0ANgA1ADQAMgA2AD8AXAB1AC0ANgA1ADQAMwAzAD8AXAB1AC0ANgA1ADQAOQA5AD8AXAB1AC0ANgA1ADQAOAA2AD8AXAB1AC0ANgA1ADQAOAA4AD8AXAB1AC0ANgA1ADQAMgAxAD8AXAB1AC0ANgA1ADQAMgAwAD8AXAB1AC0ANgA1ADQAMgA1AD8AXAB1AC0ANgA1ADQAMgAyAD8AXAB1AC0ANgA1ADQAMwA1AD8AXAB1AC0ANgA1ADQAMgAxAD8AXAB1AC0ANgA1ADQAOQA5AD8AXAB1AC0ANgA1ADQAOAA2AD8AXAB1AC0ANgA1ADQAOAA4AD8AXAB1AC0ANgA1ADQAMgA4AD8AXAB1AC0ANgA1ADQAMgA1AD8AXAB1AC0ANgA1ADQAMQA3AD8AXAB1AC0ANgA1ADQAOQA5AD8AXAB1AC0ANgA1ADQAOAA2AD8AXAB1AC0ANgA1ADQAOAA4AD8AXAB1AC0ANgA1ADQAMgA1AD8AXAB1AC0ANgA1ADQAMgA2AD8AXAB1AC0ANgA1ADQAOQA5AD8AXAB1AC0ANgA1ADQAOAA2AD8AXAB1AC0ANgA1ADQAOAA4AD8AXAB1AC0ANgA1ADQAMwA0AD8AXAB1AC0ANgA1ADQAMgA1AD8AXAB1AC0ANgA1ADQAMgAyAD8AXAB1AC0ANgA1ADQAMwA1AD8AXAB1AC0ANgA1ADQAMwAxAD8AXAB1AC0ANgA1ADQAMwAzAD8AXAB1AC0ANgA1ADQAMgA2AD8AXAB1AC0ANgA1ADQAOQA5AD8AXAB1AC0ANgA1ADQAOAA2AD8AXAB1AC0ANgA1ADQAOAA4AD8AXAB1AC0ANgA1ADQAMwAzAD8AXAB1AC0ANgA1ADQAMgA1AD8AXAB1AC0ANgA1ADQAMgA1AD8AXAB1AC0ANgA1ADQAMwA2AD8AXAB1AC0ANgA1ADQAMgAxAD8AXAB1AC0ANgA1ADQAOQA5AD8AXAB1AC0ANgA1ADQAOAA2AD8AXAB1AC0ANgA1ADQAOAA4AD8AXAB1AC0ANgA1ADQAMwA5AD8AXAB1AC0ANgA1ADQAMgA3AD8AXAB1AC0ANgA1ADQAMwAxAD8AXAB1AC0ANgA1ADQAMwA2AD8AXAB1AC0ANgA1ADQAOQA5AD8AXAB1AC0ANgA1ADQAOAA2AD8AXAB1AC0ANgA1ADQAOAA4AD8AXAB1AC0ANgA1ADQANQA4AD8AXAB1AC0ANgA1ADQAMgA1AD8AXAB1AC0ANgA1ADQAMgAyAD8AXAB1AC0ANgA1ADQAMgAwAD8AXAB1AC0ANgA1ADQAMwAyAD8AXAB1AC0ANgA1ADQAOQA5AD8AXAB1AC0ANgA1ADQAOAA2AD8AXAB1AC0ANgA1ADQAOAA4AD8AXAB1AC0ANgA1ADQANgAxAD8AXAB1AC0ANgA1ADQAMgA1AD8AXAB1AC0ANgA1ADQAMgAyAD8AXAB1AC0ANgA1ADQAMwA1AD8AXAB1AC0ANgA1ADQAMwA5AD8AXAB1AC0ANgA1ADQAMgA2AD8AXAB1AC0ANgA1ADQAOQA5AD8AXAB1AC0ANgA1ADQAOAA2AD8AXAB1AC0ANgA1ADQAOAA4AD8AXAB1AC0ANgA1ADQANgA5AD8AXAB1AC0ANgA1ADQANQA3AD8AXAB1AC0ANgA1ADQANQAwAD8AXAB1AC0ANgA1ADQANgAzAD8AXAB1AC0ANgA1ADQANgA4AD8AXAB1AC0ANgA1ADQAOQAxAD8AXAB1AC0ANgA1ADQAOAA3AD8AXAB1AC0ANgA1ADQANwA5AD8AXAB1AC0ANgA1ADQAOQA5AD8AXAB1AC0ANgA1ADQAOAA2AD8AXAB1AC0ANgA1ADQAOAA4AD8AXAB1AC0ANgA1ADQAMgA0AD8AXAB1AC0ANgA1ADQAMwA5AD8AXAB1AC0ANgA1ADQAMgAyAD8AXAB1AC0ANgA1ADQAMwA5AD8AXAB1AC0ANgA1ADQAMgA2AD8AXAB1AC0ANgA1ADQAMgA1AD8AXAB1AC0ANgA1ADQAMwAxAD8AXAB1AC0ANgA1ADQAMwA5AD8AXAB1AC0ANgA1ADQAOQAwAD8AXAB1AC0ANgA1ADQAMgAyAD8AXAB1AC0ANgA1ADQAMwA5AD8AXAB1AC0ANgA1ADQAMgAyAD8A'</div><div>b = base64.b64decode(a.encode())</div><div><br/></div><div>c = ''</div><div>for i in range(0, len(b), 2):</div><div>    c += b.decode()[i]</div><div><br/></div><div>c = c.replace(r'\u-', '').split('?')[:-1]</div><div>for i in c:</div><div>    print(chr(65536 - int(i)), end = '')</div></div><div>输出结果：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>https://vnctf-213-1257061123.cos.ap-nanjing.myqcloud.com/Pyongyang%20stores%20low%20on%20foreign%20goods%20amid%20North%20Korean%20COVID-19%20paranoia.rar</div></div><div>事后询问出题人得知这是RTF格式的混淆Unicode编码。</div><div><br/></div><div>下载得到加密的rar压缩包，提示密码为四位数字：</div><div><img src="BUUCTF Misc 64（301-304）_files/Image [14].png" type="image/png" data-filename="Image.png"/></div><div>压缩算法为RAR5，用hashcat进行爆破：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# rar2john py.rar</div><div>py.rar:$rar5$16$1349cb834c70bf27bb4e48bb3fbe6975$15$ca4a3bc58278b04d9fba4d7d52acb196$8$56245cd11e4a1c2e</div></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>D:\CTFToolkit-v1.1.0\密码工具\hashcat-6.1.1&gt;hashcat -m 13000 -a 3 $rar5$16$1349cb834c70bf27bb4e48bb3fbe6975$15$ca4a3bc58278b04d9fba4</div><div>d7d52acb196$8$56245cd11e4a1c2e ?d?d?d?d</div></div><div>得到密码为9705。</div><div><br/></div><div>再次解压得到docx格式文件，文档内容没有可疑之处，用7-zip作为压缩包打开，发现 hideinfo.xml <span style="font-size: unset; color: unset; font-family: unset;">：</span></div><div><img src="BUUCTF Misc 64（301-304）_files/Image [15].png" type="image/png" data-filename="Image.png"/></div><div>十六进制编辑器查看，发现实质为文本，没有xml格式，且其中有零宽字符：</div><div><img src="BUUCTF Misc 64（301-304）_files/Image [16].png" type="image/png" data-filename="Image.png"/></div><div>用<a href="http://330k.github.io/misc_tools/unicode_steganography.html">在线工具</a>提取零宽字符隐写信息：</div><div><img src="BUUCTF Misc 64（301-304）_files/Image [17].png" type="image/png" data-filename="Image.png"/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>vnctf{APT_1S_c0M1nG</div></div><div>最后拼接两段字符串得到flag。</div><div><br/></div><div>flag：vnctf{APT_1S_c0M1nG_fr0m_l@z@RuS}</div><div><br/></div><div><span style="font-weight: bold;">303 [VNCTF 2021]冰冰好像藏着秘密</span></div><div><br/></div><div>下载得到rar格式文件，直接打开会报错：</div><div><img src="BUUCTF Misc 64（301-304）_files/Image [18].png" type="image/png" data-filename="Image.png"/></div><div>7-zip等其他压缩软件甚至无法打开压缩包。</div><div><br/></div><div>这里有三种方法可以解压得到图片：</div><div>1、预期解，RAR伪加密。十六进制编辑器打开：</div><div><img src="BUUCTF Misc 64（301-304）_files/Image [19].png" type="image/png" data-filename="Image.png"/></div><div>RAR格式压缩包的加密标识位在第24个字节的其中1 bit上，0对应无加密，1对应加密。将该字节的低位由4改成0即可去掉伪加密，得到可正常打开的压缩包。</div><div>2、暴力解。打开压缩包，不要管报错，直接把文件拖出来：</div><div><img src="BUUCTF Misc 64（301-304）_files/Image [20].png" type="image/png" data-filename="Image.png"/></div><div>虽然又报错了，但竟能成功拖。不知道和RAR版本是否有关，待考。</div><div>3、手工解。注意到该压缩包的压缩比其实是存储模式：</div><div><img src="BUUCTF Misc 64（301-304）_files/Image [21].png" type="image/png" data-filename="Image.png"/></div><div>实际上十六进制编辑器打开也能直接看到PNG文件头和IHDR块标志，搜索 IEND 也能找到文件尾：</div><div><img src="BUUCTF Misc 64（301-304）_files/Image [22].png" type="image/png" data-filename="Image.png"/></div><div>那么直接提取 0x47 - 0xA218 字节并另存就可以得到FFT.png。</div><div><br/></div><div>得到FFT.png后，根据文件名猜测是快速傅立叶变换（fast Fourier transform）。直接搜个Python脚本来处理：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>import cv2</div><div>import numpy as np</div><div>from matplotlib import pyplot as plt</div><div><br/></div><div>img = cv2.imread('FFT.png', 0)</div><div>f = np.fft.fft2(img)</div><div>fshift = np.fft.fftshift(f)</div><div>magnitude_spectrum = 20 * np.log(np.abs(fshift))</div><div><br/></div><div>plt.subplot(121)</div><div>plt.imshow(img, cmap = 'gray')</div><div>plt.title('Input Image')</div><div>plt.xticks([])</div><div>plt.yticks([])</div><div>plt.subplot(122)</div><div>plt.imshow(magnitude_spectrum, cmap = 'gray')</div><div>plt.title('Magnitude Spectrum')</div><div>plt.xticks([])</div><div>plt.yticks([])</div><div>plt.show()</div></div><div><img src="BUUCTF Misc 64（301-304）_files/Figure_1.png" type="image/png" data-filename="Figure_1.png"/></div><div>变换结果的左上角就是flag。</div><div><br/></div><div>flag：VNCTF{Ff5_1S_bEauTiful}</div><div><br/></div><div><span style="font-weight: bold;">304 [VNCTF 2021]Do_you_like_Rhythm_Doctor</span></div><div><br/></div><div>下载得到rdzip格式文件，是《节奏医生》的自制关卡文件，但因为某个图片名里的汉字字符丢失，据说在游戏中直接载入是无法载入的。不过个人习惯，游戏题能不玩游戏就尽量不玩，再说我也没买《节奏医生》……</div><div><br/></div><div>言归正传，继续将rdzip作为压缩包解压，得到 main.rdlevel 。这是一个文本（实际是json，但我太菜了不认识）。既然是音乐游戏，通常来说最适合携带隐藏信息的就是谱面。观察第47行开始的谱面信息：</div><div><img src="BUUCTF Misc 64（301-304）_files/Image [23].png" type="image/png" data-filename="Image.png"/></div><div>容易注意到，带有 AddOneshotBeat 的行才是谱面音符。可以大致将这些行分为两类：带有 &quot;squareSound&quot;: true 的，和不带的。很显然这可以携带二进制信息，事实上，如果将 squareSound 看作0，另一种行看作1，那么前8个音符就是：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>01100110</div></div><div>对应字母 f 的二进制ASCII码。</div><div><br/></div><div>但继续按该规则转码并不能得到flag格式，甚至会出现不可打印字符。考虑改进转码规则，搜索一下《节奏医生》的游戏画面，找到一张关卡编辑器截图：</div><div><img src="BUUCTF Misc 64（301-304）_files/rd.jpg" type="image/jpeg" data-filename="rd.jpg"/></div><div>注意到谱面总共有四条线，并非《太鼓达人》那样的单线。观察一下谱面信息的其他内容：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>&quot;bar&quot;: 1,</div><div>&quot;beat&quot;: 2,</div><div>&quot;y&quot;: 0,</div><div>&quot;type&quot;: &quot;AddOneshotBeat&quot;,</div><div>&quot;row&quot;: 0,</div><div>&quot;pulseType&quot;: &quot;Wave&quot;,</div><div>&quot;subdivisions&quot;: 0,</div><div>&quot;tick&quot;: 0.5 },</div></div><div>其中bar的取值从1增大到16，每个bar内beat从1增大到8，应为小节和拍（节奏医生确实是个八拍的音乐游戏）。y和row的取值都在0-3之间，很可能对应的就是谱面的四条线。尝试将音符分四条线排列后，对每条线再按前面得到的规则转码：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div># 人菜不知道json，直接当文本处理了</div><div>s = open('C:/Users/Administrator/Desktop/main.rdlevel', 'rb').readlines()</div><div><br/></div><div>res = [''] * 4</div><div>for i in range(40, len(s)):</div><div>    line = s[i].decode()</div><div>    if 'AddOneshotBeat' in line:</div><div>        row = line.split(', &quot;row&quot;: ')[1].split(',')[0] <font color="#FF0000"># 测试后发现row才是确定音符所在线的参数</font></div><div>        row = int(row)</div><div>        if '&quot;squareSound&quot;: true,' in line:</div><div>            res[row] += '0'</div><div>        elif '&quot;subdivisions&quot;: 0, &quot;tick&quot;' in line:</div><div>            res[row] += '1'</div><div><br/></div><div>for i in res:</div><div>    for j in range(0, len(i), 8):</div><div>        print(chr(int(i[j:j+8], 2)), end = '')</div><div>    print()</div></div><div>输出结果：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>flag{}</div><div>W31co}</div><div>me_V&amp;}</div><div>N_CTF}</div></div><div>每行最后都有 } ，大概是因为四条线结尾时来了个并排的01111101。手动处理下得到flag。</div><div><br/></div><div>flag：flag{W31come_V&amp;N_CTF}</div></span>
</div></body></html> 