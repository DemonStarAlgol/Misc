<html>
<head>
  <title>BUUCTF Misc 49（241-244）</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/605894 (zh-CN, DDL); Windows/6.1.1 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="813"/>
<h1>BUUCTF Misc 49（241-244）</h1>
<h2><a href="https://DemonStarAlgol.github.io/Misc/">[无关链接]</a></h2>

<div>
<span><div><span style="font-weight: bold;">241 [UTCTF2020]gb</span></div><div><br/></div><div>下载得到gb格式文件。Linux下file命令判断类型：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# file attachment.gb</div><div>attachment.gb: Game Boy ROM image: &quot;UTCTFROM&quot; (Rev.01) [ROM ONLY], ROM: 256Kbit</div></div><div>是个Gameboy的ROM。</div><div><br/></div><div>但这题根本不是普通的杂项题……首先原题内容是：<span style="font-size: unset; color: rgb(255, 0, 0); font-family: unset;">Here's a GameBoy ROM, can you dump the flag at the beginning of memory? </span><span style="font-size: unset; color: unset; font-family: unset;">也就是说要从运行中的内存里获得flag。</span><span style="font-size: unset; color: unset; font-family: unset;">其次原题的ROM似乎不是直接提供的，而是位于服务器上，需要通过连接服务器上的一个模拟器来运行。该模拟器能够接受的输入仅限于Gameboy按键，以及每次按键后持续时钟周期数。</span></div><div><span style="font-size: unset; color: unset; font-family: unset;">如果用十六进制编辑器打开附件提供的ROM也能看到，其中给出的flag仅有格式，真正的flag在服务器上的ROM中：</span></div><div><img src="BUUCTF Misc 49（241-244）_files/Image.png" type="image/png" data-filename="Image.png"/></div><div><span style="font-size: unset; color: unset; font-family: unset;">换言之，本题其实是道基于Gameboy架构，且限制了输入内容的pwn题。做不来，告辞！</span></div><div><span style="font-size: unset;"><br/></span></div><div><span style="font-size: unset; color: unset; font-family: unset;">官方Writeup：</span></div><div><a href="https://www.danbrodsky.me/writeups/utctf2020-gameboytas/">https://www.danbrodsky.me/writeups/utctf2020-gameboytas/</a></div><div><br/></div><div>flag：utflag{dmg_cool_ciAkDGw5cf}</div><div><br/></div><div><span style="font-weight: bold;">242 [UTCTF2020]icmp-file-transfer</span></div><div><br/></div><div>下载的到pcap格式文件。wireshark打开，统计-协议分级：</div><div><img src="BUUCTF Misc 49（241-244）_files/Image [1].png" type="image/png" data-filename="Image.png"/></div><div>可以看到主要有TCP、TLS、DNS、ICMP等协议。其中ICMP协议占的字节百分比高达28.4%，结合题目名称，猜测该协议流量中包含线索。过滤icmp协议：</div><div><img src="BUUCTF Misc 49（241-244）_files/Image [2].png" type="image/png" data-filename="Image.png"/></div><div>可以看到有4个长度为1066的ICMP协议数据包，其分组字节流内容均为一段类似base64编码的字符串。尝试将其开头部分解码，得到十六进制数据1F 8B 08 08和flag.png等字符串，显然是一个gzip格式压缩包。将base64编码全部提取：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>H4sICIALVl4AA2ZsYWcucG5nAO26Z1RTXRM2nIQakZZY6DUBBaRKk6aAQECKINKbKKh0kCIQIJBbbhSkSZMmCiK9gwiEgIiFEkWatIQmndATCOU93M//7/v1/ntZZy2yztp7Zs+emWuu2fvEmZnos57hOQMCgVhRBrrmIBAkCgQCP2RmBN58lTe8DfxjvGekrwuyAC2BfmtxuyFBICEQSvfGnZCxtcngV/ctm6s3iz/vIJxhZ12SLt3mqr2veyf6X6Eb55q5OBhuIr5bJn2IPpPC0MzMaHbr0nN6BjBK5xw9+Dv3s6uFLm6Zg0TBloPst6Hk0gCTXO/SlnyirftkWNjyatvKoN/kCP/URQQq5f/7GRQfC6cHfoBu0Q8zpjONYWKjxjHK4VeBVzE99KRbzjw/HQLaGHNAUnOuwDsevm66Jj1I+9gKm7OfYAYCNYAP9n9Gqlr4dH5xKxmQyOqpPMcMasHMht8HhtONUx5DWvfxZfh4XZAK3PrHVzFUylXfBAg</div><div>……（后略）</div></div><div>或者通过tshark命令来导出数据，最后<span style="font-size: unset; color: unset; font-family: unset;">在Linux下base64转码为gz格式文件：</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# tshark -r attachment.pcap -Y 'icmp.type == 0' -T fields -e data | tr -d '\n' | xxd -r -p | tr -d '\n' | base64 -d &gt; 1.gz</div></div><div>可以看到压缩包里有flag.png：</div><div><img src="BUUCTF Misc 49（241-244）_files/Image [3].png" type="image/png" data-filename="Image.png"/></div><div>但解压提示文件末端存在错误：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# gunzip 1.gz</div><div>gzip: 1.gz: unexpected end of file</div></div><div><br/></div><div>这是因为附件给出的流量数据并不完整，只接收了4个ICMP协议包，从而只能获取gzip压缩包的开头部分。按照原题的解答思路，需要从流量包中挖掘信息，自行构造与服务器的通信，取得完整数据后，再按上述步骤提取文件并得到flag。但本题的在线环境目前可能已经失效，无法抓取到数据包。此处先记录一下Writeup和最终解压得到的flag.png：</div><div><a href="https://spotless.tech/utctf-ctf-2020-nittaku-3-star-premium.html">https://spotless.tech/utctf-ctf-2020-nittaku-3-star-premium.html</a></div><div><img src="BUUCTF Misc 49（241-244）_files/flag.png" type="image/png" data-filename="flag.png"/></div><div><br/></div><div>flag：utflag{p1Ng@b13_f1aG$}</div><div><br/></div><div><span style="font-weight: bold;">243 [GWCTF2019]fun</span></div><div><br/></div><div>nc连接题目给出的靶机，发现是一个剪刀石头布的猜拳游戏：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# nc node3.buuoj.cn 27441</div><div>Welcome go GWHT!</div><div>Let's play rock-paper-scissors, if you can win me 32 times,you'll get the flag</div><div>This time I'll take p,what's your choice</div><div>s</div><div>You win!</div><div>This time I'll take p,what's your choice</div><div>s</div><div>You lose!</div><div>This time I'll take s,what's your choice</div><div>r</div><div>You win!</div><div>This time I'll take p,what's your choice</div><div>s</div><div>You lose!</div><div>This time I'll take r,what's your choice</div><div>p</div><div>You win!</div><div>This time I'll take r,what's your choice</div><div>p</div><div>You lose!</div><div>This time I'll take s,what's your choice</div><div>r</div><div>You win!</div><div>This time I'll take p,what's your choice</div><div>s</div><div>You lose!</div></div><div>需要连赢32次才能得到flag。并且每次出拳前服务端会提示下一次要出的内容，但有时候服务端会撒谎。猜测关键在于判断撒谎规律。</div><div><br/></div><div>虽然本题给出了ELF文件，可以通过逆向找到服务端撒谎规律，但实际上本题规律并不复杂，可以通过简单尝试得到。另一方面，服务端按一定规律对要出内容撒谎，但实际解题时可以转换为寻找胜负规律的变化，即“出什么才会判定为赢”，两种规律是完全等效的。以下是简要的尝试和推断过程：</div><div>1、最初的第一局胜负规则是正常的，即服务端不撒谎；</div><div>2、每次输掉后，下一局的胜负规则也是正常的，即服务端不撒谎；</div><div>3、赢了规则正常的一局后，下一局要出输给服务端提示内容的才能赢，即服务端提示剪刀则出布，依此类推；</div><div>4、赢了第3条规则的一局后，下一局要出和服务端提示内容一致的才能赢，即服务端提示布也出布，以此类推；</div><div>5、赢了第4条规则的一局后，下一局胜负规则恢复正常，即服务端不撒谎。</div><div>由此得到取胜策略：按正常→反向→相同的规则循环进行即可。</div><div><br/></div><div>写出Python脚本：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>from pwn import *</div><div>p = remote('node3.buuoj.cn', 27441)</div><div><br/></div><div>for i in range(32):</div><div>    p.recvuntil('This time I\'ll take ')</div><div>    question = p.recv(1)</div><div>    if question == b'r':</div><div>        answer = 'psr'[i % 3]</div><div>    if question == b'p':</div><div>        answer = 'srp'[i % 3]</div><div>    if question == b's':</div><div>        answer = 'rps'[i % 3]</div><div>    p.sendlineafter('what\'s your choice\n', answer)</div><div>p.interactive()</div></div><div>运行结果：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# python3 1.py</div><div>[+] Opening connection to node3.buuoj.cn on port 27441: Done</div><div>[*] Switching to interactive mode</div><div>You win!</div><div>You get the flag:</div><div>flag{cae59b9c-3eff-4725-ba82-209c2c0c5f07}</div></div><div><br/></div><div>flag：本题是动态flag，每次生成靶机flag都不一样……</div><div><br/></div><div><span style="font-weight: bold;">244 [QCTF2018]Noise</span></div><div><br/></div><div>参见<a href="https://app.yinxiang.com/shard/s39/nl/30668439/55a7ae9d-d633-44d0-8fe4-7d797143053c">攻防世界Misc高手区130题</a>。用到的原声下载地址：<a href="https://pan.baidu.com/s/15IfmophNGsKj6aeGj5-cUw">百度网盘</a>，提取码：3ywn。</div><div><br/></div><div>flag：QCTF{Th4t_1s_v3ry_Har5h}</div></span>
</div></body></html> 