<html>
<head>
  <title>BUUCTF Misc 52（253-256）</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/605894 (zh-CN, DDL); Windows/6.1.1 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="752"/>
<h1>BUUCTF Misc 52（253-256）</h1>
<h2><a href="https://DemonStarAlgol.github.io/Misc/">[无关链接]</a></h2>

<div>
<span><div><span style="font-weight: bold;">253 [SUCTF2019]homerouter</span></div><div><span style="color: rgb(255, 0, 0);">原题：ISP发给了白菜酱一台路由器，这是路由器官网上下载的固件。怎么配置这台路由器呢？你能帮白菜酱研究一下吗？ (特殊flag，以“flag-&quot;开头)</span></div><div><br/></div><div>下载得到bin格式文件，十六进制编辑器打开：</div><div><img src="BUUCTF Misc 52（253-256）_files/Image.png" type="image/png" data-filename="Image.png"/></div><div>结合题目可以判断，是OpenWRT的固件。可以用7-Zip作为压缩包打开：</div><div><img src="BUUCTF Misc 52（253-256）_files/Image [1].png" type="image/png" data-filename="Image.png"/></div><div>可以看到etc/config目录下有正常情况下固件里不存在的文件easycwmp：</div><div><img src="BUUCTF Misc 52（253-256）_files/Image [2].png" type="image/png" data-filename="Image.png"/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div># easycwmp uci configuration</div><div><br/></div><div>config local</div><div>    option interface eth0</div><div>    option port 7547</div><div>    option ubus_socket /var/run/ubus.sock</div><div>    option date_format %FT%T%z</div><div>    option username telecom</div><div>    option password &quot;nE7jA%5m&quot;</div><div>    option provisioning_code ''</div><div>#basic authentication = 'Basic', Digest authentication = 'Digest', Default value = 'Digest'</div><div>    option authentication 'Digest'</div><div>#Logging levels: Critic=0, Warning=1, Notice=2, Info=3, Debug=4</div><div>    option logging_level '3'</div><div><br/></div><div>config acs</div><div>    option url https://acs.summershrimp.com/</div><div>    option username cpe</div><div>    option password &quot;123456&quot;</div><div>    option parameter_key ''</div><div>    option periodic_enable '1'</div><div>    option periodic_interval '100'</div><div>    option periodic_time '0001-01-01T00:00:00Z'</div><div><br/></div><div>config device</div><div>    option manufacturer easycwmp</div><div>    option oui FFFFFF</div><div>    option product_class easycwmp</div><div>    option serial_number FFFFFF123456</div><div>    option hardware_version example_hw_version</div><div>    option software_version example_sw_version</div></div><div>EasyCwmp是一个CWMP协议客户端。猜测需要根据该配置文件，自行运行EasyCwmp客户端来连接服务器。可以使用qemu或软路由来运行路由器固件，然后启动客户端。</div><div><br/></div><div>后续步骤参考：<a href="https://szu17dmy.github.io/site/ctf_writeup/suctf_2019/homerouter/">https://szu17dmy.github.io/site/ctf_writeup/suctf_2019/homerouter/</a></div><div><br/></div><div>flag：flag-Hello_tr_069_Protocol</div><div><br/></div><div><span style="font-weight: bold;">254 [DDCTF2018]安全通信</span></div><div>题目：请通过nc 116.85.48.103 5002答题，mission key是2acba569d223cf7d6e48dee88378288a，agent id随意填就可以。</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>#!/usr/bin/env python</div><div>import sys</div><div>import json</div><div>from Crypto.Cipher import AES</div><div>from Crypto import Random</div><div><br/></div><div>def get_padding(rawstr):</div><div>    remainder = len(rawstr) % 16</div><div>    if remainder != 0:</div><div>        return '\x00' * (16 - remainder)</div><div>    return ''</div><div><br/></div><div>def aes_encrypt(key, plaintext):</div><div>    plaintext += get_padding(plaintext)</div><div>    aes = AES.new(key, AES.MODE_ECB)</div><div>    cipher_text = aes.encrypt(plaintext).encode('hex')</div><div>    return cipher_text</div><div><br/></div><div>def generate_hello(key, name, flag):</div><div>    message = &quot;Connection for mission: {}, your mission's flag is: {}&quot;.format(name, flag)</div><div>    return aes_encrypt(key, message)</div><div><br/></div><div>def get_input():</div><div>    return raw_input()</div><div><br/></div><div>def print_output(message):</div><div>    print(message)</div><div>    sys.stdout.flush()</div><div><br/></div><div>def handle():</div><div>    print_output(&quot;Please enter mission key:&quot;)</div><div>    mission_key = get_input().rstrip()</div><div><br/></div><div>    print_output(&quot;Please enter your Agent ID to secure communications:&quot;)</div><div>    agentid = get_input().rstrip()</div><div>    rnd = Random.new()</div><div>    session_key = rnd.read(16)</div><div><br/></div><div>    flag = '&lt;secret&gt;'</div><div>    print_output(generate_hello(session_key, agentid, flag))</div><div>    while True:</div><div>        print_output(&quot;Please send some messages to be encrypted, 'quit' to exit:&quot;)</div><div>        msg = get_input().rstrip()</div><div>        if msg == 'quit':</div><div>            print_output(&quot;Bye!&quot;)</div><div>            break</div><div>        enc = aes_encrypt(session_key, msg)</div><div>        print_output(enc)</div><div><br/></div><div>if __name__ == &quot;__main__&quot;:</div><div>    handle()</div></div><div><br/></div><div>靶机连不上……本题考察AES加密ECB模式的攻击，先记录一下Writeup：</div><div><a href="https://delcoding.github.io/2018/04/ddctf-writeup1/">https://delcoding.github.io/2018/04/ddctf-writeup1/</a></div><div><br/></div><div>flag：DDCTF{87fa2cd38a4259c29ab1af39995be81a}</div><div><br/></div><div><span style="font-weight: bold;">255 [FBCTF2019]evil</span></div><div><br/></div><div>下载得到pcap格式文件，wireshark打开：</div><div><img src="BUUCTF Misc 52（253-256）_files/Image [3].png" type="image/png" data-filename="Image.png"/></div><div>整个流量包内只有属于同一TCP流的12个数据包，TCP流内容为：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>What's the secret password then?</div><div>The word of the day is lemons.</div><div>Every Villain Is Lemons</div><div>Welcome to the club evildoer</div></div><div>结合题目名称，查询得到<a href="https://en.wikipedia.org/wiki/Evil_bit">evil bit</a>，这是2003年愚人节<a href="https://tools.ietf.org/html/rfc3514">RFC 3514</a>中提出的虚构IPv4数据包头部标记。本题需要将evil bit设置为1后重新连接靶机，服务器会返回flag。但我目前连不上靶机……</div><div><br/></div><div>记录一下Writeup：</div><div><a href="https://ptr-yudai.hatenablog.com/entry/2019/06/03/113943#misc-896pts-evil">https://ptr-yudai.hatenablog.com/entry/2019/06/03/113943#misc-896pts-evil</a></div><div><a href="https://github.com/fbsamples/fbctf-2019-challenges/tree/master/misc/evil">https://github.com/fbsamples/fbctf-2019-challenges/tree/master/misc/evil</a></div><div><br/></div><div>flag：fb{th4t5_th3_3vi1est_th1ng_!_c4n_im4g1ne}</div><div><br/></div><div><span style="font-weight: bold;">256 [INSHack2019]You Shall Not Pass</span></div><div><br/></div><div>下载得到md格式文件和dd.img。前者是题目说明：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>One of my friends is a show-off and I don't like that.</div><div>Help me find the backdoor he just boasted about! :D</div><div>You'll find an image of his USB key.</div><div>And one last thing, my friend owns `you-shall-not-pass.ctf.insecurity-insa.fr`.</div></div><div><br/></div><div>dd.img是磁盘镜像，用DiskGenius挂载：</div><div><img src="BUUCTF Misc 52（253-256）_files/Image [4].png" type="image/png" data-filename="Image.png"/></div><div>共有4个乱码命名的文件夹，每个文件夹里有3个乱码命名的无后缀名文件。除7948954c771171c2是MP4格式视频（内容是《指环王》里甘道夫 You Shall Not Pass 的片段），其他11个文件都是以 [&quot;Spicy jalapeno 开头的难以理解的文本。</div><div><br/></div><div>用strings命令查看dd.img，发现比较可疑的字符串：</div><div><img src="BUUCTF Misc 52（253-256）_files/Image [5].png" type="image/png" data-filename="Image.png"/></div><div>使用“扇区编辑”功能以十六进制模式查看镜像（或用十六进制编辑器打开也可以），定位到上述字符串，在附近找到了疑似base64编码的内容：</div><div><img src="BUUCTF Misc 52（253-256）_files/Image [6].png" type="image/png" data-filename="Image.png"/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>freeIsoMedia File Produced By Google-BGZ-H4sIAOq1yVwAA6tWUFBKyc8vUrJSMDIAAh0gvzi1sDQ1LzkVKBatAATVSgX5RSVAnqGBgSFQhVJB</div><div>UX5JPpCvFOoSoFSrg67Gkgg1RihqQpyxqSHGLjMizLEgwhxi7DIgwi4DIswxIcIcI0xzFBRiQbGT</div><div>X5CaF1+cWpyYC4ogJXdPX19XhRAPVwU3H0d3hQCfKD09PSVoNMZn5pWkFpUl5oAN1YHGNbKoaS0A</div><div>gssCMwICAAA=-EGZ-</div></div><div>开头部分直接转码得到十六进制数据1F 8B 08 00，结合BGZ和EGZ的标记，猜测是gz格式压缩包。</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# echo &quot;H4sIAOq1yVwAA6tWUFBKyc8vUrJSMDIAAh0gvzi1sDQ1LzkVKBatAATVSgX5RSVAnqGBgSFQhVJBUX5JPpCvFOoSoFSrg67Gkgg1RihqQpyxqSHGLjMizLEgwhxi7DIgwi4DIswxIcIcI0xzFBRiQbGTX5CaF1+cWpyYC4ogJXdPX19XhRAPVwU3H0d3hQCfKD09PSVoNMZn5pWkFpUl5oAN1YHGNbKoaS0AgssCMwICAAA=&quot; | base64 -d &gt; 1.gz</div></div><div>解压得到文本：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>{  &quot;door&quot;: 20000,  &quot;sequence&quot;: [    {&quot;port&quot;: 10010, &quot;proto&quot;: &quot;UDP&quot;},    {&quot;port&quot;: 10090, &quot;proto&quot;: &quot;UDP&quot;},    {&quot;port&quot;: 10020, &quot;proto&quot;: &quot;TCP&quot;},    {&quot;port&quot;: 10010, &quot;proto&quot;: &quot;UDP&quot;},    {&quot;port&quot;: 10060, &quot;proto&quot;: &quot;TCP&quot;},    {&quot;port&quot;: 10080, &quot;proto&quot;: &quot;UDP&quot;},    {&quot;port&quot;: 10010, &quot;proto&quot;: &quot;UDP&quot;},    {&quot;port&quot;: 10000, &quot;proto&quot;: &quot;TCP&quot;},    {&quot;port&quot;: 10000, &quot;proto&quot;: &quot;UDP&quot;},    {&quot;port&quot;: 10040, &quot;proto&quot;: &quot;TCP&quot;},    {&quot;port&quot;: 10020, &quot;proto&quot;: &quot;UDP&quot;}  ],  &quot;open_sesame&quot;: &quot;GIMME THE FLAG PLZ...&quot;,  &quot;seq_interval&quot;: 10,  &quot;door_interval&quot;: 5}</div></div><div>这是<a href="https://en.wikipedia.org/wiki/Port_knocking">端口碰撞/端口试探（Port knocking）</a>，是一种通过连接尝试，从外部打开原先关闭端口的方法。一旦收到正确顺序的连接尝试，防火墙就会动态打开一些特定的端口给允许尝试连接的主机。主要目的是防止攻击者通过端口扫描来找到打开的端口，因为除非发送正确的端口“敲击”序列，否则受保护的目标端口一直处于关闭状态。</div><div>结合题目中给出的域名，连接服务器后按给出的顺序“敲击”端口就能得到flag。但现在服务器已经连不上了……</div><div><br/></div><div>记录一下Writeup：</div><div><a href="https://fireshellsecurity.team/inshack-you-shall-not-pass/">https://fireshellsecurity.team/inshack-you-shall-not-pass/</a></div><div><a href="https://shawroot.cc/archives/809">https://shawroot.cc/archives/809</a></div><div><br/></div><div>flag：INSA{213dca08e606ef9e5352f4bdd8b6dd9d6c559e9ce76b674ae3739a34c5c3be37}</div></span>
</div></body></html> 