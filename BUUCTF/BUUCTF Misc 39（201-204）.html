<html>
<head>
  <title>BUUCTF Misc 39（201-204）</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/605894 (zh-CN, DDL); Windows/6.1.1 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1300"/>
<h1>BUUCTF Misc 39（201-204）</h1>
<h2><a href="https://DemonStarAlgol.github.io/Misc/">[无关链接]</a></h2>

<div>
<span><div><span style="font-weight: bold;">201 [BJDCTF 2nd]坚固性？！</span></div><div><br/></div><div>下载得到address.txt和1.sol两个文件。仔细一看是区块链题，告辞！</div><div><br/></div><div>记录一下Writeup：</div><div><a href="https://blog.csdn.net/weixin_44017838/article/details/105056399">https://blog.csdn.net/weixin_44017838/article/details/105056399</a></div><div><a href="http://imagin.vip/?p=977">http://imagin.vip/?p=977</a></div><div><br/></div><div>flag：BJD{he1lo_bl0ck_Cha1n!}</div><div><br/></div><div><span style="font-weight: bold;">202 [GWCTF2019]math</span></div><div><br/></div><div>链接靶机：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# nc node3.buuoj.cn 29387</div><div>Pass 150 levels and i will give you the flag~</div><div>====================================================</div><div>Now level 0</div><div>Math problem: 165 * 132 - 62 + 69 = ??? Give me your answer:</div></div><div>需要迅速解出算式的答案，否则会中断连接。尝试几次会发现算式都是a * b - c + d的形式。</div><div><br/></div><div>使用pwntool中的recvuntil方法：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>from pwn import *</div><div>p = remote('node3.buuoj.cn', '29387') # 这里填入靶机地址和端口</div><div>for i in range(0,150):</div><div>        math = p.recvuntil('problem: ')</div><div>        print math</div><div>        a = int(p.recvuntil('*')[:-1])</div><div>        b = int(p.recvuntil('-')[:-1])</div><div>        c = int(p.recvuntil('+')[:-1])</div><div>        d = int(p.recvuntil('=')[:-1])</div><div>        p.sendline(str(a * b - c + d))</div><div>p.interactive()</div></div><div>运行效果：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# python math.py</div><div>[+] Opening connection to node3.buuoj.cn on port 29387: Done</div><div>Pass 150 levels and i will give you the flag~</div><div>====================================================</div><div>Now level 0</div><div>Math problem:</div><div>??? Give me your answer:</div><div>Right! Continue~</div><div>Pass 150 levels and i will give you the flag~</div><div>====================================================</div><div>Now level 1</div><div>Math problem:</div><div>??? Give me your answer:</div><div>Right! Continue~</div><div>Pass 150 levels and i will give you the flag~</div><div>====================================================</div><div>Now level 2</div><div>Math problem:</div><div>??? Give me your answer:</div><div>Right! Continue~</div><div>Pass 150 levels and i will give you the flag~</div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;"><br/></span></div><div>（中略，总共出了150题）</div><div><br/></div><div>Now level 149</div><div>Math problem:</div><div>[*] Switching to interactive mode</div><div>??? Give me your answer:</div><div>Right! Continue~</div><div>Congratulation!</div><div>（接下来拿到shell，开始执行命令）</div><div>$ ls</div><div>bin</div><div>boot</div><div>dev</div><div>etc</div><div>flag</div><div>flag.txt</div><div>home</div><div>lib</div><div>lib32</div><div>lib64</div><div>media</div><div>mnt</div><div>opt</div><div>proc</div><div>pwn</div><div>root</div><div>run</div><div>sbin</div><div>srv</div><div>sys</div><div>tmp</div><div>usr</div><div>var</div><div>$ cat flag</div><div>flag{1a1ec43a-3842-441c-b0b8-2e65f7f1ef77}</div></div><div><br/></div><div>flag：flag{1a1ec43a-3842-441c-b0b8-2e65f7f1ef77}</div><div><br/></div><div><span style="font-weight: bold;">203 大流量分析（三）</span></div><div>题目：某黑客对A公司发动了攻击，以下是一段时间内我们获取到的流量包，那黑客预留的后门的文件名是什么？</div><div><br/></div><div>和之前的大流量分析（一）和（二）用的是同样的附件。在（二）中已经找到了黑客发送的钓鱼邮件，那么生成后门的时间应该晚于邮件时间。结合黑客的攻击方式是钓鱼链接，猜测后门格式应为php，因此在时间晚于钓鱼邮件的流量包中过滤并查找php文件。<span style="font-size: unset; color: unset; font-family: unset;">钓鱼邮件所在的</span><span style="font-size: unset; color: unset; font-family: unset; font-weight: bold;">数据采集D_eth0_NS_20160809_171230.pcap</span><span style="font-size: unset; color: unset; font-family: unset;">包中没有发现线索，查看时间更晚的</span><span style="font-size: unset; color: unset; font-family: unset;"><span style="font-size: unset; color: unset; font-family: unset; font-weight: bold;">数据采集D_eth0_NS_20160809_172831.pcap</span>包。</span></div><div><span style="font-size: unset; color: unset; font-family: unset;">首先导出HTTP对象，文本过滤php：</span></div><div><img src="BUUCTF Misc 39（201-204）_files/Image.png" type="image/png" data-filename="Image.png"/></div><div>注意到<span style="font-weight: bold;">20160809092842.php</span>，不但有大量访问操作，且访问来源IP与<span style="font-size: unset; color: unset; font-family: unset;">（一）中得到黑客的IP</span><span style="font-size: unset; color: unset; font-family: unset;"><span style="font-size: unset; color: unset; font-family: unset; font-weight: bold;">183.129.152.140</span>是一致的，说明该文件必然与黑客有关。但尝试后发现这还不是预留后门。</span></div><div><span style="font-size: unset; color: unset; font-family: unset;">追踪流发现，</span><span style="font-weight: bold;">20160809092842.php</span>的路径在<span style="font-weight: bold;">uploadfile/1/20160809/</span>下，应该是上传后被服务器自动重命名了。同时考虑到此类上传文件夹很可能会定期清理，一般来说不会把长期预留后门一直保留在此类路径下，而是以此为跳板，把后门隐藏在其他目录下。</div><div><img src="BUUCTF Misc 39（201-204）_files/Image [1].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div>由此总结出后门文件应有的几个特征：</div><div>1、php格式，出现时间在<span style="font-weight: bold;">20160809092842.php</span>之后；</div><div>2、被黑客IP <span style="font-size: unset; color: unset; font-family: unset; font-weight: bold;">183.129.152.140 </span>多次访问，且可能有传输参数执行命令等操作；</div><div>3、HTTP对象的主机名应当与<span style="font-weight: bold;">20160809092842.php</span>一致，也是<span style="font-weight: bold;">oa.t3sec.cc:8082</span>。</div><div>在HTTP对象中过滤php，以主机名排序，结合访问来源IP，最终筛选得到结果：</div><div><img src="BUUCTF Misc 39（201-204）_files/Image [2].png" type="image/png" data-filename="Image.png"/></div><div>文件名很有迷惑性，甚至还执行了phpinfo()，基本上可以确定是后门了。</div><div><br/></div><div>flag：flag{admin.bak.php}</div><div><br/></div><div><span style="font-weight: bold;">204 [CFI-CTF 2018]Kadyrov's Cat</span></div><div><span style="color: rgb(255, 0, 0);">原题：A man from the soviet union has sent you two strange documents. Find the identity of the man as well as his location.</span></div><div><span style="color: rgb(255, 0, 0);">Flag format is : CFI{Firstname_Lastname_of_City}</span></div><div><br/></div><div>下载得到jpeg格式文件和pdf格式文件。根据题目说明，<span style="font-size: unset; color: unset; font-family: unset;">需要知道的信息有三个：名、姓和城市。</span></div><div>先用exiftool工具查看图片信息：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# exiftool kadyrov_cat.jpeg</div><div>ExifTool Version Number         : 11.98</div><div>File Name                       : kadyrov_cat.jpeg</div><div>Directory                       : .</div><div>File Size                       : 12 kB</div><div>File Modification Date/Time     : 2020:03:05 13:20:26+00:00</div><div>File Access Date/Time           : 2020:10:18 10:20:23+00:00</div><div>File Inode Change Date/Time     : 2020:10:18 10:20:22+00:00</div><div>File Permissions                : rwxrw-rw-</div><div>File Type                       : JPEG</div><div>File Type Extension             : jpg</div><div>MIME Type                       : image/jpeg</div><div>JFIF Version                    : 1.01</div><div>Exif Byte Order                 : Big-endian (Motorola, MM)</div><div>X Resolution                    : 1</div><div>Y Resolution                    : 1</div><div>Resolution Unit                 : None</div><div>Y Cb Cr Positioning             : Centered</div><div>GPS Version ID                  : 2.3.0.0</div><div>GPS Latitude                    : 56 deg 56' 46.63&quot;</div><div>GPS Longitude                   : 24 deg 6' 18.28&quot;</div><div>Image Width                     : 276</div><div>Image Height                    : 183</div><div>Encoding Process                : Baseline DCT, Huffman coding</div><div>Bits Per Sample                 : 8</div><div>Color Components                : 3</div><div>Y Cb Cr Sub Sampling            : YCbCr4:2:0 (2 2)</div><div>Image Size                      : 276x183</div><div>Megapixels                      : 0.051</div><div><font color="#FF0000">GPS Position                    : 56 deg 56' 46.63&quot;, 24 deg 6' 18.28&quot;</font></div></div><div>得到图片拍摄地点的GPS信息，并查询得知该地点位于拉脱维亚首都里加（Riga）。</div><div>然后用PDF阅读器打开pdf文件，从属性中找到作者的姓名。</div><div><img src="BUUCTF Misc 39（201-204）_files/Image [3].png" type="image/png" data-filename="Image.png"/></div><div>最后按照题目规定的格式拼接得到flag。</div><div><br/></div><div>flag：CFI{Kotik_Kadyrov_of_Riga}</div></span>
</div></body></html> 