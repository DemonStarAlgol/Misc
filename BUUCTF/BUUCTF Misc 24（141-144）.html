<html>
<head>
  <title>BUUCTF Misc 24（141-144）</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/605894 (zh-CN, DDL); Windows/6.1.1 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1482"/>
<h1>BUUCTF Misc 24（141-144）</h1>
<h2><a href="https://DemonStarAlgol.github.io/Misc/">[无关链接]</a></h2>

<div>
<span><div><span style="font-weight: bold;">141 [HDCTF2019]你能发现什么蛛丝马迹吗</span></div><div><br/></div><div>下载得到memory.img文件。从文件名和大小（128MB）大概能猜到是内存镜像，上volatility。</div><div>查看镜像信息：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# volatility -f memory.img imageinfo</div><div>Volatility Foundation Volatility Framework 2.6</div><div>INFO    : volatility.debug    : Determining profile based on KDBG search...</div><div>          Suggested Profile(s) : <font color="#FF0000">Win2003SP0x86, Win2003SP1x86, Win2003SP2x86</font></div><div>                     AS Layer1 : IA32PagedMemoryPae (Kernel AS)</div><div>                     AS Layer2 : FileAddressSpace (/root/Desktop/memory.img)</div><div>                      PAE type : PAE</div><div>                           DTB : 0xe02000L</div><div>                          KDBG : 0x8088e3e0L</div><div>          Number of Processors : 1</div><div>     Image Type (Service Pack) : 1</div><div>                KPCR for CPU 0 : 0xffdff000L</div><div>             KUSER_SHARED_DATA : 0xffdf0000L</div><div>           Image date and time : 2019-04-25 08:43:06 UTC+0000</div><div>     Image local date and time : 2019-04-25 16:43:06 +0800</div></div><div>列举进程：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# volatility -f memory.img pslist --profile=Win2003SP2x86</div><div>Volatility Foundation Volatility Framework 2.6</div><div>Offset(V)  Name                    PID   PPID   Thds     Hnds   Sess  Wow64 Start                          Exit                          </div><div>---------- -------------------- ------ ------ ------ -------- ------ ------ ------------------------------ ------------------------------</div><div>0x81f8f020 System                    4      0     56      319 ------      0                                                              </div><div>0xfe2f8448 smss.exe                380      4      3       18 ------      0 2018-12-07 16:20:54 UTC+0000                                 </div><div>0xfe2caa60 csrss.exe               516    380     12      509      0      0 2018-12-07 16:21:00 UTC+0000                                 </div><div>0xfe304298 winlogon.exe            580    380     25      504      0      0 2018-12-07 16:21:04 UTC+0000                                 </div><div>0xfe2fdd88 services.exe            648    580     16      303      0      0 2018-12-07 16:21:05 UTC+0000                                 </div><div>0xfe2e5530 lsass.exe               660    580     38      458      0      0 2018-12-07 16:21:05 UTC+0000                                 </div><div>0xfe2f9290 vmacthlp.exe            880    648      1       26      0      0 2018-12-07 16:21:06 UTC+0000                                 </div><div>0xfe34d658 svchost.exe             932    648      6       93      0      0 2018-12-07 16:21:07 UTC+0000                                 </div><div>0xfde05020 svchost.exe             984    648     10      268      0      0 2018-12-07 16:21:07 UTC+0000                                 </div><div>0xfddf4c08 svchost.exe            1040    648     10      138      0      0 2018-12-07 16:21:08 UTC+0000                                 </div><div>0xfddeb020 svchost.exe            1072    648     15      168      0      0 2018-12-07 16:21:08 UTC+0000                                 </div><div>0xfdde9a70 svchost.exe            1096    648     79     1271      0      0 2018-12-07 16:21:08 UTC+0000                                 </div><div>0x81e5a7d0 spoolsv.exe            1668    648     14      151      0      0 2018-12-07 16:21:26 UTC+0000                                 </div><div>0xfe7385e8 msdtc.exe              1700    648     16      166      0      0 2018-12-07 16:21:26 UTC+0000                                 </div><div>0xfddb7b18 svchost.exe            1800    648      2       54      0      0 2018-12-07 16:21:27 UTC+0000                                 </div><div>0xfddb1020 svchost.exe            1848    648      2       37      0      0 2018-12-07 16:21:27 UTC+0000                                 </div><div>0xfdda8020 VGAuthService.e        1920    648      2       65      0      0 2018-12-07 16:21:28 UTC+0000                                 </div><div>0xfdc6eb18 vmtoolsd.exe            300    648      8      244      0      0 2018-12-07 16:21:36 UTC+0000                                 </div><div>0xfe3d5600 svchost.exe             484    648     16      135      0      0 2018-12-07 16:21:40 UTC+0000                                 </div><div>0xfe3d4cb0 dllhost.exe             736    648     22      239      0      0 2018-12-07 16:21:41 UTC+0000                                 </div><div>0xfe30ed88 dllhost.exe            1052    648     22      236      0      0 2018-12-07 16:21:42 UTC+0000                                 </div><div>0xfdc40638 wmiprvse.exe           1368    932      9      215      0      0 2018-12-07 16:21:44 UTC+0000                                 </div><div>0xfdc1bb18 explorer.exe           1992   1664     16      386      0      0 2018-12-07 16:21:50 UTC+0000                                 </div><div>0xfdc1ad88 vssvc.exe              2040    648      7      112      0      0 2018-12-07 16:21:51 UTC+0000                                 </div><div>0xfdbd3418 vmtoolsd.exe           1596   1992      6      166      0      0 2018-12-07 16:22:01 UTC+0000                                 </div><div>0xfdbd2110 ctfmon.exe             1840   1992      1       69      0      0 2018-12-07 16:22:01 UTC+0000                                 </div><div>0xfdbbc330 conime.exe             1792   1636      1       32      0      0 2018-12-07 16:22:16 UTC+0000                                 </div><div>0xfdba5320 wmiprvse.exe           1128    932      8      165      0      0 2018-12-07 16:22:24 UTC+0000                                 </div><div>0xfdb90930 wuauclt.exe            2224   1096      5      116      0      0 2018-12-07 16:22:44 UTC+0000                                 </div><div>0xfdb6a638 DumpIt.exe             3660   1992      1       26      0      0 2019-04-25 08:43:04 UTC+0000        </div></div><div>可以看到只有DumpIt.exe是最近创建的，但这是提取内存镜像的软件。</div><div>注意到explorer.exe的PID是1992，将其进程数据dump出来：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# volatility -f memory.img --profile=Win2003SP2x86 memdump -p 1992 -D ./</div><div>Volatility Foundation Volatility Framework 2.6</div><div>************************************************************************</div><div>Writing explorer.exe [  1992] to 1992.dmp</div></div><div>得到1992.dmp。用foremost将其分离，得到大量文件。逐个查看，发现可疑的png图像：</div><div><img src="BUUCTF Misc 24（141-144）_files/Image.png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div>首先看这张：</div><div><img src="BUUCTF Misc 24（141-144）_files/00008070.png" type="image/png" data-filename="00008070.png"/></div><div>有key和iv偏移，说明是AES或DES。然后看二维码：</div><div><img src="BUUCTF Misc 24（141-144）_files/00008058.png" type="image/png" data-filename="00008058.png"/></div><div>扫码得到：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>jfXvUoypb8p3zvmPks8kJ5Kt0vmEw0xUZyRGOicraY4=</div></div><div>这应该就是密文。</div><div>尝试后发现iv是没用的，直接用ECB模式的AES解密可以得到flag。</div><div><br/></div><div>flag：flag{F0uNd_s0m3th1ng_1n_M3mory}</div><div><br/></div><div><span style="font-weight: bold;">142 [UTCTF2020]spectogram</span></div><div><br/></div><div>下载得到wav格式文件。audacity打开，切换到频谱图：</div><div><img src="BUUCTF Misc 24（141-144）_files/Image [1].png" type="image/png" data-filename="Image.png"/></div><div>那几个圆圈都是0，我纵向拉得不够长……</div><div><br/></div><div>flag：utflag{sp3tr0gr4m0ph0n3}</div><div><br/></div><div><span style="font-weight: bold;">143 [V&amp;N2020 公开赛]内存取证</span></div><div><br/></div><div>下载得到巨大的men.raw文件。题目已经提示是内存取证，那么直接上volatility。</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# volatility -f mem.raw imageinfo</div><div>Volatility Foundation Volatility Framework 2.6</div><div>INFO    : volatility.debug    : Determining profile based on KDBG search...</div><div>          Suggested Profile(s) : Win7SP1x86_23418, Win7SP0x86, Win7SP1x86_24000, Win7SP1x86</div><div>                     AS Layer1 : IA32PagedMemoryPae (Kernel AS)</div><div>                     AS Layer2 : FileAddressSpace (/root/Desktop/mem.raw)</div><div>                      PAE type : PAE</div><div>                           DTB : 0x185000L</div><div>                          KDBG : 0x8176bbe8L</div><div>          Number of Processors : 2</div><div>     Image Type (Service Pack) : 0</div><div>                KPCR for CPU 0 : 0x8176cc00L</div><div>                KPCR for CPU 1 : 0x807ec000L</div><div>             KUSER_SHARED_DATA : 0xffdf0000L</div><div>           Image date and time : 2020-02-18 19:56:24 UTC+0000</div><div>     Image local date and time : 2020-02-19 03:56:24 +0800</div></div><div>列举进程：</div><div><img src="BUUCTF Misc 24（141-144）_files/Image [2].png" type="image/png" data-filename="Image.png"/></div><div>TrueCrypt、notepad、mspaint和iexplore比较可疑，是可能会隐藏信息的进程。</div><div>根据题目提示提取notepad.exe的进程数据：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# volatility -f mem.raw --profile=Win7SP1x86 memdump -p 3552 -D ./</div></div><div>但内容太多，找不到线索。看一下IE的浏览记录：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# volatility -f mem.raw --profile=Win7SP1x86 iehistory</div></div><div>可以找到百度网盘的访问记录：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>**************************************************</div><div>Process: 1964 explorer.exe</div><div>Cache type &quot;URL &quot; at 0x74d5500</div><div>Record length: 0x100</div><div>Location: Visited: lethal@<font color="#FF0000">https://pan.baidu.com/s/1jAVwrRzIgW1QsLHidtzY_w</font></div><div>Last modified: 2020-02-18 19:45:39 UTC+0000</div><div>Last accessed: 2020-02-18 19:45:39 UTC+0000</div><div>File Offset: 0x100, Data Offset: 0x0, Data Length: 0xa8</div><div>**************************************************</div></div><div>对应的提取码在notepad进程中，dump得到的3552.dmp用十六进制编辑器打开，搜索pan.baidu.com：</div><div><img src="BUUCTF Misc 24（141-144）_files/Image [3].png" type="image/png" data-filename="Image.png"/></div><div>提取后保存为文本文件：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>where is link?链接: https://pan.baidu.com/s/ 提取码: <font color="#FF0000">heem</font> 复制这段内容后打开百度网盘手机App，操作更方便哦</div></div><div>从而得到下一步的线索。该链接目前已经失效，BUUCTF直接提供了下一步的文件VOL。</div><div><br/></div><div>这时候突然搞到了取证大师，试用一下。“添加设备”选择mem.raw后使用“深度数据恢复”功能，然后筛选txt。</div><div><img src="BUUCTF Misc 24（141-144）_files/Image [4].png" type="image/png" data-filename="Image.png"/></div><div>很轻松找到了share.txt。当然IE浏览历史还是要去volatility里面找。</div><div><br/></div><div>回头看VOL，volatility无法读取，联想到之前得到的进程中有TrueCrypt.exe，这可能是个加密容器。添加到取证大师后也提示存在加密分区。</div><div><img src="BUUCTF Misc 24（141-144）_files/Image [5].png" type="image/png" data-filename="Image.png"/></div><div>解密需要密钥，用“工具集”内的“内存镜像解析工具”解析“TrueCrypt密钥”。</div><div><img src="BUUCTF Misc 24（141-144）_files/Image [6].png" type="image/png" data-filename="Image.png"/></div><div>解析成功，将其导出。</div><div><img src="BUUCTF Misc 24（141-144）_files/Image [7].png" type="image/png" data-filename="Image.png"/></div><div>直接使用密钥文件解密。</div><div><img src="BUUCTF Misc 24（141-144）_files/Image [8].png" type="image/png" data-filename="Image.png"/></div><div>得到的解密结果里有个key文件。</div><div><img src="BUUCTF Misc 24（141-144）_files/Image [9].png" type="image/png" data-filename="Image.png"/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>uOjFdKu1jsbWI8N51jsbWI8N5</div></div><div>联想到TrueCrypt和VeraCrypt都存在双重加密的情况，用这段字串作为密码再解密一次VOL文件。</div><div><img src="BUUCTF Misc 24（141-144）_files/Image [10].png" type="image/png" data-filename="Image.png"/></div><div>得到了一个加密压缩包。</div><div><img src="BUUCTF Misc 24（141-144）_files/Image [11].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div>接下来找压缩包的密码，可疑进程中还有最后一个mspaint.exe。首先dump进程数据：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# volatility -f mem.raw --profile=Win7SP1x86 memdump -p 2648 -D ./</div></div><div>然后<a href="https://segmentfault.com/a/1190000018813033">用Gimp查看镜像中的系统界面</a>。重命名dump结果为.data，Gimp打开时选择“原始图像数据”：</div><div><img src="BUUCTF Misc 24（141-144）_files/Image [12].png" type="image/png" data-filename="Image.png"/></div><div>出现以下界面，接下来就是调整参数使得出现可识别图像的过程：</div><div><img src="BUUCTF Misc 24（141-144）_files/Image [13].png" type="image/png" data-filename="Image.png"/></div><div>其中高度不能改太高，宽度调整到合适值后，就一直调整位移（不必精确），直到有可以识别的图像出现为止：</div><div><img src="BUUCTF Misc 24（141-144）_files/Image [14].png" type="image/png" data-filename="Image.png"/></div><div>翻转一下得到图片：</div><div><img src="BUUCTF Misc 24（141-144）_files/Image [15].png" type="image/png" data-filename="Image.png"/></div><div>得到解压密码，部分字符不清楚的，例如是1还是I还是l，可以爆破工具中用掩码跑：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>1YxfCQ6goYBD6Q</div></div><div>最后解压之前的压缩包fffflag.zip，就得到了flag。</div><div><br/></div><div>flag：RoarCTF{wm_D0uB1e_TC-cRypt}</div><div><span style="font-weight: bold; color: rgb(255, 0, 0);">（为什么flag格式是</span><span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-weight: bold; color: rgb(255, 0, 0); font-family: 微软雅黑; font-variant-caps: normal; font-variant-ligatures: normal;">RoarCTF？这题是其他比赛的原题？）</span></div><div><span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><br/></span></div><div><span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-weight: bold; color: rgb(0, 0, 0); font-family: 微软雅黑; font-variant-caps: normal; font-variant-ligatures: normal;">144 </span><span style="font-weight: bold;">[watevrCTF 2019]Evil Cuteness</span></div><div><br/></div><div>下载得到jpg格式文件，十六进制编辑器打开，文件尾后还有个zip压缩包。</div><div><img src="BUUCTF Misc 24（141-144）_files/Image [16].png" type="image/png" data-filename="Image.png"/></div><div>提取，解压，得到名为abc的无后缀名文件，实际是个文本文件，打开得到flag。</div><div><br/></div><div>flag：watevr{7h475_4c7u4lly_r34lly_cu73_7h0u6h}</div><div><br/></div></span>
</div></body></html> 