<html>
<head>
  <title>BUUCTF Misc 42（213-216）</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/605894 (zh-CN, DDL); Windows/6.1.1 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="880"/>
<h1>BUUCTF Misc 42（213-216）</h1>
<h2><a href="https://DemonStarAlgol.github.io/Misc/">[无关链接]</a></h2>

<div>
<span><div><span style="color: rgb(255, 0, 0); font-weight: bold;">213 [CFI-CTF 2018]Windows_XP_mem_part_1</span></div><div><br/></div><div><span style="color: rgb(255, 0, 0);">因为比赛官方在将赛题上传github时使用了Git LFS大文件扩展，所以github上的文件只有指针，实际的文件并没有被上传，使用git lfs clone时会提示服务器上找不到文件，导致下载不到真实的题目。BUUCTF上的附件下载下来也只有Git LFS指针，在找到有效的题目文件下载之前，这题大概没法做了……</span></div><div><br/></div><div><span style="color: rgb(255, 0, 0);">根据</span><a href="https://github.com/CFI-UL/2018-CFI-CTF/tree/master/windows_xp_mem_part1" style="color: rgb(255, 0, 0);">官方Writeup</a><span style="color: rgb(255, 0, 0);">，本题给出的是WinXP系统的内存镜像，需要用volatility的notepad插件来查看当前展示的文本。</span></div><div><span style="color: rgb(255, 0, 0);">等找到题目文件下载后再来做。</span></div><div><br/></div><div><span style="color: rgb(255, 0, 0);">flag：CFI{Notepad_0riana_secret_is_ins3cur3}</span></div><div><br/></div><div><span style="font-weight: bold;">214 Weird_List</span></div><div><br/></div><div>下载得到weirdlist文件，实际上是个文本：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>[120]</div><div>[120]</div><div>[24, 1, 87, 1, 7]</div><div>[7, 1, 15, 1, 21, 1, 16, 1, 49, 1, 7]</div><div>[2, 1, 1, 1, 2, 1, 15, 1, 4, 1, 3, 1, 1, 1, 10, 1, 16, 1, 4, 1, 1, 1, 2, 1, 1, 1, 19, 1, 7, 1, 1, 1, 2, 1, 1, 1, 3, 1, 6]</div><div>[2, 1, 1, 1, 3, 1, 14, 1, 3, 1, 1, 1, 2, 1, 1, 1, 10, 1, 16, 1, 4, 1, 1, 1, 2, 1, 1, 1, 18, 1, 8, 1, 1, 1, 2, 1, 1, 1, 4, 1, 5]</div><div>[2, 1, 1, 1, 3, 1, 14, 1, 3, 1, 1, 1, 2, 1, 1, 1, 10, 1, 16, 1, 4, 1, 1, 1, 2, 1, 1, 1, 17, 1, 1, 1, 7, 1, 1, 1, 2, 1, 1, 1, 4, 1, 5]</div><div>[2, 1, 5, 1, 14, 1, 3, 1, 1, 1, 4, 1, 10, 1, 16, 1, 7, 1, 4, 1, 16, 1, 1, 1, 7, 1, 2, 1, 4, 1, 3, 1, 5]</div><div>[2, 1, 5, 1, 14, 1, 3, 1, 2, 1, 4, 1, 9, 1, 16, 1, 7, 1, 4, 1, 16, 1, 1, 1, 10, 1, 4, 1, 3, 1, 5]</div><div>[2, 1, 5, 1, 3, 1, 1, 1, 2, 1, 5, 1, 3, 1, 2, 1, 4, 1, 1, 1, 5, 1, 1, 1, 2, 1, 9, 1, 3, 1, 2, 1, 4, 1, 4, 1, 1, 1, 1, 1, 7, 1, 1, 1, 4, 1, 3, 1, 6, 1, 4, 1, 3, 1, 5]</div><div>[2, 1, 5, 1, 3, 1, 1, 1, 2, 1, 1, 1, 3, 1, 3, 1, 2, 1, 3, 1, 2, 1, 4, 1, 1, 1, 2, 1, 1, 1, 7, 1, 1, 1, 2, 1, 1, 1, 5, 1, 4, 1, 1, 1, 1, 1, 7, 1, 1, 1, 4, 1, 3, 1, 1, 1, 4, 1, 4, 1, 3, 1, 5]</div><div>[2, 1, 5, 1, 3, 1, 1, 1, 2, 1, 1, 1, 3, 1, 3, 1, 2, 1, 3, 1, 2, 1, 4, 1, 1, 1, 2, 1, 9, 1, 4, 1, 1, 1, 5, 1, 3, 1, 2, 1, 2, 1, 6, 1, 2, 1, 3, 1, 2, 1, 2, 1, 4, 1, 4, 1, 3, 1, 5]</div><div>[2, 1, 1, 1, 3, 1, 5, 1, 2, 1, 1, 1, 3, 1, 3, 1, 2, 1, 2, 1, 8, 1, 1, 1, 2, 1, 9, 1, 4, 1, 1, 1, 4, 1, 3, 1, 6, 1, 6, 1, 2, 1, 3, 1, 2, 1, 2, 1, 4, 1, 2, 1, 5, 1, 5]</div><div>[2, 1, 1, 1, 3, 1, 6, 1, 1, 1, 1, 1, 2, 1, 4, 1, 1, 1, 3, 1, 3, 1, 4, 1, 1, 1, 2, 1, 9, 1, 4, 1, 1, 1, 4, 1, 3, 1, 6, 1, 6, 1, 2, 1, 3, 1, 2, 1, 2, 1, 3, 1, 3, 1, 5, 1, 5]</div><div>[2, 1, 5, 1, 6, 1, 1, 1, 4, 1, 4, 1, 1, 1, 3, 1, 3, 1, 4, 1, 2, 1, 1, 1, 9, 1, 4, 1, 6, 1, 3, 1, 6, 1, 6, 1, 2, 1, 3, 1, 2, 1, 2, 1, 3, 1, 3, 1, 1, 1, 4, 1, 4]</div><div>[2, 1, 5, 1, 3, 1, 1, 1, 2, 1, 4, 1, 4, 1, 1, 1, 4, 1, 2, 1, 4, 1, 2, 1, 1, 1, 9, 1, 4, 1, 6, 1, 4, 1, 3, 1, 1, 1, 6, 1, 2, 1, 3, 1, 2, 1, 2, 1, 3, 1, 5, 1, 3, 1, 5]</div><div>[2, 1, 5, 1, 3, 1, 1, 1, 2, 1, 5, 1, 3, 1, 1, 1, 5, 1, 2, 1, 3, 1, 2, 1, 2, 1, 9, 1, 3, 1, 1, 1, 3, 1, 6, 1, 1, 1, 1, 1, 7, 1, 2, 1, 3, 1, 2, 1, 2, 1, 3, 1, 5, 1, 3, 1, 5]</div><div>[2, 1, 5, 1, 3, 1, 2, 1, 1, 1, 5, 1, 4, 1, 1, 1, 4, 1, 1, 1, 4, 1, 2, 1, 2, 1, 9, 1, 3, 1, 1, 1, 3, 1, 6, 1, 1, 1, 2, 1, 6, 1, 2, 1, 3, 1, 2, 1, 2, 1, 2, 1, 6, 1, 3, 1, 5]</div><div>[2, 1, 5, 1, 3, 1, 2, 1, 1, 1, 5, 1, 6, 1, 4, 1, 6, 1, 2, 1, 3, 1, 9, 1, 2, 1, 1, 1, 3, 1, 6, 1, 1, 1, 2, 1, 6, 1, 2, 1, 3, 1, 2, 1, 2, 1, 2, 1, 6, 1, 3, 1, 5]</div><div>[2, 1, 5, 1, 3, 1, 1, 1, 2, 1, 1, 1, 3, 1, 6, 1, 4, 1, 1, 1, 4, 1, 2, 1, 4, 1, 9, 1, 1, 1, 1, 1, 3, 1, 6, 1, 1, 1, 2, 1, 6, 1, 2, 1, 3, 1, 2, 1, 2, 1, 2, 1, 6, 1, 3, 1, 5]</div><div>[2, 1, 5, 1, 3, 1, 1, 1, 2, 1, 1, 1, 3, 1, 5, 1, 5, 1, 6, 1, 1, 1, 5, 1, 9, 1, 1, 1, 1, 1, 2, 1, 7, 1, 1, 1, 2, 1, 6, 1, 2, 1, 3, 1, 2, 1, 2, 1, 1, 1, 7, 1, 3, 1, 5]</div><div>[2, 1, 5, 1, 3, 1, 1, 1, 2, 1, 1, 1, 3, 1, 5, 1, 4, 1, 2, 1, 1, 1, 2, 1, 1, 1, 17, 1, 2, 1, 1, 1, 6, 1, 2, 1, 1, 1, 7, 1, 2, 1, 3, 1, 2, 1, 2, 1, 1, 1, 4, 1, 2, 1, 3, 1, 5]</div><div>[2, 1, 5, 1, 1, 1, 1, 1, 1, 1, 2, 1, 1, 1, 3, 1, 3, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 7, 1, 1, 1, 2, 1, 2, 1, 1, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 7, 1, 1, 1, 3, 1, 1, 1, 1, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 4, 1, 5]</div><div>[2, 1, 6, 1, 2, 1, 2, 1, 1, 1, 5, 1, 3, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 7, 1, 1, 1, 2, 1, 2, 1, 1, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 7, 1, 1, 1, 3, 1, 1, 1, 2, 1, 3, 1, 1, 1, 2, 1, 1, 1, 4, 1, 5]</div><div>[12, 1, 5, 1, 4, 1, 4, 1, 3, 1, 10, 1, 4, 1, 9, 1, 14, 1, 4, 1, 8, 1, 1, 1, 8, 1, 9, 1, 4, 1, 6]</div><div>[19, 1, 4, 1, 62, 1, 24, 1, 7]</div><div>[19, 1, 4, 1, 62, 1, 24, 1, 7]</div><div>[17, 1, 1, 1, 31, 1, 1, 1, 1, 1, 25, 1, 1, 1, 1, 1, 1, 1, 32]</div><div>[17, 1, 1, 1, 31, 1, 1, 1, 1, 1, 25, 1, 1, 1, 1, 1, 1, 1, 32]</div><div>[17, 1, 1, 1, 67, 1, 32]</div><div>[120]</div><div>[21, 1, 1, 1, 1, 1, 86, 1, 1, 1, 1, 1, 3]</div><div>[120]</div><div>[120]</div></div><div>观察特征：</div><div>1、开头和结尾两行及中间某一行为[120]；</div><div>2、其他行均包含奇数个数字，且第偶数位数字必然为1；</div><div>3、其他行的所有数字加起来均等于120。</div><div><br/></div><div>考虑以下转换方式：</div><div>1、生成图片，共34行，每行有120个像素；</div><div>2、每行以白色开始，原始文本中每行第一个数字是连续的白色像素的个数；</div><div>3、偶数位的1表示连续的白色后有1个黑色像素，接下来仍为连续的白色，个数由奇数位的数字决定。</div><div>例如[17, 1, 1, 1, 67, 1, 32]，即17白、1黑、1白、1黑、67白、1黑、32白。</div><div><br/></div><div>写脚本将其转换：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>from PIL import Image</div><div><br/></div><div>f = open('C:/Users/Administrator/Desktop/weirdlist', 'r').readlines()</div><div>img = Image.new('RGB', (120, 34))</div><div><br/></div><div>for i in range(len(f)):</div><div>    m = f[i][1:-2].split(', ')</div><div>    t = ''</div><div>    n = 0</div><div>    for j in m:</div><div>        t += str(n) * int(j)</div><div>        n = (n + 1) % 2</div><div>    for j in range(len(t)):</div><div>        if t[j] == '0':</div><div>            img.putpixel((j, i), (255, 255, 255))</div><div>        elif t[j] == '1':</div><div>            img.putpixel((j, i), (0, 0, 0))</div><div><br/></div><div>img.show()</div></div><div>得到结果（已放大）：</div><div><img src="BUUCTF Misc 42（213-216）_files/Image.png" type="image/png" data-filename="Image.png"/></div><div>接下来靠强大的视力和想象力得到flag。</div><div><br/></div><div>flag：flag{93ids_sk23a_p1o23}</div><div><br/></div><div><span style="font-weight: bold;">215 [SCTF2019]Maze</span></div><div><br/></div><div>下载得到Maze.html和Readme.txt。后者是flag格式说明：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>flag{md5(length)}</div></div><div>前者则是一个迷宫：</div><div><img src="BUUCTF Misc 42（213-216）_files/Image [1].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div>大概意思是求出迷宫里距离最大的两点，将其距离md5后得到flag。接下来开始抄<a href="https://www.anquanke.com/post/id/181019">Writeup</a>：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>把html处理一下，然后任意取一个点作为起点，扔到dfs里跑最长路径，等跑不动的时候拿当前最长路径的重点作为起点再扔进去跑，来回几次就得到4056了。</div></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div># 处理html部分</div><div>from bs4 import BeautifulSoup</div><div>from collections import deque</div><div>import re</div><div><br/></div><div>with open('C:/Users/Administrator/Desktop/Maze.html', 'r') as file:</div><div>    html_doc = file.read()</div><div>    soup = BeautifulSoup(html_doc, 'html.parser')</div><div>    lattice = soup.find_all('td')</div><div>    pattern = re.compile(r'border-([a-z]+):')</div><div>    maze = []</div><div>    for j in range(100):</div><div>        temp1 = []</div><div>        for i in range(j * 100, j * 100 + 100):</div><div>            temp = ''</div><div>            result = pattern.findall(str(lattice[i]))</div><div>            print(result)</div><div>            if 'top' not in result:</div><div>                temp += 'u'</div><div>            if 'bottom' not in result:</div><div>                temp += 'd'</div><div>            if 'right' not in result:</div><div>                temp += 'r'</div><div>            if 'left' not in result:</div><div>                temp += 'l'</div><div>            temp1.append(temp)</div><div>        maze.append(temp1)</div><div><br/></div><div># bfs部分</div><div>move = {'u': (-1, 0), 'd': (1, 0), 'l': (0, -1), 'r': (0, 1)}</div><div>queue = deque()</div><div><font color="#FF0000">queue.append(((0, 0), 0))</font></div><div>visited = []</div><div>ans = 0</div><div>ansv = ()</div><div>while queue:</div><div>    v, res = queue.popleft()</div><div>    if res &gt; ans:</div><div>        ans = res</div><div>        ansv = v</div><div>    if v not in visited:</div><div>        visited.append(v)</div><div>        for adj in maze[v[0]][v[1]]:</div><div>            queue.append(((v[0] + move[adj][0], v[1] + move[adj][1]), res + 1))</div><div>print(ansv, ans)</div></div><div><br/></div><div>注意标红的行，用于指定起点。先以(0,0)为起点运行得到最长路径另一端为(80, 92)。然后重新以(80, 92)为起点运行，得到最长路径另一端为(70, 21)且最长路径为4056（脚本运行结果要加上1）。</div><div>计算4056的md5值得到flag。</div><div><br/></div><div>flag：sctf{9529fbba677729d3206b3b9073d1e9ca}</div><div><br/></div><div><span style="font-weight: bold;">216 [HarekazeCTF2019]A_Z</span></div><div><br/></div><div>注意：本题的靶机不是用nc连的，直接http访问即可。</div><div><img src="BUUCTF Misc 42（213-216）_files/Image [2].png" type="image/png" data-filename="Image.png"/></div><div>源码：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>const express = require('express');</div><div>const path = require('path');</div><div>const vm = require('vm');</div><div><br/></div><div>const app = express();</div><div><br/></div><div>app.set('views', path.join(__dirname, 'views'));</div><div>app.set('view engine', 'pug');</div><div><br/></div><div>app.use(express.static(path.join(__dirname, 'public')));</div><div><br/></div><div>app.get('/', function (req, res, next) {</div><div>  let output = '';</div><div>  const code = req.query.code + '';</div><div>  if (code &amp;&amp; code.length &lt; 200 &amp;&amp; !/[^a-z().]/.test(code)) {</div><div>    try {</div><div>      const result = vm.runInNewContext(code, {}, { timeout: 500 });</div><div><font color="#FF0000">      if (result === 1337) {</font></div><div><font color="#FF0000">        output = process.env.FLAG;</font></div><div>      } else {</div><div>        output = 'nope';</div><div>      }</div><div>    } catch (e) {</div><div>      output = 'nope';</div><div>    }</div><div>  } else {</div><div>    output = 'nope';</div><div>  }</div><div>  res.render('index', { title: '[a-z().]', output });</div><div>});</div><div><br/></div><div>app.get('/source', function (req, res) {</div><div>  res.sendFile(path.join(__dirname, 'app.js'));</div><div>});</div><div><br/></div><div>module.exports = app;</div></div><div>也即，只能以a-z字母和().三种符号构成Javascript代码，执行结果应为1337。<span style="font-size: unset; color: unset; font-family: unset;">参考</span><a href="https://ctftime.org/writeup/15328" style="font-size: unset; font-family: unset;">Writeup</a><span style="font-size: unset; color: unset; font-family: unset;">：</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>escape.name.concat(eval.length).repeat(eval.name.concat(eval).repeat(eval.name.concat(eval.length).length).concat(escape.name).length)</div></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>escape.name.concat(eval.length).repeat(escape(escape(escape(escape(escape(escape(escape(unescape))))))).length)</div></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>console.profile.name.repeat(escape(escape(eval).sup().bold().link().link()).length).length (90 characters)</div></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>escape(escape(eval).repeat(escape.name.sup().length)).concat(eval.name.link()).length</div></div><div><br/></div><div>flag：本题是动态flag，每次生成靶机flag都不一样……</div><div>（而且本题flag是重新部署过的，和比赛原题不同。）</div></span>
</div></body></html> 