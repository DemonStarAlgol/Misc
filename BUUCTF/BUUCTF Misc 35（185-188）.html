<html>
<head>
  <title>BUUCTF Misc 35（185-188）</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/605894 (zh-CN, DDL); Windows/6.1.1 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1355"/>
<h1>BUUCTF Misc 35（185-188）</h1>
<h2><a href="https://DemonStarAlgol.github.io/Misc/">[无关链接]</a></h2>

<div>
<span><div><span style="font-weight: bold;">185 [BSidesSF2019]thekey</span></div><div><br/></div><div>下载得到pcapng格式文件。wireshark打开，发现全都是USB协议流量，从数据特征看应该是USB键盘输入数据。</div><div>如果直接用Python脚本提取按键记录，会报错，这是因为文件内不止有一个USB设备的数据包。可以看到，设备地址有1.69.0、1.62.0、1.6.0、1.69.1等多个。</div><div><img src="BUUCTF Misc 35（185-188）_files/Image.png" type="image/png" data-filename="Image.png"/></div><div>大致观察一下，会发现与host传输数据最多的地址是1.69.1，将其过滤出来。</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>usb.src == &quot;1.69.1&quot;</div></div><div>然后文件-导出特定分组，保存为1.69.1.pcapng文件。接着上脚本：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# python UsbKeyboardDataHacker-new.py 1.69.1.pcapng</div><div>Running as user &quot;root&quot; and group &quot;root&quot;. This could be dangerous.</div><div>[-] Unknow Key : 04</div><div>[-] Unknow Key : 04</div><div>[-] Unknow Key : 04</div><div>[+] Found : viim&lt;SPACE&gt;flaag.ttxt&lt;RET&gt;iTthe&lt;SPACE&gt;flaag&lt;SPACE&gt;is&lt;SPACE&gt;ctf&lt;ESC&gt;vbUuA{[my_favoritte_editor_is_vim}&lt;ESC&gt;hhhhhhhhhhhhhhhhhhhau&lt;ESC&gt;vi{U&lt;ESC&gt;&quot;;wq&lt;RET&gt;</div></div><div>排除掉部分重复字母，然后修复favourite里丢失的u，最后尝试一下发现是大写，得到flag。</div><div><br/></div><div>flag：CTF{MY_FAVOURITE_EDITOR_IS_VIM}</div><div><br/></div><div><span style="font-weight: bold;">186 [watevrCTF 2019]Polly</span></div><div><br/></div><div>下载得到txt格式文件。整理一下：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>-510233931851656757*x**56/710998587804863451854045647463724949736497978881168458687447040000000000000</div><div> + 28538582555324529581*x**55/25392806707316551851930201695133033919160642102898873524551680000000000000</div><div> - </div><div>361611288555263491*x**54/421055535502492258043032818391295177534479825940370161664000000000000</div><div> + </div><div>2189223797409040145903*x**53/5129859940872030677157616504067279579628412546040176469606400000000000</div><div> - </div><div>3001755643562030554208767*x**52/19357962041026530857198552845536904074069481305811986677760000000000000</div><div> + </div><div>78238787580756843015401*x**51/1781188998990295441405829301208769237584604463177400320000000000000</div><div> - </div><div>116104436553238240592813791*x**50/11496527230247656900485565886772482623174748513067073536000000000000</div><div> + </div><div>127279887341335237997305957*x**49/65694441315700896574203233638699900703855705788954705920000000000</div><div> - </div><div>20305349569334865003353693141*x**48/64170394447571083344765063383345446352972606387257344000000000000 + 755344461848261566273335985217*x**47/16909766104427515205715118053719408160580619250696192000000000000 - 8730828190255482707329907709523*x**46/1583041933180448232024394030560965870352228185171558400000000000 + 76555149545632714960652198194597*x**45/127331633755818662141092563327729863484853136633364480000000000 - 1602375720398047527703588216319184983*x**44/27479475110939521552978869398000199787640242135105536000000000000</div><div> + </div><div>114295162137526589722365996075069211717*x**43/22572425983986035561375499862643021254133056039550976000000000000</div><div> - </div><div>13848681865733026134505571948717935637*x**42/34996009277497729552520154825803133727338071379148800000000000</div><div> + </div><div>153346974308020314565759178978111441*x**41/5485267911833499929862093232884503719018506485760000000000</div><div> - </div><div>520024520896904430645934556087134499251423*x**40/290210808642664098728215918067635743104754738266112000000000000</div><div> + </div><div>583372437848702106759949552819801879184581*x**39/5580977089282001898619536885916071982783744966656000000000000</div><div> - </div><div>46031013908208473758789005123614987736509587*x**38/8272977802935673402659548795593236115655904303513600000000000</div><div> + </div><div>7353657867840940108498978410191786786833213*x**37/27150699353263793020311260526078188024353353891840000000000</div><div> - </div><div>92499773752352276492046888338669680452103462189*x**36/7657889561176967262139073481714360724817612636160000000000000</div><div> + </div><div>4100551582505375935469899571343423946185109603489*x**35/8296047024608381200650662938523890785219080355840000000000000</div><div> - </div><div>1895954357110172205089772212408286791708615900917*x**34/102036942013899875729927939885587961529432539136000000000000</div><div> + </div><div>43118050173835025743884479345094473671998423653*x**33/67129567114407812980215749924728922058837196800000000000</div><div> - </div><div>22765966699209423168314620580071311613337850078228970157*x**32/1114243406791786642970813103550620539901403327365120000000000000</div><div> + </div><div>2164682230392596021581197470695955891436192181935306391*x**31/3617673398674631957697445141398118636043517296640000000000000</div><div> - </div><div>920699702649221064972928655611480860602416008467275417*x**30/57052913814223586429637127677963161285274107904000000000000</div><div> + </div><div>686056125302514633652788467458025065050820545750401507*x**29/1711587414426707592889113830338894838558223237120000000000</div><div> - </div><div>3138304869574821781724911760498738183508227936479448972609*x**28/342317482885341518577822766067778967711644647424000000000000</div><div> + </div><div>1270675513242488953141124524513884117237971552020405481903*x**27/6583028517025798434188899347457287840608550912000000000000</div><div> - </div><div>35251878159156858646651490873547468067999378927697697003224477*x**26/9428213442084348517445341645428327645319566616166400000000000</div><div> + </div><div>640581045258286772319400657438117285194045922802459043053203*x**25/9620625961310559711678920046355436372775067975680000000000</div><div> - </div><div>72656459972106788902891971241582058202821865848124369081172639*x**24/66716462086011457208029806848269051769244352512000000000000</div><div> + </div><div>154039473157326645352130477125406816808322554770621702623189519*x**23/9427326164327705909830298793777148619567136768000000000000</div><div> - </div><div>1082910009287427089558040173029448590098449209287440350613671*x**22/4822161720883737038276367669451226915379609600000000000</div><div> + </div><div>24188920823778246702349239533423129779289240972762319245699197*x**21/8570296513025187190754817085251953290515578880000000000</div><div> - </div><div>2312064026649698678901994207690698059469649821996032406197587664228741*x**20/71419066189405618046396886086957233654685736370176000000000000</div><div> + </div><div>862370556128011088565191676373092759230061876592574879284609935706793*x**19/2550680935335914930228460217391329773381633441792000000000000</div><div> - </div><div>32072107483702086982352528206453150709858865925578274033380368180437*x**18/10002670334650646785209647911338548130908366438400000000000</div><div> + </div><div>1529698138827681013559573339316154298621053459717691815776842419379*x**17/55570390748059148806720266174103045171713146880000000000</div><div> - </div><div>222611348623707141383036923098732823232255364898093370342989110678452081*x**16/1044260259473944837992951668521686390518442885120000000000000</div><div> + </div><div>19351471406694225111369749822067705924291211128650839886054241035573*x**15/13048686203253171864759230125976987935703040000000000000</div><div> - </div><div>788448884149338619773551061237815179858025448137798058040565357883017969*x**14/85480045326791055697402842485438742223090876416000000000000</div><div> + </div><div>1073836757430890424151052096696872926581023064319957457780403520628397*x**13/21054198356352476772759320809221365079579033600000000000</div><div> - </div><div>13037261936583491232564987358021148191312145269662640728042654537466177*x**12/52337322240932848864901859644270462537564160000000000000</div><div> + </div><div>193553176960028089077524490434690010049391798907017144709511622501501*x**11/181523857324358216783809467780676473323520000000000000</div><div> - </div><div>68187858129806282947338026458215966993811977794098721136854363544114709*x**10/17205436276727086314158740721145118396514304000000000000</div><div> + </div><div>8945934592679151193925448392874011400632217576523903097012117504044751*x**9/707334602487669104026526007424854867412254720000000000</div><div> - </div><div>1869710221567968463761175994053678221652715546983576126590166640405599343*x**8/54712331502421205196451786674312523994337902592000000000</div><div> + </div><div>150097834583670559919903774847355537654811358204762610127392287652832711*x**7/1954011839372185899873278095511161571226353664000000000</div><div> - </div><div>887795495236087230655513134787312551397755543548982957604351894153*x**6/6324332742830674887191952972548659841433600000000</div><div> + </div><div>325850556958534026053020666873255701298636569528110069255986051*x**5/1611756757211697568252622935684799553945600000</div><div> - </div><div>1383255113415521659958099444243664043564187251342510179583421*x**4/6303358038091792437823864786842855398400000</div><div> + </div><div>1288933044552801369576288324542563196552750611910520778643*x**3/7696407860917939484522423427158553600000</div><div> - </div><div>58143815812249254268696937296354052881595701176023*x**2/732857216672564586715802770080000</div><div> + </div><div>76949958412245985708257714245417562997*x/4439171857433454741600</div><div> + </div><div>119</div></div><div>显然是一段56次多项式。观察发现一些可疑的地方：每项参数中的除数末尾都有大量的0，同时该多项式有常数项（说明与函数图像无关，否则有无常数项并不影响）。</div><div>既然与图像无关，考虑从数值方面入手，尝试计算该多项式在一些整点的值：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>from sympy import *</div><div>f = open('C:/Users/Administrator/Desktop/attachment.txt', 'r').read()</div><div><br/></div><div>x = symbols('x')</div><div>y = eval(f)</div><div>for i in range(100):</div><div>    print(i, y.subs(x, i))</div></div><div>输出结果：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>0 119</div><div>1 97</div><div>2 116</div><div>3 101</div><div>4 118</div><div>5 114</div><div>6 123</div><div>7 112</div><div>8 111</div><div>9 108</div><div>10 108</div><div>11 121</div><div>12 95</div><div>13 112</div><div>14 111</div><div>15 108</div><div>16 121</div><div>17 110</div><div>18 111</div><div>19 109</div><div>20 105</div><div>21 97</div><div>22 108</div><div>23 115</div><div>24 95</div><div>25 121</div><div>26 111</div><div>27 117</div><div>28 116</div><div>29 117</div><div>30 98</div><div>31 101</div><div>32 46</div><div>33 99</div><div>34 111</div><div>35 109</div><div>36 47</div><div>37 119</div><div>38 97</div><div>39 116</div><div>40 99</div><div>41 104</div><div>42 63</div><div>43 118</div><div>44 61</div><div>45 84</div><div>46 72</div><div>47 78</div><div>48 87</div><div>49 86</div><div>50 86</div><div>51 110</div><div>52 57</div><div>53 74</div><div>54 79</div><div>55 48</div><div>56 125</div><div>57 -1093431186431841622</div><div>58 -61079476773298862913</div><div>59 -1737822959858823093678</div><div>60 -33565286464923541413606</div><div>61 -494926852613813545142860</div><div>62 -5940639497935290533257965</div><div>63 -60443568420283747987652201</div><div>64 -536027875472355136115282891</div><div>65 -4228314503704978085182071403</div><div>66 -30130222195117974946230240610</div><div>67 -196320610602115777979517616183</div><div>68 -1181152464847184510846963710936</div><div>69 -6614763876789829475257568967624</div><div>70 -34714378977862355738833053062597</div><div>71 -171697654755282813587570654664524</div><div>72 -804266883696151169456833848472377</div><div>73 -3583061932334444613904451137611760</div><div>74 -15238166877674727250606428654905150</div><div>75 -62065467241031259545424680538930841</div><div>76 -242806810972506152751086261429159741</div><div>77 -914712942212190718571781188615316404</div><div>78 -3326032501506446777150855341701042595</div><div>79 -11697464206254970547064281068292293096</div><div>80 -39865852883735490881662278313778579191</div><div>81 -131886629745042874055366307721222634890</div><div>82 -424201451024859036487096325526168742007</div><div>83 -1328431939960551356636852260808910793945</div><div>84 -4055793107199767800289984818333018357459</div><div>85 -12086769091228240848300079553562306999017</div><div>86 -35199067314395353481737715634714261909510</div><div>87 -100274670240849477696829316020522507220547</div><div>88 -279711859118869365707644764680217175618877</div><div>89 -764682873018964174633422206863065332861685</div><div>90 -2050537222569742563764675668938472955732853</div><div>91 -5397725948243625405550684796029589475581781</div><div>92 -13958225359508416136540624397624033588272168</div><div>93 -35483402697366401904384325452995834851405021</div><div>94 -88731397017791177346837342709462463916852296</div><div>95 -218399211357979828757211329037454855194168543</div><div>96 -529414567908772866429475385864893776527348076</div><div>97 -1264582270764180550162754264855250929847023897</div><div>98 -2978015666547336768335203152169396368020719471</div><div>99 -6917447171577193848388852496402654641842600063</div></div><div>可以看到，当x取0-56之间的整数值时，多项式的值也为较小正整数，注意到这些值都在十进制ASCII可打印字符范围内。将其转码为字符：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>for i in range(57):</div><div>    print(chr(y.subs(x, i)), end = '')</div></div><div>输出：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>watevr{polly_polynomials_youtube.com/watch?v=THNWVVn9JO0}</div></div><div>访问了一下<a href="http://youtube.com/watch?v=THNWVVn9JO0">youtube.com/watch?v=THNWVVn9JO0</a>这个地址，但没有进一步的信息，看来这段就是flag了。</div><div><br/></div><div>flag：watevr{polly_polynomials_youtube.com/watch?v=THNWVVn9JO0}</div><div><br/></div><div><span style="font-weight: bold;">187 [NPUCTF2020]签到</span></div><div><br/></div><div>下载得到Game_Box文件夹。看文件结构，应该是MineCraft的世界数据。<span style="font-size: unset; color: unset; font-family: unset;">因为不会玩，只能抄一下Writeup了……</span></div><div>以下内容来自<a href="https://shimo.im/docs/6hyIjGkLoRc43JRs">官方Writeup</a>：</div><div><br/></div><div>进入游戏后，按照指引可以看到有一个开关和红石灯，打开开关后红石灯开始闪烁。</div><div><img src="BUUCTF Misc 35（185-188）_files/LO07vQvDwj7qVYle__thumbnail.png" type="image/png" data-filename="LO07vQvDwj7qVYle__thumbnail.png"/></div><div>经过分析可知，红石灯有两种状态，常亮和短亮，故猜测其代表的是二进制值短亮为0，常亮为1，可得出序列：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>001110010110000100111001</div></div><div>根据题目字符串提示，将其转为字符串为：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>9a9</div></div><div>计算其MD5为8F108D05D23041B5866F9CB2FF109661，包裹Flag格式为：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>npuctf{8F108D05D23041B5866F9CB2FF109661}</div></div><div><br/></div><div>如果不想等待红石灯闪烁可以去进行电路分析，按照开关线路，第一部分产生红石脉冲信号。</div><div><img src="BUUCTF Misc 35（185-188）_files/rTcnKBTQUu5QE3u7__thumbnail.png" type="image/png" data-filename="rTcnKBTQUu5QE3u7__thumbnail.png"/></div><div>第二部分控制活塞推动方块。</div><div><img src="BUUCTF Misc 35（185-188）_files/LyY1Oi7tk44K5d3T__thumbnail.png" type="image/png" data-filename="LyY1Oi7tk44K5d3T__thumbnail.png"/></div><div>第三部分异或门。异或门输出取反即为石灯的信号输入。</div><div><img src="BUUCTF Misc 35（185-188）_files/MkU7NFN4WttTiMYf__thumbnail.png" type="image/png" data-filename="MkU7NFN4WttTiMYf__thumbnail.png"/></div><div>游戏利用MC特性，龙蛋不能传递红石信号，而沙子可以传递红石信号。根据此可以判断活塞控制了三种状态：</div><div>1. 活塞处有两种不同方块，对应产生不同信号，异或门输出取反为灯灭；</div><div>2. 活塞推出，对应产生相同信号，异或门输出取反为灯亮；</div><div>3. 活塞处有两种相同方块，对应产生相同信号，异或门输出取反为灯亮；</div><div>所以我们只需要判断两个不同方块间是否有相同方块就可以得出0和1，如：<img src="BUUCTF Misc 35（185-188）_files/Ma3g6lL4FWNjwl0C.png" type="image/png" data-filename="Ma3g6lL4FWNjwl0C.png"/></div><div>为0。</div><div><br/></div><div><img src="BUUCTF Misc 35（185-188）_files/6vrQ6awD1ppbMVLk.png" type="image/png" data-filename="6vrQ6awD1ppbMVLk.png"/></div><div>为1。</div><div><br/></div><div>flag：npuctf{8F108D05D23041B5866F9CB2FF109661}</div><div><br/></div><div><span style="font-weight: bold;">188 [INSHack2018]Spreadshit</span></div><div><br/></div><div>下载得到md格式文件和spreadshit.ods。前者是题目说明：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>This spreadsheet doesn't contain anything interesting... Or does it ?</div></div><div><br/></div><div>十六进制编辑器查看spreadshit.ods，是zip格式压缩包。结合题目说明，猜测是某种文档。查询得知.ods是开放文档格式（OpenDocument Format，简称ODF）中OpenDocument Spreadsheet文件的扩展名。</div><div>用LibreOffice打开，真的什么都没有呢。</div><div><img src="BUUCTF Misc 35（185-188）_files/Image [1].png" type="image/png" data-filename="Image.png"/></div><div>尝试Ctrl+F搜索一下空格，就会发现很多单元格是有内容的，LibreOffice还会自动把它们都标出来。</div><div><img src="BUUCTF Misc 35（185-188）_files/Image [2].png" type="image/png" data-filename="Image.png"/></div><div>然后把列宽改成0.25cm：</div><div><img src="BUUCTF Misc 35（185-188）_files/Image [3].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div>flag：INSA{3cf6463910edffb0}</div></span>
</div></body></html> 