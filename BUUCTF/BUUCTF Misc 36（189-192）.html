<html>
<head>
  <title>BUUCTF Misc 36（189-192）</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/605894 (zh-CN, DDL); Windows/6.1.1 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1339"/>
<h1>BUUCTF Misc 36（189-192）</h1>
<h2><a href="https://DemonStarAlgol.github.io/Misc/">[无关链接]</a></h2>

<div>
<span><div><span style="font-weight: bold;">189 [BSidesSF2019]diskimage</span></div><div><br/></div><div>下载得到png格式文件。</div><div><img src="BUUCTF Misc 36（189-192）_files/attachment.png" type="image/png" data-filename="attachment.png"/></div><div>图片上半部分似乎损坏了。尝试用zsteg分析，普通模式找不到有效信息，使用-a参数：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# zsteg -a attachment.png</div><div>imagedata           .. text: [&quot;w&quot; repeated 10 times]</div><div>b1,b,msb,xy         .. file: MPEG-4 LOAS, 8 or more streams</div><div>b2,r,lsb,xy         .. text: &quot;UUUUUUUUUUUUUUT&quot;</div><div>b2,b,lsb,xy         .. text: &quot;7wwwwwwwwwwwwwwwwwwwwwp&quot;</div><div>b3,g,lsb,xy         .. file: PGP Secret Key -</div><div>b4,g,lsb,xy         .. text: &quot;\&quot;\&quot;\&quot;\&quot;3333DDDDUUUUffffwwww&quot;</div><div>b8,r,lsb,xy         .. text: &quot;iin btldk eenraoaelpa\rrsnk  ygn.\r&quot;</div><div>b8,g,lsb,xy         .. text: &quot;/NNE A2 &quot;</div><div>b8,g,msb,xy         .. text: [&quot;@&quot; repeated 8 times]</div><div>b8,b,lsb,xy         .. text: &quot;)WOA  T &quot;</div><div>b8,rgb,lsb,xy       .. file: <font color="#FF0000">DOS/MBR boot sector, code offset 0x3c+2, OEM-ID &quot;~mitsumi&quot;, root entries 224, sectors 2880 (volumes &lt;=32 MB), sectors/FAT 9, sectors/track 18, serial number 0x7e572f0f, unlabeled, FAT (12 bit)</font></div><div>……（后略）</div></div><div>注意到在特定模式下发现了隐写的DOS扇区数据，用-E参数将其提取：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# zsteg -E 'b8,rgb,lsb,xy' attachment.png &gt; out.dat</div></div><div><br/></div><div>用DiskGenius挂载或7-Zip解压会发现，该镜像里只有大量ICO格式图标文件，找不到进一步的信息。尝试用testdisk工具分析镜像，查看有无隐藏或被删除的文件。</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# testdisk out.dat</div></div><div>一路按默认选项回车即可，最后会列出镜像中所有文件列表，已删除文件用红色标识。</div><div><img src="BUUCTF Misc 36（189-192）_files/Image.png" type="image/png" data-filename="Image.png"/></div><div>根据提示，选中被删除的_LAG.ICO后，按c将其复制出来。</div><div><img src="BUUCTF Misc 36（189-192）_files/Image [1].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div>当然，直接用DiskGenius恢复文件也是完全可行的。</div><div><img src="BUUCTF Misc 36（189-192）_files/Image [2].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div>flag：CTF{FAT12_FTW}</div><div><br/></div><div><span style="font-weight: bold;">190 [watevrCTF 2019]Unspaellablle</span></div><div><br/></div><div>下载得到txt格式文件，打开看一下，应该是1997年美国电影《星际之门SG-1：众神之子》的剧本。</div><div><img src="BUUCTF Misc 36（189-192）_files/Image [3].png" type="image/png" data-filename="Image.png"/></div><div>分别在文本中搜索{和}，找到以下唯一结果：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>                                     APOPHIS</div><div>                         K'o{n! A'nsi</div></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>                                     MEDIC</div><div>                         Get the gauze on him! We gotta stop</div><div>                         the bleeding from hi}s leg!</div></div><div>看起来似乎是把flag拆成字符然后插进了正常文本中间。说起来题目名称其实就是在Unspellable中间插入了多余的a和l。</div><div><br/></div><div>搜索关键词找到<a href="https://www.imsdb.com/transcripts/Stargate-SG1-Children-Of-The-Gods.html">剧本的原文</a>，将其保存成txt格式并用BeycondCompare进行比较：</div><div><img src="BUUCTF Misc 36（189-192）_files/Image [4].png" type="image/png" data-filename="Image.png"/></div><div>有差异的行会以红色标记。依次记录比原剧本多出来的字母，得到：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>watevr{icantspeel_tiny.cc/2qtdez}</div></div><div>按惯例访问了一下<a href="http://tiny.cc/2qtdez">tiny.cc/2qtdez</a>，结果是个跳转到youtube的短链接，跳转页面是一部名为《<span style="font-size: unset; color: unset; font-family: unset;">Grammar Nazis》（语法纳粹，大致是指热爱在互联网上挑别人语法错误的人）。没有更多信息了，上面这串就是flag。</span></div><div><span style="font-size: unset;"><br/></span></div><div><span style="font-size: unset;">顺带一提，在Linux下可以使用vimdiff命令：</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# vimdiff attachment.txt SG-1.txt</div></div><div><img src="BUUCTF Misc 36（189-192）_files/Image [5].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div>flag：watevr{icantspeel_tiny.cc/2qtdez}</div><div><br/></div><div><span style="font-weight: bold;">191 [QCTF2018]picture</span></div><div><br/></div><div>下载得到没有后缀名的文件，十六进制编辑器查看发现是png格式图片。重命名一下发现这题做过了……</div><div>参见 <a href="evernote:///view/30668439/s39/55a7ae9d-d633-44d0-8fe4-7d797143053c/55a7ae9d-d633-44d0-8fe4-7d797143053c/" style="color: rgb(105, 170, 53);">攻防世界高手区18（127-132）</a>的131题。</div><div><br/></div><div>flag：QCTF{eCy0AALMDH9rLoBnWnTigXpYPkgU0sU4}</div><div><br/></div><div><span style="font-weight: bold;">192 [SUCTF2018]dead_z3r0</span></div><div><br/></div><div>下载得到没有后缀名的文件，十六进制编辑器查看，开头是一段字符串：</div><div><img src="BUUCTF Misc 36（189-192）_files/Image [6].png" type="image/png" data-filename="Image.png"/></div><div>然后在接近结尾的地方发现了&lt;module&gt;：</div><div><img src="BUUCTF Misc 36（189-192）_files/Image [7].png" type="image/png" data-filename="Image.png"/></div><div>那么就很清楚了，这是一个pyc文件。</div><div><br/></div><div>pyc文件格式为，开头两字节是与Python版本有关的Magic Number，接下来两个字节一般是0D 0A。因此该pyc文件的文件头可能是从33 0D 0D 0A开始的，将其提取出来，然后反编译：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>C:\Users\Administrator\Desktop&gt;uncompyle6 -o 1.py 1.pyc</div><div>1.pyc --</div><div># Successfully decompiled file</div></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>def encryt(key, plain):</div><div>    cipher = ''</div><div>    for i in range(len(plain)):</div><div>        cipher += chr(ord(key[(i % len(key))]) ^ ord(plain[i]))</div><div>    return cipher</div><div><br/></div><div>def getPlainText():</div><div>    plain = ''</div><div>    with open('plain.txt') as (f):</div><div>        while True:</div><div>            line = f.readline()</div><div>            if line:</div><div>                plain += line</div><div>            else:</div><div>                break</div><div>    return plain</div><div><br/></div><div>def main():</div><div>    key = 'LordCasser'</div><div>    plain = getPlainText()</div><div>    cipher = encryt(key, plain)</div><div>    with open('cipher.txt', 'w') as (f):</div><div>        f.write(cipher.encode('base_64'))</div><div><br/></div><div>if __name__ == '__main__':</div><div>    main()</div></div><div>从文件读入明文，给定key，对key和明文逐个字符按位异或，key长度用完后从头开始。得到的结果base64加密后输出。</div><div>联想到原始文件中在pyc文件头前的字符串（去掉中间的0A），很可能就是该加密脚本的输出结果。写出对应的解密脚本：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>import base64</div><div><br/></div><div>def decryt(key, cipher):</div><div>    plain = ''</div><div>    for i in range(len(cipher)):</div><div>        plain += chr(ord(key[(i % len(key))]) ^ int(cipher[i]))</div><div>    return plain</div><div><br/></div><div>str = 'KTswVQk1OgQrOgUVODAKFikZJAUuKzwPCTUxMQE1Kxc8NxYYPjcgQwY7OxMhCzFDLyYFGBYjKwkXMDALAScZEycyJgooOigHEAoSDT42IEcBLCcdDiUxBi8mBRgoLBUKPgowBR04P1QnJj0cLyYFGBYjJBs5JywFL1wjHhkbMkI8KhoWFjAWXH55'</div><div>key = 'LordCasser'</div><div><br/></div><div>s = base64.b64decode(str)</div><div>print(decryt(key, s))</div></div><div>输出：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>eTB1JTIwNHIzJTIwZjAwbDNkJTBBdGgxNSUyMDE1JTIwbjB0JTIwdGhhdCUyMHkwdSUyMHdhbnQlMEE5MCUyMDBuJTIwZHVkMyUwQWM0dGNoJTIwdGgzJTIwc3QzZzA1YXVydTU=</div></div><div>base64解码：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>y0u%204r3%20f00l3d%0Ath15%2015%20n0t%20that%20y0u%20want%0A90%200n%20dud3%0Ac4tch%20th3%20st3g05auru5</div></div><div>URL编码解码：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>y0u 4r3 f00l3d</div><div>th15 15 n0t that y0u want</div><div>90 0n dud3</div><div>c4tch th3 st3g05auru5</div></div><div>得到提示stegosaurus，也就是pyc隐写。</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>D:\CTFToolkit-v1.1.0\信息隐藏\stegosaurus-master&gt;python3 stegosaurus.py -x 1.pyc</div><div><br/></div><div>Extracted payload: SUCTF{Z3r0_fin411y_d34d}</div></div><div><br/></div><div>flag：SUCTF{Z3r0_fin411y_d34d}</div></span>
</div></body></html> 