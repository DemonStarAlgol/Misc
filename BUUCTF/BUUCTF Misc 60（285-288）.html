<html>
<head>
  <title>BUUCTF Misc 60（285-288）</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/605894 (zh-CN, DDL); Windows/6.1.1 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="661"/>
<h1>BUUCTF Misc 60（285-288）</h1>
<h2><a href="https://DemonStarAlgol.github.io/Misc/">[无关链接]</a></h2>

<div>
<span><div><span style="font-weight: bold;">285 [BSidesSF2020]magic</span></div><div>题目：Much magic, so rainbow, wow!</div><div><br/></div><div>下载得到png格式文件。Stegsolve打开：</div><div><img src="BUUCTF Misc 60（285-288）_files/Image.png" type="image/png" data-filename="Image.png" width="1338"/></div><div>注意到该图片存在Alpha透明通道，且在部分像素点处却出现了可疑情况：Alpha通道为透明，而RGB通道又存在颜色信息。由于Alpha通道的存在，这些像素点永远显示为透明，其RGB通道携带的信息就被隐藏了。</div><div><br/></div><div>尝试将图片中的Alpha通道信息去除：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>from PIL import Image</div><div>u = Image.open('C:/Users/Administrator/Desktop/unicorn.png')</div><div>new = Image.new('RGB', u.size)</div><div><br/></div><div>for i in range(u.size[0]):</div><div>    for j in range(u.size[1]):</div><div>        p = u.getpixel((i, j))</div><div>        new.putpixel((i, j), p[0:3])</div><div>new.show()</div></div><div><img src="BUUCTF Misc 60（285-288）_files/new.png" type="image/png" data-filename="new.png" width="648"/></div><div>注意到独角兽的后腿中间：</div><div><img src="BUUCTF Misc 60（285-288）_files/Image [1].png" type="image/png" data-filename="Image.png" width="499"/></div><div>其他背景区域均为噪音的情况下，只有这里出现了大量相同颜色像素点组成的色块。</div><div><br/></div><div>取色得到该色块的RGB值为(28, 193, 153)，尝试仅提取该颜色的像素点，并转为黑色显示：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>new2 = Image.new('RGB', u.size)</div><div><br/></div><div>for i in range(u.size[0]):</div><div>    for j in range(u.size[1]):</div><div>        p = u.getpixel((i, j))</div><div>        if p[0:3] == (28, 193, 153):</div><div>            new2.putpixel((i, j), (0, 0, 0))</div><div>new2.save('C:/Users/Administrator/Desktop/new2.png')</div></div><div>得到结果如下（已放大）：</div><div><img src="BUUCTF Misc 60（285-288）_files/Image [2].png" type="image/png" data-filename="Image.png" width="224"/></div><div>很明显，这是一个缺少了定位符的二维码，将其补全：</div><div><img src="BUUCTF Misc 60（285-288）_files/Image [3].png" type="image/png" data-filename="Image.png" width="215"/></div><div>扫码得到flag。</div><div><br/></div><div>flag：CTF{magical_unicorn_gait}</div><div><br/></div><div><span style="font-weight: bold;">286 [INSHack2019]industrial-process</span></div><div><br/></div><div>下载得到md格式文件和tempList.txt。前者是题目说明：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>In company XXX, we have a big expertise in laser cutting and we are well informed about cybersecurity. We have setup a small honeypot to simulate the cut of some pieces. In our fake process, we have manufactured 25 pieces of 1 meter by 1 meter.</div><div>We have found this really weird file thanks to a super effective detection tool. There was also a weird string : `893c539a84e6c96acf5f2ceea2ad9ef7be895580`</div></div><div><br/></div><div>首先通过Google搜索给出的字符串，找到<a href="https://github.com/TryCatchHCF/Cloakify/tree/893c539a84e6c96acf5f2ceea2ad9ef7be895580">Cloakify</a>。该工具可以把任意文件混淆为常见单词或字符组成的列表，从而在数据盗取的过程中躲避DLP/MLS数据泄露防护系统的检测，突破数据白名单控制，或避开社会工程学分析。</div><div><br/></div><div>查看tempList.txt：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>Nice France</div><div>Málaga Spain</div><div>Fenerbahçe Turkey</div><div>Salzburg Austria</div><div>Nice France</div><div>Lyon France</div><div>Málaga Spain</div><div>……（后略）</div></div><div>文本中包含大量足球队名称，很可能是Cloadkify对某个文件加密后的结果，且使用了密文字典worldFootballTeams。在Linux下用decloakify.py解密：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop/Cloakify# python2 decloakify.py tempList.txt ciphers/worldFootballTeams &gt; out</div></div><div>file命令判断文件类型：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop/Cloakify# file out</div><div>out: pcapng capture file - version 1.0</div></div><div>是pcapng格式流量包，wireshark打开，提示文件可能在某个数据包中途被截断。</div><div><img src="BUUCTF Misc 60（285-288）_files/Image [4].png" type="image/png" data-filename="Image.png" width="510"/></div><div><br/></div><div>先查看流量包中现有信息。首先，所有数据包均为Modbus协议，且Query和Response交错出现：</div><div><img src="BUUCTF Misc 60（285-288）_files/Image [5].png" type="image/png" data-filename="Image.png" width="1087"/></div><div>其次，所有的Response包都包含三个数值：</div><div><img src="BUUCTF Misc 60（285-288）_files/Image [6].png" type="image/png" data-filename="Image.png" width="655"/></div><div>由于流量包中找不到其他有规律的信息，先尝试提取这些数值：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# tshark -r out -Y modbus -T fields -E header=y -e modbus.regval_uint16 &gt; data.txt</div><div>Running as user &quot;root&quot; and group &quot;root&quot;. This could be dangerous.</div><div>tshark: The file &quot;out&quot; appears to have been cut short in the middle of a packet.</div></div><div>输出结果去掉空行（对应Query包）后得到：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>0,0,0</div><div>0,0,0</div><div>0,0,0</div><div>0,0,0</div><div>0,0,0</div><div>0,0,0</div><div>0,0,0</div><div>250,0,0</div><div>125,0,0</div><div>125,1000,0</div><div>0,1000,0</div><div>250,1000,0</div><div>0,0,1</div><div>0,1000,1</div><div>750,0,1</div><div>……（后略）</div></div><div>观察规律：共有212行，每行3个数字，最后一个数字逐行从0增大到24，联想到三维坐标。（事实上结合Modbus协议还可以联想到无人机，那么每行数字就是无人机当前的空间坐标位置。但坐标也可能来自其他设备，而且本题只需要考虑三维坐标即可解答。）</div><div><br/></div><div>考虑z轴坐标为0的前几行：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>0,0,0</div><div>250,0,0</div><div>125,0,0</div><div>125,1000,0</div><div>0,1000,0</div><div>250,1000,0</div></div><div>如果在二维坐标轴中画出每行x和y坐标对应的点，再依次连接，可以看到类似字母I的形状。猜测每个z轴坐标对应的x和y坐标形成的路径对应flag中的一个字符。写Python脚本绘图：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>import matplotlib.pyplot</div><div>f = open('C:/Users/Administrator/Desktop/data.txt', 'r').readlines()</div><div><br/></div><div>def draw(z):</div><div>    X, Y = [], []</div><div>    for line in f:</div><div>        l = line[:-1].split(',')</div><div>        if l[2] == str(z):</div><div>            X.append(int(l[0]))</div><div>            Y.append(int(l[1]))</div><div>    matplotlib.pyplot.plot(X, Y, '-')</div><div>    matplotlib.pyplot.axis('equal')</div><div>    matplotlib.pyplot.show()</div><div><br/></div><div>for i in range(25):</div><div>    draw(i)</div></div><div>输出结果：</div><div><img src="BUUCTF Misc 60（285-288）_files/Image [7].png" type="image/png" data-filename="Image.png" width="504"/></div><div>整理得到：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>INSAHACKINDUSTRIALPROCESS</div></div><div><br/></div><div>flag：INSA{HACKINDUSTRIALPROCESS}</div><div><br/></div><div><span style="font-weight: bold;">287 [INSHack2018]NotRandom</span></div><div><br/></div><div>下载得到md格式文件和server.py。前者是题目说明：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>Try to show us you have the luck needed to get your degree!</div><div>&lt;code&gt;nc notrandom.ctf.insecurity-insa.fr 10002&lt;/code&gt;</div></div><div><br/></div><div>服务器已经失效，记录一下Writeup：</div><div><a href="https://github.com/seclib/inshack-2018/blob/master/prog/notrandom/writeup.md">https://github.com/seclib/inshack-2018/blob/master/prog/notrandom/writeup.md</a></div><div><br/></div><div>flag：INSA{Why_w0ulD_U_Us3_b4s1c_r4nd0m}</div><div><br/></div><div><span style="font-weight: bold;">288 [INSHack2017]crypt0r-part1</span></div><div><br/></div><div>下载得到md格式文件：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>One of our HR opened a mail attachment and got her files encrypted. Could you have a look at her emails and find what's wrong?</div><div>You'll find an archive with her e-mails here: http://crypt0r.challenge-by.ovh/mails.tgz</div></div><div><br/></div><div>附件下载地址失效了，Github上也没有提供这个文件。Writeup是空的，exp里写着“参见WP”。记录一下一位日本师傅写的日文Writeup：</div><div><a href="https://st98.github.io/diary/posts/2017-04-10-inshack-2017.html">https://st98.github.io/diary/posts/2017-04-10-inshack-2017.html</a></div><div><br/></div><div>flag：<span style="font-size: unset; color: unset; font-family: unset;">INSAc79371180eddac4582321f98d32db67c</span></div><div><span style="font-size: unset; color: unset; font-family: unset;">（本题flag不含{}，在BUUCTF需要整体包上flag{}提交。）</span></div></span>
</div></body></html> 