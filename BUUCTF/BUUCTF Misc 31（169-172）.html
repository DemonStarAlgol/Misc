<html>
<head>
  <title>BUUCTF Misc 31（169-172）</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/605894 (zh-CN, DDL); Windows/6.1.1 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1421"/>
<h1>BUUCTF Misc 31（169-172）</h1>
<h2><a href="https://DemonStarAlgol.github.io/Misc/">[无关链接]</a></h2>

<div>
<span><div><span style="font-weight: bold;">169 [MRCTF2020]小O的考研复试</span></div><div><br/></div><div>下载得到pdf文件，内容：</div><div><img src="BUUCTF Misc 31（169-172）_files/Image.png" type="image/png" data-filename="Image.png"/></div><div>结果还真的就是要做数学题啊……被模的数和模数都很大，直接算会很麻烦。考虑到乘某数再取模，和先取模再乘某数再取模，结果是一样的：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>a = 0</div><div>b = int(1e9 + 7)</div><div><br/></div><div>for i in range(19260817):</div><div>    a = a * 10 + 2</div><div>    a %= b</div><div>print(a)</div></div><div>结果：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>577302567</div></div><div><br/></div><div>flag：flag{577302567}</div><div><br/></div><div><span style="font-weight: bold;">170 Beautiful_Side</span></div><div><br/></div><div>下载得到jpg格式图片，十六进制编辑器打开，文件尾后还有数据。提取得到一张png格式图片。</div><div><img src="BUUCTF Misc 31（169-172）_files/1.png" type="image/png" data-filename="1.png"/></div><div>是半个二维码。因为没有其他线索了，先尝试用<a href="https://merricx.github.io/qrazybox/">qrazybox</a>将其尽可能补全。</div><div>首先可以确定版本为ver.3（边长为29），纠错级别为H，Mask Pattern为2。</div><div><img src="BUUCTF Misc 31（169-172）_files/Image [1].png" type="image/png" data-filename="Image.png"/></div><div>然后把能确定的部分二维码画好（包括最左边能依稀看见的一列）：</div><div><img src="BUUCTF Misc 31（169-172）_files/Image [2].png" type="image/png" data-filename="Image.png"/></div><div>理论上二维码的数据块都在右半边，左半边为纠错码，这里已经包含了二维码中的所有信息，但常见的工具都扫不出来。</div><div><br/></div><div>接下来需要参考<a href="https://coolshell.cn/articles/10590.html">二维码的生成细节与原理</a>和<a href="https://yous.be/2014/12/07/seccon-ctf-2014-qr-easy-write-up/">SECCON CTF 2014的类似题目解法</a>进行手工计算。基本思路是：</div><div>1、根据Mask对数据块部分进行异或；</div><div>2、对异或后的图像，按规定的顺序记录每个方块的值；</div><div>3、根据二维码数据码的算法，将值还原成信息。</div><div><br/></div><div>不过后来又发现<a href="https://merricx.github.io/qrazybox/">qrazybox</a>本身就自带了这方面的功能。<span style="font-size: unset; color: unset; font-family: unset;">首先画二维码时要把已经确定的黑色、白色点都画好。</span></div><div><img src="BUUCTF Misc 31（169-172）_files/Image [3].png" type="image/png" data-filename="Image.png"/></div><div>然后点击上方的Tools，选择Extract QR Information。</div><div><img src="BUUCTF Misc 31（169-172）_files/Image [4].png" type="image/png" data-filename="Image.png"/></div><div>然后就自动根据已有的数据块计算出了原始信息。</div><div><img src="BUUCTF Misc 31（169-172）_files/Image [5].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div>flag：Flag{OQWIC_4DS1A_S034S}</div><div><br/></div><div><span style="font-weight: bold;">171 [XMAN2018排位赛]AutoKey</span></div><div><br/></div><div>下载得到pcapng格式文件，wireshark打开。</div><div><img src="BUUCTF Misc 31（169-172）_files/Image [6].png" type="image/png" data-filename="Image.png"/></div><div>全部数据均为USB协议，从题目名称和分组字节流，猜测是USB键盘输入数据。</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# python UsbKeyboardDataHacker-new.py attachment.pcapng</div><div>Running as user &quot;root&quot; and group &quot;root&quot;. This could be dangerous.</div><div>Traceback (most recent call last):</div><div>  File &quot;UsbKeyboardDataHacker-new.py&quot;, line 64, in &lt;module&gt;</div><div>    main()</div><div>  File &quot;UsbKeyboardDataHacker-new.py&quot;, line 49, in main</div><div>    if Bytes[0] == &quot;00&quot;:</div><div>IndexError: list index out of range</div></div><div>报错，但是生成了usb.dat。在usb.dat存在的前提下应用另一个脚本：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# python3 UsbKeyboard2.py</div><div>output :n&lt;CAP&gt;a&lt;CAP&gt;utokey('****').decipheer('&lt;CAP&gt;mplrvffczeyoujfjkybxgzvdgqaurkxzolkolvtufblrnjesqitwahxnsijxpnmplshcjbtyhzealogviaaissplfhlfswfehjncrwhtinsmambvexo&lt;DEL&gt;pze&lt;DEL&gt;iz')</div></div><div>大概自己翻译一下，&lt;CAP&gt;是Caps Lock，&lt;DEL&gt;是删除前一字符：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>Autokey('****').decipher('MPLRVFFCZEYOUJFJKYBXGZVDGQAURKXZOLKOLVTUFBLRNJESQITWAHXNSIJXPNMPLSHCJBTYHZEALOGVIAAISSPLFHLFSWFEHJNCRWHTINSMAMBVEXPZIZ')</div></div><div><br/></div><div>意思是需要用未知密钥来解密一段Autokey密文，使用脚本进行爆破：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>E:\break_autokey&gt;python break_autokey.py</div><div>-824.697138698 autokey, klen 3 :&quot;YCI&quot;, ONDDICCUXCERSFORFKKSWPDHRNTDERUVXRPRUGCAZZLSOYMESWPEESTJAPAXANPPYDSEGJPSYKMCBCEUGWGCWMNPTUWMYATGHQHVBPMSTBATZMIWSPTHTG</div><div>-772.470967688 autokey, klen 4 :&quot;SYNR&quot;, URYABOHCYQRMWTOXOFNASUIDOWSRDOFILXFGAYOOFDXDIGHPICMHSFLGADYRPKOYWITENTAUUGEGRICPRSYTBARSEHUNOPLRTUCLYCFIKLNEQBOROWBIUD</div><div>-803.48764464 autokey, klen 5 :&quot;BCGKY&quot;, LNFHXUSXSHEWXRYFOBKZBLUTHPPAYDIKONHGBHGNZAELAKEOFIJSMCPEAWHILNQIDHUMBYMEVYGOHTIPUTHADYWEFENJORBRYVWBAYMXHNUADFOBEUKLHV</div><div>-761.616653993 autokey, klen 6 :&quot;KIDAHF&quot;, CHIROADVRNKOROOWAKKJSDVTWHIRWRBSGUOXKDNAREBOAJNOPUTNNTITZVWEHUNUPOAIWHEKHRITHEZEAHTETOPEMDSRDSTBPSKKYVSBYDURILDSKGHOFH</div><div>-743.720273262 autokey, klen 7 :&quot;KIDEAFY&quot;, CHINVAHASWLTUCFRONIDEUEPTIXQXGIGGOURFNNORHUMAWQBJOHWERWEEBNTYRILKFOESTIOCLAISGSTXASQMAWOFPVTSARZSOUKRFIBUTIVVEABLPUEEZ</div><div><font style="color: rgb(255, 0, 0);">-674.914569565 autokey, klen 8 :&quot;FLAGHERE&quot;, HELLOBOYSANDGIRLSYOUARESOSMARTTHATYOUCANFINDTHEFLAGTHATIHIDEINTHEKEYBOARDPACKAGEFLAGIS<b>JHAWLZKEWXHNCDHSLWBAQJTUQZDXZQPF</b></font></div></div><div>爆破到密钥长度为8时得到正确结果，密钥为FLAGHERE，flag为最后加粗部分。</div><div><br/></div><div>flag：flag{JHAWLZKEWXHNCDHSLWBAQJTUQZDXZQPF}</div><div><br/></div><div><span style="font-weight: bold;">172 [INSHack2017]hiding-in-plain-sight</span></div><div><br/></div><div>下载得到md格式文件和chall.png。前者是题目说明：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>Your smart-plate has an embedded camera that takes pictures of your meals and automatically uploads them to your Instagram. However you fear it has been compromised and is quietly sharing information with all your followers. Bellow is the last picture that went online.</div></div><div><br/></div><div>十六进制编辑器打开chall.png，发现IHDR块后跟着一段大小较大的inSa数据块，同时发现了很明显的jpg文件头。</div><div><img src="BUUCTF Misc 31（169-172）_files/Image [7].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div>尝试foremost分离该图片，得到了一张jpg图像。</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# foremost chall.png</div><div>Processing: chall.png</div><div>|*|</div></div><div><img src="BUUCTF Misc 31（169-172）_files/00000000.jpg" type="image/jpeg" data-filename="00000000.jpg"/></div><div><br/></div><div>flag：INSA{l337_h4xx0r5_c0mmun1c473_w17h_PNGs}</div></span>
</div></body></html> 