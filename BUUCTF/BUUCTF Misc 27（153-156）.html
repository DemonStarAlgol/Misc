<html>
<head>
  <title>BUUCTF Misc 27（153-156）</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/605894 (zh-CN, DDL); Windows/6.1.1 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1460"/>
<h1>BUUCTF Misc 27（153-156）</h1>
<h2><a href="https://DemonStarAlgol.github.io/Misc/">[无关链接]</a></h2>

<div>
<span><div><span style="font-weight: bold;">153 greatescape</span></div><div><br/></div><div>下载得到pcap格式文件，wireshark打开，先看协议。</div><div>HTTP协议没有找到明显线索，但可以发现大量TLS协议包。同时<span style="font-size: unset; color: unset; font-family: unset;">发现有FTP协议：</span></div><div><img src="BUUCTF Misc 27（153-156）_files/Image.png" type="image/png" data-filename="Image.png"/></div><div>可以看到661号包通过FTP协议下载了ssc.key文件。</div><div><img src="BUUCTF Misc 27（153-156）_files/Image [1].png" type="image/png" data-filename="Image.png"/></div><div>很明显是个RSA私钥，联想到TLS协议包，尝试解密流量。</div><div>编辑-首选项-Protocols-TLS，将导出得到的ssc.key文件导入：</div><div><img src="BUUCTF Misc 27（153-156）_files/Image [2].png" type="image/png" data-filename="Image.png"/></div><div>筛选器设置tls协议，列表中可以看到大量已经解密的流量包显示为HTTP协议。对这些流量逐个追踪TLS流，最后在2274号包（tcp流80）中找到了flag：</div><div><img src="BUUCTF Misc 27（153-156）_files/Image [3].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div>flag：INS{OkThatWasWay2Easy}</div><div><br/></div><div><span style="font-weight: bold;">154 [RoarCTF2019]forensic</span></div><div><br/></div><div>题目给了一个链接：<a href="http://roarctf.wetolink.com/mem.raw">http://roarctf.wetolink.com/mem.raw</a>，访问后可以下载到512MB的mem.raw。</div><div>这个文件名和大小总觉得有点眼熟……<span style="font-size: unset; color: unset; font-family: unset;">没错就是</span><a href="https://app.yinxiang.com/shard/s39/nl/30668439/f66f9c18-04b1-410e-82ef-e1f003e0e6c6" style="font-size: unset; font-family: unset;">143题 [V&amp;N2020 公开赛]内存取证</a><span style="font-size: unset; color: unset; font-family: unset;">里做过的那道。</span></div><div><span style="font-size: unset; color: unset; font-family: unset;">当时很疑惑为什么最后flag格式是RoarCTF，现在疑问完美得到了解答，还真的是其他比赛的原题……</span></div><div><span style="font-size: unset;"><br/></span></div><div><span style="font-size: unset;">当然前面的步骤还是有点不同的，简单记录如下。</span></div><div><span style="font-size: unset;">用取证大师导入mem.raw后进行深度文件恢复，文件过滤“flag”找到多个压缩包：</span></div><div><img src="BUUCTF Misc 27（153-156）_files/Image [4].png" type="image/png" data-filename="Image.png"/></div><div>其中flag.zip和flag.rar都是加密的，均导出备用。flag(2).rar和flag.rar是同一个文件。</div><div><br/></div><div>接下来寻找密码，取证大师可以找到pass.txt，但其中内容不是压缩包的密码（而是143题得到的key文件）。还有一个Accountn.txt，内容是welcome2w&amp;mctf<span style="color: rgb(255, 0, 0); font-weight: bold;">（所以又出现了第三个CTF比赛名字……）</span>。</div><div>还是用volatility，先看镜像信息：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# volatility -f mem.raw imageinfo</div><div>Volatility Foundation Volatility Framework 2.6</div><div>INFO    : volatility.debug    : Determining profile based on KDBG search...</div><div>          Suggested Profile(s) : Win7SP1x86_23418, Win7SP0x86, Win7SP1x86_24000, Win7SP1x86</div><div>                     AS Layer1 : IA32PagedMemoryPae (Kernel AS)</div><div>                     AS Layer2 : FileAddressSpace (/root/Desktop/mem.raw)</div><div>                      PAE type : PAE</div><div>                           DTB : 0x185000L</div><div>                          KDBG : 0x81729be8L</div><div>          Number of Processors : 2</div><div>     Image Type (Service Pack) : 0</div><div>                KPCR for CPU 0 : 0x8172ac00L</div><div>                KPCR for CPU 1 : 0x807ec000L</div><div>             KUSER_SHARED_DATA : 0xffdf0000L</div><div>           Image date and time : 2019-09-16 13:55:23 UTC+0000</div><div>     Image local date and time : 2019-09-16 21:55:23 +0800</div></div><div><span style="font-size: unset;">然后列举进程：</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# volatility -f mem.raw --profile=Win7SP1x86 pslist</div></div><div><span style="font-size: unset;">同样注意到几个可疑进程：</span></div><div><img src="BUUCTF Misc 27（153-156）_files/Image [5].png" type="image/png" data-filename="Image.png"/></div><div>扫描文件：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# volatility -f mem.raw --profile=Win7SP1x86 filescan | grep -E 'png|jpg|gif|zip|rar|7z|pdf|txt|doc'</div></div><div><span style="font-size: unset;">注意到比较可疑的图片：</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>0x000000001efb29f8      8      0 R--r-d \Device\HarddiskVolume2\Users\lethal\Pictures\无标题.png</div></div><div><span style="font-size: unset;">将其dump出来：</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# volatility -f mem.raw --profile=Win7SP1x86 dumpfiles -Q 0x000000001efb29f8 --dump-dir=./</div><div>Volatility Foundation Volatility Framework 2.6</div><div>DataSectionObject 0x1efb29f8   None   \Device\HarddiskVolume2\Users\lethal\Pictures\无标题.png</div></div><div>得到图片：</div><div><img src="BUUCTF Misc 27（153-156）_files/file.None.0x84435c28.png" type="image/png" data-filename="file.None.0x84435c28.png"/></div><div><span style="font-size: unset;">虽然字迹不同，但内容和143题最终得到的图片是一样的……用这个密码解压flag.zip就得到了最终的flag。而flag.zip和143题的加密压缩包是一样的，解压得到的flag当然也一样。</span></div><div><span style="font-size: unset;"><br/></span></div><div><span style="font-size: unset;"><span style="font-size: unset; color: rgb(255, 0, 0); font-weight: bold;">我个人的怀疑是：出题人有一台512MB内存的Win7虚拟机，专门用于出内存取证题。所以每次出题的时候会把目标文件和密码重复使用，而且不同题目的线索或目标文件也会互相残留。比如本题如果去查iehistory，会发现也访问了至少6个百度网盘地址，以及本地的flag.zip、flag.rar、pass.txt、123.txt、Accountn.txt……</span></span></div><div><span style="font-size: unset;"><br/></span></div><div><span style="font-size: unset; color: unset; font-family: unset;">flag：</span>RoarCTF{wm_D0uB1e_TC-cRypt}</div><div><br/></div><div><span style="font-weight: bold;">155 [GKCTF2020]Sail a boat down the river</span></div><div><br/></div><div>下载得到flag.mp4和加密压缩包vocal.rar。</div><div><br/></div><div>先播放视频，在接近结尾的某一帧突然闪过了一个二维码。用DVDVideoSoft将视频逐帧转为图片，得到这一帧：</div><div><img src="BUUCTF Misc 27（153-156）_files/flag 466.jpg" type="image/jpeg" data-filename="flag 466.jpg"/></div><div>扫码得到：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>https://pan.baidu.com/s/1tygt0Nm_G5fTfVFlgxVcrQ</div></div><div>访问该网址，发现需要提取码。根据题目hint“闪烁的光芒”，注意到视频中某个闪烁的灯：</div><div><img src="BUUCTF Misc 27（153-156）_files/Image [6].png" type="image/png" data-filename="Image.png"/></div><div>间隔出现了四次连续闪烁，正好和提取码的位数一样。逐张查看按帧转出的图片，发现亮灯时间有1帧或3帧两种情况：</div><div>第一次闪烁，119-131帧，长短长长；</div><div>第二次闪烁，201-209帧，短长长；</div><div>第三次闪烁，321-335帧，长长长短短；</div><div>第四次闪烁，411-419帧，长长短。</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>-.-- .-- ---.. --.</div></div><div>摩斯电码，解码得到yw8g。从百度网盘下载得到shudu.txt：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>0 8 1 7 4 0 0 0 0</div><div>3 0 2 0 6 8 0 0 0</div><div>4 0 6 5 0 0 8 2 0</div><div>0 3 0 0 0 0 0 5 6</div><div>7 0 4 3 0 9 2 0 1</div><div>1 2 0 0 0 0 0 4 0</div><div>0 5 9 0 0 4 1 0 8</div><div>0 0 0 1 8 0 9 0 2</div><div>0 0 0 0 9 7 4 6 0</div><div><br/></div><div>密文:</div><div>efb851bdc71d72b9ff668bddd30fd6bd</div><div>密钥:</div><div>第一列九宫格从左到右从上到下（题目提示更正：是一行不是一列）</div></div><div>解数独得到：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>[5, 8, 1, 7, 4, 2, 6, 9, 3]</div><div>[3, 7, 2, 9, 6, 8, 5, 1, 4]</div><div>[4, 9, 6, 5, 1, 3, 8, 2, 7]</div><div>[9, 3, 8, 4, 2, 1, 7, 5, 6]</div><div>[7, 6, 4, 3, 5, 9, 2, 8, 1]</div><div>[1, 2, 5, 8, 7, 6, 3, 4, 9]</div><div>[2, 5, 9, 6, 3, 4, 1, 7, 8]</div><div>[6, 4, 7, 1, 8, 5, 9, 3, 2]</div><div>[8, 1, 3, 2, 9, 7, 4, 6, 5]</div></div><div>得到密钥：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>52693795149137</div></div><div>有提示加密方式很常见，尝试后发现是AES密码：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>cipher16='\xef\xb8\x51\xbd\xc7\x1d\x72\xb9\xff\x66\x8b\xdd\xd3\x0f\xd6\xbd'</div><div>key=b'52693795149137'.ljust(16, b'\0')</div><div>print binascii.b2a_hex(key)</div><div>plain=AES_ECB_decrypt(key,cipher16)</div><div>print plain</div><div><br/></div><div>C:\Users\Administrator\Desktop&gt;python AES_EBC_CBC.py</div><div>35323639333739353134393133370000</div><div>GG0kc.tf</div></div><div><br/></div><div>用GG0kc.tf解压vocal.rar得到 逆光 vocal.ovex ，这是打谱软件Overture的乐谱文件格式。</div><div><img src="BUUCTF Misc 27（153-156）_files/Image [7].png" type="image/png" data-filename="Image.png"/></div><div><img src="BUUCTF Misc 27（153-156）_files/Image [8].png" type="image/png" data-filename="Image.png"/></div><div><img src="BUUCTF Misc 27（153-156）_files/Image [9].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div>flag：flag{gkctf_is_fun}</div><div><br/></div><div><span style="font-weight: bold;">156 [MRCTF2020]摇滚DJ（建议大声播放</span></div><div><br/></div><div>下载得到wav格式文件。audacity打开发现全程为长度不同的正弦波形，听一下发现疑似某种无线电信号。尝试用SSTV转成图像：</div><div><img src="BUUCTF Misc 27（153-156）_files/Image [10].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div>flag：merak{r3ce1ved_4n_img}</div></span>
</div></body></html> 