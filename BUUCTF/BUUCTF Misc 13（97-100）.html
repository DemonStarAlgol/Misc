<html>
<head>
  <title>BUUCTF Misc 13（97-100）</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/605894 (zh-CN, DDL); Windows/6.1.1 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1662"/>
<h1>BUUCTF Misc 13（97-100）</h1>
<h2><a href="https://DemonStarAlgol.github.io/Misc/">[无关链接]</a></h2>

<div><span><div><span style="font-weight: bold;">97 [GUET-CTF2019]zips</span></div><div><br/></div><div>下载得到222.zip，加密的，爆破之。</div><div><img src="BUUCTF Misc 13（97-100）_files/Image.png" type="image/png" data-filename="Image.png" width="998"/><br/></div><div>解压得到111.zip，内含未加密但里面有加密文件的flag.zip，和加密但仔细一看是伪加密的setup.sh。</div><div>ZipCenOp处理并解压两个文件。<span style="font-size: unset; color: unset; font-family: unset;">setup.sh的内容是：</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>#!/bin/bash</div><div>#</div><div>zip -e --password=`python -c &quot;print(__import__('time').time())&quot;` flag.zip flag</div></div><div>试着运行一下：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>python -c &quot;print(__import__('time').time())&quot;</div></div><div>输出：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>1602382771.67</div></div><div>换言之，flag.zip是用生成文件当时的时间戳作为密码加密的，肯定在2019年5月17日16:10之后。</div><div><img src="BUUCTF Misc 13（97-100）_files/Image [1].png" type="image/png" data-filename="Image.png" width="1051"/><br/></div><div><br/></div><div>生成这个时间点的时间戳：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>import time</div><div>stamp=time.mktime(time.strptime('2019-05-17 16:10:00', '%Y-%m-%d %H:%M:%S'))</div><div>print(stamp)</div></div><div>运行得到：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>1558080600.0</div></div><div><br/></div><div>以这个时间戳为起始点，在ARCHPR中使用掩码爆破。注意时间戳的小数应为2位，掩码设置为1558??????.?? ：</div><div><img src="BUUCTF Misc 13（97-100）_files/Image [2].png" type="image/png" data-filename="Image.png" width="585"/><br/></div><div>最后解压得到flag。</div><div><br/></div><div>flag：flag{fkjabPqnLawhvuikfhgzyffj}</div><div><br/></div><div><span style="font-weight: bold;">98 [ACTF新生赛2020]swp</span></div><div><br/></div><div>下载得到pcapng文件，wireshark打开。先导出HTTP对象。</div><div><img src="BUUCTF Misc 13（97-100）_files/Image [3].png" type="image/png" data-filename="Image.png" width="760"/><br/></div><div>注意到secret.zip和hint.html。导出，前者是一个看似加密的zip压缩包，后者是这么说的：</div><div><img src="BUUCTF Misc 13（97-100）_files/Image [4].png" type="image/png" data-filename="Image.png" width="541"/><br/></div><div>所以就是伪加密，ZipCenOp处理，解压得到flag和.flag.swp。先看flag，是一个ELF执行文件。Linux下运行：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# ./flag</div><div>段错误</div></div><div>再来看.flag.swp，可以看作vim编辑时生成的备份文件。总之直接用文本编辑器打开：</div><div><img src="BUUCTF Misc 13（97-100）_files/Image [5].png" type="image/png" data-filename="Image.png" width="1025"/><br/></div><div><br/></div><div>flag：actf{c5558bcf-26da-4f8b-b181-b61f3850b9e5}</div><div><br/></div><div><span style="font-weight: bold;">99 [MRCTF2020]千层套路</span></div><div><br/></div><div>下载得到zip压缩包。</div><div><img src="BUUCTF Misc 13（97-100）_files/Image [6].png" type="image/png" data-filename="Image.png" width="1051"/><br/></div><div>根据提示试验一下，从0573.zip开始，发现解压密码就是当前压缩包的文件名。用python脚本循环解压：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>import zipfile</div><div><br/></div><div>path = 'C:/Users/Administrator/Desktop/zip/' # 工作文件夹</div><div>name = '0573' # 起始压缩包名</div><div>while True:</div><div>    zipname = path + name + '.zip' # 生成完整的待解压压缩包名</div><div>    print(name)</div><div>    ts1 = zipfile.ZipFile(zipname)</div><div>    password = bytes(name, 'utf-8') # 解压密码就是文件名</div><div>    ts1.extractall(path, pwd = password) # 解压得到下一个压缩包</div><div>    name = ts1.namelist()[0].split('.')[0] # 读取压缩包内的下一个压缩包的文件名，以供下一个循环使用</div></div><div>本来以为解压到最后会报错的，没想到陷入了qr的死循环。</div><div><img src="BUUCTF Misc 13（97-100）_files/Image [7].png" type="image/png" data-filename="Image.png" width="1400"/><br/></div><div>原来因为最后一个压缩包叫qr.zip，没有加密，而包含的文件也叫qr.txt，导致一直在解压缩qr.zip，解压出来的还是空文件（因为用密码去解压缩未加密文件了）。总之强行停止脚本，然后解压得到qr.txt。</div><div>这个文本共有40000行，前几行是：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>(255, 255, 255)</div><div>(255, 255, 255)</div><div>(255, 255, 255)</div><div>(255, 255, 255)</div><div>(255, 255, 255)</div><div>(255, 255, 255)</div><div>(255, 255, 255)</div><div>(255, 255, 255)</div><div>……</div></div><div>这样就很明显了，是一个200x200的图片，每行代表一个像素点的RGB值。写脚本画出来：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>from PIL import Image</div><div><br/></div><div>qr = open('C:/Users/Administrator/Desktop/zip/qr.txt').readlines()</div><div>img = Image.new('RGB', (200, 200))</div><div><br/></div><div>i = 0</div><div>for lines in qr:</div><div>    x = i % 200</div><div>    y = i // 200</div><div>    r = int(lines.split(', ')[0][1:])</div><div>    g = int(lines.split(', ')[1])</div><div>    b = int(lines.split(', ')[2][:-2])</div><div>    img.putpixel((x, y), (r, g, b))</div><div>    i += 1</div><div>img.save('C:/Users/Administrator/Desktop/1.png')</div></div><div><img src="BUUCTF Misc 13（97-100）_files/1.png" type="image/png" data-filename="1.png" width="200"/><br/></div><div>扫码得到flag。</div><div><br/></div><div>flag：MRCTF{ta01uyout1nreet1n0usandtimes}</div><div><br/></div><div><span style="font-weight: bold;">100 [MRCTF2020]CyberPunk</span></div><div><br/></div><div>下载得到cyberpunk! .exe。先运行一下：</div><div><img src="BUUCTF Misc 13（97-100）_files/Image [8].png" type="image/png" data-filename="Image.png" width="843"/><br/></div><div>大意是说《赛博朋克2077》将于2020年9月17日发售（哈哈哈但是游戏跳票到11月19日了出题人没想到吧），等游戏发售时就会给出flag了。那么把系统时间改到9月17日（哈哈哈但是游戏后来又跳票到12月10日了没想到吧）：</div><div><img src="BUUCTF Misc 13（97-100）_files/Image [9].png" type="image/png" data-filename="Image.png" width="843"/><br/></div><div><br/></div><div>flag：MRCTF{We1cOm3_70_cyber_security}</div></span>
</div></body></html> 