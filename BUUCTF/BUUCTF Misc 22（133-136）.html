<html>
<head>
  <title>BUUCTF Misc 22（133-136）</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/605894 (zh-CN, DDL); Windows/6.1.1 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1517"/>
<h1>BUUCTF Misc 22（133-136）</h1>
<h2><a href="https://DemonStarAlgol.github.io/Misc/">[无关链接]</a></h2>

<div>
<span><div><span style="font-weight: bold;">133 [GWCTF2019]huyao</span></div><div><br/></div><div>下载得到huyao.png和stillhuyao.png，图片内容几乎一样，大小有少许差别。考虑双图隐写，由于两张图SUB后出现了大量横线，猜测是盲水印。</div><div><img src="BUUCTF Misc 22（133-136）_files/Image.png" type="image/png" data-filename="Image.png" width="421"/></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop/blind-watermark-python3# python decode.py --original huyao.png --image stillhuyao.png --result out.png</div></div><div><span style="color: rgb(255, 0, 0); font-weight: bold;">（盲水印解码时，可以把两张图片交换一下，看看能否得到更清晰的结果。）</span></div><div><img src="BUUCTF Misc 22（133-136）_files/out.png" type="image/png" data-filename="out.png" width="400"/></div><div><br/></div><div>flag：GWHT{BWM_1s_c00l}</div><div><br/></div><div><span style="font-weight: bold;">134 Business Planning Group</span></div><div><br/></div><div>下载得到challenge.png。十六进制编辑器打开，文件尾后还有数据。</div><div><img src="BUUCTF Misc 22（133-136）_files/Image [1].png" type="image/png" data-filename="Image.png" width="844"/></div><div>观察到这段数据开头是42 50 47 BPG，联系到题目名称的首字母缩写也是BPG。查询找到<a href="https://www.zhihu.com/question/27089508">新的BPG图片格式</a>。</div><div>先将数据提取保存为.bpg格式文件。然后从<a href="https://bellard.org/bpg/">BPG官网</a>下载到bpg-0.9.8-win64.zip，利用其中的bpgdec.exe转图片格式，得到out.png。</div><div><img src="BUUCTF Misc 22（133-136）_files/out [1].png" type="image/png" data-filename="out.png" width="1479"/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div> YnNpZGVzX2RlbGhpe0JQR19pNV9iM3R0M3JfN2g0bl9KUEd9Cg==</div></div><div>解码得到flag。</div><div><br/></div><div>flag：bsides_delhi{BPG_i5_b3tt3r_7h4n_JPG}</div><div><br/></div><div><span style="font-weight: bold;">135 [QCTF2018]X-man-A face</span></div><div><br/></div><div>下载得到png格式文件。</div><div><img src="BUUCTF Misc 22（133-136）_files/Xman-Aface-61df10385eaccbb3627ca3926c6ae174.png" type="image/png" data-filename="Xman-Aface-61df10385eaccbb3627ca3926c6ae174.png"/></div><div>把脸上的二维码定位符补齐。</div><div><img src="BUUCTF Misc 22（133-136）_files/无标题.png" type="image/png" data-filename="无标题.png"/></div><div>扫码得到：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>KFBVIRT3KBZGK5DUPFPVG2LTORSXEX2XNBXV6QTVPFZV6TLFL5GG6YTTORSXE7I=</div></div><div>base32解码得到flag。</div><div><br/></div><div>flag：QCTF{Pretty_Sister_Who_Buys_Me_Lobster}</div><div><br/></div><div><span style="font-weight: bold;">136 [ACTF新生赛2020]剑龙</span></div><div><br/></div><div>下载得到hint.zip和O_O文件。其实从题目名称就可以联想到pyc隐写工具stegosaurus，不过给了hint就看一下。</div><div><br/></div><div>hint.zip中包括pwd.txt和hh.jpg两个文件。pwd.txt的内容：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>ﾟωﾟﾉ= /｀ｍ´）ﾉ ~┻━┻   //*´∇｀*/ ['_']; o=(ﾟｰﾟ)  =_=3; c=(ﾟΘﾟ) =(ﾟｰﾟ)-(ﾟｰﾟ); (ﾟДﾟ) =(ﾟΘﾟ)= (o^_^o)/ (o^_^o);(ﾟДﾟ)={ﾟΘﾟ: '_' ,ﾟωﾟﾉ : ((ﾟωﾟﾉ==3) +'_') [ﾟΘﾟ] ,ﾟｰﾟﾉ :(ﾟωﾟﾉ+ '_')[o^_^o -(ﾟΘﾟ)] ,ﾟДﾟﾉ:((ﾟｰﾟ==3) +'_')[ﾟｰﾟ] }; (ﾟДﾟ) [ﾟΘﾟ] =((ﾟωﾟﾉ==3) +'_') [c^_^o];(ﾟДﾟ) ['c'] = ((ﾟДﾟ)+'_') [ (ﾟｰﾟ)+(ﾟｰﾟ)-(ﾟΘﾟ) ];(ﾟДﾟ) ['o'] = ((ﾟДﾟ)+'_') [ﾟΘﾟ];(ﾟoﾟ)=(ﾟДﾟ) ['c']+(ﾟДﾟ) ['o']+(ﾟωﾟﾉ +'_')[ﾟΘﾟ]+ ((ﾟωﾟﾉ==3) +'_') [ﾟｰﾟ] + ((ﾟДﾟ) +'_') [(ﾟｰﾟ)+(ﾟｰﾟ)]+ ((ﾟｰﾟ==3) +'_') [ﾟΘﾟ]+((ﾟｰﾟ==3) +'_') [(ﾟｰﾟ) - (ﾟΘﾟ)]+(ﾟДﾟ) ['c']+((ﾟДﾟ)+'_') [(ﾟｰﾟ)+(ﾟｰﾟ)]+ (ﾟДﾟ) ['o']+((ﾟｰﾟ==3) +'_') [ﾟΘﾟ];(ﾟДﾟ) ['_'] =(o^_^o) [ﾟoﾟ] [ﾟoﾟ];(ﾟεﾟ)=((ﾟｰﾟ==3) +'_') [ﾟΘﾟ]+ (ﾟДﾟ) .ﾟДﾟﾉ+((ﾟДﾟ)+'_') [(ﾟｰﾟ) + (ﾟｰﾟ)]+((ﾟｰﾟ==3) +'_') [o^_^o -ﾟΘﾟ]+((ﾟｰﾟ==3) +'_') [ﾟΘﾟ]+ (ﾟωﾟﾉ +'_') [ﾟΘﾟ]; (ﾟｰﾟ)+=(ﾟΘﾟ); (ﾟДﾟ)[ﾟεﾟ]='\\'; (ﾟДﾟ).ﾟΘﾟﾉ=(ﾟДﾟ+ ﾟｰﾟ)[o^_^o -(ﾟΘﾟ)];(oﾟｰﾟo)=(ﾟωﾟﾉ +'_')[c^_^o];(ﾟДﾟ) [ﾟoﾟ]='\&quot;';(ﾟДﾟ) ['_'] ( (ﾟДﾟ) ['_'] (ﾟεﾟ+(ﾟДﾟ)[ﾟoﾟ]+ (ﾟДﾟ)[ﾟεﾟ]+(ﾟΘﾟ)+ ((o^_^o) +(o^_^o))+ ((ﾟｰﾟ) + (o^_^o))+ (ﾟДﾟ)[ﾟεﾟ]+(ﾟΘﾟ)+ (ﾟｰﾟ)+ ((ﾟｰﾟ) + (ﾟΘﾟ))+ (ﾟДﾟ)[ﾟεﾟ]+(ﾟΘﾟ)+ ((ﾟｰﾟ) + (ﾟΘﾟ))+ (ﾟｰﾟ)+ (ﾟДﾟ)[ﾟεﾟ]+(ﾟΘﾟ)+ (ﾟｰﾟ)+ (o^_^o)+ (ﾟДﾟ)[ﾟεﾟ]+(ﾟΘﾟ)+ ((ﾟｰﾟ) + (ﾟΘﾟ))+ ((ﾟｰﾟ) + (o^_^o))+ (ﾟДﾟ)[ﾟεﾟ]+(ﾟΘﾟ)+ ((ﾟｰﾟ) + (ﾟΘﾟ))+ ((ﾟｰﾟ) + (ﾟΘﾟ))+ (ﾟДﾟ)[ﾟεﾟ]+((o^_^o) +(o^_^o))+ (o^_^o)+ (ﾟДﾟ)[ﾟεﾟ]+(ﾟｰﾟ)+ (ﾟΘﾟ)+ (ﾟДﾟ)[ﾟoﾟ]) (ﾟΘﾟ)) ('_');</div></div><div>很明显是aaencode。记录一下离线解法：</div><div>用83.0.4103.61版Google Chrome浏览器（这里用的Kali下的，Windows的86版经测试不行），F12-Console，输入代码后回车运行。一般如果明文不是可执行的Javascript代码，会报错。</div><div><img src="BUUCTF Misc 22（133-136）_files/Image [2].png" type="image/png" data-filename="Image.png"/></div><div>点击报错信息旁边的VM25:3。</div><div><img src="BUUCTF Misc 22（133-136）_files/Image [3].png" type="image/png" data-filename="Image.png"/></div><div>可以看到已经输出了解密后的内容。根据文件名，welcom3!应该是某处的密码。</div><div><br/></div><div>然后用steghide提取hh.jpg中的隐写信息：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>D:\CTFToolkit-v1.1.0\信息隐藏\steghide&gt;steghide.exe extract -sf hh.jpg</div><div>Enter passphrase:<font color="#FF0000">（此处输入welcom3!）</font></div><div>wrote extracted data to &quot;secret.txt&quot;.</div></div><div>得到secret.txt，内容：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>想要flag吗？解出我的密文吧~</div><div>U2FsdGVkX1/7KeHVl5984OsGUVSanPfPednHpK9lKvp0kdrxO4Tj/Q==</div></div><div>显然是AES或DES加密，需要密钥。在图片的EXIF信息中找到：</div><div><img src="BUUCTF Misc 22（133-136）_files/Image [4].png" type="image/png" data-filename="Image.png"/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>@#$%^&amp;%%$)</div></div><div>尝试后发现是DES：</div><div><img src="BUUCTF Misc 22（133-136）_files/Image [5].png" type="image/png" data-filename="Image.png"/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>think about stegosaurus</div></div><div>嗯……但是这个提示好像用不着了。</div><div><br/></div><div>来看O_O文件，Linux下file命令判断文件类型。</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# file O_O</div><div>O_O: python 3.6 byte-compiled</div></div><div>这里光看文件头比较难，根据<a href="https://www.cnblogs.com/txw1958/archive/2012/02/23/2365145.html">PYC文件简介</a>：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>pyc文件的最开始4个字节是一个Maigc int，标识此pyc的版本信息，不同的版本的 Magic 都在 Python/import.c 内定义。</div></div><div>也就是说不同版本Python生成的pyc文件头是不一样的。<span style="font-size: unset; color: unset; font-family: unset;">总之接下来直接上工具：</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>D:\CTFToolkit-v1.1.0\信息隐藏\stegosaurus-master&gt;python3 stegosaurus.py -x O_O.pyc</div><div>Extracted payload: flag{3teg0Sauru3_!1}</div></div><div><br/></div><div>flag：flag{3teg0Sauru3_!1}</div></span>
</div></body></html> 