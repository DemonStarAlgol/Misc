<html>
<head>
  <title>BUUCTF Misc 12（93-96）</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/605894 (zh-CN, DDL); Windows/6.1.1 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1674"/>
<h1>BUUCTF Misc 12（93-96）</h1>
<h2><a href="https://DemonStarAlgol.github.io/Misc/">[无关链接]</a></h2>

<div>
<span><div><span style="font-weight: bold;">93 [安洵杯 2019]Attack</span></div><div><br/></div><div>下载得到pcap格式文件，先尝试foremost分解，可以得到一个加密的zip压缩包，内含flag.txt。</div><div><img src="BUUCTF Misc 12（93-96）_files/Image.png" type="image/png" data-filename="Image.png" width="1051"/></div><div>但暂时找不到密码的线索。</div><div><br/></div><div>wireshark打开pcap文件，导出HTTP对象，注意到lsass.dmp。</div><div><img src="BUUCTF Misc 12（93-96）_files/Image [1].png" type="image/png" data-filename="Image.png" width="760"/></div><div>结合压缩包注释里的administrator，联想到可以用mimikatz从lsass.exe进程数据中获取Windows登陆密码。</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>mimikatz.exe &quot;sekurlsa::minidump lsass.dmp&quot; &quot;sekurlsa::logonPasswords full&quot; exit</div><div>也可以在最后加上&gt; 1.txt把运行结果保存到文本文件中</div></div><div><img src="BUUCTF Misc 12（93-96）_files/Image [2].png" type="image/png" data-filename="Image.png" width="843"/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>Authentication Id : 0 ; 347784 (00000000:00054e88)</div><div>Session           : Interactive from 1</div><div>User Name         : Administrator</div><div>Domain            : WIN7</div><div>Logon Server      : WIN7</div><div>Logon Time        : 2019/11/14 9:38:33</div><div>SID               : S-1-5-21-1539156736-1959120456-2224594862-500</div><div>    msv :    </div><div>     [00000003] Primary</div><div>     * Username : Administrator</div><div>     * Domain   : WIN7</div><div>     * LM       : c4d0515fb12046a475113b7737dc0019</div><div>     * NTLM     : aafdad330f5a9f4fbf562ed3d25f97de</div><div>     * SHA1     : 8b9a7ca86970d1392b6fa0b94b8694c2b919469f</div><div>    tspkg :    </div><div>     * Username : Administrator</div><div>     * Domain   : WIN7</div><div>     * Password : W3lc0meToD0g3</div><div>    wdigest :    </div><div>     * Username : Administrator</div><div>     * Domain   : WIN7</div><div>     * Password : W3lc0meToD0g3</div><div>    kerberos :    </div><div>     * Username : Administrator</div><div>     * Domain   : WIN7</div><div>     * Password : W3lc0meToD0g3</div><div>    ssp :    </div><div>    credman :    </div></div><div>得到了密码W3lc0meToD0g3。用同样的密码解压之前得到的zip压缩包，得到flag.txt。拉到最后得到flag。</div><div><br/></div><div>flag：D0g3{3466b11de8894198af3636c5bd1efce2}</div><div><br/></div><div><span style="font-weight: bold;">94 百里挑一</span></div><div><br/></div><div>下载得到pcap格式文件，wireshark打开，可以看到基本上全部流量都在下载图片。</div><div><img src="BUUCTF Misc 12（93-96）_files/Image [3].png" type="image/png" data-filename="Image.png" width="760"/></div><div>先导出HTTP对象，得到全部图片。考虑查看图片的exif信息，利用Kali的exiftool工具：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop/新建文件夹# exiftool * | grep flag</div><div>XP Comment                      : 恭喜你！找到一半了，还有另一半哦！flag{ae58d0408e26e8f</div></div><div>得到前半段flag。<span style="font-size: unset; color: unset; font-family: unset;">猜测后半段flag很可能也在图片exif信息中，但暂时无法找到第二张带有exif备注信息的图片。</span></div><div><br/></div><div>回过头继续看流量包，注意到最后一个HTTP对象开始于14211号数据包，而整个流量包共包含21283个数据包：</div><div><img src="BUUCTF Misc 12（93-96）_files/Image [4].png" type="image/png" data-filename="Image.png"/></div><div>说明后半部分可能还有大量并非通过HTTP协议传输的数据，点击菜单栏的统计-协议分级：</div><div><img src="BUUCTF Misc 12（93-96）_files/Image [5].png" type="image/png" data-filename="Image.png"/></div><div>发现有FTP协议通信数据，且从字节百分比看，有20.6%的字节为Data，很可能是通过FTP协议下载的文件。稍微筛选一下：</div><div><img src="BUUCTF Misc 12（93-96）_files/Image [6].png" type="image/png" data-filename="Image.png"/></div><div>可以看到确实从某个FTP服务器下载了某个名为image4的文件夹及其内容。再看一下接收方的情况：</div><div><img src="BUUCTF Misc 12（93-96）_files/Image [7].png" type="image/png" data-filename="Image.png"/></div><div>合计下载了151张jpg图片，里面很可能有后半段flag的信息。</div><div><br/></div><div>考虑到提取从FTP下载的所有图片比较麻烦，考虑另一种方法。观察之前HTTP对象中取得的图片可以发现，有且仅有携带了前半段flag的那一张图片包含了exif备注信息，也仅有这一张图片包含了JPEG图像的APP1块。如果后半段flag所在图片也采用了同样方式隐藏信息，它很可能也包含特征一致的APP1块，即开头字节为FF E1 XX XX 45 78 69 66 00 00 4D 4D，或者更直观的，包含“Exif”四个字符。那么随便搜一下就可以找到18078号数据包：</div><div><img src="BUUCTF Misc 12（93-96）_files/Image [8].png" type="image/png" data-filename="Image.png"/></div><div>对应图片81.jpg。通过右键菜单-追踪TCP流，将图片提取出来：</div><div><img src="BUUCTF Misc 12（93-96）_files/Image [9].png" type="image/png" data-filename="Image.png"/></div><div>然后exiftool得到另一半flag：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# exiftool 81.jpg | grep Comment</div><div>XP Comment                      : 恭喜你！找到一半了，还有另一半哦！26a3c0589d23edeec}</div></div><div><br/></div><div>顺带一提，前半段flag所在图片（导出HTTP对象的文件名为90(2).jpg）和这张81.jpg的图片内容是一样的。此外，因为JPEG格式图像的exif信息的数据储存方式缘故，实际上可以从字节数据中直接看到exif备注信息里的ASCII字符。因此能够从81.jpg对应的114号TCP流数据里看到后半段flag，当然前提是要能找到这个流……</div><div><img src="BUUCTF Misc 12（93-96）_files/Image [10].png" type="image/png" data-filename="Image.png" width="1386"/></div><div><br/></div><div>flag：flag{ae58d0408e26e8f26a3c0589d23edeec}</div><div><br/></div><div><span style="font-weight: bold;">95 [WUSTCTF2020]alison_likes_jojo</span></div><div><br/></div><div>下载得到boki.jpg和jljy.jpg两张图片。十六进制编辑器打开，boki.jpg文件尾后有zip压缩包。</div><div><img src="BUUCTF Misc 12（93-96）_files/Image [11].png" type="image/png" data-filename="Image.png" width="848"/></div><div>提取得到加密压缩包，尝试爆破密码：</div><div><img src="BUUCTF Misc 12（93-96）_files/Image [12].png" type="image/png" data-filename="Image.png" width="998"/></div><div><br/></div><div>解压得到beisi.txt，内容为：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>WVRKc2MySkhWbmxqV0Zac1dsYzBQUT09</div></div><div>base64解码三次得到：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>killerqueen</div></div><div><br/></div><div>接下来看jljy.jpg，怀疑可能存在隐写，且killerqueen是隐写密码。尝试多种工具发现为outguess：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# outguess -k killerqueen -r jljy.jpg out.txt</div><div>Reading jljy.jpg....</div><div>Extracting usable bits:   5580 bits</div><div>Steg retrieve: seed: 127, len: 40</div></div><div>提取出的out.txt中即为flag。</div><div><br/></div><div>flag：wctf2020{pretty_girl_alison_likes_jojo}</div><div><br/></div><div><span style="font-weight: bold;">96 二维码</span></div><div><br/></div><div>下载得到jpg格式图片，有点过分了啊……</div><div><img src="BUUCTF Misc 12（93-96）_files/860c6e1a-a433-4a70-bfd0-5a318e758705.jpg" type="image/jpeg" data-filename="860c6e1a-a433-4a70-bfd0-5a318e758705.jpg" width="2448"/></div><div>用Photoshop拼好就行，借用一下<a href="https://zhuanlan.zhihu.com/p/140875776">别人拼好的图</a>：</div><div><img src="BUUCTF Misc 12（93-96）_files/20200514170725958.png" type="image/png" data-filename="20200514170725958.png" width="471"/></div><div>用微信可以强行扫出flag。</div><div><br/></div><div>flag：flag{7bf116c8ec2545708781fd4a0dda44e5}</div></span>
</div></body></html> 