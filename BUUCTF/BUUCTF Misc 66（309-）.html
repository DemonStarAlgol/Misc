<html>
<head>
  <title>BUUCTF Misc 66（309-）</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/605894 (zh-CN, DDL); Windows/6.1.1 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="4547"/>
<h1>BUUCTF Misc 66（309-）</h1>
<h2><a href="https://DemonStarAlgol.github.io/Misc/">[无关链接]</a></h2>

<div>
<span><div><span style="font-weight: bold;">309 [GKCTF 2021]你知道apng吗</span></div><div><br/></div><div>下载得到apng格式文件。不管扩展名还是题目名称都提示APNG，那就拖进浏览器看一下：</div><div><img src="BUUCTF Misc 66（309-）_files/Image.png" type="image/png" data-filename="Image.png"/></div><div>首先确实是动画，其次在部分帧肉眼可见存在二维码。用APNG Disassembler拆帧：</div><div><img src="BUUCTF Misc 66（309-）_files/Image [1].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div>依次查看，首先是第2帧：</div><div><img src="BUUCTF Misc 66（309-）_files/apngframe02.png" type="image/png" data-filename="apngframe02.png"/></div><div>利用Photoshop中的自由变换-斜切功能将二维码恢复到可扫描的形状：</div><div><img src="BUUCTF Misc 66（309-）_files/Image [2].png" type="image/png" data-filename="Image.png"/></div><div>扫描结果：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>flag{a3c7e4e5</div></div><div><br/></div><div>然后是第18帧：</div><div><img src="BUUCTF Misc 66（309-）_files/apngframe18.png" type="image/png" data-filename="apngframe18.png"/></div><div>虽然反色了，但大部分工具应该都能直接扫：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>-ad20</div></div><div><br/></div><div>然后是第26帧：</div><div><img src="BUUCTF Misc 66（309-）_files/apngframe26.png" type="image/png" data-filename="apngframe26.png"/></div><div>虽然被切片后移动了，但QR Research还是可以直接扫：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>-0327-288a235370ea}</div></div><div><br/></div><div>然后问题来了，三段字符串拼接后提交发现不对，对比其他题目flag格式后发现确实也少了一段。回头看一下有二维码的帧序号分别是2、18、26，加上10就正好构成等差数列。找到第10帧：</div><div><img src="BUUCTF Misc 66（309-）_files/apngframe10.png" type="image/png" data-filename="apngframe10.png"/></div><div>居然真的有个淡淡的二维码。用Stegsolve提取二维码比较明显的Red Plane 2：</div><div><img src="BUUCTF Misc 66（309-）_files/solved.bmp" type="image/bmp" data-filename="solved.bmp"/></div><div>扫描得到：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>-9b9d</div></div><div><br/></div><div>最后按照帧顺序拼接得到flag。</div><div><br/></div><div>flag：flag{a3c7e4e5-9b9d-ad20-0327-288a235370ea}</div><div><br/></div><div><span style="font-weight: bold;">310 签到</span></div><div><br/></div><div>下载得到pcapng格式文件。用wireshark打开，发现有HTTP协议，先导出HTTP对象：</div><div><img src="BUUCTF Misc 66（309-）_files/Image [3].png" type="image/png" data-filename="Image.png"/></div><div>依次查看，可以发现部分HTTP流中有hex编码形式的base64编码数据，结尾的3d3d（即==）特征很明显：</div><div><img src="BUUCTF Misc 66（309-）_files/Image [4].png" type="image/png" data-filename="Image.png"/></div><div>尝试解码几个：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>634768774c6d78735a57687a6347313043673d3d</div><div>php.llehspmt</div><div><br/></div><div>595852685a4331336433634b</div><div>atad-www</div><div><br/></div><div>626d6c69436e52766232494b646d566b436d4e305a51706e4e44466d436d56746232674b5a3231704c6d527964476c756151706b624738755a3231704c6d527964476c75615170696157774b4d6a4e696157774b4e445a696157774b4d6a4e34596d6c73436d52756457396d4b33527a62</div><div>nib</div><div>toob</div><div>ved</div><div>cte</div><div>g41f</div><div>emoh</div><div>gmi.drtini</div><div>dlo.gmi.drtini</div><div>bil</div><div>23bil</div><div>46bil</div><div>23xbil</div><div>dnuof+tsl</div></div><div>追踪相应HTTP流，可以看出对应的POST请求实际是在通过shell执行命令，但返回的结果是经过每行倒转-base64-hex三重编码的。<span style="font-size: unset; color: unset; font-family: unset;">结合以上信息，依次追踪HTTP流，找到TCP流5的92号数据包（对应的POST请求在90号包）：</span></div><div><img src="BUUCTF Misc 66（309-）_files/Image [5].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div>写脚本：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>import base64</div><div><br/></div><div>s = '64306c455357644251306c6e51554e4a5a3046355355737764306c7154586c4a616b31355357704e65556c7154586c4a616b31355357704e65556c7154586c4a616b31355357704e65556c7154586c4a616b31355357704e65556c7154576c44546d39525241707154586c4a616b31355357704e65556c7154586c4a616b31355357704e65556c7154586c4a616b31355357704e65556c7162314645616b46445357644251306c6e51554e4a5a32644554545a46524530325157704e5a3046365458524e524531305257704e436e5177553078304d464e4d6444425454485177553078304d464e4d6444425454485177553078304d464e4d6444425454485177553078304d464e4d6444425454485177553078304d464e4d644442705130354e65556c7154586c4a616b31355357704e65556b4b4e6b467154576442656b31305455524e644556715458644a616b38775a566f324d6d56774e557377643074795556645a64315a485a48593152556c3051576c4e4d5546355a4777316255733254545a7162475a7763573579555552304d464e4d64444254544170304d464e4d6444425454485177553078304d464e4d6444425454485177553078304d464e4d6444425454485177553078304d464e4d6444425454485177553078304d464e4d537a42425357526159585a764e7a567462485a735130354e564530325255524e436e6f77655531334d464e4e6555467154545a524e327877596a647362584a5252484a7a5131706f516c68614d446c745647637751306c355655524a4d315a74596e4676656d3951567974736357563151303477553078304d464e4d64444254544851775530774b63336858576d786b4d5659354d544e6c4e325179576d684752324a7a576d31615a7a427363446c7064573569567974585a7a427363446c7064573569567974585a7a427363446c706457356956797458537a423354586876564531336230524e6555464454517045546a4252524534775555527356324636546c684e65444258596d593562464a48556b524f5245347759584a6b4d464a6d4f565a6162444658596e644252456c6b556d46746345524c61577832526b6c6b556d46746345524c61577832566b747754544a5a436a303955556c6f545442525245347755516f3d'</div><div>s = int(s, 16).to_bytes(len(s)//2, 'big')</div><div>s = base64.b64decode(s).decode()</div><div>s = s.split('\n')[:-1]</div><div>s = [i[::-1] for i in s]</div><div><br/></div><div>print(s)</div></div><div>输出结果：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>['DQoNCiMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIw0KIyAgICAgICAgIDIw', 'MjEtMDMtMzAgMjA6MDE6MDggICAgICAgICAjDQojIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMj', 'IyMjIyMjIyMjIyMNCi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t', 'LS0tLS0tDQrnqpflj6M6Km5ldyA1MiAtIE5vdGVwYWQrKw0K5pe26Ze0OjIwMjEtMDMtMzAgMjA6', 'MDE6MTMNClvlm57ovaZdIA0KLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t', 'LS0tLS0tLS0tLS0NCueql+WPozoqbmV3IDUyIC0gTm90ZXBhZCsrDQrml7bpl7Q6MjAyMS0wMy0z', 'MCAyMDowMToxMw0KW+Wbnui9pl0gW+Wbnui9pl0gW+Wbnui9pl0gZmZsbGFhZ2d7e319V1dlZWxs', 'Y2MpKVvliKDpmaRdIFvliKDpmaRdIDAwbW1lZV9fR0dra0NDNDRGRl9fbW0xMXNzaWlDQ0NDQ0ND', 'Q0NDQ0MhIQ==']</div></div><div>每行仍然是base64编码，修改一下脚本：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>import base64</div><div><br/></div><div>s = '64306c455357644251306c6e51554e4a5a3046355355737764306c7154586c4a616b31355357704e65556c7154586c4a616b31355357704e65556c7154586c4a616b31355357704e65556c7154586c4a616b31355357704e65556c7154576c44546d39525241707154586c4a616b31355357704e65556c7154586c4a616b31355357704e65556c7154586c4a616b31355357704e65556c7162314645616b46445357644251306c6e51554e4a5a32644554545a46524530325157704e5a3046365458524e524531305257704e436e5177553078304d464e4d6444425454485177553078304d464e4d6444425454485177553078304d464e4d6444425454485177553078304d464e4d6444425454485177553078304d464e4d644442705130354e65556c7154586c4a616b31355357704e65556b4b4e6b467154576442656b31305455524e644556715458644a616b38775a566f324d6d56774e557377643074795556645a64315a485a48593152556c3051576c4e4d5546355a4777316255733254545a7162475a7763573579555552304d464e4d64444254544170304d464e4d6444425454485177553078304d464e4d6444425454485177553078304d464e4d6444425454485177553078304d464e4d6444425454485177553078304d464e4d537a42425357526159585a764e7a567462485a735130354e564530325255524e436e6f77655531334d464e4e6555467154545a524e327877596a647362584a5252484a7a5131706f516c68614d446c745647637751306c355655524a4d315a74596e4676656d3951567974736357563151303477553078304d464e4d64444254544851775530774b63336858576d786b4d5659354d544e6c4e325179576d684752324a7a576d31615a7a427363446c7064573569567974585a7a427363446c7064573569567974585a7a427363446c706457356956797458537a423354586876564531336230524e6555464454517045546a4252524534775555527356324636546c684e65444258596d593562464a48556b524f5245347759584a6b4d464a6d4f565a6162444658596e644252456c6b556d46746345524c61577832526b6c6b556d46746345524c61577832566b747754544a5a436a303955556c6f545442525245347755516f3d'</div><div>s = int(s, 16).to_bytes(len(s)//2, 'big')</div><div>s = base64.b64decode(s).decode()</div><div>s = s.split('\n')[:-1]</div><div>s = [base64.b64decode(i[::-1].encode()).decode('utf-8') for i in s]</div><div><br/></div><div>print(''.join(s))</div></div><div>输出结果：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>#######################################</div><div>#         2021-03-30 20:01:08         #</div><div>#######################################</div><div>--------------------------------------------------</div><div>窗口:*new 52 - Notepad++</div><div>时间:2021-03-30 20:01:13</div><div>[回车]</div><div>--------------------------------------------------</div><div>窗口:*new 52 - Notepad++</div><div>时间:2021-03-30 20:01:13</div><div>[回车] [回车] [回车] ffllaagg{{}}WWeellcc))[删除] [删除] 00mmee__GGkkCC44FF__mm11ssiiCCCCCCCCCCCC!!</div></div><div>整理一下：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>ffllaagg{{}}WWeellcc00mmee__GGkkCC44FF__mm11ssiiCCCCCCCCCCCC!!</div></div><div>很明显每个字符都重复出现了两次，去掉一个：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>s = 'ffllaagg{{}}WWeellcc00mmee__GGkkCC44FF__mm11ssiiCCCCCCCCCCCC!!'</div><div>for i in range(0, len(s), 2):</div><div>    print(s[i], end = '')</div></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>flag{}Welc0me_GkC4F_m1siCCCCCC!</div></div><div><br/></div><div>flag：flag{Welc0me_GkC4F_m1siCCCCCC!}</div><div><br/></div><div><span style="font-weight: bold;">311 [GKCTF 2021]银杏岛の奇妙冒险</span></div><div>题目：（前略）进入游戏后，根据游戏内的任务索引完成任务，即可获取flag（后略）</div><div><br/></div><div>Minecraft题，饶了我吧，上班摸鱼刷题不能玩游戏啊。总之这里提供一种不（太）需要打游戏的方法。</div><div>下载得到游戏压缩包，依次进入 附件\.minecraft\saves 目录，其中的 Where is the flag 文件夹中就是这个Minecraft地图的世界数据，将其解压出来。然后打开NBTExplorer，查看该文件夹：</div><div><img src="BUUCTF Misc 66（309-）_files/Image [6].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div>如果实际进行了游戏，可以发现在游戏开头，起提示作用的剧情文字似乎是写在桌子上的一本书（或者是告示牌？）里的。那么回到NBTExplorer，依次打开level.dat-Player-EnderItems：</div><div><img src="BUUCTF Misc 66（309-）_files/Image [7].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div>注意所有6 entries的节点，其中包含tag节点，即游戏中的相关文字信息。例如：</div><div><img src="BUUCTF Misc 66（309-）_files/Image [8].png" type="image/png" data-filename="Image.png"/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>{&quot;text&quot;:&quot;part 2\nt0_9kctf_\n\npart 3 \n324 -190 79&quot;}</div></div><div><br/></div><div>既然有part 2，说明必定有其他part。依次看一遍：</div><div><img src="BUUCTF Misc 66（309-）_files/Image [9].png" type="image/png" data-filename="Image.png"/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>{&quot;text&quot;:&quot; part 1\nw3lc0me_\n\npart 2\n291 -95 67&quot;}</div></div><div><br/></div><div><img src="BUUCTF Misc 66（309-）_files/Image [10].png" type="image/png" data-filename="Image.png"/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>{&quot;text&quot;:&quot;part 3\n2021_\n\npart 4\n362 -144 69&quot;}</div></div><div><br/></div><div><img src="BUUCTF Misc 66（309-）_files/Image [11].png" type="image/png" data-filename="Image.png"/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>Part 4</div><div>Check_1n</div></div><div><br/></div><div>最后按顺序拼接起来得到flag。</div><div><br/></div><div>flag：GKCTF{w3lc0me_t0_9kctf_2021_Check_1n}</div></span>
</div></body></html> 