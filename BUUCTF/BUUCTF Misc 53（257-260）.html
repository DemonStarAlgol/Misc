<html>
<head>
  <title>BUUCTF Misc 53（257-260）</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/605894 (zh-CN, DDL); Windows/6.1.1 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="744"/>
<h1>BUUCTF Misc 53（257-260）</h1>
<h2><a href="https://DemonStarAlgol.github.io/Misc/">[无关链接]</a></h2>

<div>
<span><div><span style="font-weight: bold;">257 [INSHack2019]Lit FAM - Part A</span></div><div><br/></div><div>下载得到md格式文件和FAM.wav。前者是题目说明：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>We have a proof of extraterrestrial life ! Or is it just a random amateur radio operator ?</div><div>Anyway, here is a strange RF interception. The file contains two independent flags, please submit the one matching `INSA{[A-Z]+}` here.</div></div><div>注意FAM.wav中包含两个flag，其中全部为大写字母的是Part A的flag，大小写字母数字混合的是Part F的flag。</div><div><br/></div><div>分析FAM.wav，audacity打开，放大查看波形：</div><div><img src="BUUCTF Misc 53（257-260）_files/Image.png" type="image/png" data-filename="Image.png"/></div><div>可以看到两种正弦波叠加的痕迹，说明存在<a href="https://zh.wikipedia.org/wiki/%E9%A0%BB%E7%8E%87%E5%81%8F%E7%A7%BB%E8%AA%BF%E8%AE%8A">频率偏移调制</a>（FSK，Frequency-Shift Keying）。对于二进制FSK，两个离散频率分别代表二进制的0和1，可以据此提取出数据。</div><div><br/></div><div>缩小查看波形：</div><div><img src="BUUCTF Misc 53（257-260）_files/Image [1].png" type="image/png" data-filename="Image.png"/></div><div>可以看到信号的幅度不断变化，说明还存在<a href="https://zh.wikipedia.org/wiki/%E6%8C%AF%E5%B9%85%E8%AA%BF%E8%AE%8A">幅度调制</a>（调幅，AM，Amplitude Modulation）。用变化的信号强度来发送某个波形，波形则可以解码为声音或其他的信号强度。</div><div><br/></div><div>猜测两种调制方式各携带了一部分flag信息。使用Python的wavio库进行解码，并用bitarray库将FSK调制信息转为文字：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>import wavio</div><div>import bitarray</div><div><br/></div><div>wav = wavio.read('C:/Users/Administrator/Desktop/FAM.wav')</div><div>wavio.write('C:/Users/Administrator/Desktop/rectified.wav', abs(wav.data), wav.rate)</div><div>l = [(a-2*b+c) / float(b) for a,b,c in zip(wav.data[:10000], wav.data[1:], wav.data[2:])]</div><div>print(bitarray.bitarray([0] + [int(e&lt;-0.25) for e in l][10::20]).tobytes())</div></div><div>输出FSK调制解码结果：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>b'_in_th3_AiR_4_u_4nd_Me}INSA{iS_in_th3_AiR_4_u_4nd_Me}INSA{iS_ih'</div></div><div>同时将AM调制解码结果生成为文件rectified.wav，播放后听到如下内容：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>The flag is I, N, S, A, opening bracket, RADIOACTIVITY, closing bracket. All letters are in uppercase.</div></div><div>即：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>INSA{RADIOACTIVITY}</div></div><div>根据flag格式说明，AM调制解码结果是Part A的flag。</div><div><br/></div><div>解码原理参考Writeup：</div><div><a href="https://hackingforsoju.team/blog/write-up-inshack-2019-lit-fam/">https://hackingforsoju.team/blog/write-up-inshack-2019-lit-fam/</a></div><div><br/></div><div>flag：INSA{RADIOACTIVITY}</div><div><br/></div><div><span style="font-weight: bold;">258 [INSHack2017]captcha-audio</span></div><div><br/></div><div>下载得到md格式文件：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>I am pretty sure that bots are using my last connected mug to send data to the NSA so I have built my own captcha system !</div><div>https://captcha.insecurity-insa.fr</div></div><div><br/></div><div>给出的URL已经打不开了。参考<a href="https://github.com/HugoDelval/inshack-2017/blob/master/challenges/programming/captcha-audio-175/writeup.md">官方Writeup</a>，本题内容大致如下：</div><div>1、访问给出的URL，页面上有音频验证码，但输入限制为5秒，基本上来不及完成听验证码并输入的操作；</div><div>2、在页面源代码中找到/debug目录，下载得到一个加密的zip压缩包；</div><div>3、暴力破解压缩包，解压后得到所有验证码的原始音频文件；</div><div>4、通过把页面给出的音频验证码与原始文件比对的方法，快速得到验证码内容。</div><div><br/></div><div>flag：INSA{C4ptcha_Ar3_T0o_S1mple}</div><div><br/></div><div><span style="font-weight: bold;">259 [BSidesSF2019]goodluks</span></div><div><br/></div><div>下载得到三个md格式文件。本题实际上总共有三题，BUUCTF上下载到的附件仅为题目说明。</div><div><br/></div><div><span style="font-weight: bold;">第一题：</span>We've recovered an encrypted disk image from an insider threat. While he won't give up the passphrase, we think the post-it note is related.</div><div>题目附件：<a href="https://github.com/mzfr/ctf-writeups/blob/master/BsidesSF_2019/Good_luks1/goodluks1.7z">goodluks1.7z</a> <a href="https://github.com/mzfr/ctf-writeups/blob/master/BsidesSF_2019/Good_luks1/goodluks1.jpg">goodluks1.jpg</a></div><div><br/></div><div>下载得到jpg格式图片和7z格式压缩包，解压得到goodluks1.img。直接在Linux下用mount命令挂载会报错，根据题目猜测，该镜像可能已被LUKS（Linux Unified Key Setup）加密，需要解密后才能挂载。同时根据题目内容，解密所需的密码提示很可能在图片中的便笺上：</div><div><img src="BUUCTF Misc 53（257-260）_files/Image [2].png" type="image/png" data-filename="Image.png"/></div><div>对数字尝试常见的加密方法和进制转换均无结果，注意到上方文字 Renew EFF Membership! 和下方的两个骰子，尝试搜索“eff dice crypto”，找到<a href="https://www.eff.org/dice">EFF Dice-Generated Passphrases</a>。这是一种通过投掷5枚骰子，根据结果数字在<a href="https://www.eff.org/files/2016/07/18/eff_large_wordlist.txt">单词表</a>中寻找对应单词并组合成密码的方法。根据便笺上的数字找到对应单词：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>66135     wages</div><div>65263     upturned</div><div>31234     flogging</div><div>52253     rinse</div><div>35536     landmass</div><div>42235     number</div></div><div>从而得到密码：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>wages upturned flogging rinse landmass number</div></div><div>尝试解密LUKS镜像：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# cryptsetup luksOpen goodluks1.img luks</div><div>goodluks1.img 不是有效的 LUKS 设备。</div></div><div>报错。用7-Zip打开goodluks1.img，解压得到0.img。</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# cryptsetup luksOpen 0.img luks</div><div>输入 0.img 的口令：（在这里输入得到的密码）</div></div><div>解密并挂载完成后打开镜像，在flag.txt中找到flag。</div><div><img src="BUUCTF Misc 53（257-260）_files/Image [3].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div>flag：CTF{Look_Under_Keyboards_4_Secrets}</div><div><br/></div><div><span style="font-weight: bold;">第二题：</span>Our first insider threat has lead to a second insider. We haven't found any clues to the passphrase here, but given the vocabulary of the suspect, I don't think you'll have a hard time.</div><div>题目附件：<a href="https://storage.googleapis.com/bsides-sf-ctf-2019-large-artifacts/goodluks2.7z">goodluks2.7z</a>（749MB）</div><div><br/></div><div>下载得到7z格式压缩包，解压得到goodluks2.img，参照第一题，再用7-Zip解压一次得到0.img（32GB）。同样是LUKS加密镜像，挂载需要密码，且本题没有给出密码线索。考虑暴力破解。</div><div>首先从镜像文件的头部提取密码的hash值：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# cryptsetup luksDump 0.img</div><div>LUKS header information for 0.img</div><div><br/></div><div>Version:        1</div><div>Cipher name:    aes</div><div>Cipher mode:    cbc-essiv:sha256</div><div>Hash spec:      sha1</div><div><span style="color: rgb(255, 0, 0);">Payload offset: 4096</span></div><div>MK bits:        256</div><div>MK digest:      f9 88 ef ee 9e 28 aa 8c 5a 9e ca 1b fa 50 f6 1b be b7 db 85</div><div>MK salt:        5b b3 77 d8 e9 dd 1f ea 61 b1 21 20 53 54 e1 e1</div><div>                b4 fd 11 21 bf 41 67 6f 9d 80 62 f3 b1 2f 6c dd</div><div>MK iterations:  132387</div><div>UUID:           4e42c516-dc27-402d-872b-a086739d7e2f</div><div><br/></div><div>Key Slot 0: ENABLED</div><div>        Iterations:             10260</div><div>        Salt:                   73 2d 5e e0 7e 99 40 8c ff ca de 32 c4 2d e0 cd</div><div>                                1b 6d ad b9 39 08 b5 c5 09 04 af 64 28 d5 bd a9</div><div>        Key material offset:    8</div><div>        AF stripes:             4000</div><div>Key Slot 1: DISABLED</div><div>Key Slot 2: DISABLED</div><div>Key Slot 3: DISABLED</div><div>Key Slot 4: DISABLED</div><div>Key Slot 5: DISABLED</div><div>Key Slot 6: DISABLED</div><div>Key Slot 7: DISABLED</div></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# dd if=0.img of=LUKS2.dd bs=521 count=4096</div><div>记录了4096+0 的读入</div><div>记录了4096+0 的写出</div><div>2134016 bytes (2.1 MB, 2.0 MiB) copied, 0.0732214 s, 29.1 MB/s</div></div><div>然后用hashcat工具配合Kali自带的密码字典rockyou.txt进行hash爆破：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>D:\CTFToolkit-v1.1.0\密码工具\hashcat-6.1.1&gt;hashcat.exe -D 1,2 -a 0 -m 14600 LUKS2.dd rockyou.txt</div></div><div><img src="BUUCTF Misc 53（257-260）_files/Image [4].png" type="image/png" data-filename="Image.png"/></div><div>得到密码：gaffer3。解密并挂载镜像：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# cryptsetup luksOpen 0.img luks</div><div>输入 0.img 的口令：（在这里输入得到的密码）</div></div><div>然后打开镜像得到flag：</div><div><img src="BUUCTF Misc 53（257-260）_files/Image [5].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div>flag：CTF{lame_users_keys_suck}</div><div><span style="font-weight: bold;">在BUUCTF上本题需要交的就是flag{lame_users_keys_suck}。</span></div><div><br/></div><div><span style="font-weight: bold;">第三题：</span>Our third suspect was caught with a running machine with the encrypted disk mounted. We captured the whole hard drive and system memory for you. Can you help us? <span style="font-size: unset; color: unset; font-family: unset;">(Please note, this is a rather large file!)</span></div><div>题目附件：<a href="https://storage.googleapis.com/bsides-sf-ctf-2019-large-artifacts/goodluks3.7z">goodluks3.7z</a>（361MB）</div><div><br/></div><div>下载得到7z格式压缩包，解压得到内存dump文件goodluks3.mem和镜像goodluks3.img。直接用7-Zip解压镜像文件goodluks3.img会发现有多个磁盘。用parted命令查看：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# parted goodluks3.img</div><div>GNU Parted 3.3</div><div>Using /root/Desktop/goodluks3.img</div><div>Welcome to GNU Parted! Type 'help' to view a list of commands.</div><div>(parted) <span style="color: rgb(255, 0, 0);">print</span>                                                            </div><div>Model:  (file)</div><div>Disk /root/Desktop/goodluks3.img: 4295MB</div><div>Sector size (logical/physical): 512B/512B</div><div>Partition Table: msdos</div><div>Disk Flags:</div><div><br/></div><div>Number  Start   End     Size    Type     File system     Flags</div><div>1      1049kB  3000MB  2999MB  primary  ext4            boot</div><div>2      3000MB  4000MB  1000MB  primary</div><div>3      4000MB  4294MB  294MB   primary  linux-swap(v1)</div></div><div>LUKS加密磁盘在第2个。用7-Zip解压goodluks3.img得到1.img（1GB），同样为LUKS加密镜像，密码应该在同时给出的goodluks3.mem中。考虑到cryptsetup luksOpen命令可以直接从文件读取AES密钥作为密码，参考<a href="https://teamrocketist.github.io/2019/03/05/Forensics-BsidesSF-2019-goodluks3/">Writeup</a>，用<a href="https://sourceforge.net/projects/findaes/">findaes</a>工具从文件中搜索AES密钥：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>D:\CTFToolkit-v1.1.0\密码工具\findaes-1.2&gt;findaes.exe goodluks3.mem</div><div>Searching goodluks3.mem</div><div>Found AES-256 key schedule at offset 0x895dd88:</div><div>b0 7a 29 f5 44 15 47 76 57 04 6e ec d3 03 f5 bd af a4 e6 df b2 71 01 ab af 7e 22 e1 23 94 15 f5</div><div>Found AES-256 key schedule at offset 0x895df78:</div><div>8e 8c 3a 67 eb 11 54 6c b1 cc 7d 0f cc 85 e8 43 30 7c 16 d4 7f 86 08 a1 0f 59 3d 4c 31 0f c8 6a</div></div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">共得到两段32字节长的密钥，用十六进制编辑器分别保存为key1和key2，先尝试key1：</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# cryptsetup luksOpen --master-key-file key1 1.img decrypted</div><div>Cannot read 64 bytes from keyfile key1.</div></div><div>提示需要64字节长度的密钥，因此需要把两段数据拼接成一个文件作为密钥，尝试后发现拼接顺序如下：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>8e 8c 3a 67 eb 11 54 6c b1 cc 7d 0f cc 85 e8 43 30 7c 16 d4 7f 86 08 a1 0f 59 3d 4c 31 0f c8 6a</div><div>b0 7a 29 f5 44 15 47 76 57 04 6e ec d3 03 f5 bd af a4 e6 df b2 71 01 ab af 7e 22 e1 23 94 15 f5</div></div><div>然后解密并挂载，得到flag：</div><div><img src="BUUCTF Misc 53（257-260）_files/Image [6].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div>flag：CTF{lucky_U_k33p_secrets!}</div><div><br/></div><div>最后提醒一下，BUUCTF上要交的是第二题的flag。</div><div><br/></div><div><span style="font-weight: bold;">260 [INSHack2019]Lit [FAM] - Part F</span></div><div><br/></div><div>下载得到md格式文件和FAM.wav。前者是题目说明：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>We have a proof of extraterrestrial life ! Or is it just a random amateur radio operator ?</div><div>Anyway, here is a strange RF interception(same file as part A). The file contains two independent flags, please submit the one matching `INSA{[A-Za-z0-9_]+}` here.</div></div><div>FAM.wav文件和Part A提供的完全一致，本题需要提交另一个大小写字母数字混合的flag。</div><div><br/></div><div>参见257题Part A中FSK调制解码结果：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>b'_in_th3_AiR_4_u_4nd_Me}INSA{iS_in_th3_AiR_4_u_4nd_Me}INSA{iS_ih'</div></div><div><br/></div><div>flag：INSA{iS_in_th3_AiR_4_u_4nd_Me}</div></span>
</div></body></html> 