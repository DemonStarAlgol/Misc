<html>
<head>
  <title>BUUCTF Misc 54（261-264）</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/605894 (zh-CN, DDL); Windows/6.1.1 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="733"/>
<h1>BUUCTF Misc 54（261-264）</h1>
<h2><a href="https://DemonStarAlgol.github.io/Misc/">[无关链接]</a></h2>

<div>
<span><div><span style="font-weight: bold;">261 [INSHack2019]neurovision</span></div><div><br/></div><div>下载得到md格式文件和无后缀名的neurovision文件。前者是题目说明：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>We found this strange file from an AI Startup. Maybe it contains sensitive information...</div></div><div><br/></div><div>用file命令查看文件类型：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# file neurovision-2d327377b559adb7fc04e0c3ee5c950c</div><div>neurovision-2d327377b559adb7fc04e0c3ee5c950c: Hierarchical Data Format (version 5) data</div></div><div>结合题目名称，可以判断这是一个<a href="https://keras.io/zh/">Keras</a>模型文件。</div><div><br/></div><div>先记录一下Writeup：</div><div><a href="https://zenhack.it/writeups/Inshack2019/neurovision/">https://zenhack.it/writeups/Inshack2019/neurovision/</a></div><div><a href="https://blog.julianjm.com/INS-Hack-2019/">https://blog.julianjm.com/INS-Hack-2019/</a></div><div><br/></div><div>flag：INSA{0v3rfitt3d_th3_Fl4g!}</div><div><br/></div><div><span style="font-weight: bold;">262 [INSHack2019]Drone Motion</span></div><div><br/></div><div>下载得到md格式文件和sensors.log。前者是题目说明：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>We intercepted a drone flying above a restricted area and retrieved a log from its memory card.</div><div>Help us find out what this drone was doing above our heads!</div><div>Flag must match the regex: `INSA\{[a-f0-9]+\}`</div><div><br/></div><div>Hint 1 :</div><div>The flag is expected to be a lowercase hexadecimal string.</div><div>Do not mess things up with `E` and `F`, `F` has a shorter horizontal line in the middle.</div></div><div><br/></div><div>打开sensors.log：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>[drone](DEBUG)&gt; accel: 0</div><div>[drone](DEBUG)&gt; dir: (x=0.00000,y=0.00000,z=1.00000)</div><div>[drone](DEBUG)&gt; accel: 4</div><div>[drone](DEBUG)&gt; dir: (x=0.00000,y=0.00000,z=1.00000)</div><div>[drone](DEBUG)&gt; accel: 4</div><div>[drone](DEBUG)&gt; dir: (x=0.00000,y=0.00000,z=0.99999)</div><div>[drone](DEBUG)&gt; accel: 4</div><div>[drone](DEBUG)&gt; dir: (x=0.00000,y=0.00000,z=0.99999)</div><div>[drone](DEBUG)&gt; accel: 4</div><div>[drone](DEBUG)&gt; dir: (x=0.00000,y=0.00000,z=1.00000)</div><div>[drone](DEBUG)&gt; accel: 4</div><div>[drone](DEBUG)&gt; dir: (x=0.00000,y=0.00000,z=1.00000)</div><div>[drone](DEBUG)&gt; accel: 4</div><div>[drone](DEBUG)&gt; dir: (x=0.00000,y=0.00000,z=1.00000)</div><div>[drone](DEBUG)&gt; accel: 4</div><div>[drone](DEBUG)&gt; dir: (x=0.00000,y=0.00000,z=0.99999)</div><div>[drone](DEBUG)&gt; accel: 4</div><div>[drone](DEBUG)&gt; dir: (x=0.00000,y=0.00000,z=1.00000)</div><div>……（后略）</div></div><div>很明显是无人机的飞行记录，每行都有一组x y z的三维坐标。根据无人机原理，记录的不可能是空间绝对坐标，只能是相对上一条记录的相对坐标。根据坐标绘图就能得到无人机的飞行路径。</div><div><br/></div><div>写Python脚本计算每一条日志记录时间点无人机的三维坐标：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>log = open('C:/Users/Administrator/Desktop/sensors.log', 'r').readlines()</div><div><br/></div><div>x, y, z = 0, 0, 0</div><div>X, Y, Z = [], [], []</div><div>for i in log:</div><div>    if i[-2] == ')':</div><div>        line = i.replace('[drone](DEBUG)&gt; dir: (x=', '').replace('y=', '').replace('z=', '').replace(')', '')[:-1]</div><div>        line = line.split(',')</div><div>        x += float(line[0])</div><div>        X.append(x)</div><div>        y += float(line[1])</div><div>        Y.append(y)</div><div>        z += float(line[2])</div><div>        Z.append(z)</div></div><div>尝试对每两组坐标绘图，发现仅x-y坐标的路径是有意义的，z轴大部分时间在单调上升。以x-y坐标绘图：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>import matplotlib.pyplot</div><div><br/></div><div>matplotlib.pyplot.plot(X, Y, '-')</div><div>matplotlib.pyplot.axis('equal')</div><div>matplotlib.pyplot.show()</div></div><div><img src="BUUCTF Misc 54（261-264）_files/无标题.png" type="image/png" data-filename="无标题.png"/></div><div>根据题目提示，flag是小写的十六进制数字串，E和F的区别是F中间的一横较短。由此得到flag。</div><div><br/></div><div>flag：INSA{66333db55e9ca50e9e9c4c94dc45250532832dc4681d531f0fab6d1a255c8578}</div><div><br/></div><div><span style="font-weight: bold;">263 [b01lers2020]matryoshka</span></div><div><br/></div><div>下载得到png格式文件。大小为6050x6050，放大看一下局部：</div><div><img src="BUUCTF Misc 54（261-264）_files/Image.png" type="image/png" data-filename="Image.png"/></div><div>很多草莓，有的朝左有的朝右。单个草莓占据的空间是50x50，也即总共有121x121个草莓。</div><div><br/></div><div>首先用ImageMagick提取朝左和朝右的草莓图像：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>C:\Users\Administrator\Desktop&gt;magick convert matryoshka.png -crop 50x50+0+0 right.png</div><div>C:\Users\Administrator\Desktop&gt;magick convert matryoshka.png -crop 50x50+200+200 left.png</div></div><div><img src="BUUCTF Misc 54（261-264）_files/right.png" type="image/png" data-filename="right.png"/><img src="BUUCTF Misc 54（261-264）_files/left.png" type="image/png" data-filename="left.png"/></div><div>选择一个两张图间存在差异的像素点(15, 10)作为判别依据：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>from PIL import Image</div><div><br/></div><div>right = Image.open('C:/Users/Administrator/Desktop/right.png')</div><div>left = Image.open('C:/Users/Administrator/Desktop/left.png')</div><div>r = right.getpixel((15, 10))</div><div>print(r)</div><div>l = left.getpixel((15, 10))</div><div>print(l)</div></div><div>读取原图并以每50x50像素为单位判别左右朝向草莓，由于121x121不是7或8的倍数，先排除ASCII转码，尝试将左右朝向分别转为黑白像素点：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>img = Image.open('C:/Users/Administrator/Desktop/matryoshka.png')</div><div>res = Image.new('RGB', (121, 121))</div><div>for x in range(121):</div><div>    for y in range(121):</div><div>        orix = 50 * x - 35</div><div>        oriy = 50 * y - 40</div><div>        p = img.getpixel((orix, oriy))</div><div>        if p == r:</div><div>            res.putpixel((x, y), (255, 255, 255))</div><div>        elif p == l:</div><div>            res.putpixel((x, y), (0, 0, 0))</div><div>res.save('C:/Users/Administrator/Desktop/res.png')</div></div><div>得到结果：</div><div><img src="BUUCTF Misc 54（261-264）_files/res.png" type="image/png" data-filename="res.png"/></div><div>但该二维码储存的是一段二进制数据（而非文字），使用<a href="https://zxing.org/w/decode.jspx">ZXing Decoder Online</a>扫码得到十六进制形式结果：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>40 48 d1 f8 b0 80 08 69   f6 35 e0 00 3e d9 94 b6</div><div>e1 b4 10 c4 4f 7b a0 de   fc 5f ba f1 36 09 aa f1</div><div>e7 b9 45 59 24 58 0c 8b   02 d8 f7 ac 86 27 da 8d</div><div>8e 9f e0 b8 fc fd f2 8f   ae f5 5a de 7d 17 cf ef</div><div>ce 8e 7e b7 3a 95 ba f9   d5 79 e6 fe 78 aa b5 0b</div><div>59 b2 af db cc 21 d3 5d   57 bb e9 d3 bd 2a 58 2e</div><div>4d 43 a5 5c ff 50 1f 69   40 4c 82 93 9d 7e 9f c1</div><div>c2 f0 1a fe f5 50 f2 48   f3 39 70 e9 0f 9a 4d d7</div><div>3e cd 75 53 35 88 5a 7e   9d 07 3a 46 6e 25 ae 0b</div><div>f5 40 d5 75 3e d1 9f 04   df 4d 16 b9 81 4d d2 f5</div><div>e8 bf eb ff 37 17 94 08   f9 40 fd 6a 35 64 9c 0a</div><div>83 f5 47 cf 16 b6 fa 42   1b f5 24 a3 4c 5d ba 81</div><div>82 98 4b 58 6f 7c b4 47   bb c4 e3 de 82 c1 f9 dd</div><div>ea 88 5c 6e 30 32 07 27   d7 0a 3c af 20 a9 1b 35</div><div>af 6f 8f 26 06 e8 ee f9   51 7f 50 e7 fc 36 bb 74</div><div>fe 2a 25 4d 61 2f 01 05   cc 99 85 6a b3 dc 1f 80</div><div>e5 bc 7a a9 41 e3 15 80   83 97 cd 4c a5 c0 97 8a</div><div>7d 14 ac 34 b3 fb 9e 3c   69 a2 be d7 36 b9 f2 d4</div><div>74 4d 7f b6 53 9c b7 ec   dd 61 b7 76 6c 08 29 9b</div><div>cd 81 17 b6 1c 50 4d 92   3d a2 8b 52 65 9f cb 3b</div><div>3d 84 2c ba f9 8d f6 a6   34 2e 68 d0 77 59 79 03</div><div>a0 5f 04 20 ca 70 64 6b   45 11 23 26 2a 5a 48 80</div><div>17 c1 fd ec 36 ab b8 58   85 cf e7 6d ac 01 a0 d1</div><div>8d 9f 4c 25 96 29 56 da   2b d7 1f 31 a0 74 c0 7f</div><div>b4 2f e2 75 13 1b 67 64   26 fa ce 2b e5 60 b1 8e</div><div>3e 99 5d 47 a8 3f 57 bc   16 8a e5 de 3e bb 71 33</div><div>05 de 96 cc b0 34 e6 66   d0 c0 af 13 29 d0 0c a6</div><div>ba ee a6 8c 73 8a dc a0   d7 9e 29 a8 83 56 7c d2</div><div>b3 72 1d 4c 2a fc 0e 3c   05 0a 47 be 9f 19 1e 2d</div><div>c6 0e c2 47 82 54 0d ee   40 52 9a 77 71 8e db 69</div><div>87 8a 02 a9 78 99 6a a9   31 ea be 50 9f bd e2 f0</div><div>da bb 26 da bb d6 26 eb   f7 2c 91 11 a9 4d 3a 35</div><div>32 4c d2 ba 35 72 6d 23   b8 cf 6c 51 a8 d5 d3 3d</div><div>3c 4a 78 b7 55 9e b4 37   bd 94 f0 49 3a c3 5b b2</div><div>05 f3 6a ec 5c 05 85 1a   e6 92 1b 54 bc 4b 6d d2</div><div>66 f7 a1 3c a0 74 36 7a   c2 93 0e 64 15 ec 81 76</div><div>fe d0 25 c1 c5 e5 c8 c6   a2 1f 01 22 a0 6d 9d 9e</div><div>2b 19 27 b4 9d 62 11 94   b2 de c6 60 03 d2 5c 9e</div><div>01 a1 8a 58 99 4f fd 3e   04 e6 ca 5b 99 eb 9a e7</div><div>74 27 a9 36 33 bd e7 e0   d9 16 81 d1 98 25 34 e2</div><div>b9 5a c7 4e ea ba ae 84   4f 59 81 c8 ce b8 53 83</div><div>28 9e cb d0 7b 44 2d aa   04 b5 74 78 53 67 41 c3</div><div>b9 62 75 b6 84 96 43 c1   4e ac ad c0 a6 b8 6a fa</div><div>b2 a9 68 7d 58 42 1b c0   e0 25 92 bc ca 06 27 e8</div><div>7c 9c ab 84 3c f8 54 32   90 ab 4e 63 3b 6b d0 72</div><div>43 a6 5f 2b 3e 8a 93 d5   ca 27 ea 54 07 ec 4c dd</div><div>84 b3 f6 d8 fe 29 89 cb   db 03 2b 37 8d 27 a5 82</div><div>2f 5c 6f c4 ac 7c 71 dc   b8 59 d5 d0 56 32 99 a2</div><div>10 8f 15 51 50 de 70 61   7d be 69 02 91 4d e5 8c</div><div>00 ce 84 e9 a9 69 0c 41   6b 0d 81 a1 b8 af bd bb</div><div>f5 d5 21 8a 80 1a b3 e5   02 2d a5 66 20 d4 79 40</div><div>16 86 c2 be 95 ba 7d 5a   c8 c7 5e bb d7 76 04 ce</div><div>b9 23 38 e6 e1 75 7f 93   dd 69 15 e2 19 cf 4c 81</div><div>16 18 5f 02 5d 29 df 7a   de 63 25 ee d0 8d df a6</div><div>97 0e 73 ca 1a 4a 33 dd   01 af 4d a9 9a 11 88 02</div><div>15 dc ce ec 48 66 9e 6a   d0 ba b7 65 70 7f 6e 4c</div><div>c5 a5 ee f0 56 46 ab 3c   f3 20 cb fc c1 5e b5 a5</div><div>1b fc 7a e1 7f 56 30 70   c4 69 d8 bb 1c 58 bd 7b</div><div>54 09 4a 96 58 a7 80 59   0f 09 30 db 35 26 06 39</div><div>54 ee e7 d6 4d 68 7c 20   8a 20 46 5b f4 2b b6 38</div><div>a0 0e 89 6b e0 15 7d 07   8f 16 ad 1b 58 80 22 5b</div><div>3d 26 e9 ec 77 eb 75 aa   b1 29 e8 66 d0 cd 4d c0</div><div>f4 9f 01 68 7a c6 c4 d5   aa a7 20 cc ea 5e 38 8b</div><div>89 5c a5 83 b5 b9 e3 91   65 86 81 3a d7 4e c5 7d</div><div>9f cb ed 54 13 8f 36 6b   d2 44 03 a6 26 eb 50 a8</div><div>c7 50 48 9e 78 55 9e 12   34 c2 99 e4 c6 fb fd 22</div><div>91 6c 20 fc c8 62 c2 bf   be 28 19 ee fb f1 50 75</div><div>76 29 17 4c 59 56 45 8d   a2 3e 9f 5d 77 2c ba 50</div><div>96 4f b2 9a 36 7a c8 75   f5 46 56 b8 44 eb 59 26</div><div>75 b4 7b 23 14 8e 25 7a   c5 a0 1f 3c da 9d ef 9c</div><div>89 33 c2 e5 ec 91 ce 65   50 a0 05 97 e9 2c 0c 1d</div><div>1e bf f6 15 65 28 a5 6f   62 88 ba 63 42 15 d9 58</div><div>23 ff df 85 ff 5f 30 30   4d 50 ca 08 e1 c0 00 00</div><div>00 ec 11 ec 11 ec</div></div><div>但ZXing给出的结果中，第1位数字是编码模式（4代表byte字节模式，支持0x00-0xFF的所有字符，也因此本题的二维码无法直接扫描识别为文字），第2-5位是数据长度，第6位开始才是被编码的数据。因此，这段数据的开头实际上是1F 8B，很明显是gzip格式压缩包的文件头。<span style="font-size: unset; color: unset; font-family: unset;">把这段数据的前5位删掉，再去掉空格和换行，用十六进制编辑器保存为gz格式文件：</span></div><div><a href="BUUCTF Misc 54（261-264）_files/1.gz"><img src="BUUCTF Misc 54（261-264）_files/2426a8f4b9379f02e6387cbd05e7fdcf.png" alt="1.gz"></a></div><div><span style="font-size: unset; color: unset; font-family: unset;">解压得到文本：</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>lllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllll</div><div>lllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllll</div><div>lllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllll</div><div>lllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllll</div><div>llll1111111l111l111l1l1lll1l1ll111l11lll111l111l1lll1l1llll1l1l11l1lllllll1111111llll</div><div>llll1lllll1l1ll1l1111ll1l1l11l1l1l1l1ll11ll1ll11llllll1ll11l111l1ll1111l1l1lllll1llll</div><div>llll1l111l1l111l11llll1l11ll11l1llll11ll1lllll1l11l1l1111ll111l11l11llll1l1l111l1llll</div><div>llll1l111l1l1111ll1ll1l1111111llll1ll1ll1llll1lll1lll1lllllll11ll1111lll1l1l111l1llll</div><div>llll1l111l1ll1ll11l1111lll11111111l111111l11l1ll1l11111l1l11lll1l11l1l111l1l111l1llll</div><div>llll1lllll1ll11lll111111ll111lll1l1111ll1l1l11l11l1lll111l1l1ll1ll1ll11lll1lllll1llll</div><div>llll1111111l1l1l1l1l1l1l1l1l1l1l1l1l1l1l1l1l1l1l1l1l1l1l1l1l1l1l1l1l1l1l1l1111111llll</div><div>lllllllllllllll11111l1l1ll111lll1l1l11ll1l111ll11l1lll111l1ll111l1l11llllllllllllllll</div><div>llll1l111l1l1l1l1l1llll1l1l1111111ll11l1l1lllll1ll11111l111l11ll1llll1l111lll1111llll</div><div>llllll1ll1l11l111ll1lllll1l11ll1l1l1l1l11111l1111l111l1ll1ll11ll1lll1l11ll1l11l1lllll</div><div>llll1lll1l11l1ll11ll11l11ll11l1l1l11l1ll11l111ll11llllll1lll111lll1111111ll1l1lllllll</div><div>llll1111llll1l11l1l1l1111lll1l1l1ll111lll11ll111l11l1l111l11lllll11l1l1l11ll1l1l1llll</div><div>llll1l1lll111l11llllll1l11l11lll1l1l1ll1l111l1lll1ll11l1l1l11l11lll1ll111ll11ll11llll</div><div>llll1l11lll1l1llllllllll1llll111l1lllll11l11l1ll1l1lll1llll1ll1l1l11l111l1111l1llllll</div><div>lllll1l11l1l111111ll111l1l1lll1l1lll1lll1l1111ll11l1l1l1l11111l111l1lllll1ll1ll11llll</div><div>llll1l1l1ll11lllll11l1lllll1llll1lllll1l1llll1l1l1l1l111ll11ll11l1lll1l1llll1l1l1llll</div><div>llllll111l1l1l1l1l111ll1ll11l1ll1111111l1111l1l11llll111ll1ll111111l111llll1l1l11llll</div><div>llll11111llll111111l11l111111l11l1l11l1ll11lllll1ll1l1llllllll1ll1111ll111l11111lllll</div><div>llll1ll1ll1llllll1l111l1lll111ll1l1ll1ll11ll111111llll1lll1ll1ll1ll11llll1l1l1l1lllll</div><div>lllll1l1llll1111l11ll111ll1111l1l11ll1lll1l11lll1l111l1111l11ll1l11ll111l1ll11l11llll</div><div>llll11l1111lll11l1llll1l11l1ll11111l1ll1111l1l111111l111lll11l11llllll1lll1lll111llll</div><div>lllll1lllll111ll11l1ll1ll1l11l111111l1l11111lll1l111l11ll1lll1111ll1lllll1l11l11lllll</div><div>llll1ll11l1l1l1l11lllll111111l1l1l1l1ll1ll1l1lll111l11lll11ll111l1l11lll111lll1l1llll</div><div>lllll1ll1ll1ll1ll11111l1l1l1l11ll1l1ll11l1ll1l1ll1111l11lll1ll111l1l1lllll1l11l11llll</div><div>llll1111111111ll1l1111llll1l1111111111ll1ll1ll11ll111111ll1l1l11l1l1ll1l1111111llllll</div><div>llllll1l1lll1lll11l1ll111l1l1lll11111ll111ll1l111l1lll11l1lllll1l111llll1lll1l1llllll</div><div>llll1l1l1l1l1111l111l1111ll11l1l1lll11ll11lll1111l1l1l1l1lll111ll1lllll11l1l1l1l1llll</div><div>llll1ll11lll1lllll1111llll1l1lll1ll11ll11l1llll1111lll1llll1l1111ll11lll1lll1ll1lllll</div><div>lllll111111111lll1ll1l1l1l1l1111111l11l11lll1l111l11111lll111llll1lll1l111111l1l1llll</div><div>llll1lll1ll11111l111llllll1llll1ll11ll1ll11llll1l111l1111l11111lll111ll1l1llll1llllll</div><div>lllllll11l1llll111l11l11l111111l11llll11lll11l1ll1l1lll1ll111llllll11l11ll111lll1llll</div><div>lllllll111lll111111lll1l11ll11ll1l1l11l111l1llllll11ll111l11l111111111l1l11l1ll11llll</div><div>llll1l11ll11l11ll1l11111lll111ll1ll111ll111l1llll11l1l11l1l1l1111l11l11llllll1l1lllll</div><div>lllll11lllllll1l111l11111l111ll1l1ll11l11ll1l1lll1ll1llll11ll1111ll1l111l1lll1111llll</div><div>llllllll1111l1llll1llll1l1l1ll1ll111lll111111111ll111l11llll1l1llll1111ll11lll1llllll</div><div>llll11l111ll1ll11111lll1l1l111lll1llll111l1lll11111llll11l1l11111l11111ll111ll111llll</div><div>lllll1l1l11l1ll1ll1llll1l1111111l1ll1lll1l1l11l11lllll1l1ll111111l1l11l1lll1ll1l1llll</div><div>llll1ll11llllllllllll111l111l1111l1ll1ll111ll111ll1l11ll1l1l11l11ll11ll11l1l11111llll</div><div>llll11l1l1111l11ll1lll1ll1ll1lllll1lll1ll1l111l11l1ll1lll1lllll11l11l1l11lll1ll1lllll</div><div>llll111ll1l1l1111ll1l1l111l1ll1lllll1l1l1lll1ll11l1l11ll1llll11lll1l1llll111lll11llll</div><div>llll1l1l1l11111111111111lll11111ll11l1l111l11ll1l1ll11l11111lll1l1lll1ll1l1l1llllllll</div><div>llll1l1l1lll111l111l1lll111l1l11l11l11ll1l1l11ll1111l1l11l11l1ll1111l1ll1lll1l11lllll</div><div>lllllll11l11ll11llll1ll1111111111ll111llll1ll11lll11l1ll1l11ll1l1ll1l1111ll1111l1llll</div><div>lllll11l1ll11ll111ll1111lll1l1l1llllll11111llllll11l111ll111l11l11lll1l1lllllll11llll</div><div>lllll11l111lll1lll1111lll11lll1l1l1111l111l11llll11l1llll1l1l11l111l11ll111111ll1llll</div><div>lllllllll1l11l1l1l1l11ll1l1lll1ll1l1l11ll1l1111l1l1lll111l11lll11ll111lllll11l111llll</div><div>llllllll111111111ll11l11ll1l11111ll11l11llll111ll1111111l111lll1lll1l1ll11111l111llll</div><div>llll11ll1lll1ll11lll1ll1lll11lll1111l1lll11lll1ll11lll1l1lllll111l1llll11lll11111llll</div><div>llllllll1l1l1lll1l1l11ll11111l1l11l1ll1l11l111ll111l1l1ll1111111l1111ll11l1l11ll1llll</div><div>llll111l1lll11l1lll1l1l111ll1lll1ll1l111111lll11ll1lll1111llll1lll11llll1lll1lll1llll</div><div>llll111l111111ll1l111llll11l111111lll1l1lll1111lll11111l111l11l11ll1llll11111ll1lllll</div><div>llllllll1ll1lll1111ll1lll1llll1l11llll1llll1l1lll1lll11lll111ll1l11ll1lll111l1lllllll</div><div>llll1l1l1l1l1111ll1111ll1ll111111lllll1l1lll11ll1l11llll1111lll11l1l1lll1l1l1l11lllll</div><div>llll1llll1llll1ll1111llll1l1lll111lll1ll1l1ll1l1lllll11lllll1ll111111ll1l11lll1llllll</div><div>llll11111l1l11l1ll11l1ll1lllll1l111111ll11ll1lllll11lll11ll1ll1llll11111l111llll1llll</div><div>llll1111l1l11lll1l1ll1l11ll111111l1ll111ll1lll1ll1l11lllll1l1ll1ll1l1l11111l11lllllll</div><div>lllll1ll1111l11ll1ll11111ll1l111l11l1l1ll1l111l111ll11ll1111l11ll1l1111111lll1l11llll</div><div>llllllll1lll1ll11ll1lll1l1ll1lll1l11ll1lll111llll1ll1ll1llll111lll11111ll1l11l111llll</div><div>llll111lll1lllll1ll111ll11l1l111l11l1l1lll1111l111l1ll111l111lll1l1ll11l1ll1l1lllllll</div><div>llll1l1l1llll1l111ll1111l111llll1ll1l1111l11l111ll1lllll1ll11lll11lll111l1ll11ll1llll</div><div>llll11l1l11l111l1ll11ll111l111l1ll1lll11l1ll1llll1111ll1lll11l11lllll11ll1lll1l11llll</div><div>llll1l1ll1l11l1111llll1l11ll11lll1l1ll1l1lll1111l1ll11lll11l11l11l1l11111ll11l11lllll</div><div>llll1l1l1l11lll1l1111l1l11111l111ll11l1l11llll1ll111ll111llllllllll1lllll11ll1111llll</div><div>llll11ll11l1ll11l11111lllll1l11l1llllll111l11l1ll1l1111l1lll11l11lll1llll11l1lll1llll</div><div>llll11lll11l1l111l1l11ll1llll1llll1llllll11l1l1111ll1l11l1l111ll1l1ll1l11ll1l1ll1llll</div><div>llll11ll11ll1llll1ll1111lll1lll1l11l11l1l1ll11lll11ll1l1l1l11111l1lll1l1111111ll1llll</div><div>lllll1ll111111l11ll1111l1111111l1l1l1l11l111llll1l111lll1l1l1l1l11111ll11llll1lllllll</div><div>llllllll1llllll1llll1lll1ll11lll1ll11l11l1l1ll1l1ll1ll1ll11l1l1l1l1l11ll11llll1llllll</div><div>lllll1111l111l111111l1l1ll11111111l1lll1ll11l1lll111111l1l11l1l111ll1l1111111lll1llll</div><div>llllllllllll11l11lll11l1llll1lll1ll111l1l1llll1ll11lll11111111l1l1111l1l1lll1l11lllll</div><div>llll1111111lllll111l11l11l111l1l1l11llll1l1lll1l111l1l1ll11l1ll11l1l1l1l1l1l1ll11llll</div><div>llll1lllll1ll11l11l1l1lllll11lll1l11l1ll1l1llll11l1lll1l11l1ll1ll11111ll1lll1l111llll</div><div>llll1l111l1l11ll1llll1lll11111111llll111l1lll11lll11111l1lll11111l11llll11111l111llll</div><div>llll1l111l1l1ll1lll11ll1ll111l1ll11ll1llll11l1ll11lll1l1ll1ll111l111ll11lll11l1llllll</div><div>llll1l111l1l11ll1lll1111l111ll1l111ll1ll11ll11l1ll1ll1lll1l11l11ll1l11l11llllllllllll</div><div>llll1lllll1ll1l1ll1lllllllll1lll1l1l1l11l11lll1l1ll11ll1l1ll11ll111lll11ll11lll11llll</div><div>llll1111111l1111111ll11llll11ll1ll1l1l11111l1l11l1111l11l1l1111l1l11ll11l11lll1llllll</div><div>lllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllll</div><div>lllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllll</div><div>lllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllll</div><div>lllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllll</div></div><div>是由数字1和小写l两种字符组成的85x85方阵，同样将数字1和小写l分别转换为黑白像素点：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>from PIL import Image</div><div><br/></div><div>data = open('C:/Users/Administrator/Desktop/1', 'r').readlines()</div><div>img = Image.new('RGB', (85, 85))</div><div><br/></div><div>for i in range(85):</div><div>    for j in range(85):</div><div>        if data[i][j] == '1':</div><div>            img.putpixel((j, i), (0, 0, 0))</div><div>        elif data[i][j] == 'l':</div><div>            img.putpixel((j, i), (255, 255, 255))</div><div>img.save('C:/Users/Administrator/Desktop/res2.png')</div></div><div><img src="BUUCTF Misc 54（261-264）_files/res2.png" type="image/png" data-filename="res2.png"/></div><div>同样使用<a href="https://zxing.org/w/decode.jspx">ZXing Decoder Online</a>扫码得到十六进制形式结果数据：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>40 20 78 95 04 e4 70 d0   a1 a0 a0 00 00 00 d4 94</div><div>84 45 20 00 00 03 90 00   00 03 90 10 00 00 00 0a</div><div>46 3b e2 80 00 00 1c e4   94 44 15 47 8d a8 dd 1e</div><div>f4 b1 37 11 c0 7f 0f 7f   77 3d fb cb b4 c4 fd a2</div><div>6a be dc 14 c9 a1 25 12   93 22 ea 11 ff 42 01 45</div><div>a5 85 19 ed 09 3c 04 7f   9b 81 e5 80 d7 a2 cf d7</div><div>85 25 89 1f 5a 0c 6d 8a   58 b8 87 e2 0c 58 25 66</div><div>bc 11 01 96 41 bd 43 94   6c d1 f2 b1 b6 57 7e dd</div><div>cf 52 ff 8f a1 75 ec 03   a2 8c 5c 45 6f da 30 94</div><div>86 db 98 a7 b5 40 20 95   75 b8 74 70 30 60 8d 5c</div><div>a2 35 90 50 8e 46 30 ff   60 04 cf 29 97 dc ba ea</div><div>8c 99 44 21 26 06 18 94   10 ef 65 47 dd 78 16 66</div><div>bb 2f e2 31 a0 01 35 2c   a4 57 24 e0 ff 08 da 17</div><div>0d ba 1d a3 81 8b b5 63   ad 6f ac b5 68 91 d2 f6</div><div>5e f9 e4 a8 29 cb 54 bb   33 3e d2 d8 07 cc 1f 7f</div><div>54 3f c2 04 8f 0f b4 35   3f a0 0b 8f dd 9f a3 93</div><div>87 71 66 4e 78 35 97 16   a0 56 82 a4 dc bf 1d 81</div><div>cb 06 9d 01 f1 4c 31 a2   0f 67 63 ec be b0 69 8f</div><div>23 ab 99 2d af cd 42 4b   3f b0 63 98 57 19 07 06</div><div>5b 97 4b 3d f0 4d 9f e8   9f 4a 7e e3 23 89 fc fb</div><div>ee 87 ad b0 03 45 a8 5f   ad 8e e1 85 84 3f fb 61</div><div>3a ec 85 29 20 95 fa c3   fb b2 6e b1 aa dd da b9</div><div>d3 9d 26 10 0f 4e fc 04   43 ea e8 1b 8e cb ad 59</div><div>b9 90 1d ff 0b c5 23 62   f3 78 13 1a d9 65 66 13</div><div>fe 68 e6 7d ff 97 92 70   22 2f 76 27 48 77 e1 f4</div><div>cf e3 e5 df 71 63 d7 d5   cf 85 68 c2 d7 66 90 08</div><div>fb 41 b8 7e 39 d8 02 82   d0 ce 57 22 a5 8b 34 77</div><div>28 fa 48 65 4a a2 e6 58   64 7e 43 44 83 18 eb e3</div><div>ff 7c 40 b6 ee dd ff bf   25 dd 60 b3 42 63 2c ec</div><div>e4 40 c1 ca b6 3f a9 d8   7b fc 1c 16 f9 fe c5 14</div><div>20 12 66 de f5 8f 8f ba   6d 6c 2c 55 7c 9f 29 6d</div><div>5c a7 a6 af 11 f2 1c 0a   bc 09 9c 8e f1 e0 00 00</div><div>00 04 94 54 e4 4a e4 26   08 20 00</div></div><div>去掉前5位后开头是89 50 4E 47，是PNG格式文件头。十六进制编辑器保存为png格式图片：</div><div><img src="BUUCTF Misc 54（261-264）_files/res3.png" type="image/png" data-filename="res3.png"/></div><div>反色处理后，继续使用<a href="https://zxing.org/w/decode.jspx">ZXing Decoder Online</a>扫码得到十六进制形式结果数据：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>4b 23 77 ab ca f2 71 c0   00 40 61 a7 14 a3 00 00</div><div>00 00 00 00 00 06 20 00   00 00 00 00 00 04 24 d0</div><div>5a 38 62 e6 8e b4 29 7d   63 a8 74 95 36 d0 90 13</div><div>73 13 37 87 3e 87 17 c1   4e 29 8f 3e 56 89 e1 0b</div><div>6d 5d da 12 2c 7d 1a 38   3b 14 9a 7e f1 bd ee 2a</div><div>2e 70 10 40 60 00 10 93   00 00 70 b0 10 00 22 40</div><div>6f 10 70 10 a5 30 76 46   7e cf 1b 6d 68 1a f2 12</div><div>10 10 00 10 00 c2 c2 80   00 80 a0 18 97 8b 59 f0</div><div>00 00 50 11 90 90 00 00   00 00 00 00 00 00 01 10</div><div>b0 06 60 06 c0 06 10 06   70 00 00 01 90 01 40 a0</div><div>10 08 0b e9 b6 a2 cf 3d   50 11 50 60 10 02 08 08</div><div>08 10 00 00 00 ec 11 ec   11 ec 11 ec 11 ec 11 ec</div><div>11 ec</div></div><div>本次解码长度较短，长度数据占1字节。去掉第1位4和长度数据b2后，实际数据开头为37 7A，是7z格式文件头。或者也可以通过ZXing返回的Raw text观察到文件头和类型。十六进制编辑器保存为7z格式文件：</div><div><img src="BUUCTF Misc 54（261-264）_files/Image [1].png" type="image/png" data-filename="Image.png"/></div><div>然而这个压缩包带有密码。经过搜索，在这一步找到了原题：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><b><font color="#FF0000">Super-secret password: один два ... ...</font></b></div></div><div>один два是俄语的1和2，后面跟着两段省略号，猜测密码是1234，成功解压。（所以这一步其实也可以弱密码字典爆破。）flag文件实际是个文本，打开就得到了flag。</div><div><br/></div><div>flag：pctf{dolls_do_get_boring_after_a_while}</div><div><br/></div><div><span style="font-weight: bold;">264 [INSHack2018]Visual hashing - hard</span></div><div><br/></div><div>下载得到md格式文件和chall.png。前者是题目说明：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>We recommend you to have a look at the first part of this chall (Visual hashing - easy) before attempting this one.</div><div>Our teams managed to infect a French Bureau of Investigation expert who uses the same extension(https://chrome.google.com/webstore/detail/visual-hashing/lkoelcpcjjehbjcchcbddggjmphfaiie), however our spy forgot to click &quot;Remove USB safely&quot; so now the video file is all corrupted.</div><div>We managed to save one of the frames from the capture, see what you can do with it. Also, we know that the password has the format INSA{&lt;lowercase&gt;}. Good luck.</div></div><div>图片内容：</div><div><img src="BUUCTF Misc 54（261-264）_files/chall.png" type="image/png" data-filename="chall.png"/></div><div><br/></div><div>从图片上可以看到，密码输入框内有一个11位的密码。由于已经知道flag格式是INSA{}，未知字符只有5位。同时题目还给出了一个Chrome浏览器扩展，该扩展的效果是根据输入的密码，将输入框显示为四种颜色。因此思路是，对5位未知字符进行爆破，直到扩展生成的颜色和图片中的相符为止。</div><div><br/></div><div>下载扩展查看代码，生成颜色的逻辑大致为：</div><div>1、计算所输入密码的SHA1值；</div><div>2、对SHA1值（十六进制格式）的第2、4、6、...位随机进行+/-3范围的扰动；</div><div>3、取扰动结果（十六进制格式）的前24位，每6位一段，转为RGB颜色值（十六进制格式）；</div><div>4、将密码输入框显示为这四种颜色。</div><div><br/></div><div>由于SHA1值的扰动是每隔两位进行，实际效果相当于四个颜色的R、G、B值各产生了+/-3的扰动。根据题目说明，5位未知字符均为小写。因此爆破流程为：生成5位小写字母组成的字符串，计算SHA1值，每两位与四种颜色的RGB值比较，如果12次比较中，差值均在+/-3以内，视为爆破成功。<span style="font-size: unset; color: unset; font-family: unset;">据此写出爆破脚本：</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>from PIL import Image</div><div>import string</div><div>import itertools</div><div>import hashlib</div><div><br/></div><div>img = Image.open('C:/Users/Administrator/Desktop/chall.png')</div><div>col1 = img.getpixel((77, 179))</div><div>col2 = img.getpixel((131, 180))</div><div>col3 = img.getpixel((215, 179))</div><div>col4 = img.getpixel((290, 179))</div><div>col = col1 + col2 + col3 + col4</div><div><br/></div><div>dic = string.ascii_lowercase</div><div><br/></div><div>for i in itertools.product(dic, repeat=5):</div><div>    pw = 'INSA{' + ''.join(i) + '}'</div><div>    sha = hashlib.sha1()</div><div>    sha.update(pw.encode('utf-8'))</div><div>    sha = sha.hexdigest()</div><div>    B = 0</div><div>    for j in range(12):</div><div>        c = int(sha[j * 2:j * 2 + 2], 16)</div><div>        if abs(col[j] - c) &gt; 3:</div><div>            B = 1</div><div>    if B == 0:</div><div>        print(pw)</div><div>        break</div></div><div>爆破结果：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>INSA{hctib}</div></div><div><br/></div><div>flag：INSA{hctib}</div></span>
</div></body></html> 