<html>
<head>
  <title>BUUCTF Misc 65（305-308）</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/605894 (zh-CN, DDL); Windows/6.1.1 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="3958"/>
<h1>BUUCTF Misc 65（305-308）</h1>
<h2><a href="https://DemonStarAlgol.github.io/Misc/">[无关链接]</a></h2>

<div>
<span><div><span style="font-weight: bold;">305 [VNCTF 2021]HAPPYNEWYEAR</span></div><div><br/></div><div>下载得到加密的zip格式压缩包和 password.png 图片。先看后者：</div><div><img src="BUUCTF Misc 65（305-308）_files/Image.png" type="image/png" data-filename="Image.png"/></div><div>应该是某两种符号式替换密码。根据提示<a href="https://www.dcode.fr/tools-list#symbols">https://www.dcode.fr/tools-list#symbols</a>，找到<a href="https://www.dcode.fr/chinese-code">Chinese Code</a>和<a href="https://www.dcode.fr/sheikah-language">Sheikah Language</a>（也就是《塞尔达传说》中的希卡字母）。对应替换表得到解压密码，字母为小写：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>f87840bdddcc01e4</div></div><div><br/></div><div>解压得到 happynewyear.png ，Stegsolve查看可以发现RGB Plane 0/1的左上角有LSB隐写痕迹。实际上根据提示，这里用到的是stegpy工具（该工具默认设置下确实也是把信息LSB隐写到颜色通道最低两位的）。尝试提取隐写信息：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# stegpy happynewyear.png</div><div>b'\xb6\xc2\xd0d|\xf5'</div><div>ERROR! No encoded info found!</div></div><div>说明需要密码，但题目并未给出密码，结合提示，猜测可能需要爆破。</div><div>stegpy原始用法里，输入密码是交互式的。但交互式输入密码的爆破脚本不会写，只能直接从源码里拿解密函数来用。</div><div><br/></div><div>首先把stegpy库里原有的lsb.py改成lsb2.py，主要改动读取隐写信息函数read_message一段：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>    def</div><div><br/></div><div><br/></div><div>read_message(self, password=None):</div><div>        msg = decode_message(self.data)</div><div>        </div><div>        if password:</div><div>            try:</div><div>                salt = bytes(msg[:16])</div><div>                msg = crypt.decrypt_info(password, bytes(msg[16:]), salt)</div><div>            except:</div><div>                <font color="#FF0000">return</font>(&quot;Wrong password.&quot;)</div><div><br/></div><div>        check_magic_number(msg)</div><div>        msg_len = int.from_bytes(bytes(msg[6:10]), 'big')</div><div>        filename_len = int.from_bytes(bytes(msg[10:11]), 'big')</div><div><br/></div><div>        start = filename_len + 11</div><div>        end = start + msg_len</div><div>        end_filename = filename_len + 11</div><div>        if(filename_len &gt; 0):</div><div>            filename = '_' + bytes(msg[11:end_filename]).decode('utf-8')</div><div>        </div><div>        else:</div><div>            text = bytes(msg[start:end]).decode('utf-8')</div><div>            print(text)</div><div>            return</div></div><div>目的是给出一个返回值，便于判断爆破时密码是否正确。然后直接调用lsb2.py中的函数写爆破脚本：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>from stegpy import lsb2</div><div><br/></div><div>host = lsb2.HostElement('C:/Users/Administrator/Desktop/happynewyear.png')</div><div>dic = open('C:/Users/Administrator/Desktop/password.txt').readlines()</div><div><br/></div><div>for i in range(len(dic)):</div><div>    tmp = host.read_message(dic[i][:-1])</div><div>    if tmp != &quot;Wrong password.&quot;:</div><div>        break</div><div>    else:</div><div>        print(i, dic[i][:-1])</div></div><div>密码字典的来源为github的<a href="https://github.com/Misclife/CTFpics-1/blob/master/password.txt">CTFpics项目</a>。运行结果：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>0 123456.com</div><div>1 abc</div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">（中略）</span></div><div>39 1236</div><div>40 qqii</div><div>VNCTF{HappyNewY3a5}</div></div><div>从而得到flag，对应的密码是tyinfo。</div><div><br/></div><div>flag：VNCTF{HappyNewY3a5}</div><div><br/></div><div>2021.6.26 举办的GKCTF 2021题目。没有参赛，只拿小号报名看了题。以下是根据赛后放到练习场的题目重新整理的解题笔记。序号接着前面的往下写，顺序是乱的，以题目名为准。</div><div><br/></div><div><span style="font-weight: bold;">306 [GKCTF 2021]FireFox Forensics</span></div><div>题目：取证大佬说这是一份登录凭证文件</div><div><br/></div><div>下载得到logins.json和key4.db文件。搜索文件名可以找到<a href="http://kb.mozillazine.org/Profile_folder_-_Firefox">这个页面</a>，是Mozilla Firefox的Profile文件夹内容目录。在其中可以找到logins.json是Firefox 32.0及以上版本加密储存浏览器所保存密码的文件。此外虽然页面最后更新于2015年因此信息较老没有列出key4.db，但能找到类似的<a href="http://kb.mozillazine.org/Key3.db">key3.db</a>，用于储存加密和解密浏览器所保存密码的密钥。</div><div><br/></div><div>看一下logins.json的文本内容：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>{&quot;nextId&quot;:5,&quot;logins&quot;:[{&quot;id&quot;:1,&quot;hostname&quot;:&quot;https://ctf.g1nkg0.com&quot;,&quot;httpRealm&quot;:null,&quot;formSubmitURL&quot;:&quot;https://ctf.g1nkg0.com&quot;,&quot;usernameField&quot;:&quot;user&quot;,&quot;passwordField&quot;:&quot;pw&quot;,&quot;encryptedUsername&quot;:&quot;MDIEEPgAAAAAAAAAAAAAAAAAAAEwFAYIKoZIhvcNAwcECBXzxJ6wNr0cBAhx14543pGy8g==&quot;,&quot;encryptedPassword&quot;:&quot;MFoEEPgAAAAAAAAAAAAAAAAAAAEwFAYIKoZIhvcNAwcECMW2u+IHw6/EBDANYRi1rCmbtlQ+NcZ8LX3T5PpXCaOdhDA5WIfxNe6r5MInejMWjj2dBFnNCG2eTSA=&quot;,&quot;guid&quot;:&quot;{f2f8705f-9210-42f6-b74a-de8f7d48d90a}&quot;,&quot;encType&quot;:1,&quot;timeCreated&quot;:1620471029427,&quot;timeLastUsed&quot;:1620471029427,&quot;timePasswordChanged&quot;:1620471029427,&quot;timesUsed&quot;:1}],&quot;disabledHosts&quot;:[],&quot;version&quot;:3,&quot;potentiallyVulnerablePasswords&quot;:[],&quot;dismissedBreachAlertsByLoginGUID&quot;:{}}</div></div><div>很明显只包含一组用户名和密码。结合题目名称及内容，可以判断本题要求解密还原这段Firefox加密储存的登录密码。</div><div><br/></div><div>Google搜索关键词“key4.db logins.json decrypt”，在搜索结果第三个找到工具<a href="https://github.com/lclevy/firepwd">firepwd</a>。直接用：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop/firepwd-master# python3 firepwd.py -d ./</div><div>globalSalt: b'1e26e84b2f01da28d865e7258f9003d16b9c43f2'</div><div>SEQUENCE {</div><div>   SEQUENCE {</div><div>     OBJECTIDENTIFIER 1.2.840.113549.1.5.13 pkcs5 pbes2</div><div>     SEQUENCE {</div><div>       SEQUENCE {</div><div>         OBJECTIDENTIFIER 1.2.840.113549.1.5.12 pkcs5 PBKDF2</div><div>         SEQUENCE {</div><div>           OCTETSTRING b'66a735e17767b37d83d464126b36d4269243f9e0c99405ccd68f442798f83129'</div><div>           INTEGER b'01'</div><div>           INTEGER b'20'</div><div>           SEQUENCE {</div><div>             OBJECTIDENTIFIER 1.2.840.113549.2.9 hmacWithSHA256</div><div>           }</div><div>         }</div><div>       }</div><div>       SEQUENCE {</div><div>         OBJECTIDENTIFIER 2.16.840.1.101.3.4.1.42 aes256-CBC</div><div>         OCTETSTRING b'24eb241594de7ab37ec379d9ba06'</div><div>       }</div><div>     }</div><div>   }</div><div>   OCTETSTRING b'946322a2b2978db6601e449e1bdf7c4d'</div><div>}</div><div>clearText b'70617373776f72642d636865636b0202'</div><div>password check? True</div><div>SEQUENCE {</div><div>   SEQUENCE {</div><div>     OBJECTIDENTIFIER 1.2.840.113549.1.5.13 pkcs5 pbes2</div><div>     SEQUENCE {</div><div>       SEQUENCE {</div><div>         OBJECTIDENTIFIER 1.2.840.113549.1.5.12 pkcs5 PBKDF2</div><div>         SEQUENCE {</div><div>           OCTETSTRING b'56722302469f529a29dc73f28d6af3ed0ee483cceff05772e96e2313336816fd'</div><div>           INTEGER b'01'</div><div>           INTEGER b'20'</div><div>           SEQUENCE {</div><div>             OBJECTIDENTIFIER 1.2.840.113549.2.9 hmacWithSHA256</div><div>           }</div><div>         }</div><div>       }</div><div>       SEQUENCE {</div><div>         OBJECTIDENTIFIER 2.16.840.1.101.3.4.1.42 aes256-CBC</div><div>         OCTETSTRING b'ef6a4df3e5fd7608c97df9e22092'</div><div>       }</div><div>     }</div><div>   }</div><div>   OCTETSTRING b'51b24cd6a2672c312255d7f2dddeb67336fd56973b4302bb2eacf2270c251d41'</div><div>}</div><div>clearText b'673dec57458fb95bd50bdc9198541038970e5b3d518973a40808080808080808'</div><div>decrypting login/password pairs</div><div>https://ctf.g1nkg0.com:b'admin',b'GKCTF{9cf21dda-34be-4f6c-a629-9c4647981ad7}'</div></div><div><br/></div><div>另一个可用的工具是PasswordFox：</div><div><img src="BUUCTF Misc 65（305-308）_files/Image [1].png" type="image/png" data-filename="Image.png"/></div><div>菜单栏File-Select Folders，然后选中两个文件所在的文件夹即可直接看到flag。</div><div><br/></div><div>flag：GKCTF{9cf21dda-34be-4f6c-a629-9c4647981ad7}</div><div><br/></div><div><span style="font-weight: bold;">307 [GKCTF 2021]excel 骚操作</span></div><div><br/></div><div>下载得到xlsx格式文件，打开看一下：</div><div><img src="BUUCTF Misc 65（305-308）_files/Image [2].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div>看起来什么都没有，但选中部分单元格后可以看到上方的内容栏里出现了字符1：</div><div><img src="BUUCTF Misc 65（305-308）_files/Image [3].png" type="image/png" data-filename="Image.png"/></div><div>实际上整个表格里有503个字符1：</div><div><img src="BUUCTF Misc 65（305-308）_files/Image [4].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div>利用替换功能把所有带1的单元格标注出来：</div><div><img src="BUUCTF Misc 65（305-308）_files/Image [5].png" type="image/png" data-filename="Image.png"/></div><div><img src="BUUCTF Misc 65（305-308）_files/Image [6].png" type="image/png" data-filename="Image.png"/></div><div>得到结果：</div><div><img src="BUUCTF Misc 65（305-308）_files/Image [7].png" type="image/png" data-filename="Image.png"/></div><div>可以看到黑色单元格排列成了类似汉信码的形状，调整一下A-AG列的列宽为3使单个格子更接近正方形：</div><div><img src="BUUCTF Misc 65（305-308）_files/Image [8].png" type="image/png" data-filename="Image.png"/></div><div>用中国编码手机APP扫描：</div><div><img src="BUUCTF Misc 65（305-308）_files/微信图片_20210628103941.jpg" type="image/jpeg" data-filename="微信图片_20210628103941.jpg"/></div><div>得到flag。</div><div><br/></div><div>flag：flag{9ee0cb62-f443-4a72-e9a3-43c0b910757e}</div><div><br/></div><div><span style="font-weight: bold;">308 [GKCTF 2021]0.03</span></div><div>题目：我的真心值三分吗</div><div><br/></div><div>下载得到350MB的rar格式压缩包。看见rar就留个心眼，7zip打开看看：</div><div><img src="BUUCTF Misc 65（305-308）_files/Image [9].png" type="image/png" data-filename="Image.png"/></div><div>果然有NTFS数据流文件。</div><div><br/></div><div>依次查看压缩包里的三个文件。第一个flag_in_the_disk.zip直接打开报错，十六进制编辑器查看，可以判定其并非常见压缩文件格式，很可能是其他类型文件被修改了后缀名。根据文件名称，怀疑其可能是某种磁盘镜像。尝试了多种与磁盘镜像相关的工具后发现VeraCrypt能够加载，还问我要密码：</div><div><img src="BUUCTF Misc 65（305-308）_files/Image [10].png" type="image/png" data-filename="Image.png"/></div><div>那就继续找密码。</div><div><br/></div><div>看一下两个txt文件。首先是secret.txt：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>do you believe that you get?</div><div><br/></div><div>311223313313112122312312313311</div></div><div>然后是whatyoumaywant：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>QAZ WSX EDC</div><div>RFV TGB YHN</div><div>UJM IKO LP/</div></div><div>看起来像是密文和密码本。观察一下规律：</div><div>1、密文仅由123三种数字构成，且长度为30；</div><div>2、密码本由27个不同字符（26个大写字母及斜杠/）构成，且排列成了 3行 x 3列 x 3个 的形式。</div><div>结合题目内容里的“三分”，判定为<a href="https://baike.baidu.com/item/%E4%B8%89%E5%88%86%E5%AF%86%E7%A0%81/2250183">三分密码</a>。密文中三个数字一组，对应了明文字符在密码本中的坐标。坐标顺序有先行后列或先列后行两种可能性。因为我不想数数所以写个脚本跑一下：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>s = '311223313313112122312312313311'</div><div>t = '''QAZ WSX EDC</div><div>RFV TGB YHN</div><div>UJM IKO LP/'''</div><div><br/></div><div>m = [i.split(' ') for i in t.split('\n')]</div><div>pw1, pw2 = '', ''</div><div>for i in range(0, len(s), 3):</div><div>    pw1 += m[int(s[i])-1][int(s[i+1])-1][int(s[i+2])-1]</div><div>    pw2 += m[int(s[i+1])-1][int(s[i])-1][int(s[i+2])-1]</div><div>print(pw1, pw2)</div></div><div>输出结果：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>UBMMASJJMU EBCCAFDDCE</div></div><div>两个密码都输入VeraCrypt试一下，正确密码是后者。</div><div><br/></div><div>最后进入挂载得到的虚拟磁盘，找到flag.txt，得到flag：</div><div><img src="BUUCTF Misc 65（305-308）_files/Image [11].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div>flag：flag{85ec0e23-ebbe-4fa7-9c8c-e8b743d0d85c}</div></span>
</div></body></html> 