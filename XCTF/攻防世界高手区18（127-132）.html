<html>
<head>
  <title>攻防世界高手区18（127-132）</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/605894 (zh-CN, DDL); Windows/6.1.1 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="971"/>
<h1>攻防世界高手区18（127-132）</h1>
<h2><a href="https://DemonStarAlgol.github.io/Misc/">[无关链接]</a></h2>

<div>
<span><div><span style="font-weight: bold;">127 神秘的交易</span></div><div>题目：--宝贝儿约吗~ --约~老地方吗 --嗯呐~等你哦 --上次送你的那张会员卡，我是用我们的门牌号的密码，爱你 --晚上等我！ 惊了！怪不得柠檬师傅最近总往北街跑。看他午休的时候，我悄悄拿走了他的会员卡， 是一张4442的接触式卡。你知道吗，通过逻辑分析仪可以嗅探出他的加密密钥。快来 跟我念出密钥，把他揪出来！（以16进制表示）</div><div><br/></div><div>下载得到logicdata格式文件。Saleae Logic打开。</div><div><img src="攻防世界高手区18（127-132）_files/Image.png" type="image/png" data-filename="Image.png"/></div><div>可以看到有时钟电平clk和数据电平data。查4442卡手册可以得知指令格式为：</div><div>1、每个指令从时钟高电平时数据下降沿后开始，数据从低位到高位的顺序发送。每个命令由三个字节组成：控制字节、地址字节、数据字节。时钟高电平数据电平上升沿代表本次命令结束。</div><div><span style="font-size: unset; color: unset; font-family: unset;">2、与加密密钥相关的指令类型是0x33，用于校验口令。而4442卡的口令为三字节。</span></div><div><span style="font-size: unset; color: unset; font-family: unset;">因此我们需要找到这样一串数据：</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>0x33 0x01 flag[1] 0x33 0x02 flag[2] 0x33 0x03 flag[3]</div></div><div>在6s950ms处找到这串数据：</div><div><img src="攻防世界高手区18（127-132）_files/Image [1].png" type="image/png" data-filename="Image.png"/></div><div>第一段：</div><div><img src="攻防世界高手区18（127-132）_files/Image [2].png" type="image/png" data-filename="Image.png"/></div><div>因此密钥的第一个字节是0x40。重点是在时钟电平找到开始和结束标志（表现为一个较宽的峰），然后从数据电平按从高到低读取数据。第二段和第三段就在第一段后，各相隔3位。以此类推得到flag。</div><div><br/></div><div>flag：SCTF{403110}</div><div><br/></div><div><span style="font-weight: bold;">128 secret_in_the_center</span></div><div><br/></div><div>下载得到无后缀名文件，十六进制编辑器查看发现是zip压缩包，但开头被改成50 4B 13 14。重命名并修复文件头为50 4B 03 04，解压得到raw.txt，内容：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>1284127282371497062677311074762266138188682452,1061034162220021178928947580605340250986215805</div><div>3340934738305796487992773649714719725826419120,3521272815040026806681782376130203385829188680</div><div>2227289825537197658661849099809813150550946084,2200795509400016754176113985081377116143242930</div></div><div>共三行，每行两段46位的十进制数字。如果将其看作三角形的三个顶点，然后根据题目提示计算三角形的重心：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>x1, y1 = 1284127282371497062677311074762266138188682452, 1061034162220021178928947580605340250986215805</div><div>x2, y2 = 3340934738305796487992773649714719725826419120, 3521272815040026806681782376130203385829188680</div><div>x3, y3 = 2227289825537197658661849099809813150550946084, 2200795509400016754176113985081377116143242930</div><div><br/></div><div>x = (x1 + x2 + x3) // 3</div><div>y = (y1 + y2 + y3) // 3</div><div>x = hex(x)[2:]</div><div>y = hex(y)[2:]</div><div>print(x, y)</div></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>输出：</div><div>666c61677b6365663434623436663136616538 6563663636346466343236366666646266397d</div></div><div>ASCII转码得到flag。</div><div><br/></div><div>flag：flag{cef44b46f16ae8ecf664df4266ffdbf9}</div><div><br/></div><div><span style="font-weight: bold;">129 opm-3</span></div><div><br/></div><div>下载得到无后缀名文件，file查看确认是png格式，重命名。zsteg看一下：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# zsteg a.png</div><div>imagedata           .. text: &quot;$%%#%%;;9Z\\Z&quot;</div><div>b1,rgb,lsb,xy       .. file: Zip archive data, at least v2.0 to extract</div><div>b4,rgb,lsb,xy       .. text: &quot;C'DSGGen&quot;</div><div>b4,bgr,lsb,xy       .. text: &quot;#DGCWGeo&quot;</div></div><div>最低位存在LSB隐写，内容是zip压缩包。用Stegsolve提取。解压得到名为STMFD SP!, {R11,LR}的文件。</div><div>该文件实际为文本文件，共1203行，每行是两个8位的十六进制数字，前几行为：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>aa109c60 e92d4800</div><div>aa109c64 e28db004</div><div>aa109c68 e24dd018</div><div>aa109c6c e50b0010</div><div>aa109c70 e50b1014</div><div>aa109c74 e50b2018</div><div>aa109c78 e51b3010</div><div>aa109c7c e5933000</div><div>aa109c80 e59332a4</div></div><div>搜索一下这个文件名，会发现是ARM的二进制代码段dump，接下来就是逆向题了。抄Writeup：</div><div><a href="https://github.com/sixstars/ctf/tree/master/2016/0ctf/misc/opm">https://github.com/sixstars/ctf/tree/master/2016/0ctf/misc/opm</a></div><div><br/></div><div>转成二进制形式扔ida里，在0xaa109cc4处create function，F5得到这样的东西：</div><div><img src="攻防世界高手区18（127-132）_files/opm_function.png" type="image/png" data-filename="opm_function.png"/></div><div>猜测v6-34是flag字符串，长为16。<span style="font-size: unset; color: unset; font-family: unset;">然后函数结尾处有个check：</span></div><div><img src="攻防世界高手区18（127-132）_files/opm_equation.png" type="image/png" data-filename="opm_equation.png"/></div><div>每个被检查的变量都是flag字符串的线性组合，如图：</div><div><img src="攻防世界高手区18（127-132）_files/opm_coeff.png" type="image/png" data-filename="opm_coeff.png"/></div><div>那么提取系数，解16元线性方程组，得到flag：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>&gt;&gt;&gt; import numpy</div><div>&gt;&gt;&gt; a=numpy.array([[-32, 97, 46, 45, 67, 79, -73, -13, -5, 27, -83, -100, -26, -55, 32, -55], [-31, -90, 20, -66, -89, -64, -73, 26, 87, -76, 15, 72, 85, 89, 6, 84], [78, 22, 94, 75, 34, 31, 61, -16, 100, 14, 27, 92, -42, -7, 83, 57], [43, 44, 75, -59, -17, 82, -1, -44, 47, -68, 76, 72, 48, -89, 96, -27], [44, -60, 87, -64, 57, -18, -60, 9, -81, -33, 24, 84, 62, 89, 42, -97], [30, 68, 23, 91, 46, 32, -62, 42, -5, 54, -57, 59, 48, -97, 89, 79], [-29, -14, 14, -89, -60, 11, 49, -79, 75, -86, -99, -57, -10, 9, 62, -97], [58, 58, 17, 91, -98, -75, -5, -60, -26, 83, -81, 80, 97, 6, 31, -69], [-21, -11, 62, -77, 84, -86, 49, -66, -1, 26, -4, -27, -43, -1, 19, 73], [83, 43, 77, 96, 83, -20, 26, -7, -89, -60, -23, 68, -51, -75, 42, 35], [74, 58, 73, -86, -100, 71, 12, 66, 69, 50, 48, 58, -52, 14, 45, -91], [-60, -61, 26, -31, 20, -59, -53, 72, 68, -90, -41, -74, 48, -27, 30, 8], [-26, 19, 31, -16, -95, 33, 64, -83, 10, 98, -35, -76, 7, -12, 25, -34], [-89, 61, -40, -67, 20, 42, 27, -37, 38, -16, 71, 16, 75, 4, 51, -6], [32, 57, -92, -47, 40, -54, -21, -25, -14, 91, 64, 39, 7, 38, 96, 82], [-56, -6, 55, 42, -6, -38, -37, -27, 64, 16, -54, -53, -96, -31, 84, 100]])</div><div>&gt;&gt;&gt; y=numpy.array([-7026,-2645,53442,20609,8630,27564,-27078,15265,-12183,17452,31435,-23099,-8136,13019,20430,-12714])</div><div>&gt;&gt;&gt; import numpy.linalg</div><div>&gt;&gt;&gt; x=numpy.linalg.solve(a,y)</div><div>&gt;&gt;&gt; x</div><div>array([  84.,  114.,   52.,   99.,   49.,   78.,  103.,   95.,   70.,</div><div>         48.,   82.,   95.,   70.,  117.,   78.,   33.])</div><div>&gt;&gt;&gt; ''.join([chr(int(round(i))) for i in x])</div><div>'Tr4c1Ng_F0R_FuN!'</div></div><div><br/></div><div>flag：flag{Tr4c1Ng_F0R_FuN!}</div><div><br/></div><div><span style="font-weight: bold;">130 Noise</span></div><div><br/></div><div>下载得到wav文件，听音频会发现歌曲中夹杂着其他声音，结合题目名称Noise，猜测需要将噪声提取出来。<span style="font-size: unset; color: unset; font-family: unset;">这里可以利用声波叠加干涉消除原声，当声波的相位差达到180度的时候，就可以达到消音的效果。但必须</span>要找到原曲才能消音，先抄一份Writeup在这里。</div><div>下载《My Little Pony Theme Song》的原曲，用Adobe Audition对原曲进行相位调整，然后把两个音频文件对轨，整合输出，得到噪声部分。这段噪声是信号，导入SSTV软件（如MMSSTV）中就可以得到图像。</div><div><img src="攻防世界高手区18（127-132）_files/20180716083417539.png" type="image/png" data-filename="20180716083417539.png"/></div><div><br/></div><div>flag：QCTF{Th4t_1s_V3ry_Har5h}</div><div><br/></div><div><span style="font-weight: bold;">131 picture1</span></div><div><br/></div><div>下载得到无后缀名文件，file判断为png，重命名。</div><div><img src="攻防世界高手区18（127-132）_files/1.png" type="image/png" data-filename="1.png"/></div><div>Stegsolve打开可以看到在RGB plane 0处，单色背景出现了大量黑白交错像素点，怀疑有LSB隐写。</div><div><img src="攻防世界高手区18（127-132）_files/Image [3].png" type="image/png" data-filename="Image.png"/></div><div>尝试后发现需要用带密码的LSB解密脚本，密码是图中汉字的首字母。</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop/lsb# python lsb.py extract 1.png out.txt wwjkwywq</div><div>[+] Image size: 440x440 pixels.</div><div>[+] Written extracted data to out.</div></div><div><span style="color: rgb(255, 0, 0); font-weight: bold;">（后来查看Writeup发现，原题文件名是wwjkwywq.jpg-stego.png，基本把加密方式和密码都写在文件名里了……）</span></div><div><br/></div><div>解密出的内容很明显是一段DES加密的python脚本：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>#_*_ coding:utf-8 _*_</div><div>import re</div><div>import sys</div><div><br/></div><div>ip=  (58, 50, 42, 34, 26, 18, 10, 2,</div><div>      60, 52, 44, 36, 28, 20, 12, 4,</div><div>      62, 54, 46, 38, 30, 22, 14, 6,</div><div>      64, 56, 48, 40, 32, 24, 16, 8,</div><div>      57, 49, 41, 33, 25, 17, 9 , 1,</div><div>      59, 51, 43, 35, 27, 19, 11, 3,</div><div>      61, 53, 45, 37, 29, 21, 13, 5,</div><div>      63, 55, 47, 39, 31, 23, 15, 7)</div><div><br/></div><div>ip_1=(40, 8, 48, 16, 56, 24, 64, 32,</div><div>      39, 7, 47, 15, 55, 23, 63, 31,</div><div>      38, 6, 46, 14, 54, 22, 62, 30,</div><div>      37, 5, 45, 13, 53, 21, 61, 29,</div><div>      36, 4, 44, 12, 52, 20, 60, 28,</div><div>      35, 3, 43, 11, 51, 19, 59, 27,</div><div>      34, 2, 42, 10, 50, 18, 58, 26,</div><div>      33, 1, 41,  9, 49, 17, 57, 25)</div><div><br/></div><div>e  =(32, 1,  2,  3,  4,  5,  4,  5,</div><div>       6, 7,  8,  9,  8,  9, 10, 11,</div><div>      12,13, 12, 13, 14, 15, 16, 17,</div><div>      16,17, 18, 19, 20, 21, 20, 21,</div><div>      22, 23, 24, 25,24, 25, 26, 27,</div><div>      28, 29,28, 29, 30, 31, 32,  1)</div><div><br/></div><div>p=(16,  7, 20, 21, 29, 12, 28, 17,</div><div>     1, 15, 23, 26,  5, 18, 31, 10,</div><div>     2,  8, 24, 14, 32, 27,  3,  9,</div><div>     19, 13, 30, 6, 22, 11,  4,  25)</div><div><br/></div><div>s=[ [[14, 4, 13,  1,  2, 15, 11,  8,  3, 10,  6, 12,  5,  9,  0,  7],</div><div>     [0, 15,  7,  4, 14,  2, 13,  1, 10,  6, 12, 11,  9,  5,  3,  8],</div><div>     [4,  1, 14,  8, 13,  6,  2, 11, 15, 12,  9,  7,  3, 10,  5,  0],    </div><div>     [15, 12,  8,  2,  4,  9,  1,  7,  5, 11,  3, 14, 10,  0,  6, 13]],</div><div><br/></div><div>     [[15,  1,  8, 14,  6, 11,  3,  4,  9,  7,  2, 13, 12,  0,  5, 10],     </div><div>     [3, 13,  4,  7, 15,  2,  8, 14, 12,  0,  1, 10,  6,  9, 11,  5],     </div><div>     [0, 14,  7, 11, 10,  4, 13,  1,  5,  8, 12,  6,  9,  3,  2, 15],     </div><div>     [13,  8, 10,  1,  3, 15,  4,  2, 11,  6,  7, 12,  0,  5, 14,  9]],</div><div><br/></div><div>     [[10,  0,  9, 14,  6,  3, 15,  5,  1, 13, 12,  7, 11,  4,  2,  8],     </div><div>     [13,  7,  0,  9,  3,  4,  6, 10,  2,  8,  5, 14, 12, 11, 15,  1],   </div><div>     [13,  6,  4,  9,  8, 15,  3,  0, 11,  1,  2, 12,  5, 10, 14,  7],     </div><div>     [1, 10, 13,  0,  6,  9,  8,  7,  4, 15, 14,  3, 11,  5,  2, 12]],</div><div><br/></div><div>    [[7, 13, 14,  3,  0,  6,  9, 10,  1,  2,  8,  5, 11,  12,  4, 15],     </div><div>     [13,  8, 11,  5,  6, 15,  0,  3,  4,  7,  2, 12,  1, 10, 14,9],     </div><div>     [10,  6,  9,  0, 12, 11,  7, 13, 15,  1,  3, 14,  5,  2,  8,  4],     </div><div>     [3, 15,  0,  6, 10,  1, 13,  8,  9,  4,  5, 11, 12,  7,  2, 14]],</div><div><br/></div><div>    [[2, 12,  4,  1,  7, 10, 11,  6,  8,  5,  3, 15, 13,  0, 14,  9],     </div><div>     [14, 11,  2, 12,  4,  7, 13,  1,  5,  0, 15, 10,  3,  9,  8,  6],     </div><div>     [4,  2,  1, 11, 10, 13,  7,  8, 15,  9, 12,  5,  6,  3,  0, 14],     </div><div>     [11,  8, 12,  7,  1, 14,  2, 13,  6, 15,  0,  9, 10,  4,  5,  3]],</div><div><br/></div><div>    [[12,  1, 10, 15,  9,  2,  6,  8,  0, 13,  3,  4, 14,  7,  5, 11],</div><div>     [10, 15,  4,  2,  7, 12,  9,  5,  6,  1, 13, 14,  0, 11,  3,  8],     </div><div>     [9, 14, 15,  5,  2,  8, 12,  3,  7,  0,  4, 10,  1, 13, 11,  6],     </div><div>     [4,  3,  2, 12,  9,  5, 15, 10, 11, 14,  1,  7,  6,  0,  8, 13]],</div><div><br/></div><div>    [[4, 11,  2, 14, 15,  0,  8, 13,  3, 12,  9,  7,  5, 10,  6,  1],     </div><div>     [13,  0, 11,  7,  4,  9,  1, 10, 14,  3,  5, 12,  2, 15,  8,  6],     </div><div>     [1,  4, 11, 13, 12,  3,  7, 14, 10, 15,  6,  8,  0,  5,  9,  2],     </div><div>     [6, 11, 13,  8,  1,  4, 10,  7,  9,  5,  0, 15, 14,  2,  3, 12]],</div><div><br/></div><div><br/></div><div>   [[13,  2,  8,  4,  6, 15, 11,  1, 10,  9,  3, 14,  5,  0, 12,  7],     </div><div>     [1, 15, 13,  8, 10,  3,  7,  4, 12,  5,  6, 11,  0, 14,  9,  2],     </div><div>     [7, 11,  4,  1,  9, 12, 14,  2,  0,  6, 10, 13, 15,  3,  5,  8],     </div><div>     [2,  1, 14,  7,  4, 10,  8, 13, 15, 12,  9,  0,  3,  5,  6, 11]]]</div><div>     </div><div>pc1=(57, 49, 41, 33, 25, 17,  9,</div><div>       1, 58, 50, 42, 34, 26, 18,</div><div>      10,  2, 59, 51, 43, 35, 27,</div><div>      19, 11,  3, 60, 52, 44, 36,</div><div>      63, 55, 47, 39, 31, 23, 15,</div><div>       7, 62, 54, 46, 38, 30, 22,</div><div>      14,  6, 61, 53, 45, 37, 29,</div><div>      21, 13,  5, 28, 20, 12, 4);</div><div><br/></div><div>pc2= (14, 17, 11, 24,  1,  5,  3, 28,</div><div>      15,  6, 21, 10, 23, 19, 12,  4,</div><div>      26,  8, 16,  7, 27, 20, 13,  2,</div><div>      41, 52, 31, 37, 47, 55, 30, 40,</div><div>      51, 45, 33, 48, 44, 49, 39, 56,</div><div>      34, 53, 46, 42, 50, 36, 29, 32)</div><div><br/></div><div>d = (  1,  1,  2,  2,  2,  2,  2,  2, 1, 2, 2, 2, 2, 2, 2, 1)</div><div><br/></div><div>__all__=['desencode']</div><div>class DES():</div><div>    def __init__(self):</div><div>        pass</div><div><br/></div><div>    def code(self,from_code,key,code_len,key_len):</div><div>        output=&quot;&quot;</div><div>        trun_len=0</div><div>        code_string=self._functionCharToA(from_code,code_len)</div><div>        code_key=self._functionCharToA(key,key_len)</div><div>        if code_len%16!=0:</div><div>            real_len=(code_len/16)*16+16</div><div>        else:</div><div>            real_len=code_len</div><div>        </div><div>        if key_len%16!=0:</div><div>            key_len=(key_len/16)*16+16</div><div>        key_len*=4</div><div>        trun_len=4*real_len</div><div><br/></div><div>        for i in range(0,trun_len,64):</div><div>            run_code=code_string[i:i+64]</div><div>            l=i%key_len</div><div>            run_key=code_key[l:l+64]</div><div>            run_code= self._codefirstchange(run_code)</div><div>            run_key= self._keyfirstchange(run_key)</div><div><br/></div><div>            for j in range(16):</div><div>                code_r=run_code[32:64]</div><div>                code_l=run_code[0:32]</div><div>                run_code=code_r</div><div>                code_r= self._functionE(code_r)</div><div>                key_l=run_key[0:28]</div><div>                key_r=run_key[28:56]</div><div>                key_l=key_l[d[j]:28]+key_l[0:d[j]]</div><div>                key_r=key_r[d[j]:28]+key_r[0:d[j]]</div><div>                run_key=key_l+key_r</div><div>                key_y= self._functionKeySecondChange(run_key)</div><div>                code_r= self._codeyihuo(code_r,key_y)</div><div>                code_r= self._functionS(code_r)</div><div>                code_r= self._functionP(code_r)</div><div>                code_r= self._codeyihuo(code_l,code_r)</div><div>                run_code+=code_r</div><div>            code_r=run_code[32:64]</div><div>            code_l=run_code[0:32]</div><div>            run_code=code_r+code_l</div><div>            output+=self._functionCodeChange(run_code)</div><div>        return output</div><div><br/></div><div>    def _codeyihuo(self,code,key):</div><div>        code_len=len(key)</div><div>        return_list=''</div><div>        for i in range(code_len):</div><div>            if code[i]==key[i]:</div><div>                return_list+='0'</div><div>            else:</div><div>                return_list+='1'</div><div>        return return_list</div><div>                                         </div><div>    def _codefirstchange(self,code):</div><div>        changed_code=''</div><div>        for i in range(64):</div><div>            changed_code+=code[ip[i]-1]</div><div>        return changed_code</div><div><br/></div><div>    def _keyfirstchange (self,key):</div><div>        changed_key=''</div><div>        for i in range(56):</div><div>            changed_key+=key[pc1[i]-1]</div><div>        return changed_key</div><div><br/></div><div>    def _functionCodeChange(self, code):</div><div>        lens=len(code)/4</div><div>        return_list=''</div><div>        for i in range(lens):</div><div>            list=''</div><div>            for j in range(4):</div><div>                list+=code[ip_1[i*4+j]-1]</div><div>            return_list+=&quot;%x&quot; %int(list,2)</div><div>        return return_list</div><div><br/></div><div>    def _functionE(self,code):</div><div>        return_list=''</div><div>        for i in range(48):</div><div>            return_list+=code[e[i]-1]</div><div>        return return_list        </div><div><br/></div><div>    def _functionP(self,code):</div><div>        return_list=''</div><div>        for i in range(32):</div><div>            return_list+=code[p[i]-1]</div><div>        return return_list</div><div><br/></div><div>    def _functionS(self, key):</div><div>        return_list=''</div><div>        for i in range(8):</div><div>            row=int( str(key[i*6])+str(key[i*6+5]),2)</div><div>            raw=int(str( key[i*6+1])+str(key[i*6+2])+str(key[i*6+3])+str(key[i*6+4]),2)</div><div>            return_list+=self._functionTos(s[i][row][raw],4)</div><div><br/></div><div><br/></div><div>        return return_list</div><div><br/></div><div>    def _functionKeySecondChange(self,key):</div><div>        return_list=''</div><div>        for i in range(48):</div><div>            return_list+=key[pc2[i]-1]</div><div>        return return_list</div><div><br/></div><div>    def _functionCharToA(self,code,lens):</div><div>        return_code=''</div><div>        lens=lens%16</div><div>        for key in code:</div><div>            code_ord=int(key,16)</div><div>            return_code+=self._functionTos(code_ord,4)        </div><div>        if lens!=0:</div><div>            return_code+='0'*(16-lens)*4</div><div>        return return_code</div><div><br/></div><div>    def _functionTos(self,o,lens):</div><div>        return_code=''</div><div>        for i in range(lens):</div><div>            return_code=str(o&gt;&gt;i &amp;1)+return_code</div><div>        return return_code</div><div><br/></div><div>def tohex(string):</div><div>    return_string=''</div><div>    for i in string:</div><div>        return_string+=&quot;%02x&quot;%ord(i)</div><div>    return return_string</div><div>        </div><div>def tounicode(string):</div><div>    return_string=''</div><div>    string_len=len(string)</div><div>    for i in range(0,string_len,2):</div><div>        return_string+=chr(int(string[i:i+2],16))</div><div>    return return_string</div><div><br/></div><div>def desencode(from_code,key):</div><div>    from_code=tohex(from_code)</div><div>    key=tohex(key)</div><div>    </div><div>    des=DES()</div><div>    key_len=len(key)</div><div>    string_len=len(from_code)        </div><div>        </div><div>    if string_len&lt;1 or key_len&lt;1:</div><div>        print 'error input'</div><div>        return False</div><div>    key_code= des.code(from_code,key,string_len,key_len)</div><div>    return key_code</div><div><br/></div><div>if __name__  == '__main__':</div><div>    if(desencode(sys.argv[1],'mtqVwD4JNRjw3bkT9sQ0RYcZaKShU4sf')=='e3fab29a43a70ca72162a132df6ab532535278834e11e6706c61a1a7cefc402c8ecaf601d00eee72'):</div><div>        print 'correct.'</div><div>    else:</div><div>        print 'try again.'</div></div><div><br/></div><div>搜索__all__行可以找到脚本的原始出处：<a href="https://github.com/liupengs/DES_Python/blob/master/des.py">https://github.com/liupengs/DES_Python/blob/master/des.py</a>。</div><div>用同一工程下的des_1.py解密即可得到flag。</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>C:\Users\Administrator\Desktop\DES_Python-master&gt;python2 des_1.py</div><div>DES 解密</div><div><br/></div><div>请输入密文（长度不限）:e3fab29a43a70ca72162a132df6ab532535278834e11e6706c61a1a7cefc402c8ecaf601d00eee72</div><div>请输入密钥（长度不限）:mtqVwD4JNRjw3bkT9sQ0RYcZaKShU4sf</div><div>QCTF{eCy0AALMDH9rLoBnWnTigXpYPkgU0sU4}</div></div><div><br/></div><div>flag：QCTF{eCy0AALMDH9rLoBnWnTigXpYPkgU0sU4}</div><div><br/></div><div><span style="font-weight: bold;">132 traffic1</span></div><div><br/></div><div>下载得到pcapng文件，wireshark打开。首先看到大量FTP协议，过滤器应用ftp-data筛选出FTP传输的文件。</div><div><img src="攻防世界高手区18（127-132）_files/Image [4].png" type="image/png" data-filename="Image.png"/></div><div>可以看到flag.zip、singlelist.c、key.log等。先看flag.zip。8022和8142号包各有一个。通过显示分组字节的方式导出。</div><div>8142号包导出的flag.zip是伪加密，解除后得到flag.txt显示：</div><div><img src="攻防世界高手区18（127-132）_files/Image [5].png" type="image/png" data-filename="Image.png"/></div><div>8022号包导出的flag.zip是真实加密，无法爆破出密码，暂时放置，先寻找其他线索。</div><div><br/></div><div>从9024号追踪TCP流，得到key.log：</div><div><img src="攻防世界高手区18（127-132）_files/Image [6].png" type="image/png" data-filename="Image.png"/></div><div>考虑到文件中包含大量SSL流量，尝试用key.log解密。进入编辑-首选项-Protocols-TLS（旧版wireshark为SSL），导入刚才获得的key.log。</div><div><img src="攻防世界高手区18（127-132）_files/Image [7].png" type="image/png" data-filename="Image.png"/></div><div>可以看到确实有一些流量被解密了。</div><div><img src="攻防世界高手区18（127-132）_files/Image [8].png" type="image/png" data-filename="Image.png"/></div><div>导出http对象，基本在和baidu.com通信，内容是jpeg或gif图片。仅有一处是与baiduupcs.com通信，内容为zip。</div><div><img src="攻防世界高手区18（127-132）_files/Image [9].png" type="image/png" data-filename="Image.png"/></div><div>导出该压缩包，解压得到2.mp3。</div><div><img src="攻防世界高手区18（127-132）_files/Image [10].png" type="image/png" data-filename="Image.png"/></div><div>查看2.mp3的频谱图（audacity不知道为什么不行，临时装了Cool Edit Pro 2.0才看到）：</div><div><img src="攻防世界高手区18（127-132）_files/Image [11].png" type="image/png" data-filename="Image.png"/></div><div>得到key: AaaAaaaAAaaaAAaaaaaaAAAAAaaaaaaa!</div><div>用这段key解压之前得到的flag.txt得到flag：</div><div><img src="攻防世界高手区18（127-132）_files/Image [12].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div>flag：flag{4sun0_y0zora_sh0ka1h@n__#&gt;&gt;_&lt;&lt;#}</div></span>
</div></body></html> 