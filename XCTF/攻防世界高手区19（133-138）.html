<html>
<head>
  <title>攻防世界高手区19（133-138）</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/605894 (zh-CN, DDL); Windows/6.1.1 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="951"/>
<h1>攻防世界高手区19（133-138）</h1>
<h2><a href="https://DemonStarAlgol.github.io/Misc/">[无关链接]</a></h2>

<div>
<span><div><span style="font-weight: bold;">133 misc2</span></div><div><br/></div><div>下载得到txt文件，打开发现大量乱码。</div><div><img src="攻防世界高手区19（133-138）_files/Image.png" type="image/png" data-filename="Image.png"/></div><div>可以看到有大量相同的字符间隔连续出现，不像是特定的文件格式。考虑字符编码，可以尝试用Word打开。</div><div><img src="攻防世界高手区19（133-138）_files/Image [1].png" type="image/png" data-filename="Image.png"/></div><div>UTF-8下为乱码，逐个尝试其他编码格式，直到找到可读编码为止。但对比原题和XCTF提供的附件后发现附件有问题，先记录一下Writeup的后续步骤：</div><div>切换到Ext Alpha 小写字母或IBM EBCDIC，文件可读，在文本末尾有flag。</div><div><img src="攻防世界高手区19（133-138）_files/Image [2].png" type="image/png" data-filename="Image.png"/></div><div>或者在十六进制编辑器（010Editor也可以）中切换编码也可以得到可读文本。</div><div><img src="攻防世界高手区19（133-138）_files/Image.webp" type="image/webp" data-filename="Image.webp"/></div><div><br/></div><div>flag：flag{0a07c11e46af753fd24d40023f0fdce1}</div><div><br/></div><div><span style="font-weight: bold;">134 santa-walks-into-a-bar</span></div><div><br/></div><div>下载得到list.zip和santa-id.png。</div><div><img src="攻防世界高手区19（133-138）_files/santa-id.png" type="image/png" data-filename="santa-id.png"/></div><div>list.zip中是大量png图片，内容均为二维码。</div><div><img src="攻防世界高手区19（133-138）_files/Image [3].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div>注意到santa-id.png上的ID：7ab7df3f4425f4c446ea4e5398da8847，可以发现存在对应名称的图片，扫码得到：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>Now I have Xavier in 1b3ff9ed24dfa790c7a3d68902cbdaee</div></div><div>再扫码1b3ff9ed24dfa790c7a3d68902cbdaee.png得到：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>Next kiddie is Samuel in aa5e9b88521b4e209615fdeb6e26c640</div></div><div>可以看出每个二维码内容都提示了下一条信息所在，尝试写脚本循环处理：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>from pyzbar import pyzbar</div><div>from PIL import Image,ImageEnhance</div><div><br/></div><div>def get_ewm(img_adds):</div><div>    img = Image.open(img_adds)</div><div>    txt_list = pyzbar.decode(img)</div><div>    for txt in txt_list:</div><div>        barcodeData = txt.data.decode(&quot;utf-8&quot;)</div><div>        return barcodeData</div><div><br/></div><div>path = 'C:/Users/Administrator/Desktop/1.png'</div><div>img = Image.open(path)</div><div>txt_list = pyzbar.decode(img)</div><div>print(txt_list)</div><div>for txt in txt_list:</div><div>    print(txt)</div><div>    barcodeData = txt.data.decode(&quot;utf-8&quot;)</div><div>    print(barcodeData)</div><div>print(txt_list[0].data.decode(&quot;utf-8&quot;))</div></div><div>运行脚本直到循环报错。</div><div><img src="攻防世界高手区19（133-138）_files/Image [4].png" type="image/png" data-filename="Image.png"/></div><div>可以看到报错前最后的输出是：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>Y0ur gift is in goo.gl/wFGwqO inugky3leb2gqzjanruw42yk</div></div><div>访问goo.gl/wFGwqO网址得到flag。（好像已经没法访问了……强行靠关键字搜到了flag。）</div><div><br/></div><div>flag：3DS{I_h0p3_th4t_Y0u_d1d_n0t_h4v3_ch4ck3d_OnE_by_0n3}</div><div><br/></div><div><span style="font-weight: bold;">135 USB-probing</span></div><div><br/></div><div>下载得到pcap文件，wireshark打开。发现全部都是USB流量包，尝试键盘和鼠标数据发现都不是，同时发现有几个数据包长度特别大，可能有文件传输。先对流量包按长度排序：</div><div><img src="攻防世界高手区19（133-138）_files/Image [5].png" type="image/png" data-filename="Image.png"/></div><div>发现最大的101号数据包中有PNG和IHDR字符串，疑似png图片文件。显示分组字节，并保存为png文件。Linux下打开图片找到flag。</div><div><img src="攻防世界高手区19（133-138）_files/1.png" type="image/png" data-filename="1.png"/></div><div><br/></div><div>flag：ALEXCTF{SN1FF_TH3_FL4G_OV3R_U58}</div><div><br/></div><div><span style="font-weight: bold;">136 Hidden Write</span></div><div><br/></div><div>下载得到png图片。十六进制编辑器（010Editor）打开提示数据模板出错，提示该文件结构可能有改动。</div><div><span style="font-size: unset; color: unset; font-family: unset;">查找png文件头部和文件尾部特征字符串IHDR、IEND，发现各存在3处：</span></div><div><img src="攻防世界高手区19（133-138）_files/Image [6].png" type="image/png" data-filename="Image.png"/></div><div>整个文件结构是：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>PNG头-IHDR-IEND-IHDR-IEND-IHDR-IEND-尾部额外不明字符串</div></div><div><br/></div><div>尝试将三组IHDR-IEND间数据分别与PNG头组合成三张png图片。使用zsteg逐张查看，在3.png中找到LSB隐写信息：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# zsteg 3.png</div><div>[?] 15 bytes of extra data after image end (IEND), offset = 0x2dc4a</div><div>extradata:0         .. text: &quot;\r\n\r\nef4526a41ea&quot;</div><div>imagedata           .. file: dBase III DBT, version number 0, next free block index 4278124033</div><div>b1,b,lsb,xy         .. text: &quot;\nRFbSBcvG&quot;</div><div><b><font style="color: rgb(255, 0, 0);">b1,bgr,lsb,xy       .. text: &quot;hxb2018{490fe1033073e985&quot;</font></b></div><div>b2,r,lsb,xy         .. file: 5View capture file</div><div>b2,r,msb,xy         .. file: VISX image file</div><div>b2,g,lsb,xy         .. file: 5View capture file</div><div>b2,g,msb,xy         .. file: VISX image file</div><div>b2,b,lsb,xy         .. file: 5View capture file</div><div>b2,b,msb,xy         .. file: VISX image file</div><div>b2,rgb,lsb,xy       .. file: 5View capture file</div><div>b2,rgb,msb,xy       .. file: VISX image file</div><div>b2,bgr,lsb,xy       .. file: 5View capture file</div><div>b2,bgr,msb,xy       .. file: VISX image file</div><div>b4,r,msb,xy         .. text: [&quot;w&quot; repeated 9 times]</div><div>b4,g,msb,xy         .. text: [&quot;w&quot; repeated 12 times]</div><div>b4,b,msb,xy         .. text: [&quot;w&quot; repeated 10 times]</div><div>b4,rgb,msb,xy       .. text: [&quot;w&quot; repeated 28 times]</div><div>b4,bgr,msb,xy       .. text: [&quot;w&quot; repeated 29 times]</div></div><div><br/></div><div>显然flag还有其他部分，继续看1.png和2.png。Stegsolve打开2.png，在Blue plane 0处有明显的横向噪点，尝试盲水印。</div><div><img src="攻防世界高手区19（133-138）_files/Image [7].png" type="image/png" data-filename="Image.png"/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop/blind-watermark-python3/BlindWaterMark# python bwm.py decode 1.png 2.png flag.png</div><div>image&lt;1.png&gt; + image(encoded)&lt;2.png&gt; -&gt; watermark&lt;flag.png&gt;</div></div><div><img src="攻防世界高手区19（133-138）_files/flag.png" type="image/png" data-filename="flag.png"/></div><div>得到：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>903ef}</div></div><div>结合原始图片末尾的一段额外不明字符串：</div><div><img src="攻防世界高手区19（133-138）_files/Image [8].png" type="image/png" data-filename="Image.png"/></div><div>拼接得到flag。</div><div><br/></div><div>flag：hxb2018{490fe1033073e985ef4526a41ea903ef}</div><div><span style="color: rgb(255, 0, 0); font-weight: bold;">攻防世界上本题的题目和标准答案对不上，后台认为标准答案是hxb2018{1e30f3b836d78d25c78cd89c18c20b4a}。</span></div><div><br/></div><div><span style="font-weight: bold;">137 happy_puzzle</span></div><div><br/></div><div>下载得到puzzle文件夹，内含info.txt和26个.data文件。info.txt内容为：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>mode=RGB size=400x400</div></div><div>看来本题可能需要将所有数据恢复成一张400x400大小的图像。图像按数据块的形式存储，联想到png格式。同时<span style="font-size: unset; color: unset; font-family: unset;">考虑到除mrxtfkzj.data外，其他data长度都是10240，</span><span style="font-size: unset; color: unset; font-family: unset;">mrxtfkzj.data应该是最后一块。</span></div><div><span style="font-size: unset; color: unset; font-family: unset;">先用画图创建一张400x400的空白png图片，然后用十六进制编辑器打开：</span></div><div><img src="攻防世界高手区19（133-138）_files/Image [9].png" type="image/png" data-filename="Image.png"/></div><div>PNG文件结构如下：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>文件头-IHDR-IDAT（长度-数据块-CRC）-IEND</div><div>其中多处存在CRC32校验</div></div><div><br/></div><div>文件头和IHDR部分可以直接从空白图片取得。</div><div>CRC校验在Windows系统下可以忽略，用0填充。</div><div>IDAT的长度和数据内容已知，每块前方加上00 00 28 00（0x2800=10240），后接00 00 00 00（填充CRC校验）即可。</div><div>IEND在Windows系统下也可以不需要。</div><div>问题在于确定10240长度的25个data的顺序。</div><div><br/></div><div>采取以下做法：</div><div>在文件头和IHDR后依次尝试接25个data，其中必有一个能够显示出部分图片，即可确定这一块。然后继续尝试下一块即可。最后可以确定顺序为：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>yvxmeawg.data rnydeiho.data uozjmdnl.data fhnkotmb.data jlxphwfm.data yscijlzx.data ciaoxptf.data blczioav.data jtxsbevz.data lstjobzi.data pyusgabf.data wgkapjbh.data xufbyndk.data csizrgxn.data oaeqnubi.data gpiuezjw.data tihzkoyu.data hbctmwqj.data ycqzmbrw.data fkjhepcs.data kczwtlrd.data dwelszrk.data uilqywot.data xufnmacj.data jrbiznkl.data mrxtfkzj.data</div></div><div>最后得到的图片是：</div><div><img src="攻防世界高手区19（133-138）_files/flag [1].png" type="image/png" data-filename="flag.png"/></div><div><br/></div><div>另外这里有个脚本可以拼接数据，留作参考。</div><div><a href="攻防世界高手区19（133-138）_files/1.py"><img src="攻防世界高手区19（133-138）_files/23705c70de00a62931cf0f944f1e6bf7.png" alt="1.py"></a></div><div><br/></div><div>flag：unctf{312bbd92c1b891e1827ba519326b6688}</div><div><br/></div><div><span style="font-weight: bold;">138 godwave</span></div><div><br/></div><div>下载得到wav文件，audacity打开。</div><div><img src="攻防世界高手区19（133-138）_files/Image [10].png" type="image/png" data-filename="Image.png"/></div><div>看起来好像是摩斯电码，但实际上不是。仔细观察会发现是以64个点为单位，有时振幅高，有时振幅低。以高位为1，低位为0，整理得到的数据只有10和01组成，显然是曼彻斯特编码。</div><div><br/></div><div>使用如下脚本将wav文件中的数据提取：</div><div><a href="攻防世界高手区19（133-138）_files/godwave.py"><img src="攻防世界高手区19（133-138）_files/38a08fb8c7b37408fb9e9ccea5e09444.png" alt="godwave.py"></a></div><div>输出曼彻斯特编码：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>10010101100101100110011001010101011001011010100101100101011010100101010110100110010101011001100101010110100110010101010110011001010101010101010101010101010101010101010101010101010101011010011001100101100101100110010110010101011001010110010101100110010110010101010101010101010101010101010101010101010101100101100110100101010101010101010101010101010101010101010101010110010110011……（后略）</div></div><div>以“10”为1，“01”为0转换为二进制数据，然后再转换为十六进制：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>a = open('C:/Users/Administrator/Desktop/output.txt', 'r').read()</div><div><br/></div><div>b = ''</div><div>for i in range(0, len(a), 2):</div><div>    if a[i: i+2] == '10':</div><div>        b += '1'</div><div>    elif a[i: i+2] == '01':</div><div>        b += '0'</div><div><br/></div><div>for i in range(0, len(b), 8):</div><div>    n = b[i: i+8]</div><div>    n = int(n, 2)</div><div>    n = hex(n)</div><div>    print(str(n)[2:].zfill(2), end = '')</div></div><div>输出；</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>89504e470d0a1a0a0000000d494844520000012c0000012c0802000000f61f1……（后略）</div></div><div>从文件头来看，显然是PNG格式图片。用十六进制编辑器将其保存。</div><div><img src="攻防世界高手区19（133-138）_files/1 [1].png" type="image/png" data-filename="1.png"/></div><div>最后扫码得到flag。</div><div><br/></div><div>本题可以搜索原题“JarvisOJ Misc 上帝之音”找到Writeup。部分完全相同思路的题目的Writeup：</div><div><a href="https://itw01.com/2NO4ETL.html">https://itw01.com/2NO4ETL.html</a></div><div><a href="https://blog.csdn.net/Ni9htMar3/article/details/53887845">https://blog.csdn.net/Ni9htMar3/article/details/53887845</a></div><div><a href="https://blog.maxkit.com.tw/2020/01/ctf-steganography.html">https://blog.maxkit.com.tw/2020/01/ctf-steganography.html</a></div><div><br/></div><div>flag：PCTF{Good_Signal_Analyzer}</div></span>
</div></body></html> 