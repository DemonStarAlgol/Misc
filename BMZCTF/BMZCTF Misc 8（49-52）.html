<html>
<head>
  <title>BMZCTF Misc 8（49-52）</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/605894 (zh-CN, DDL); Windows/6.1.1 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="5459"/>
<h1>BMZCTF Misc 8（49-52）</h1>
<h2><a href="https://DemonStarAlgol.github.io/Misc/">[无关链接]</a></h2>

<div>
<span><div><span style="font-weight: bold;">49 [2020首届祥云杯]带音乐家</span></div><div><br/></div><div>下载得到加密的RAR格式压缩包和不带扩展名的decode_it文件，先看前者：</div><div><img src="BMZCTF Misc 8（49-52）_files/Image.png" type="image/png" data-filename="Image.png"/></div><div>注释里有空白字符串，观察发现仅由空格和Tab组成，且每行字符数不超过五个。尝试将空格作为短音，Tab作为长音，摩斯电码解码得到：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>AESKEY9219232322</div></div><div>说明存在AES加密，密钥为9219232322，密文暂时还没找到。</div><div><br/></div><div>回头看decode_it，十六进制编辑器打开：</div><div><img src="BMZCTF Misc 8（49-52）_files/Image [1].png" type="image/png" data-filename="Image.png"/></div><div>从文件头可以判断是midi格式声音文件，常规的基于波形的音频隐写很可能不起作用。尝试搜索“midi stego”等关键词，但找到的工具也均无法提取出有意义的隐写信息。那么继续尝试在网络上直接搜索相同或有类似音节的midi音频，可以找到<a href="http://velato.net/Language/HelloWorld/">这个页面</a>，从页面下方提供的<a href="http://danieltemkin.com/Content/Velato/velatotracks/print_h_5.mid">Complete &quot;Hello, World&quot; program midi file</a>链接可以下载到完全一样的midi格式文件：</div><div><img src="BMZCTF Misc 8（49-52）_files/Image [2].png" type="image/png" data-filename="Image.png"/></div><div>根据<a href="http://velato.net/">该官方站点</a>提供的信息，这是一种基于midi音频、名为<a href="https://esolangs.org/wiki/Velato">Velato</a>的Esolang，解释器也可以从<a href="http://velato.net/Content/Velato/Velato_0_1.zip">官方网站</a>下载到。利用该解释器，先将midi音频文件编译为Windows可执行文件exe，再运行该exe：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>D:\CTFToolkit-v1.1.0\信息隐藏\Velato&gt;Vlt.exe decode_it.midi</div><div>2 tracks found, will read 1st track containing note information.</div><div>Program</div><div>        DeclareFunction</div><div>                PrintToScreen</div><div>                        CharConstant</div><div>                PrintToScreen</div><div>                        CharConstant</div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">……（中略）</span></div><div><br/></div><div>D:\CTFToolkit-v1.1.0\信息隐藏\Velato&gt;decode_it.exe</div><div>Hello, World!</div></div><div>从而得到解码结果，当然这个结果实际上在搜到官网页面时就能知道了，毕竟用现成代码出题就是会有这种事……</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>Hello, World!</div></div><div>尝试后发现这是Doc1.rar压缩包的解压密码。</div><div><br/></div><div>解压得到Doc1.docx，打开后是这样：</div><div><img src="BMZCTF Misc 8（49-52）_files/Image [3].png" type="image/png" data-filename="Image.png"/></div><div>这是托尔金《魔戒》系列中的精灵语言书写系统Tengwar script，详细介绍可以参见另一条笔记 <a href="evernote:///view/30668439/s39/5bd517c5-68e8-4489-857a-8899ad831b3f/5bd517c5-68e8-4489-857a-8899ad831b3f/" style="color: rgb(105, 170, 53);">Bugku Misc 9（57-60）</a>。根据网传的某张<a href="https://site.douban.com/120385/widget/notes/3710474/note/204978980/">Tengwar script到英文字母转译表</a>，上述字母转换后为：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>flagis</div></div><div>没什么用。顺带一提字母s在这里用的是位于单词开头和中间的写法，位于单词末尾的应该用另一种尖端朝下的形式才对——虽然后面确实还有隐藏字体，但is这个单词本身也已经结尾了，所以不影响。</div><div><br/></div><div>然后在Word中全选-右键-字体-取消隐藏：</div><div><img src="BMZCTF Misc 8（49-52）_files/Image [4].png" type="image/png" data-filename="Image.png"/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>nvPrjrss1PyqAZB/14lkvJGTJ9l4rOfwJeqSqSHSqXU=</div></div><div>显然是base64编码，但直接解码无法得到有意义内容。联系到之前得到的AES密钥，尝试AES解密。找个在线工具跑一下：</div><div><img src="BMZCTF Misc 8（49-52）_files/Image [5].png" type="image/png" data-filename="Image.png"/></div><div>得到flag。</div><div><br/></div><div>flag：flag{mU51c_And_ch@ract0rs~}</div><div><br/></div><div><span style="font-weight: bold;">50 2018 QCTF X-man-Keyword</span></div><div><br/></div><div>下载得到png格式文件，看一下：</div><div><img src="BMZCTF Misc 8（49-52）_files/Image [6].png" type="image/png" data-filename="Image.png"/></div><div>Stegsolve查看，在R/G/B Plane 0处左上方有黑白相间小点，是LSB隐写的特征。</div><div><img src="BMZCTF Misc 8（49-52）_files/Image [7].png" type="image/png" data-filename="Image.png"/></div><div>结合图片上的keyword，尝试基于LSB原理且可以设置密码的隐写工具，包括<a href="https://github.com/livz/cloacked-pixel">cloacked-pixel</a>和<a href="https://github.com/dhsdshdhk/stegpy">stegpy</a>等。这里是前者：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop/lsb# python lsb.py extract attachment.png flag.txt lovekfc</div><div>[+] Image size: 360x245 pixels.</div><div>[+] Written extracted data to flag.txt.</div></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>PVSF{vVckHejqBOVX9C1c13GFfkHJrjIQeMwf}</div></div><div>已经接近flag格式，还需要进一步解密。首先对比一下正确的flag格式，编制<span style="font-size: unset; color: unset; font-family: unset;">对应表：</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>ABCDEFGHIJKLMNOPQRSTUVWXYZ</div><div>  V  F          P T</div></div><div>联系到图片给出的keyword，判定对应表为：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>ABCDEFGHIJKLMNOPQRSTUVWXYZ</div><div><span style="color: rgb(255, 0, 0);">LOVEKFC</span>ABDGHIJMNPQRSTUWXYZ</div></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>import string</div><div><br/></div><div>a = 'PVSF{vVckHejqBOVX9C1c13GFfkHJrjIQeMwf}'</div><div>b = 'LOVEKFCABDGHIJMNPQRSTUWXY'</div><div>flag = ''</div><div><br/></div><div>for i in a:</div><div>    if i in string.ascii_lowercase:</div><div>        index = b.lower().index(i)</div><div>        flag += string.ascii_lowercase[index]</div><div>    elif i in string.ascii_uppercase:</div><div>        index = b.upper().index(i)</div><div>        flag += string.ascii_uppercase[index]</div><div>    else:</div><div>        flag += i</div><div>print(flag)</div></div><div>得到flag。</div><div><br/></div><div>flag：QCTF{cCgeLdnrIBCX9G1g13KFfeLNsnMRdOwf}</div><div><br/></div><div><span style="font-weight: bold;">51 Administrator's_secret</span></div><div><br/></div><div>下载得到mem.dump文件。从文件名来看应该是内存镜像，按惯例volatility先梭一把：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# volatility -f mem.dump imageinfo</div><div>Volatility Foundation Volatility Framework 2.6</div><div>INFO    : volatility.debug    : Determining profile based on KDBG search...</div><div>          Suggested Profile(s) : Win7SP1x64, Win7SP0x64, Win2008R2SP0x64, Win2008R2SP1x64_24000, Win2008R2SP1x64_23418, Win2008R2SP1x64, Win7SP1x64_24000, Win7SP1x64_23418</div><div>                     AS Layer1 : WindowsAMD64PagedMemory (Kernel AS)</div><div>                     AS Layer2 : FileAddressSpace (/root/Desktop/mem.dump)</div><div>                      PAE type : No PAE</div><div>                           DTB : 0x187000L</div><div>                          KDBG : 0xf80003e02110L</div><div>          Number of Processors : 1</div><div>     Image Type (Service Pack) : 1</div><div>                KPCR for CPU 0 : 0xfffff80003e03d00L</div><div>             KUSER_SHARED_DATA : 0xfffff78000000000L</div><div>           Image date and time : 2019-11-13 08:39:44 UTC+0000</div><div>     Image local date and time : 2019-11-13 16:39:44 +0800</div></div><div>然后看一下进程列表：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# volatility -f mem.dump --profile=Win7SP1x64 pslist</div><div>Volatility Foundation Volatility Framework 2.6</div><div>Offset(V)          Name                    PID   PPID   Thds     Hnds   Sess  Wow64 Start                          Exit                          </div><div>------------------ -------------------- ------ ------ ------ -------- ------ ------ ------------------------------ ------------------------------</div><div>0xfffffa800ccc1b10 System                    4      0     88      534 ------      0 2019-11-13 08:31:48 UTC+0000                                 </div><div>0xfffffa800d2fbb10 smss.exe                252      4      2       29 ------      0 2019-11-13 08:31:48 UTC+0000                                 </div><div>0xfffffa800e2227e0 csrss.exe               344    328      9      400      0      0 2019-11-13 08:31:49 UTC+0000                                 </div><div>0xfffffa800e3f3340 wininit.exe             396    328      3       79      0      0 2019-11-13 08:31:49 UTC+0000                                 </div><div>0xfffffa800e3f77d0 csrss.exe               404    388     10      225      1      0 2019-11-13 08:31:49 UTC+0000                                 </div><div>0xfffffa800e41fb10 winlogon.exe            444    388      3      111      1      0 2019-11-13 08:31:49 UTC+0000                                 </div><div>0xfffffa800e457060 services.exe            500    396      8      210      0      0 2019-11-13 08:31:49 UTC+0000                                 </div><div>0xfffffa800e426b10 lsass.exe               508    396      6      554      0      0 2019-11-13 08:31:49 UTC+0000                                 </div><div>0xfffffa800e464060 lsm.exe                 516    396      9      145      0      0 2019-11-13 08:31:49 UTC+0000                                 </div><div>0xfffffa800e4f8b10 svchost.exe             608    500     10      351      0      0 2019-11-13 08:31:50 UTC+0000                                 </div><div>0xfffffa800e52bb10 svchost.exe             684    500      8      273      0      0 2019-11-13 08:31:50 UTC+0000                                 </div><div>0xfffffa800e570b10 svchost.exe             768    500     21      443      0      0 2019-11-13 08:31:50 UTC+0000                                 </div><div>0xfffffa800e5b5b10 svchost.exe             816    500     16      381      0      0 2019-11-13 08:31:50 UTC+0000                                 </div><div>0xfffffa800e5d7870 svchost.exe             860    500     18      666      0      0 2019-11-13 08:31:50 UTC+0000                                 </div><div>0xfffffa800e5f8b10 svchost.exe             888    500     37      919      0      0 2019-11-13 08:31:50 UTC+0000                                 </div><div>0xfffffa800e66c870 svchost.exe            1016    500      5      114      0      0 2019-11-13 08:31:50 UTC+0000                                 </div><div>0xfffffa800e74fb10 svchost.exe            1032    500     15      364      0      0 2019-11-13 08:31:51 UTC+0000                                 </div><div>0xfffffa800e510320 spoolsv.exe            1156    500     13      273      0      0 2019-11-13 08:31:51 UTC+0000                                 </div><div>0xfffffa800e5b0060 svchost.exe            1184    500     11      194      0      0 2019-11-13 08:31:51 UTC+0000                                 </div><div>0xfffffa800e56e060 svchost.exe            1276    500     10      155      0      0 2019-11-13 08:31:52 UTC+0000                                 </div><div>0xfffffa800e685060 svchost.exe            1308    500     12      228      0      0 2019-11-13 08:31:52 UTC+0000                                 </div><div>0xfffffa800e632060 svchost.exe            1380    500      4      167      0      0 2019-11-13 08:31:52 UTC+0000                                 </div><div>0xfffffa800e692060 VGAuthService.         1480    500      4       94      0      0 2019-11-13 08:31:52 UTC+0000                                 </div><div>0xfffffa800e7dab10 vmtoolsd.exe           1592    500     11      287      0      0 2019-11-13 08:31:52 UTC+0000                                 </div><div>0xfffffa800e8a7720 svchost.exe            1824    500      6       92      0      0 2019-11-13 08:31:53 UTC+0000                                 </div><div>0xfffffa800e898300 WmiPrvSE.exe           1980    608     10      203      0      0 2019-11-13 08:31:53 UTC+0000                                 </div><div>0xfffffa800e8e9b10 dllhost.exe            2044    500     15      197      0      0 2019-11-13 08:31:53 UTC+0000                                 </div><div>0xfffffa800e90d840 msdtc.exe              1320    500     14      152      0      0 2019-11-13 08:31:54 UTC+0000                                 </div><div>0xfffffa800e991b10 taskhost.exe           2208    500     10      264      1      0 2019-11-13 08:31:56 UTC+0000                                 </div><div>0xfffffa800e44a7a0 dwm.exe                2268    816      7      144      1      0 2019-11-13 08:31:57 UTC+0000                                 </div><div>0xfffffa800e9b8b10 explorer.exe           2316   2260     25      699      1      0 2019-11-13 08:31:57 UTC+0000                                 </div><div>0xfffffa800ea4f060 vm3dservice.ex         2472   2316      2       40      1      0 2019-11-13 08:31:57 UTC+0000                                 </div><div>0xfffffa800ea54b10 vmtoolsd.exe           2480   2316      9      188      1      0 2019-11-13 08:31:57 UTC+0000                                 </div><div>0xfffffa800ea9ab10 rundll32.exe           2968   2620      6      611      1      1 2019-11-13 08:32:02 UTC+0000                                 </div><div>0xfffffa800e8b59c0 WmiPrvSE.exe           2764    608     11      316      0      0 2019-11-13 08:32:13 UTC+0000                                 </div><div>0xfffffa800ea75b10 cmd.exe                2260   2316      1       20      1      0 2019-11-13 08:33:45 UTC+0000                                 </div><div>0xfffffa800e687330 conhost.exe            2632    404      2       63      1      0 2019-11-13 08:33:45 UTC+0000                                 </div><div>0xfffffa800e41db10 WmiApSrv.exe           2792    500      4      113      0      0 2019-11-13 08:34:27 UTC+0000                                 </div><div>0xfffffa800ed68840 CnCrypt.exe            1608   2316      4      115      1      1 2019-11-13 08:34:40 UTC+0000                                 </div><div>0xfffffa800e4a5b10 audiodg.exe            2100    768      6      130      0      0 2019-11-13 08:39:29 UTC+0000                                 </div><div>0xfffffa800ea57b10 DumpIt.exe             1072   2316      1       26      1      1 2019-11-13 08:39:43 UTC+0000                                 </div><div>0xfffffa800ea1c060 conhost.exe            2748    404      2       62      1      0 2019-11-13 08:39:43 UTC+0000                                 </div></div><div>排除系统进程，比较可疑的是CnCrypt.exe，但搜索可知这是一个磁盘加密软件，暂时还不知道有没有用。此外注意到cmd.exe正在运行中，看一下cmd命令行内容：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# volatility -f mem.dump --profile=Win7SP1x64 cmdscan</div><div>Volatility Foundation Volatility Framework 2.6</div><div>**************************************************</div><div>CommandProcess: conhost.exe Pid: 2632</div><div>CommandHistory: 0x242350 Application: cmd.exe Flags: Allocated, Reset</div><div>CommandCount: 1 LastAdded: 0 LastDisplayed: 0</div><div>FirstCommand: 0 CommandCountMax: 50</div><div>ProcessHandle: 0x60</div><div>Cmd #0 @ 0x2229d0: <font style="color: rgb(255, 0, 0);">flag.ccx_password_is_same_with_Administrator</font></div><div>**************************************************</div><div>CommandProcess: conhost.exe Pid: 2748</div><div>CommandHistory: 0x2926d0 Application: DumpIt.exe Flags: Allocated</div><div>CommandCount: 0 LastAdded: -1 LastDisplayed: -1</div><div>FirstCommand: 0 CommandCountMax: 50</div><div>ProcessHandle: 0x60</div></div><div>提到了一个名为flag.ccx的文件，以及它的密码和Administrator相同。事实上CnCrypt生成的加密文件正是.ccx格式，说明接下来可能需要利用密码解密该文件获得下一步线索。<span style="font-size: unset; color: unset; font-family: unset;">先找到这个文件：</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# volatility -f mem.dump --profile=Win7SP1x64 filescan | grep flag.ccx</div><div>Volatility Foundation Volatility Framework 2.6</div><div>0x000000003e435890     15      0 R--rw- \Device\HarddiskVolume2\Users\Administrator\Desktop\flag.ccx</div></div><div>然后dump出来：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# volatility -f mem.dump --profile=Win7SP1x64 dumpfiles -Q 0x000000003e435890 -D ./</div><div>Volatility Foundation Volatility Framework 2.6</div><div>DataSectionObject 0x3e435890   None   \Device\HarddiskVolume2\Users\Administrator\Desktop\flag.ccx</div></div><div>接下来用mimikatz插件得到Administrator用户的密码：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# volatility -f mem.dump --profile=Win7SP1x64 mimikatz</div><div>Volatility Foundation Volatility Framework 2.6</div><div>Module   User             Domain           Password                                </div><div>-------- ---------------- ---------------- ----------------------------------------</div><div>wdigest  Administrator    USER-O27N6483CQ  <font style="color: rgb(255, 0, 0);">ABCabc123</font>                               </div><div>wdigest  USER-O27N6483CQ$ WORKGROUP   </div></div><div>最后用CnCrypt加载flag.ccx即可，密码即ABCabc123：</div><div><img src="BMZCTF Misc 8（49-52）_files/Image [8].png" type="image/png" data-filename="Image.png"/></div><div>加载后得到虚拟磁盘，内含flag.txt：</div><div><img src="BMZCTF Misc 8（49-52）_files/Image [9].png" type="image/png" data-filename="Image.png"/></div><div>从而得到flag。</div><div><br/></div><div>flag：flag{now_you_see_my_secret}</div><div><br/></div><div><span style="font-weight: bold;">52 技协杯-S&amp;M</span></div><div><br/></div><div>下载得到pcapng格式文件。wireshark打开，可以看到大量S7COMM协议的数据包：</div><div><img src="BMZCTF Misc 8（49-52）_files/Image [10].png" type="image/png" data-filename="Image.png"/></div><div>搜索可知S7COMM是西门子的专属通讯协议，考虑到本题是工控比赛题，出现此类协议应该是有意义的。</div><div><br/></div><div>尝试过滤S7COMM协议，发现数据包的长度比较一致，有76、79、80、81、85、91六种。伟大的套神曾经教导我们，数据包的长度越长，里面的内容就越多。根据这一指示，按长度倒序排列数据包，先看看长度91的包里都有啥：</div><div><img src="BMZCTF Misc 8（49-52）_files/Image [11].png" type="image/png" data-filename="Image.png"/></div><div><img src="BMZCTF Misc 8（49-52）_files/Image [12].png" type="image/png" data-filename="Image.png"/></div><div>……有flag。</div><div><br/></div><div>那么接下来按惯例是tshark练习时间。注意到每个数据包中包含flag的两位字符，但如果直接提取s7comm.resp.data仅能得到一位字符，不知道是不是wireshark和tshark的版本问题。所以这里改为提取cotp.segment_data：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# tshark -r 1.pcapng -Y &quot;s7comm and frame.len == 91&quot; -T fields -e &quot;cotp.segment_data&quot;</div><div>Running as user &quot;root&quot; and group &quot;root&quot;. This could be dangerous.</div><div>320100001f69000e00060501120a1002000100008300000800040008666c</div><div>3201000020b0000e00060501120a10020001000083000008000400086167</div><div>320100002149000e00060501120a10020001000083000008000400087b51</div><div>3201000021ec000e00060501120a10020001000083000008000400084b77</div><div>3201000022a4000e00060501120a1002000100008300000800040008545a</div><div>32010000234a000e00060501120a10020001000083000008000400084453</div><div>3201000023cf000e00060501120a10020001000083000008000400084245</div><div>320100002451000e00060501120a10020001000083000008000400084c4e</div><div>3201000024c6000e00060501120a10020001000083000008000400085059</div><div>320100002540000e00060501120a1002000100008300000800040008717a</div><div>3201000025cd000e00060501120a1002000100008300000800040008767d</div></div><div>很明显每行最后两位就是flag对应的十六进制ASCII码，利用倒转命令rev和分割字符串命令cut取得对应内容：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# tshark -r 1.pcapng -Y &quot;s7comm and frame.len == 91&quot; -T fields -e &quot;cotp.segment_data&quot; | rev | cut -c1-4 | rev</div><div>Running as user &quot;root&quot; and group &quot;root&quot;. This could be dangerous.</div><div>666c</div><div>6167</div><div>7b51</div><div>4b77</div><div>545a</div><div>4453</div><div>4245</div><div>4c4e</div><div>5059</div><div>717a</div><div>767d</div></div><div>接下来任意方法十六进制ASCII转码即可。</div><div><br/></div><div>flag：flag{QKwTZDSBELNPYqzv}</div></span>
</div></body></html> 