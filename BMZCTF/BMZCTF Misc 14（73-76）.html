<html>
<head>
  <title>BMZCTF Misc 14（73-76）</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/605894 (zh-CN, DDL); Windows/6.1.1 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="5799"/>
<h1>BMZCTF Misc 14（73-76）</h1>
<h2><a href="https://DemonStarAlgol.github.io/Misc/">[无关链接]</a></h2>

<div>
<span><div><span style="font-weight: bold;">73 2018 QCTF picture</span></div><div>题目：Just misc it</div><div>hint：注意文件名（非hash部分）</div><div>原文件名：bd4408a3-9835-4962-a9af-6acf6cc56b26.wwjkwywq-2a7c8b1b70e00a010c92cab0394c6f93</div><div><br/></div><div>下载得到无扩展名的picture文件，十六进制编辑器查看，根据文件头判断为PNG格式图片。将其重命名：</div><div><img src="BMZCTF Misc 14（73-76）_files/picture.png" type="image/png" data-filename="picture.png"/></div><div>Stegsolve打开，在R/G/B Plane 0处发现隐写痕迹：</div><div><img src="BMZCTF Misc 14（73-76）_files/Image.png" type="image/png" data-filename="Image.png"/></div><div>注意到图像上方有横向的多行黑白交错点，且与原图的白色单色背景部分存在重叠，因此很可能是LSB隐写痕迹。尝试直接提取LSB隐写信息失败，因此可能是使用了某些基于LSB隐写原理的隐写工具，如<a href="https://github.com/dhsdshdhk/stegpy">stegpy</a>或<a href="https://github.com/livz/cloacked-pixel">cloacked-pixel</a>。从默认写入的颜色通道层级来看，cloacked-pixel的可能性比较高。该工具需要密码，根据题目提示，文件名中非hash的部分wwjkwywq可能就是密码。尝试提取隐写信息：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop/lsb# python lsb.py extract picture.png out wwjkwywq</div><div>[+] Image size: 440x440 pixels.</div><div>[+] Written extracted data to out.</div></div><div><br/></div><div>提取得到的out文件实际为文本，<span style="font-size: unset; color: unset; font-family: unset;">很明显是一段DES加密的python脚本：</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>#_*_ coding:utf-8 _*_</div><div>import re</div><div>import sys</div><div><br/></div><div>ip=  (58, 50, 42, 34, 26, 18, 10, 2,</div><div>      60, 52, 44, 36, 28, 20, 12, 4,</div><div>      62, 54, 46, 38, 30, 22, 14, 6,</div><div>      64, 56, 48, 40, 32, 24, 16, 8,</div><div>      57, 49, 41, 33, 25, 17, 9 , 1,</div><div>      59, 51, 43, 35, 27, 19, 11, 3,</div><div>      61, 53, 45, 37, 29, 21, 13, 5,</div><div>      63, 55, 47, 39, 31, 23, 15, 7)</div><div><br/></div><div>ip_1=(40, 8, 48, 16, 56, 24, 64, 32,</div><div>      39, 7, 47, 15, 55, 23, 63, 31,</div><div>      38, 6, 46, 14, 54, 22, 62, 30,</div><div>      37, 5, 45, 13, 53, 21, 61, 29,</div><div>      36, 4, 44, 12, 52, 20, 60, 28,</div><div>      35, 3, 43, 11, 51, 19, 59, 27,</div><div>      34, 2, 42, 10, 50, 18, 58, 26,</div><div>      33, 1, 41,  9, 49, 17, 57, 25)</div><div><br/></div><div>e  =(32, 1,  2,  3,  4,  5,  4,  5,</div><div>       6, 7,  8,  9,  8,  9, 10, 11,</div><div>      12,13, 12, 13, 14, 15, 16, 17,</div><div>      16,17, 18, 19, 20, 21, 20, 21,</div><div>      22, 23, 24, 25,24, 25, 26, 27,</div><div>      28, 29,28, 29, 30, 31, 32,  1)</div><div><br/></div><div>p=(16,  7, 20, 21, 29, 12, 28, 17,</div><div>     1, 15, 23, 26,  5, 18, 31, 10,</div><div>     2,  8, 24, 14, 32, 27,  3,  9,</div><div>     19, 13, 30, 6, 22, 11,  4,  25)</div><div><br/></div><div>s=[ [[14, 4, 13,  1,  2, 15, 11,  8,  3, 10,  6, 12,  5,  9,  0,  7],</div><div>     [0, 15,  7,  4, 14,  2, 13,  1, 10,  6, 12, 11,  9,  5,  3,  8],</div><div>     [4,  1, 14,  8, 13,  6,  2, 11, 15, 12,  9,  7,  3, 10,  5,  0],    </div><div>     [15, 12,  8,  2,  4,  9,  1,  7,  5, 11,  3, 14, 10,  0,  6, 13]],</div><div><br/></div><div>     [[15,  1,  8, 14,  6, 11,  3,  4,  9,  7,  2, 13, 12,  0,  5, 10],     </div><div>     [3, 13,  4,  7, 15,  2,  8, 14, 12,  0,  1, 10,  6,  9, 11,  5],     </div><div>     [0, 14,  7, 11, 10,  4, 13,  1,  5,  8, 12,  6,  9,  3,  2, 15],     </div><div>     [13,  8, 10,  1,  3, 15,  4,  2, 11,  6,  7, 12,  0,  5, 14,  9]],</div><div><br/></div><div>     [[10,  0,  9, 14,  6,  3, 15,  5,  1, 13, 12,  7, 11,  4,  2,  8],     </div><div>     [13,  7,  0,  9,  3,  4,  6, 10,  2,  8,  5, 14, 12, 11, 15,  1],   </div><div>     [13,  6,  4,  9,  8, 15,  3,  0, 11,  1,  2, 12,  5, 10, 14,  7],     </div><div>     [1, 10, 13,  0,  6,  9,  8,  7,  4, 15, 14,  3, 11,  5,  2, 12]],</div><div><br/></div><div>    [[7, 13, 14,  3,  0,  6,  9, 10,  1,  2,  8,  5, 11,  12,  4, 15],     </div><div>     [13,  8, 11,  5,  6, 15,  0,  3,  4,  7,  2, 12,  1, 10, 14,9],     </div><div>     [10,  6,  9,  0, 12, 11,  7, 13, 15,  1,  3, 14,  5,  2,  8,  4],     </div><div>     [3, 15,  0,  6, 10,  1, 13,  8,  9,  4,  5, 11, 12,  7,  2, 14]],</div><div><br/></div><div>    [[2, 12,  4,  1,  7, 10, 11,  6,  8,  5,  3, 15, 13,  0, 14,  9],     </div><div>     [14, 11,  2, 12,  4,  7, 13,  1,  5,  0, 15, 10,  3,  9,  8,  6],     </div><div>     [4,  2,  1, 11, 10, 13,  7,  8, 15,  9, 12,  5,  6,  3,  0, 14],     </div><div>     [11,  8, 12,  7,  1, 14,  2, 13,  6, 15,  0,  9, 10,  4,  5,  3]],</div><div><br/></div><div>    [[12,  1, 10, 15,  9,  2,  6,  8,  0, 13,  3,  4, 14,  7,  5, 11],</div><div>     [10, 15,  4,  2,  7, 12,  9,  5,  6,  1, 13, 14,  0, 11,  3,  8],     </div><div>     [9, 14, 15,  5,  2,  8, 12,  3,  7,  0,  4, 10,  1, 13, 11,  6],     </div><div>     [4,  3,  2, 12,  9,  5, 15, 10, 11, 14,  1,  7,  6,  0,  8, 13]],</div><div><br/></div><div>    [[4, 11,  2, 14, 15,  0,  8, 13,  3, 12,  9,  7,  5, 10,  6,  1],     </div><div>     [13,  0, 11,  7,  4,  9,  1, 10, 14,  3,  5, 12,  2, 15,  8,  6],     </div><div>     [1,  4, 11, 13, 12,  3,  7, 14, 10, 15,  6,  8,  0,  5,  9,  2],     </div><div>     [6, 11, 13,  8,  1,  4, 10,  7,  9,  5,  0, 15, 14,  2,  3, 12]],</div><div><br/></div><div><br/></div><div>   [[13,  2,  8,  4,  6, 15, 11,  1, 10,  9,  3, 14,  5,  0, 12,  7],     </div><div>     [1, 15, 13,  8, 10,  3,  7,  4, 12,  5,  6, 11,  0, 14,  9,  2],     </div><div>     [7, 11,  4,  1,  9, 12, 14,  2,  0,  6, 10, 13, 15,  3,  5,  8],     </div><div>     [2,  1, 14,  7,  4, 10,  8, 13, 15, 12,  9,  0,  3,  5,  6, 11]]]</div><div>     </div><div>pc1=(57, 49, 41, 33, 25, 17,  9,</div><div>       1, 58, 50, 42, 34, 26, 18,</div><div>      10,  2, 59, 51, 43, 35, 27,</div><div>      19, 11,  3, 60, 52, 44, 36,</div><div>      63, 55, 47, 39, 31, 23, 15,</div><div>       7, 62, 54, 46, 38, 30, 22,</div><div>      14,  6, 61, 53, 45, 37, 29,</div><div>      21, 13,  5, 28, 20, 12, 4);</div><div><br/></div><div>pc2= (14, 17, 11, 24,  1,  5,  3, 28,</div><div>      15,  6, 21, 10, 23, 19, 12,  4,</div><div>      26,  8, 16,  7, 27, 20, 13,  2,</div><div>      41, 52, 31, 37, 47, 55, 30, 40,</div><div>      51, 45, 33, 48, 44, 49, 39, 56,</div><div>      34, 53, 46, 42, 50, 36, 29, 32)</div><div><br/></div><div>d = (  1,  1,  2,  2,  2,  2,  2,  2, 1, 2, 2, 2, 2, 2, 2, 1)</div><div><br/></div><div>__all__=['desencode']</div><div>class DES():</div><div>    def __init__(self):</div><div>        pass</div><div><br/></div><div>    def code(self,from_code,key,code_len,key_len):</div><div>        output=&quot;&quot;</div><div>        trun_len=0</div><div>        code_string=self._functionCharToA(from_code,code_len)</div><div>        code_key=self._functionCharToA(key,key_len)</div><div>        if code_len%16!=0:</div><div>            real_len=(code_len/16)*16+16</div><div>        else:</div><div>            real_len=code_len</div><div>        </div><div>        if key_len%16!=0:</div><div>            key_len=(key_len/16)*16+16</div><div>        key_len*=4</div><div>        trun_len=4*real_len</div><div><br/></div><div>        for i in range(0,trun_len,64):</div><div>            run_code=code_string[i:i+64]</div><div>            l=i%key_len</div><div>            run_key=code_key[l:l+64]</div><div>            run_code= self._codefirstchange(run_code)</div><div>            run_key= self._keyfirstchange(run_key)</div><div><br/></div><div>            for j in range(16):</div><div>                code_r=run_code[32:64]</div><div>                code_l=run_code[0:32]</div><div>                run_code=code_r</div><div>                code_r= self._functionE(code_r)</div><div>                key_l=run_key[0:28]</div><div>                key_r=run_key[28:56]</div><div>                key_l=key_l[d[j]:28]+key_l[0:d[j]]</div><div>                key_r=key_r[d[j]:28]+key_r[0:d[j]]</div><div>                run_key=key_l+key_r</div><div>                key_y= self._functionKeySecondChange(run_key)</div><div>                code_r= self._codeyihuo(code_r,key_y)</div><div>                code_r= self._functionS(code_r)</div><div>                code_r= self._functionP(code_r)</div><div>                code_r= self._codeyihuo(code_l,code_r)</div><div>                run_code+=code_r</div><div>            code_r=run_code[32:64]</div><div>            code_l=run_code[0:32]</div><div>            run_code=code_r+code_l</div><div>            output+=self._functionCodeChange(run_code)</div><div>        return output</div><div><br/></div><div>    def _codeyihuo(self,code,key):</div><div>        code_len=len(key)</div><div>        return_list=''</div><div>        for i in range(code_len):</div><div>            if code[i]==key[i]:</div><div>                return_list+='0'</div><div>            else:</div><div>                return_list+='1'</div><div>        return return_list</div><div>                                         </div><div>    def _codefirstchange(self,code):</div><div>        changed_code=''</div><div>        for i in range(64):</div><div>            changed_code+=code[ip[i]-1]</div><div>        return changed_code</div><div><br/></div><div>    def _keyfirstchange (self,key):</div><div>        changed_key=''</div><div>        for i in range(56):</div><div>            changed_key+=key[pc1[i]-1]</div><div>        return changed_key</div><div><br/></div><div>    def _functionCodeChange(self, code):</div><div>        lens=len(code)/4</div><div>        return_list=''</div><div>        for i in range(lens):</div><div>            list=''</div><div>            for j in range(4):</div><div>                list+=code[ip_1[i*4+j]-1]</div><div>            return_list+=&quot;%x&quot; %int(list,2)</div><div>        return return_list</div><div><br/></div><div>    def _functionE(self,code):</div><div>        return_list=''</div><div>        for i in range(48):</div><div>            return_list+=code[e[i]-1]</div><div>        return return_list        </div><div><br/></div><div>    def _functionP(self,code):</div><div>        return_list=''</div><div>        for i in range(32):</div><div>            return_list+=code[p[i]-1]</div><div>        return return_list</div><div><br/></div><div>    def _functionS(self, key):</div><div>        return_list=''</div><div>        for i in range(8):</div><div>            row=int( str(key[i*6])+str(key[i*6+5]),2)</div><div>            raw=int(str( key[i*6+1])+str(key[i*6+2])+str(key[i*6+3])+str(key[i*6+4]),2)</div><div>            return_list+=self._functionTos(s[i][row][raw],4)</div><div><br/></div><div><br/></div><div>        return return_list</div><div><br/></div><div>    def _functionKeySecondChange(self,key):</div><div>        return_list=''</div><div>        for i in range(48):</div><div>            return_list+=key[pc2[i]-1]</div><div>        return return_list</div><div><br/></div><div>    def _functionCharToA(self,code,lens):</div><div>        return_code=''</div><div>        lens=lens%16</div><div>        for key in code:</div><div>            code_ord=int(key,16)</div><div>            return_code+=self._functionTos(code_ord,4)        </div><div>        if lens!=0:</div><div>            return_code+='0'*(16-lens)*4</div><div>        return return_code</div><div><br/></div><div>    def _functionTos(self,o,lens):</div><div>        return_code=''</div><div>        for i in range(lens):</div><div>            return_code=str(o&gt;&gt;i &amp;1)+return_code</div><div>        return return_code</div><div><br/></div><div>def tohex(string):</div><div>    return_string=''</div><div>    for i in string:</div><div>        return_string+=&quot;%02x&quot;%ord(i)</div><div>    return return_string</div><div>        </div><div>def tounicode(string):</div><div>    return_string=''</div><div>    string_len=len(string)</div><div>    for i in range(0,string_len,2):</div><div>        return_string+=chr(int(string[i:i+2],16))</div><div>    return return_string</div><div><br/></div><div>def desencode(from_code,key):</div><div>    from_code=tohex(from_code)</div><div>    key=tohex(key)</div><div>    </div><div>    des=DES()</div><div>    key_len=len(key)</div><div>    string_len=len(from_code)        </div><div>        </div><div>    if string_len&lt;1 or key_len&lt;1:</div><div>        print 'error input'</div><div>        return False</div><div>    key_code= des.code(from_code,key,string_len,key_len)</div><div>    return key_code</div><div><br/></div><div>if __name__  == '__main__':</div><div>    if(desencode(sys.argv[1],'mtqVwD4JNRjw3bkT9sQ0RYcZaKShU4sf')=='e3fab29a43a70ca72162a132df6ab532535278834e11e6706c61a1a7cefc402c8ecaf601d00eee72'):</div><div>        print 'correct.'</div><div>    else:</div><div>        print 'try again.'</div></div><div><br/></div><div>搜索__all__行可以找到脚本的<a href="https://github.com/liupengs/DES_Python/blob/master/des.py">原始出处</a>，<span style="font-size: unset; color: unset; font-family: unset;">用同一库中的des_1.py解密即可得到flag：</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>C:\Users\Administrator\Desktop\DES_Python-master&gt;python2 des_1.py</div><div>DES 解密</div><div><br/></div><div>请输入密文（长度不限）:e3fab29a43a70ca72162a132df6ab532535278834e11e6706c61a1a7cefc402c8ecaf601d00eee72</div><div>请输入密钥（长度不限）:mtqVwD4JNRjw3bkT9sQ0RYcZaKShU4sf</div><div>QCTF{eCy0AALMDH9rLoBnWnTigXpYPkgU0sU4}</div></div><div><br/></div><div>flag：QCTF{eCy0AALMDH9rLoBnWnTigXpYPkgU0sU4}</div><div><br/></div><div><span style="font-weight: bold;">74 2018 HITCON EV3 Basic</span></div><div><br/></div><div>下载得到ev3_basic.jpg和ev3_basic.pklg。</div><div><br/></div><div>先看前者，是乐高EV3机器人。放大查看屏幕，有flag格式hitcon{}。</div><div><img src="BMZCTF Misc 14（73-76）_files/Image [1].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div>再看pklg文件（这是OS X Packet Logger文件）可以用wireshark打开。<span style="font-size: unset; color: unset; font-family: unset;">乐高EV3机器人支持USB、蓝牙等方式连接，观察流量包中的协议，能看到HCI和RFCOMM，基本可以确定传输数据在RFCOMM的send包中。</span></div><div><br/></div><div><span style="font-size: unset; color: unset; font-family: unset;">接下来参考两篇Writeup：</span></div><div><a href="https://www.cnblogs.com/xiao3c/p/9829168.html">https://www.cnblogs.com/xiao3c/p/9829168.html</a></div><div><a href="https://blog.csdn.net/weixin_30708329/article/details/98380568">https://blog.csdn.net/weixin_30708329/article/details/98380568</a></div><div><br/></div><div>flag：hitcon{m1nd5t0rm_communication_and_firmware_developer_kit}</div><div><br/></div><div><span style="font-weight: bold;">75 2018 护网杯 easy_dump</span></div><div><br/></div><div>下载得到img格式文件。测试后发现是内存镜像，那么上volatility：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# volatility -f easy_dump.img imageinfo</div><div>Volatility Foundation Volatility Framework 2.6</div><div>INFO    : volatility.debug    : Determining profile based on KDBG search...</div><div>          Suggested Profile(s) : Win7SP1x64, Win7SP0x64, Win2008R2SP0x64, Win2008R2SP1x64_24000, Win2008R2SP1x64_23418, Win2008R2SP1x64, Win7SP1x64_24000, Win7SP1x64_23418</div><div>                     AS Layer1 : WindowsAMD64PagedMemory (Kernel AS)</div><div>                     AS Layer2 : FileAddressSpace (/root/Desktop/easy_dump.img)</div><div>                      PAE type : No PAE</div><div>                           DTB : 0x187000L</div><div>                          KDBG : 0xf80004006070L</div><div>          Number of Processors : 1</div><div>     Image Type (Service Pack) : 0</div><div>                KPCR for CPU 0 : 0xfffff80004007d00L</div><div>             KUSER_SHARED_DATA : 0xfffff78000000000L</div><div>           Image date and time : 2018-09-30 05:30:17 UTC+0000</div><div>     Image local date and time : 2018-09-30 13:30:17 +0800</div></div><div>然后看一下进程列表：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# volatility -f easy_dump.img --profile=Win7SP1x64 pslist</div><div>Volatility Foundation Volatility Framework 2.6</div><div>Offset(V)          Name                    PID   PPID   Thds     Hnds   Sess  Wow64 Start                          Exit                          </div><div>------------------ -------------------- ------ ------ ------ -------- ------ ------ ------------------------------ ------------------------------</div><div>0xfffffa8007d0ab30 System                    4      0     87      483 ------      0 2018-09-30 05:17:32 UTC+0000                                 </div><div>0xfffffa8008423310 smss.exe                248      4      2       29 ------      0 2018-09-30 05:17:32 UTC+0000                                 </div><div>0xfffffa800947c920 csrss.exe               336    320      9      437      0      0 2018-09-30 05:17:32 UTC+0000                                 </div><div>0xfffffa80096af3a0 wininit.exe             388    320      3       77      0      0 2018-09-30 05:17:32 UTC+0000                                 </div><div>0xfffffa80096b2060 csrss.exe               396    380     10      236      1      0 2018-09-30 05:17:32 UTC+0000                                 </div><div>0xfffffa8009af1060 winlogon.exe            432    380      3      111      1      0 2018-09-30 05:17:32 UTC+0000                                 </div><div>0xfffffa8009aebb30 services.exe            488    388      7      203      0      0 2018-09-30 05:17:33 UTC+0000                                 </div><div>0xfffffa8009b3f550 lsass.exe               504    388      6      547      0      0 2018-09-30 05:17:33 UTC+0000                                 </div><div>0xfffffa8009b41aa0 lsm.exe                 512    388     10      142      0      0 2018-09-30 05:17:33 UTC+0000                                 </div><div>0xfffffa8009b93060 svchost.exe             612    488     10      356      0      0 2018-09-30 05:17:33 UTC+0000                                 </div><div>0xfffffa8009bc4b30 vmacthlp.exe            668    488      3       53      0      0 2018-09-30 05:17:33 UTC+0000                                 </div><div>0xfffffa8009bec9e0 svchost.exe             700    488      8      266      0      0 2018-09-30 05:17:33 UTC+0000                                 </div><div>0xfffffa8009c2f960 svchost.exe             796    488     20      461      0      0 2018-09-30 05:17:33 UTC+0000                                 </div><div>0xfffffa8009c576d0 svchost.exe             840    488     17      368      0      0 2018-09-30 05:17:33 UTC+0000                                 </div><div>0xfffffa8009c6a060 svchost.exe             888    488     32      888      0      0 2018-09-30 05:17:33 UTC+0000                                 </div><div>0xfffffa8009ceb060 svchost.exe             260    488     14      619      0      0 2018-09-30 05:17:33 UTC+0000                                 </div><div>0xfffffa8009d2b390 svchost.exe             944    488     14      361      0      0 2018-09-30 05:17:33 UTC+0000                                 </div><div>0xfffffa8009dc5b30 spoolsv.exe            1192    488     12      311      0      0 2018-09-30 05:17:34 UTC+0000                                 </div><div>0xfffffa8009dc8340 dwm.exe                1204    840      5      125      1      0 2018-09-30 05:17:34 UTC+0000                                 </div><div>0xfffffa8009deb560 taskhost.exe           1232    488      9      171      1      0 2018-09-30 05:17:34 UTC+0000                                 </div><div><font color="#FF0000">0xfffffa8009e03630 explorer.exe           1260   1172     34      953      1      0 2018-09-30 05:17:34 UTC+0000  </font>                               </div><div>0xfffffa8009e04740 svchost.exe            1268    488     18      299      0      0 2018-09-30 05:17:34 UTC+0000                                 </div><div>0xfffffa8009f57210 vmtoolsd.exe           1536   1260      7      257      1      0 2018-09-30 05:17:34 UTC+0000                                 </div><div>0xfffffa8009fdb740 VGAuthService.         1632    488      3       88      0      0 2018-09-30 05:17:35 UTC+0000                                 </div><div>0xfffffa8009ffd060 vmtoolsd.exe           1688    488      9      296      0      0 2018-09-30 05:17:35 UTC+0000                                 </div><div>0xfffffa800a114060 svchost.exe            1928    488      6       92      0      0 2018-09-30 05:17:35 UTC+0000                                 </div><div>0xfffffa800a1531d0 TPAutoConnSvc.         1992    488      9      130      0      0 2018-09-30 05:17:35 UTC+0000                                 </div><div>0xfffffa800a1018a0 WmiPrvSE.exe           1548    612     10      196      0      0 2018-09-30 05:17:36 UTC+0000                                 </div><div>0xfffffa800a107060 dllhost.exe            1900    488     13      184      0      0 2018-09-30 05:17:36 UTC+0000                                                                                         </div><div>0xfffffa800a210b30 msdtc.exe              2084    488     12      143      0      0 2018-09-30 05:17:37 UTC+0000                                                                                         </div><div>0xfffffa800a23eb30 SearchIndexer.         2332    488     11      642      0      0 2018-09-30 05:17:40 UTC+0000                                                                                         </div><div>0xfffffa800a299630 TPAutoConnect.         2608   1992      3      109      1      0 2018-09-30 05:17:46 UTC+0000                                                                                         </div><div>0xfffffa800a283060 conhost.exe            2616    396      1       32      1      0 2018-09-30 05:17:46 UTC+0000                                                                                         </div><div>0xfffffa8008401730 WmiPrvSE.exe           2716    612      8      214      0      0 2018-09-30 05:17:56 UTC+0000                                                                                         </div><div><font color="#FF0000">0xfffffa80083f4060 notepad.exe            2952   1260      1       57      1      0 2018-09-30 05:18:25 UTC+0000  </font>                                                                                       </div><div>0xfffffa800a25b700 sppsvc.exe             1744    488      6      147      0      0 2018-09-30 05:19:36 UTC+0000                                                                                         </div><div>0xfffffa80083fbb30 svchost.exe            2484    488     14      334      0      0 2018-09-30 05:19:37 UTC+0000                                                                                         </div><div>0xfffffa800a113060 audiodg.exe            1856    796      6      128      0      0 2018-09-30 05:29:56 UTC+0000                                                                                         </div><div>0xfffffa80083ea9f0 dllhost.exe            2740    612     10      197      1      0 2018-09-30 05:30:14 UTC+0000                                                                                         </div><div>0xfffffa800a1a2b30 DumpIt.exe             2256   1260      2       43      1      1 2018-09-30 05:30:16 UTC+0000                                                                                         </div><div>0xfffffa8009b1fb30 conhost.exe            2964    396      2       57      1      0 2018-09-30 05:30:16 UTC+0000    </div></div><div>比较可疑的进程是记事本notepad.exe和资源管理器explorer.exe，看一下前者的内容。由于notepad插件不支持Win7SP1x64内存镜像，改为dump出notepad.exe进程的数据：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# volatility -f easy_dump.img --profile=Win7SP1x64 memdump -p 2952 -D ./</div><div>Volatility Foundation Volatility Framework 2.6</div><div>************************************************************************</div><div>Writing notepad.exe [  2952] to 2952.dmp</div></div><div>搜索数据中的文本，注意notepad的字符编码是16进制小端序，因此strings命令的-e参数要设为l：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# strings -e l 2952.dmp | grep flag</div><div>flag{flag is not here,but I put an strange jpg for you,hope you like it :)}</div><div>flag{flag is not here,but I put an strange jpg for you,hope you like it :)}</div><div>flag{flag is not here,but I put an strange jpg for you,hope you like it :)}</div><div>Allow flag to be passed with CreateFile call that indicates to perform downgrade if applicable.</div><div>thread_flags</div><div>……（后略）</div></div><div>得到提示，下一步线索在某张jpg格式图片文件中。用filescan列出文件，筛选jpg格式：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# volatility -f easy_dump.img --profile=Win7SP1x64 filescan | grep .jpg</div><div>Volatility Foundation Volatility Framework 2.6</div><div>0x00000000235c8770     32      0 RW---- \Device\HarddiskVolume1\phos.jpg</div></div><div>然后dump出来：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# volatility -f easy_dump.img --profile=Win7SP1x64 dumpfiles -Q 0x00000000235c8770 -D ./</div><div>Volatility Foundation Volatility Framework 2.6</div><div>DataSectionObject 0x235c8770   None   \Device\HarddiskVolume1\phos.jpg</div><div>SharedCacheMap 0x235c8770   None   \Device\HarddiskVolume1\phos.jpg</div></div><div>分析图片，发现文件尾后还有额外数据，为zip格式压缩包，binwalk分离：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# binwalk -e file.None.0xfffffa8007d34120.vacb</div><div><br/></div><div>DECIMAL       HEXADECIMAL     DESCRIPTION</div><div>--------------------------------------------------------------------------------</div><div>0             0x0             JPEG image data, EXIF standard</div><div>12            0xC             TIFF image data, little-endian offset of first image directory: 8</div><div>2238922       0x2229CA        Zip archive data, at least v2.0 to extract, compressed size: 87691, uncompressed size: 1048576, name: message.img</div><div>2326763       0x2380EB        End of Zip archive, footer length: 22</div></div><div>有时候binwalk好就好在分离出来的压缩包会自动解压，看一下分离结果：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# cd _file.None.0xfffffa8007d34120.vacb.extracted/</div><div>root@kali:~/Desktop/_file.None.0xfffffa8007d34120.vacb.extracted# ls</div><div>2229CA.zip  message.img</div><div>root@kali:~/Desktop/_file.None.0xfffffa8007d34120.vacb.extracted# file message.img</div><div>message.img: Linux rev 1.0 ext2 filesystem data (mounted or unclean), UUID=9eebf529-3408-406c-a4b3-302abe38aea1 (large files)</div></div><div>可以看到分离出的zip压缩包里是一个名为message.img的ext2格式磁盘镜像，直接进行一个挂载：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop/_file.None.0xfffffa8007d34120.vacb.extracted# mount message.img /mnt</div><div>root@kali:~/Desktop/_file.None.0xfffffa8007d34120.vacb.extracted# cd ../</div><div>root@kali:~/Desktop# ls -a /mnt</div><div>.  ..  hint.txt  lost+found  .Trash-0</div><div>root@kali:~/Desktop# mv /mnt/hint.txt ./</div></div><div>挂载后得到hint.txt，内容：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>10 10</div><div>10 11</div><div>10 12</div><div>10 13</div><div>10 14</div><div>10 15</div><div>10 16</div><div>10 17</div><div>10 18</div><div>10 19</div><div>10 20</div><div>10 21</div><div>……（后略）</div></div><div>每行两个数字，数字最小为10，最大为269，可能是某种坐标。尝试绘图，既然都在Linux下操作，就懒得用Python了，正好数据格式也直接适用gnuplot：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# gnuplot</div><div><br/></div><div>        G N U P L O T</div><div>        Version 5.2 patchlevel 8    last modified 2019-12-01</div><div><br/></div><div>        Copyright (C) 1986-1993, 1998, 2004, 2007-2019</div><div>        Thomas Williams, Colin Kelley and many others</div><div><br/></div><div>        gnuplot home:     http://www.gnuplot.info</div><div>        faq, bugs, etc:   type &quot;help FAQ&quot;</div><div>        immediate help:   type &quot;help&quot;  (plot window: hit 'h')</div><div><br/></div><div>Terminal type is now 'qt'</div><div>gnuplot&gt; plot 'hint.txt'</div><div>qt5ct: using qt5ct plugin</div></div><div>得到二维码：</div><div><img src="BMZCTF Misc 14（73-76）_files/Image [2].png" type="image/png" data-filename="Image.png"/></div><div>扫码得到：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>Here is the vigenere key: aeolus, but i deleted the encrypted message。</div></div><div>得到了维吉尼亚密码的密钥，但是密文被删掉了。继续看挂载的ext2磁盘，注意到其中存在隐藏目录.Trash-0，看一下里面：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# ls -a /mnt/.Trash-0/</div><div>.  ..  files  info</div><div>root@kali:~/Desktop# ls -a /mnt/.Trash-0/info/</div><div>.  ..  .message.swp.trashinfo</div><div>root@kali:~/Desktop# ls -a /mnt/.Trash-0/files/</div><div>.  ..  .message.swp</div></div><div>发现了vim临时文件.swp，用vim恢复：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# cd /mnt/.Trash-0/files/</div><div>root@kali:/mnt/.Trash-0/files# vim -r message</div></div><div>得到恢复后的文本：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>yispn!buwh_qcfd_ebo_mglzs</div></div><div>维吉尼亚密码解密：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>yeeet!just_find_and_solve</div></div><div><br/></div><div>flag：flag{yeeet!just_find_and_solve}</div><div><br/></div><div><span style="font-weight: bold;">76 BJDCTF-2020-Misc-一叶障目</span></div><div><br/></div><div>下载得到png格式文件。010editor模板提示IHDR块CRC错误，由于图片本身内容似乎是正常的（虽然基本上是一片黑，但是纹理还挺清晰的），可以判断是图像高度被修改了。多此一举地爆破一下正确高度：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>import struct</div><div>import binascii</div><div>from Crypto.Util.number import bytes_to_long</div><div><br/></div><div>img = open('C:/Users/Administrator/Desktop/1.png', 'rb').read()</div><div><br/></div><div>for i in range(0xFFFF):</div><div>    stream = img[12:20] + struct.pack('&gt;i', i) + img[24:29]</div><div>    crc = binascii.crc32(stream)</div><div>    if crc == bytes_to_long(img[29:33]):</div><div>        print(i, hex(i))</div></div><div>输出结果：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>844 0x34c</div></div><div>修改高度得到图像：</div><div><img src="BMZCTF Misc 14（73-76）_files/1.png" type="image/png" data-filename="1.png"/></div><div><br/></div><div>flag：xaflag{66666}</div></span>
</div></body></html> 