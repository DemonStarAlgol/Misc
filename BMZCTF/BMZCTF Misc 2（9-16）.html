<html>
<head>
  <title>BMZCTF Misc 2（9-16）</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/605894 (zh-CN, DDL); Windows/6.1.1 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="4907"/>
<h1>BMZCTF Misc 2（9-16）</h1>
<h2><a href="https://DemonStarAlgol.github.io/Misc/">[无关链接]</a></h2>

<div>
<span><div><span style="font-weight: bold;">9 技协杯-签到</span></div><div><br/></div><div>下载得到docx格式文件。直接打开，文档内仅有一张图片：</div><div><img src="BMZCTF Misc 2（9-16）_files/Image.png" type="image/png" data-filename="Image.png"/></div><div>注意到Microsoft Office的文档格式实质为zip压缩包，用压缩软件打开查看，在\word\media\路径下发现两张图片：</div><div><img src="BMZCTF Misc 2（9-16）_files/Image [1].png" type="image/png" data-filename="Image.png"/></div><div>其中修改时间2020年的图片很明显不是从文档内引入（否则修改时间应为1980年），而是另外压缩进去的。解压得到：</div><div><img src="BMZCTF Misc 2（9-16）_files/03CCAA9A-50C7-4915-B22C-BE38E74B646E.png" type="image/png" data-filename="03CCAA9A-50C7-4915-B22C-BE38E74B646E.png"/></div><div><br/></div><div>flag：flag{873f6218-dc48-11ea-a3b9-dca90498a2db}</div><div><br/></div><div><span style="font-weight: bold;">10 Fix it</span></div><div><br/></div><div>下载得到png格式文件。看一下：</div><div><img src="BMZCTF Misc 2（9-16）_files/Fix_it.png" type="image/png" data-filename="Fix_it.png"/></div><div>像是二维码，但右上角和左下角的定位符不见了。修复一下，注意定位符旁边必须有一格宽的空白：</div><div><img src="BMZCTF Misc 2（9-16）_files/1.png" type="image/png" data-filename="1.png"/></div><div>扫描得到flag。</div><div><br/></div><div>flag：flag{easyQRcode}</div><div><br/></div><div><span style="font-weight: bold;">11 解不开的秘密</span></div><div><br/></div><div>下载得到flag.docx和无扩展名的file文件。前者打开提示需要密码，先看后者，实际为文本：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>56326c755a473933637942535a57647063335279655342465a476c3062334967566d567963326c76626941314c6a417743677062534574465756394456564a53525535555831565452564a635532396d64486468636d5663556d566862465a4f5131304b436c74495330565a</div><div>……（后略）</div></div><div>十六进制ASCII转码：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>V2luZG93cyBSZWdpc3RyeSBFZGl0b3IgVmVyc2lvbiA1LjAwCgpbSEtFWV9DVVJSRU5UX1VTRVJcU29mdHdhcmVcUmVhbFZOQ10KCltIS0VZX0NVUlJFTlRfVVNFUlxTb2Z0d2FyZVxSZWFsVk5DXHZuY2xpY2Vuc2V3aXpdCiJfQW5sQ2xpZW50SWQiPSI4ZjVjYzM3OC0yZTFkLTQ2NzAt</div><div>……（后略）</div></div><div>base64解码：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>Windows Registry Editor Version 5.00</div><div><br/></div><div>[HKEY_CURRENT_USER\Software\RealVNC]</div><div><br/></div><div>[HKEY_CURRENT_USER\Software\RealVNC\vnclicensewiz]</div><div>&quot;_AnlClientId&quot;=&quot;8f5cc378-2e1d-4670-80e0-d2d81d882561&quot;</div><div>&quot;_AnlSelected&quot;=&quot;0&quot;</div><div>&quot;_AnlInclRate&quot;=&quot;0.0025&quot;</div><div><br/></div><div>[HKEY_CURRENT_USER\Software\RealVNC\vncserver]</div><div><br/></div><div>[HKEY_CURRENT_USER\Software\RealVNC\VNCViewer4]</div><div>&quot;dummy&quot;=&quot;&quot;</div><div><br/></div><div>[HKEY_CURRENT_USER\Software\RealVNC\VNCViewer4\MRU]</div><div>&quot;00&quot;=&quot;127.0.0.1&quot;</div><div>&quot;Order&quot;=hex:00,01</div><div>&quot;01&quot;=&quot;127.0.0.1:5900&quot;</div><div><br/></div><div>[HKEY_CURRENT_USER\Software\RealVNC\WinVNC4]</div><div><font style="color: rgb(255, 0, 0);">&quot;Password&quot;=hex:37,5e,be,86,70,b3,c6,f3</font></div><div>&quot;SecurityTypes&quot;=&quot;VncAuth&quot;</div><div>&quot;ReverseSecurityTypes&quot;=&quot;None&quot;</div><div>&quot;QueryConnect&quot;=dword:00000000</div><div>&quot;PortNumber&quot;=dword:0000170c</div><div>&quot;LocalHost&quot;=dword:00000000</div><div>&quot;IdleTimeout&quot;=dword:00000e10</div><div>&quot;HTTPPortNumber&quot;=dword:000016a8</div><div>&quot;Hosts&quot;=&quot;+,&quot;</div><div>&quot;AcceptKeyEvents&quot;=dword:00000001</div><div>&quot;AcceptPointerEvents&quot;=dword:00000001</div><div>&quot;AcceptCutText&quot;=dword:00000001</div><div>&quot;SendCutText&quot;=dword:00000001</div><div>&quot;DisableLocalInputs&quot;=dword:00000000</div><div>&quot;DisconnectClients&quot;=dword:00000001</div><div>&quot;AlwaysShared&quot;=dword:00000000</div><div>&quot;NeverShared&quot;=dword:00000000</div><div>&quot;DisconnectAction&quot;=&quot;None&quot;</div><div>&quot;RemoveWallpaper&quot;=dword:00000000</div><div>&quot;RemovePattern&quot;=dword:00000000</div><div>&quot;DisableEffects&quot;=dword:00000000</div><div>&quot;UseHooks&quot;=dword:00000001</div><div>&quot;PollConsoleWindows&quot;=dword:00000001</div><div>&quot;CompareFB&quot;=dword:00000001</div><div>&quot;Protocol3.3&quot;=dword:00000000</div><div>&quot;dummy&quot;=&quot;&quot;</div></div><div>是一串关于RealVNC的注册表信息。搜索可知<a href="https://www.realvnc.com/en/">RealVNC</a>是一种远程控制软件，同时注意到注册表项中存在Password项，猜测可能需要破解该软件的登录密码。搜索“RealVNC 注册表 密码 破解”可以找到相关文章，例如<a href="https://blog.51cto.com/darren/587007">这一个</a>和<a href="https://www.cnblogs.com/xiykj/p/12923937.html">那一个</a>。这里尝试使用一下github找到的<a href="https://github.com/x0rz4/vncpwd">vncpwd工具</a>：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>C:\Users\Administrator\Desktop\vncpwd-master&gt;vncpwd.exe 37 5e be 86 70 b3 c6 f3</div><div><br/></div><div>*VNC password decoder 0.2</div><div>by Luigi Auriemma</div><div>e-mail: aluigi@autistici.org</div><div>web:    aluigi.org</div><div><br/></div><div>- your input password seems in hex format (or shorter than 8 chars)</div><div><br/></div><div>  Password:   !QAZ2wsx</div><div><br/></div><div>  Press RETURN to exit</div></div><div>得到密码：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>!QAZ2wsx</div></div><div><br/></div><div>尝试以之解密flag.docx，得到：</div><div><img src="BMZCTF Misc 2（9-16）_files/Image [2].png" type="image/png" data-filename="Image.png"/></div><div>删除图片并把字体颜色改为黑色，得到flag：</div><div><img src="BMZCTF Misc 2（9-16）_files/Image [3].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div>flag：flag{aec1294a146b8ece1e3a295e557e198c}</div><div><br/></div><div><span style="font-weight: bold;">12 日志审计</span></div><div><br/></div><div>下载得到log格式文件。文本编辑器查看一下，<span style="font-size: unset; color: unset; font-family: unset;">共有6019条日志信息，其中4704行开始有明显的sql注入特征：</span></div><div><img src="BMZCTF Misc 2（9-16）_files/Image [4].png" type="image/png" data-filename="Image.png"/></div><div>选取一行出来把GET传参部分URL解码：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>192.168.0.1 - - [13/Oct/2018:12:38:14 +0000] &quot;GET /flag.php?user=hence%27%20AND%20ORD%28MID%28%28SELECT%20IFNULL%28CAST%28secret%20AS%20CHAR%29%2C0x20%29%20FROM%20haozi.secrets%20ORDER%20BY%20secret%20LIMIT%200%2C1%29%2C1%2C1%29%29%3D102--%20pZaF HTTP/1.1&quot; 200 327 &quot;-&quot; &quot;sqlmap/1.2#pip (http://sqlmap.org)&quot;</div></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>user=hence' AND ORD(MID((SELECT IFNULL(CAST(secret AS CHAR),0x20) FROM haozi.secrets ORDER BY secret LIMIT 0,1),1,1))=102</div></div><div>即secret的第一个字符ASCII码为102。进一步可以看出从4704到4728行都在对secret进行注入，且每行日志中注入语句的判断都成立，从而可以得到secret每一位字符对应的ASCII码。</div><div><br/></div><div>脚本如下：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>s = open('C:/Users/Administrator/Desktop/logcheck.log', 'r').readlines()[4703: 4728]</div><div><br/></div><div>flag = ''</div><div>for i in s:</div><div>    char = i.split('%3D')[1].split('--')[0]</div><div>    flag += chr(int(char))</div><div>print(flag)</div></div><div>运行结果：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>flag{mayiyahei1965ae7569}</div></div><div>比较奇怪的一点在于，日志的4728行注入得到的实际上是secret的第38位，但flag长度却只有25位。</div><div><br/></div><div>flag：flag{mayiyahei1965ae7569}</div><div><br/></div><div><span style="font-weight: bold;">13 赢战2019</span></div><div><br/></div><div>下载得到jpg格式文件。十六进制编辑器查看：</div><div><img src="BMZCTF Misc 2（9-16）_files/Image [5].png" type="image/png" data-filename="Image.png"/></div><div>文件尾后有额外数据，提取得到另一张jpg格式图片：</div><div><img src="BMZCTF Misc 2（9-16）_files/Image [6].png" type="image/png" data-filename="Image.png"/></div><div>直接扫码得到：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>眉头一皱，发现这个二维码并没有那么简单</div></div><div>Stegsolve查看图片，在Red Plane 2可以看到比较清晰的flag：</div><div><img src="BMZCTF Misc 2（9-16）_files/Image [7].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div>flag：flag{You_ARE_SOsmart}</div><div><br/></div><div><span style="font-weight: bold;">14 宝宝</span></div><div><br/></div><div>下载得到png格式文件。是个二维码：</div><div><img src="BMZCTF Misc 2（9-16）_files/3.png" type="image/png" data-filename="3.png"/></div><div>直接扫描得到：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>?一个宝宝是解不开这个东西的！</div></div><div>十六进制编辑器查看，文件尾部有额外数据：</div><div><img src="BMZCTF Misc 2（9-16）_files/Image [8].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div>提取得到zip格式压缩包，解压提示需要密码：</div><div><img src="BMZCTF Misc 2（9-16）_files/Image [9].png" type="image/png" data-filename="Image.png"/></div><div>接下来是猜谜时间，根据二维码扫描结果，猜测压缩包密码是多个baby组合，尝试后发现密码为：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>babybaby</div></div><div>解压得到flag和readme.txt，后者内容为：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>56a75oiQ5Yqf5Y+q5beu5LiA5q2l5LqGLi4uLg==</div></div><div>base64解码：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>离成功只差一步了....</div></div><div>再看flag，十六进制编辑器查看文件头，可以看出为PNG格式图片。修改文件扩展名得到图片：</div><div><img src="BMZCTF Misc 2（9-16）_files/flag.png" type="image/png" data-filename="flag.png"/></div><div>是个反色的二维码，扫码得到：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>flag{ThIs_Is_QR_Code}</div></div><div><br/></div><div>flag：flag{ThIs_Is_QR_Code}</div><div><br/></div><div><span style="font-weight: bold;">15 哆啦A梦</span></div><div><br/></div><div>下载得到jpg格式文件。十六进制编辑器查看，文件尾后有额外数据：</div><div><img src="BMZCTF Misc 2（9-16）_files/Image [10].png" type="image/png" data-filename="Image.png"/></div><div>提取得到PNG格式图片，是下方缺失一块的二维码。同时IHDR块的CRC报错，说明图片高度被修改过。爆破正确高度：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>import struct</div><div>import binascii</div><div>from Crypto.Util.number import bytes_to_long</div><div><br/></div><div>img = open('C:/Users/Administrator/Desktop/1.png', 'rb').read()</div><div><br/></div><div>for i in range(0xFFFF):</div><div>    stream = img[12:20] + struct.pack('&gt;i', i) + img[24:29]</div><div>    crc = binascii.crc32(stream)</div><div>    if crc == bytes_to_long(img[29:33]):</div><div>        print(i, hex(i))</div></div><div>运行结果：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>300 0x12c</div></div><div>修改高度得到完整图片：</div><div><img src="BMZCTF Misc 2（9-16）_files/1 [1].png" type="image/png" data-filename="1.png"/></div><div>扫码得到：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>ZmxhZ3tDdGZfMjAxOF92ZXJ5X2dvb2R9</div></div><div>base64解码得到flag。</div><div><br/></div><div>flag：<span style="text-indent: 0px;">flag{Ctf_2018_very_good}</span></div><div><br/></div><div><span style="text-indent: 0px; font-weight: bold;">16 </span><span style="font-weight: bold;">SDNISC2020_简单数据包</span></div><div><br/></div><div>下载得到pcapng格式文件。直接用wireshark打开会报错，十六进制编辑器查看，发现文件头缺失。尝试strings处理：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# strings 1.pcapng</div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">……（前略）</span></div><div>Counters provided by dumpcap</div><div>key.txtUT</div><div>ZmxhZ3tzZG5pc2NfbmV0X3NRMlgzUTl4fQ==</div><div>key.txtUT</div></div><div>可以发现key.txt和一段base64编码。实际上原文件尾部有一个压缩等级为的zip格式压缩包：</div><div><img src="BMZCTF Misc 2（9-16）_files/Image [11].png" type="image/png" data-filename="Image.png"/></div><div>压缩包内含key.txt，其内容即为上述base64编码。解码得到：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>flag{sdnisc_net_sQ2X3Q9x}</div></div><div>对原文件使用binwalk -e命令分解也可以得到同样的结果。</div><div><br/></div><div>flag：flag{sdnisc_net_sQ2X3Q9x}</div></span>
</div></body></html> 