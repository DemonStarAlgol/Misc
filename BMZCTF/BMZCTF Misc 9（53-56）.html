<html>
<head>
  <title>BMZCTF Misc 9（53-56）</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/605894 (zh-CN, DDL); Windows/6.1.1 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="5499"/>
<h1>BMZCTF Misc 9（53-56）</h1>
<h2><a href="https://DemonStarAlgol.github.io/Misc/">[无关链接]</a></h2>

<div>
<span><div><span style="font-weight: bold;">53 [2020第三届安洵杯]王牌特工</span></div><div><br/></div><div>下载得到无扩展名的findme文件，file命令看一下文件类型：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# file findme</div><div>findme: Linux rev 1.0 ext3 filesystem data, UUID=f2b1e8fa-29a6-454b-b6df-6182044790bc (needs journal recovery) (large files)</div></div><div>可以挂载也可以直接7-Zip作为压缩文件打开：</div><div><img src="BMZCTF Misc 9（53-56）_files/Image.png" type="image/png" data-filename="Image.png"/></div><div>key.txt的内容是：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>key:a_cool_key</div><div>use Veracrypt</div></div><div>解压出flagbox，根据提示用Veracrypt加载：</div><div><img src="BMZCTF Misc 9（53-56）_files/Image [1].png" type="image/png" data-filename="Image.png"/></div><div>得到flag.txt：</div><div><img src="BMZCTF Misc 9（53-56）_files/Image [2].png" type="image/png" data-filename="Image.png"/></div><div>……行吧。</div><div><br/></div><div>那就回头看看走过的路。目前为止一共涉及了两个磁盘镜像，一个Linux ext3格式磁盘，一个Veracrypt加密卷。注意到ext3格式磁盘中存在lost+found目录，结合以前做过的类似题目，可以用extundelete工具找到该磁盘中曾被删除的文件：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# extundelete findme --restore-all</div><div>NOTICE: Extended attributes are not restored.</div><div>WARNING: EXT3_FEATURE_INCOMPAT_RECOVER is set.</div><div>The partition should be unmounted to undelete any files without further data loss.</div><div>If the partition is not currently mounted, this message indicates</div><div>it was improperly unmounted, and you should run fsck before continuing.</div><div>If you decide to continue, extundelete may overwrite some of the deleted</div><div>files and make recovering those files impossible.  You should unmount the</div><div>file system and check it with fsck before using extundelete.</div><div>Would you like to continue? (y/n)</div><div>y</div><div>Loading filesystem metadata ... 2 groups loaded.</div><div>Loading journal descriptors ... 39 descriptors loaded.</div><div>Searching for recoverable inodes in directory / ...</div><div>1 recoverable inodes found.</div><div>Looking through the directory structure for deleted files ...</div><div>0 recoverable inodes still lost.</div></div><div>恢复成功.coolboy.swp文件，这是vim编辑器的临时文件，看一下内容：</div><div><img src="BMZCTF Misc 9（53-56）_files/Image [3].png" type="image/png" data-filename="Image.png"/></div><div><span style="font-size: unset; color: unset; font-family: unset;">比较值得注意的是一段base64编码：</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>55yf55qE5a+G56CBOnRoaXNfaXNfYV90cnVlX2tleQ==</div></div><div>解码：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>真的密码:this_is_a_true_key</div></div><div>再在Veracrypt里用这段密码加载加密卷，得到realflag.txt：</div><div><img src="BMZCTF Misc 9（53-56）_files/Image [4].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div>flag：flag{you_are_a_cool_boy}</div><div><br/></div><div><span style="font-weight: bold;">54 [2020第三届安洵杯]BeCare4</span></div><div><br/></div><div>下载得到加密压缩包flag.7z和无扩展名文件npmtxt。先看后者，实际是个文本，但包含大量Unicode零宽控制符：</div><div><img src="BMZCTF Misc 9（53-56）_files/Image [5].png" type="image/png" data-filename="Image.png"/></div><div>各种零宽隐写在线工具均尝试一遍后发现是<a href="https://yuanfux.github.io/zero-width-web/">Zero Width Lib</a>：</div><div><img src="BMZCTF Misc 9（53-56）_files/Image [6].png" type="image/png" data-filename="Image.png"/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>oh,you found the pass:RealV1siBle</div></div><div>得到解压密码。</div><div><br/></div><div>解压得到JPG格式图片，Stegsolve查看，在R/G/B颜色通道的3、2、1、0低位通道右下角发现隐写痕迹：</div><div><img src="BMZCTF Misc 9（53-56）_files/Image [7].png" type="image/png" data-filename="Image.png"/></div><div>这种类似特定花纹小方格/小圆圈重复出现的隐写痕迹是SilentEye的特征，直接用工具提取隐写信息：</div><div><img src="BMZCTF Misc 9（53-56）_files/Image [8].png" type="image/png" data-filename="Image.png"/></div><div>得到flag。</div><div><br/></div><div>flag：D0g3{1nV1sible_flag_Can_You_find?!}</div><div><br/></div><div><span style="font-weight: bold;">55 [2020第三届安洵杯]套娃</span></div><div><br/></div><div>下载得到hardzip.zip，内含加密压缩的easyzip.zip和password1文件夹，后者又内含6个2字节的txt文本文件：</div><div><img src="BMZCTF Misc 9（53-56）_files/Image [9].png" type="image/png" data-filename="Image.png"/></div><div>明显是CRC32碰撞：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>import binascii, string, itertools</div><div><br/></div><div>dic = string.printable</div><div>crc = ['EA4446B6', 'ED7987DE', '46FE0943', '4BE30989', 'B31975C0', 'D6BB1BEF']</div><div><br/></div><div>def CRCcrack(c):</div><div>    for i in itertools.product(dic, repeat=2):</div><div>        s = ''.join(i)</div><div>        crc32 = hex(binascii.crc32(s.encode())).upper()[2:].zfill(8)</div><div>        if crc32 == c:</div><div>            return(s)</div><div><br/></div><div>for i in crc:</div><div>    print(CRCcrack(i), end='')</div></div><div>输出结果：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>!qQIdEa@#!z)</div></div><div><br/></div><div>解压得到easyzip.zip，内含三个加密压缩的txt文本文件：</div><div><img src="BMZCTF Misc 9（53-56）_files/Image [10].png" type="image/png" data-filename="Image.png"/></div><div>从CRC32可以看出后两个文件是完全相同的。可以联想到明文攻击，这样一来需要将其中一个解压，尝试伪加密：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>D:\CTFToolkit-v1.1.0\暴力破解\ZipCenOp&gt;java -jar ZipCenOp.jar r easyzip.zip</div><div>success 3 flag(s) found</div></div><div>生成的未加密压缩包中redeme.txt是可以正常解压的，说明原压缩包中仅有该文件是伪加密。将该压缩包中另外两个txt文本文件删除，然后把 redeme.txt 重命名为 redeme - 副本.txt ，作为明文压缩包。原来的easyzip.zip中的redeme.txt删除，作为加密压缩包。然后进行明文攻击：</div><div><img src="BMZCTF Misc 9（53-56）_files/Image [11].png" type="image/png" data-filename="Image.png"/></div><div>得到密码：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>%3#c$v!@</div></div><div>解压得到flag.txt：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>V20xa2NGa3hPV1ppYlRrd1lraDBkMk51WkdwWU1UazVXVmh2YlZreVZtaGFSMnhC</div></div><div>base64解码三次得到：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>fgic__notl{prwc__}az&amp;ceadi@</div></div><div>已经能看到flag格式，尝试手动排列一下栅栏：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>fgic__not</div><div>l{prwc__}</div><div>az&amp;ceadi@</div></div><div>竖着读得到：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>flag{zip&amp;crc_we_can_do_it}@</div></div><div><br/></div><div>flag：flag{zip&amp;crc_we_can_do_it}</div><div><br/></div><div><b>56 2018 SUCTF follow-me</b></div><div><br/></div><div>下载得到pcapng格式文件，wireshark打开，统计-协议分级：</div><div><img src="BMZCTF Misc 9（53-56）_files/Image [12].png" type="image/png" data-filename="Image.png"/></div><div>可以看到大部分数据量来自HTTP协议，由于HTTP协议是明文的，先尝试搜索一下flag格式：</div><div><img src="BMZCTF Misc 9（53-56）_files/Image [13].png" type="image/png" data-filename="Image.png"/></div><div>然后就找到了flag。</div><div><br/></div><div>flag：<span style="color: unset; font-family: unset; font-size: unset;">SUCTF{password_is_not_weak}</span></div></span>
</div></body></html> 