<html>
<head>
  <title>BMZCTF Misc 22（105-108）</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/605894 (zh-CN, DDL); Windows/6.1.1 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="7217"/>
<h1>BMZCTF Misc 22（105-108）</h1>
<h2><a href="https://DemonStarAlgol.github.io/Misc/">[无关链接]</a></h2>

<div>
<span><div><span style="font-weight: bold;">105 </span><span style="font-weight: bold;">[2021CISCN线上赛]tiny traffic</span></div><div><br/></div><div>下载得到pcapng格式文件。wireshark打开，统计-协议分级：</div><div><img src="BMZCTF Misc 22（105-108）_files/Image.png" type="image/png" data-filename="Image.png"/></div><div>字节百分比以TLS和HTTP为主，前者是加密流量，先看后者，导出HTTP对象：</div><div><img src="BMZCTF Misc 22（105-108）_files/Image [1].png" type="image/png" data-filename="Image.png"/></div><div>发现了和flag有关的痕迹，具体来说，是从192.168.2.193:5000下载了一个gzip类型压缩文件。并且其后还从同一个服务器下载了test和secret两个br类型文件。将三个文件全部导出，解压flag_wrapper得到 文本：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>CISCN{}</div></div><div>是个平平无奇的flag格式，那么关键可能在另外两个br类型文件。</div><div><br/></div><div>搜索可知编码内容类型br对应的是利用开源压缩算法<a href="https://zh.wikipedia.org/wiki/Brotli">Brotli</a>进行压缩的内容编码。有些压缩软件可能自带支持，但7-zip之类的就不大行。但我在Github Desktop的安装文件夹里找到了一个brotli.exe：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>C:\Users\Administrator\Desktop&gt;C:\Users\Administrator\AppData\Local\GitHubDeskto</div><div>p\app-2.9.4\resources\app\git\mingw64\bin\brotli.exe -d secret.br -o secret</div><div><br/></div><div>C:\Users\Administrator\Desktop&gt;C:\Users\Administrator\AppData\Local\GitHubDeskto</div><div>p\app-2.9.4\resources\app\git\mingw64\bin\brotli.exe -d test.br -o test</div></div><div>得到的test是一段文本：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>syntax = &quot;proto3&quot;;</div><div><br/></div><div>message PBResponse {</div><div>  int32 code = 1;</div><div>  int64 flag_part_convert_to_hex_plz = 2;</div><div>  message data {</div><div>    string junk_data = 2;</div><div>    string flag_part = 1;</div><div>  }</div><div>  repeated data dataList = 3;</div><div>  int32 flag_part_plz_convert_to_hex = 4;</div><div>  string flag_last_part = 5;</div><div>}</div><div><br/></div><div>message PBRequest {</div><div>  string cate_id = 1;</div><div>  int32 page = 2;</div><div>  int32 pageSize = 3;</div><div>}</div></div><div>secret则是一段数据：</div><div><img src="BMZCTF Misc 22（105-108）_files/Image [2].png" type="image/png" data-filename="Image.png"/></div><div>搜索proto3，找到<a href="https://zh.wikipedia.org/wiki/Protocol_Buffers">Protocol Buufers</a>，根据百科内容，这是一种序列化数据结构的协议。容易想到，secret文件很可能就是利用Protocol Buufers序列化后的数据，那么将其反序列化回去即可。参考<a href="https://blog.csdn.net/weixin_57440207/article/details/116402943">这篇文章</a>，test就是定义数据结构用的proto文件，先将其编译：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>C:\Users\Administrator\Desktop\protoc-3.19.4-win64\bin&gt;protoc.exe --python_out=.</div><div>test.proto</div></div><div>会得到一个test_pb2.py文件，内容略，然后import它进行反序列化：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>import test_pb2</div><div><br/></div><div>secret = open('secret', 'rb').read()</div><div>data = test_pb2.PBResponse()</div><div>data.ParseFromString(secret)</div><div>print(data)</div></div><div>得到：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>code: 200</div><div>flag_part_convert_to_hex_plz: 15100450</div><div>dataList {</div><div>  flag_part: &quot;e2345&quot;</div><div>  junk_data: &quot;7af2c&quot;</div><div>}</div><div>dataList {</div><div>  flag_part: &quot;7889b0&quot;</div><div>  junk_data: &quot;82bc0&quot;</div><div>}</div><div>flag_part_plz_convert_to_hex: 16453958</div><div>flag_last_part: &quot;d172a38dc&quot;</div></div><div>那么接下来根据说明把flag拼接起来即可：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div># 接在上面的脚本之后</div><div>flag = hex(data.flag_part_convert_to_hex_plz)[2:]</div><div>flag += data.dataList[0].flag_part</div><div>flag += data.dataList[1].flag_part</div><div>flag += hex(data.flag_part_plz_convert_to_hex)[2:]</div><div>flag += data.flag_last_part</div><div>print(f'CISCN{{{flag}}}')</div></div><div><br/></div><div>flag：CISCN{e66a22e23457889b0fb1146d172a38dc}</div><div><br/></div><div><span style="font-weight: bold;">106 [2021东华杯]project</span></div><div><br/></div><div>下载得到一整个Kingdemo3文件夹：</div><div><img src="BMZCTF Misc 22（105-108）_files/Image [3].png" type="image/png" data-filename="Image.png"/></div><div>似乎是个叫<a href="http://www.con-star.com/product/showproduct.php?lang=cn&amp;id=73&amp;ivk_sa=1024320u">组控王</a>的东西，和工控有关。但再仔细看一下会发现，整个文件夹除了test.exe修改日期是2021年，其他的最晚也是2011年。怎么说呢，感觉上就是找了堆组控王的现成文件，然后把test.exe丢在里面……</div><div><br/></div><div>那就来看test.exe，从图标来看是pyinstaller库打包的。尝试反编译了一下（参见 <a href="evernote:///view/30668439/s39/efcce1a9-ccf2-484d-9b62-4d89055df103/efcce1a9-ccf2-484d-9b62-4d89055df103/" style="color: rgb(105, 170, 53);">44 红包题 凌波微步</a>），得到的Python代码是：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>byte = b'PK（中略）'</div><div>with open('problem_bak.zip', 'wb+') as (in_file):</div><div>    in_file.write(byte)</div></div><div>没有别的玄机，就是运行后生成一个zip格式压缩包，过度包装了属于是。那么就直接运行一下这个exe，得到problem_bak.zip，再解压这个zip，得到一个叫“你来了~”的文件。打开看一下发现是个文本：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>Date: Sun, 19 Sep 2021 21:28:55 +0800</div><div>From: &quot;mklkxxx@yeah.net&quot; &lt;mklkxxx@yeah.net&gt;</div><div>To: mklkxxx &lt;mklkxxx@yeah.net&gt;</div><div>Subject: =?UTF-8?B?5L2g5p2l5LqGfg==?=</div><div>X-Priority: 3</div><div>X-Has-Attach: no</div><div>X-Mailer: Foxmail 7.2.20.273[cn]</div><div>Mime-Version: 1.0</div><div>Message-ID: &lt;202109192128112273138@yeah.net&gt;</div><div>Content-Type: multipart/related;</div><div>    boundary=&quot;----=_001_NextPart057850482324_=----&quot;</div><div><br/></div><div>This is a multi-part message in MIME format.</div><div><br/></div><div>------=_001_NextPart057850482324_=----</div><div>Content-Type: multipart/alternative;</div><div>    boundary=&quot;----=_002_NextPart832058858335_=----&quot;</div><div><br/></div><div>------=_002_NextPart832058858335_=----</div><div>Content-Type: text/plain;</div><div>    charset=&quot;UTF-8&quot;</div><div>Content-Transfer-Encoding: base64</div><div><br/></div><div>6KGo5oOF5YyF5paH5YyW77yM5piv6ZqP552A572R57uc56S+5Lqk5rKf6YCa55qE5aKe5aSa5Ye6</div><div>546w55qE5LiA56eN5Li75rWB5paH5YyW44CC5LiA5Liq5Lq655qE6KGo5oOF5YyF5piv5YW26ZqQ</div><div>6JeP6LW35p2l55qE55yf5oiR77yM5LiA5Liq5Zu95a6255qE6KGo5oOF5YyF6YeM6IO955yL5Yiw</div><div>……（后略）</div></div><div>很明显是邮件格式。可以重命名为.eml后用本地邮件软件打开，没有的话也可以用QQ邮箱作为附件发给自己，然后在线预览：</div><div><img src="BMZCTF Misc 22（105-108）_files/Image [4].png" type="image/png" data-filename="Image.png"/></div><div>邮件内容是一段文字和一张图片。图片下载后十六进制编辑器打开，文件尾后有额外数据：</div><div><img src="BMZCTF Misc 22（105-108）_files/Image [5].png" type="image/png" data-filename="Image.png"/></div><div>从无法辩识这点来看有点像用OurSecret隐写的信息，那么就还需要一个密钥。回头看文字部分，在QQ邮箱的预览页面查看源代码：</div><div><img src="BMZCTF Misc 22（105-108）_files/Image [6].png" type="image/png" data-filename="Image.png"/></div><div>有Unicode零宽度控制字符，说明很可能是零宽隐写，几个常见工具试一下，发现是<a href="http://330k.github.io/misc_tools/unicode_steganography.html">这个</a>的默认设置：</div><div><img src="BMZCTF Misc 22（105-108）_files/Image [7].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div>然后直接用OurSecret：</div><div><img src="BMZCTF Misc 22（105-108）_files/Image [8].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div>flag：flag{f3a5dc36-ad43-d4fa-e75f-ef79e2e28ef3}</div><div><br/></div><div><span style="font-weight: bold;">107 [2021东华杯]JumpJumpTiger</span></div><div><br/></div><div>下载得到jump.exe，勇敢运行一下：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>C:\Users\Administrator\Desktop&gt;jump.exe</div><div>This is your hint!!!</div></div><div>啥都没有。IDA64逆向，Shift+F12查看字符串，可以看到这段内容：</div><div><img src="BMZCTF Misc 22（105-108）_files/Image [9].png" type="image/png" data-filename="Image.png"/></div><div>此外还有三大段符合base64编码格式的字符串，在十六进制编辑器里也可以找到：</div><div><img src="BMZCTF Misc 22（105-108）_files/Image [10].png" type="image/png" data-filename="Image.png"/></div><div>看到两个/，容易联想到/9j/是JPG格式图像的base64编码的开头（实际上是文件头FF D8和第一个APP0块第一个字节FF对应的base64编码）。相应可以发现iVBO是PNG格式图像的base64编码的开头（对应文件头前三个字节89 50 4E）。那么很明显，这一整段字符串其实是两张图的base64编码逐字符交错穿插得到的，写个脚本提取一下：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>from base64 import b64decode</div><div><br/></div><div>data = open('C:/Users/Administrator/Desktop/jump.exe', 'rb').read()[0x2600: 0x7d4660].decode()</div><div>jpg = ''.join([data[i] for i in range(0, len(data), 2)]).encode()</div><div>png = ''.join([data[i] for i in range(1, len(data), 2)]).encode()</div><div>open('C:/Users/Administrator/Desktop/1.jpg', 'wb').write(b64decode(jpg))</div><div>open('C:/Users/Administrator/Desktop/1.png', 'wb').write(b64decode(png))</div></div><div>得到两个图像：</div><div><img src="BMZCTF Misc 22（105-108）_files/Image [11].png" type="image/png" data-filename="Image.png"/></div><div>大小和画面内容都类似，用Stegsolve的Image Combiner看一下：</div><div><img src="BMZCTF Misc 22（105-108）_files/Image [12].png" type="image/png" data-filename="Image.png"/></div><div>XOR模式下出现了大量蓝色虚线样图案，说明可能是盲水印。几个常见的盲水印脚本尝试一下：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop/blind-watermark-python3/BlindWaterMark# python3 bwmforpy3.py decode 1.jpg 1.png out.png</div><div>image&lt;1.jpg&gt; + image(encoded)&lt;1.png&gt; -&gt; watermark&lt;out.png&gt;</div></div><div>得到：</div><div><img src="BMZCTF Misc 22（105-108）_files/out.png" type="image/png" data-filename="out.png"/></div><div><br/></div><div>然后想起来逆向逆到一半还没逆完，回去在IDA64里F5切换到伪代码：</div><div><img src="BMZCTF Misc 22（105-108）_files/Image [13].png" type="image/png" data-filename="Image.png"/></div><div>简而言之就是把奇数和偶数分开放进两个数组，原来这就是hint，行吧……</div><div><br/></div><div>flag：flag{72f73bbe-9193-e59a-c593-1b1cb8f76714}</div><div><br/></div><div><span style="font-weight: bold;">108 [2021东华杯]where_can_find_code</span></div><div><br/></div><div>下载得到code.asc文件。是个文本：</div><div><img src="BMZCTF Misc 22（105-108）_files/Image [14].png" type="image/png" data-filename="Image.png"/></div><div>大致看一下，似乎是个html富文本，但有几个可疑之处：</div><div>1、开头部分行的部分空格被00字节替换了（所以如果用记事本打开，看到的缩进仍然很整齐）；</div><div>2、末尾有如下内容：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>format(&quot;Translate the letter J into I&quot;);</div><div>dpeb{e58ca5e2-2c51-4eef-5f5e-33539364deoa}</div></div><div>看似凯撒移位密码的提示，以及一个类似flag格式的字符串（但无法简单移位成flag）。</div><div><br/></div><div>第二条姑且先不管，第一条很明显就是wbStego对文本文件进行隐写的特征。而wbStego确实也支持扩展名为asc的文本文件的隐写：</div><div><img src="BMZCTF Misc 22（105-108）_files/Image [15].png" type="image/png" data-filename="Image.png"/></div><div>事实上这个asc扩展名指的就是DOS系统下的ASCII文本文件。无隐写密钥，提取隐写信息得到：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>20810842042108421</div></div><div>仅包含01248五个数字，且以0分隔，很明显是<a href="http://www.tuili.com/blog/u/503/archives/2009/1200.html">云影密码</a>：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">bingo</span></div></div><div>看起来是个密钥，类似flag格式的字符串可能是密文，那么关键应该是加密方法。</div><div><br/></div><div>搜索&quot;Translate the letter J into I&quot;，发现可能与Playfair密码有联系：</div><div><img src="BMZCTF Misc 22（105-108）_files/Image [16].png" type="image/png" data-filename="Image.png"/></div><div>由于<a href="https://zh.wikipedia.org/wiki/%E6%B3%A2%E9%9B%B7%E8%B2%BB%E5%AF%86%E7%A2%BC">Playfair密码</a>的加密矩阵是5x5的，填入26个英文字母时需要将某两个字母视为同一个或去掉一个，最常用的就是把字母J视作I，因此在线工具中会有这样的选项：</div><div><img src="BMZCTF Misc 22（105-108）_files/Image [17].png" type="image/png" data-filename="Image.png"/></div><div>用bingo作为密钥解密密文即可得到flag（但不要用上面搜出来这个，这个不大行）。</div><div><br/></div><div>flag：flag{d58af5d2-2a51-4dde-5e5d-33539364cdbf}</div><div><br/></div><div><span style="font-weight: bold;">112 2018 护网杯 Old Attack</span></div><div>提示：The title is hint。:) / <span style="font-size: unset; color: unset; font-family: unset;">malformat RSN / </span><span style="font-size: unset; color: unset; font-family: unset;">不规范的802.11 frame / </span><span style="font-size: unset; color: unset; font-family: unset;">Evil AKM Fuzz?</span></div><div><br/></div><div><span style="font-size: unset; color: unset; font-family: unset;">下载得到</span>dict.pcapng和huwang.cap。</div></span>
</div></body></html> 