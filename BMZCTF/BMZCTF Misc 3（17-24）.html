<html>
<head>
  <title>BMZCTF Misc 3（17-24）</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/605894 (zh-CN, DDL); Windows/6.1.1 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="5049"/>
<h1>BMZCTF Misc 3（17-24）</h1>
<h2><a href="https://DemonStarAlgol.github.io/Misc/">[无关链接]</a></h2>

<div>
<span><div><span style="font-weight: bold;">17 Traffic_Light</span></div><div><br/></div><div>下载得到gif格式文件。是一个红绿灯的动画，GIFFrame打开，共有1168帧：</div><div><img src="BMZCTF Misc 3（17-24）_files/Image.png" type="image/png" data-filename="Image.png"/></div><div>观察规律，可以看出大致以18帧为1个单元，共65个单元（最后一个单元为16帧）。每个单元内有9次“灯亮-灯暗”的循环，且第1次亮灯必定为绿灯，2-8次为绿灯或红灯，第9次亮灯必定为黄灯。猜测黄灯为分隔符，前8次亮灯的红绿信息是8位二进制数据。若以第1位绿灯对应0，红灯对应1，那么8位二进制数据正好对应1个ASCII字符。</div><div><br/></div><div>本题已经做过，参见 <a href="evernote:///view/30668439/s39/1de7ea68-ed53-44b2-a1a5-17279bb291e8/1de7ea68-ed53-44b2-a1a5-17279bb291e8/" style="color: rgb(105, 170, 53);">CTFshow Misc 10（37-40）</a>。这里换个不需要提前拆分动画帧的脚本试试看：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>from PIL import Image</div><div><br/></div><div>img = Image.open('C:/Users/Administrator/Desktop/Traffic_Light.gif')</div><div>img.seek(0)</div><div>green = img.getpixel((110, 140))</div><div>img.seek(2)</div><div>red = img.getpixel((110, 50))</div><div><br/></div><div>flag = ''</div><div>for i in range(65):</div><div>    s = ''</div><div>    for j in range(8):</div><div>        img.seek(i * 18 + j * 2)</div><div>        if img.getpixel((110, 140)) == green:</div><div>            s += '0'</div><div>        if img.getpixel((110, 50)) == red:</div><div>            s += '1'</div><div>    flag += chr(int(s, 2))</div><div><br/></div><div>print(flag)</div></div><div>输出结果：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>flag{Pl34s3_p4y_4tt3nt10n_t0_tr4ff1c_s4f3ty_wh3n_y0u_4r3_0uts1d3}</div></div><div><br/></div><div>flag：flag{Pl34s3_p4y_4tt3nt10n_t0_tr4ff1c_s4f3ty_wh3n_y0u_4r3_0uts1d3}</div><div><br/></div><div><span style="font-weight: bold;">18 2018 hackergame Word 文档</span></div><div><br/></div><div>下载得到docx格式文件。直接打开会报错：</div><div><img src="BMZCTF Misc 3（17-24）_files/Image [1].png" type="image/png" data-filename="Image.png"/></div><div>将docx文件作为压缩包打开，发现flag.txt：</div><div><img src="BMZCTF Misc 3（17-24）_files/Image [2].png" type="image/png" data-filename="Image.png"/></div><div>得到flag。</div><div><br/></div><div>flag：flag{xlsx,pptx,docx_are_just_zip_files}</div><div><br/></div><div><span style="font-weight: bold;">19 神秘压缩包</span></div><div><br/></div><div>下载得到加密的RAR格式压缩包和压缩包密码.txt。先看后者：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAArIAAACtCAIAAADDBAuwAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAZ/SURBVHhe7d1NcuJIFIXRXhcLYj2sxpvxYqqlzCvpKQWUO3ogwOdMrJ9UQo3eV9gR/PMHAKCRBQBAyA</div><div>……（后略）</div></div><div>直接输入浏览器地址栏转成图片：</div><div><img src="BMZCTF Misc 3（17-24）_files/download.png" type="image/png" data-filename="download.png"/></div><div><br/></div><div>解压得到160张二维码：</div><div><img src="BMZCTF Misc 3（17-24）_files/Image [3].png" type="image/png" data-filename="Image.png"/></div><div>写个脚本扫描一下所有二维码：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>from pyzbar import pyzbar</div><div>from PIL import Image</div><div><br/></div><div>def get_QR(path):</div><div>    img = Image.open(path)</div><div>    txt_list = pyzbar.decode(img)</div><div>    for txt in txt_list:</div><div>        barcodeData = txt.data.decode(&quot;utf-8&quot;)</div><div>        return barcodeData</div><div><br/></div><div>for i in range(160):</div><div>    path = f'C:/Users/Administrator/Desktop/wenjian/{str(i)}.png'</div><div>    print(get_QR(path))</div></div><div>输出的扫描结果均为0或1，共160个，尝试将其每8位二进制ASCII转码：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>res = ''</div><div>for i in range(160):</div><div>    path = f'C:/Users/Administrator/Desktop/wenjian/{str(i)}.png'</div><div>    res += get_QR(path)</div><div>print(int(res, 2).to_bytes(20, 'big'))</div></div><div>运行得到flag。</div><div><br/></div><div>flag：flag{QRcode1sUseful}</div><div><br/></div><div><span style="font-weight: bold;">20 海量的txt文件</span></div><div><br/></div><div>下载得到flag文件夹。内含500个8KB左右的txt格式文本：</div><div><img src="BMZCTF Misc 3（17-24）_files/Image [4].png" type="image/png" data-filename="Image.png"/></div><div>任意打开一个文件，可以看到大量可打印字符随机组成的类似乱码的文本。先尝试明文查找flag，搜索flag、ctf、key等常见关键字，发现318.txt包含关键字key：</div><div><img src="BMZCTF Misc 3（17-24）_files/Image [5].png" type="image/png" data-filename="Image.png"/></div><div>打开318.txt搜索关键字key发现flag：</div><div><img src="BMZCTF Misc 3（17-24）_files/Image [6].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div>flag：key{fe9ff627da72364a}</div><div><br/></div><div><span style="font-weight: bold;">21 [2020首届祥云杯]到点了</span></div><div><br/></div><div>下载得到三个docx格式文件。其中2.docx提示需要密码，3.docx打开报错，只有1.docx能正常打开：</div><div><img src="BMZCTF Misc 3（17-24）_files/Image [7].png" type="image/png" data-filename="Image.png"/></div><div>全选-右键-字体-取消隐藏：</div><div><img src="BMZCTF Misc 3（17-24）_files/Image [8].png" type="image/png" data-filename="Image.png"/></div><div>得到提示，密码为8位字母数字。</div><div><br/></div><div>但如果真的用8位大小写字母及数字组成的密码对2.docx进行爆破，可能需要几十年的时间。但从8位数字可以联想（这两个字读作cāi mí）到日期，尝试配合掩码进行爆破：</div><div><img src="BMZCTF Misc 3（17-24）_files/Image [9].png" type="image/png" data-filename="Image.png"/></div><div>破解得到密码20201024，实际上是1.docx的修改时间，就很猜谜。</div><div><img src="BMZCTF Misc 3（17-24）_files/Image [10].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div>打开2.docx，同样是一段话加一张图片。删掉图片，发现有白色文字。</div><div><img src="BMZCTF Misc 3（17-24）_files/Image [11].png" type="image/png" data-filename="Image.png"/></div><div>修改字体颜色或者直接复制得到：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>AABBAABBBAABBBAAAABBABBABABAAAAABBAAABBBBAABBBAABABABBAAABAAAABAABAABBABAAAAABAA</div></div><div>培根密码解密（注意使用正确对应的字符表，这里用的是全部26个字母，而非缺少J和V的字符表）得到：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>GOODNIGHTSWEETIE</div></div><div><br/></div><div>最后看3.docx，作为压缩包打开，发现4.zip：</div><div><img src="BMZCTF Misc 3（17-24）_files/Image [12].png" type="image/png" data-filename="Image.png"/></div><div>解压两次得到4.bmp。考虑到上面得到了一串暂时不知道用途的字符串，考虑带有密码的现成工具隐写。结合BMP格式，猜测可能为wbStego。用GOODNIGHTSWEETIE作为密码提取隐写信息：</div><div><img src="BMZCTF Misc 3（17-24）_files/Image [13].png" type="image/png" data-filename="Image.png"/></div><div>得到的文件实际为文本，内容为：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>flag{2ec9405ac7bcfb16f5fd494bcf21337c}</div></div><div><br/></div><div>flag：BMZCTF{2ec9405ac7bcfb16f5fd494bcf21337c}</div><div><br/></div><div><span style="font-weight: bold;">22 小明的演讲</span></div><div><br/></div><div>下载得到pptx格式文件。直接打开会报错：</div><div><img src="BMZCTF Misc 3（17-24）_files/Image [14].png" type="image/png" data-filename="Image.png"/></div><div>作为压缩包打开，在\ppt\media\路径下找到不可读取内容，是一个zip格式压缩包：</div><div><img src="BMZCTF Misc 3（17-24）_files/Image [15].png" type="image/png" data-filename="Image.png"/></div><div>再次解压得到两个txt文本文件和一个加密的flag.zip。根据文件名提示，需要破解两段密文得到压缩包密码。先看第一部分：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>2053250813784316</div></div><div>可以发现进制转换和常见的以数字为密文的替换式古典密码均无法得到有意义结果。注意到密文长度为4的倍数，尝试<a href="http://code.mcdvisa.com/">标准中文电码</a>，得到结果：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">我是密码</span></div><div>再看第二部分，直接打开文本显示为乱码，十六进制编辑器查看：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>FF FE 62 11 4E 5F 66 2F 5B C6 78 01</div></div><div>注意到汉字“我”的Unicode编码是\u6211，去掉开头两个字节后每两个字节Unicode转码得到：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>我也是密码</div></div><div>实际上，FF FE是UTF-16编码（小端序）的BOM头，而这段编码很明显是大端序的，BOM头应为FE FF（<a href="https://blog.csdn.net/ysh1042436059/article/details/80905062">参考资料</a>）。因此只需要把开头两字节改为FE FF就能直接打开文本看到明文。最后拼接得到密码为：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>我是密码我也是密码</div></div><div>解压得到flag.txt：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>c3Nzc3Nzc3Nzc3Nzc3Nzc3Nzc3Nzc3Nzc3NzZmxhZ3twcHR4cG93ZXJwb2ludH0=</div></div><div>base64解码：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>sssssssssssssssssssssssssssflag{pptxpowerpoint}</div></div><div><br/></div><div>flag：flag{pptxpowerpoint}</div><div><br/></div><div><span style="font-weight: bold;">23 SDNISC2020_过去和现在</span></div><div><br/></div><div>下载得到png格式文件。用TweakPNG和010Editor的模板功能均会对文件末尾报错，十六进制编辑器查看文件尾：</div><div><img src="BMZCTF Misc 3（17-24）_files/Image [16].png" type="image/png" data-filename="Image.png"/></div><div>这个IDAT块很显然有问题。一方面，文件中共有两个IDAT块，前一个IDAT块长度为0x210A1，与这一块长度差距较大，很少有PNG生成器会这样处理数据块；另一方面，这个IDAT块的长度位是00 00 00 5C即十进制的92，但很显然其长度并没有这么长。特别是注意到这个块的数据部分开头字节为78 9C，是zlib压缩数据的文件头。因此，这个IDAT块很可能是从额外的zlib压缩数据生成的。</div><div><br/></div><div>提取这段压缩数据有不止一种方法：</div><div>1、用Python的zlib库：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>import zlib</div><div><br/></div><div>s = open('C:/Users/Administrator/Desktop/flag.png', 'rb').read()[0x21154: 0x21186]</div><div>print(zlib.decompress(s))</div></div><div>2、利用binwalk -e命令。首先，binwalk工具会将文件中的zlib压缩包提取出来；其次，binwalk对提取得到的压缩包会自动尝试解压，因此解压后会得到一个无扩展名的文本，其内容即为flag：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# binwalk -e flag.png</div><div><br/></div><div>DECIMAL       HEXADECIMAL     DESCRIPTION</div><div>--------------------------------------------------------------------------------</div><div>0             0x0             PNG image, 600 x 379, 8-bit/color RGB, non-interlaced</div><div>179           0xB3            Zlib compressed data, best compression</div><div>135508        0x21154         Zlib compressed data, default compression</div><div><br/></div><div>root@kali:~/Desktop# cd _flag.png.extracted/</div><div>root@kali:~/Desktop/_flag.png.extracted# ls</div><div>21154  21154.zlib  B3  B3.zlib</div><div>root@kali:~/Desktop/_flag.png.extracted# cat 21154</div><div>flag{fc25cbb7b85959fe03738241a96bf23d}</div></div><div><br/></div><div>flag：flag{fc25cbb7b85959fe03738241a96bf23d}</div><div><br/></div><div><span style="font-weight: bold;">24 2018 QCTF X-man-A face</span></div><div><br/></div><div>下载得到png格式文件：</div><div><img src="BMZCTF Misc 3（17-24）_files/Image [17].png" type="image/png" data-filename="Image.png"/></div><div>是个缺少定位符的二维码，拿Windows画图随便补一下即可：</div><div><img src="BMZCTF Misc 3（17-24）_files/Image [18].png" type="image/png" data-filename="Image.png"/></div><div>扫码得到：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>KFBVIRT3KBZGK5DUPFPVG2LTORSXEX2XNBXV6QTVPFZV6TLFL5GG6YTTORSXE7I=</div></div><div>base32解码：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>QCTF{Pretty_Sister_Who_Buys_Me_Lobster}</div></div><div><br/></div><div>flag：QCTF{Pretty_Sister_Who_Buys_Me_Lobster}</div></span>
</div></body></html> 