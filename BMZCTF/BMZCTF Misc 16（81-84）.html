<html>
<head>
  <title>BMZCTF Misc 16（81-84）</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/605894 (zh-CN, DDL); Windows/6.1.1 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="5903"/>
<h1>BMZCTF Misc 16（81-84）</h1>
<h2><a href="https://DemonStarAlgol.github.io/Misc/">[无关链接]</a></h2>

<div>
<span><div><span style="font-weight: bold;">81 TallShanBen</span></div><div><br/></div><div>下载得到jpg格式文件。看一下：</div><div><img src="BMZCTF Misc 16（81-84）_files/TallShanBen.jpg" type="image/jpeg" data-filename="TallShanBen.jpg"/></div><div>很明显图像下方的字幕没有显示完整，结合题目名，猜测图片高度被修改过。借助010Editor的模板功能，凭感觉把SOFx块中的图片高度字节改到01 C2（即十进制450）：</div><div><img src="BMZCTF Misc 16（81-84）_files/TallShanBen [1].jpg" type="image/jpeg" data-filename="TallShanBen.jpg"/></div><div><br/></div><div>flag：flag{Sh4n_B3n}</div><div><br/></div><div><span style="font-weight: bold;">82 十二宫的挑衅</span></div><div><br/></div><div>下载得到png格式文件：</div><div><img src="BMZCTF Misc 16（81-84）_files/Twelve_palaces_of_serial_killers.png" type="image/png" data-filename="Twelve_palaces_of_serial_killers.png"/></div><div>结合题目名称，猜测为黄道十二宫杀手密码的模仿。原版的黄道十二宫杀手密码一般指的是Z-340，即1969年11月8日，黄道十二宫杀手寄给《旧金山纪事报》的信中的340字符长的密文。2020年该密码被破解，大致步骤如下：</div><div>1、340个字符排成17x20的矩阵，将其切分为17x9、17x9和17x2的三段；</div><div>2、以第一段为例，取第1行第1列、第2行第3列直到第9行第17列的9个字符（即左上-右下对角线的字符），然后从第1行第2列开始重复上述步骤，直到将全部字符按这样的顺序重新排列；</div><div>3、最后一步是单纯的替换密码，可以用专用工具AZdecrypt穷举破解。</div><div><br/></div><div>本题是i春秋新年欢乐赛的原题，解法与原版密码解法类似。<span style="font-size: unset; color: unset; font-family: unset;">先把图片上的字符提取出来：</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>^#@$@#()/&gt;@?==%1(</div><div>!)&gt;(*+3&lt;#86@-7$^.</div><div>4&amp;)8%#5&amp;6!=%1#$-$</div><div>+5&amp;?#!.03!%=@=101</div><div>0?(*~#??.+)%&amp;.7^8</div><div>=1%*^=$5$7@@8&gt;&amp;*9</div><div>9@0185(+7)&lt;%3#@^4</div><div>&amp;@@&lt;.)#3*#%%&lt;&lt;*++</div><div>.@.?=~**+!==65^@&amp;</div></div><div>然后重新排序：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>code = '''^#@$@#()/&gt;@?==%1(</div><div>!)&gt;(*+3&lt;#86@-7$^.</div><div>4&amp;)8%#5&amp;6!=%1#$-$</div><div>+5&amp;?#!.03!%=@=101</div><div>0?(*~#??.+)%&amp;.7^8</div><div>=1%*^=$5$7@@8&gt;&amp;*9</div><div>9@0185(+7)&lt;%3#@^4</div><div>&amp;@@&lt;.)#3*#%%&lt;&lt;*++</div><div>.@.?=~**+!==65^@&amp;'''.split()</div><div><br/></div><div>res = ''</div><div>for i in range(17):</div><div>    for j in range(9):</div><div>        res += code[j][(i+j*2) % 17]</div><div>        if len(res.replace('\n', '')) % 17 == 0:</div><div>            res += '\n'</div><div>print(res)</div></div><div>输出结果：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>^&gt;%..@3*&amp;#(#0+@#+</div><div>.@*53)8@+@$+&amp;!%&gt;^</div><div>&amp;.@36%&amp;&amp;4@?#&lt;!=.*</div><div>9@=(#=@79@&lt;~)8%=^</div><div>=0.*/611811)*&gt;@#0</div><div>0%8#+@-$1?*53!?7-</div><div>+(^(*==$$5*=+#==^</div><div>4&amp;~$7%6%.&amp;?#5)%51</div><div>!)#?$&lt;&lt;^()8!?7%&lt;@</div></div><div><br/></div><div>然后将结果放到AZdecrypt中运行，马上可以得到结果：</div><div><img src="BMZCTF Misc 16（81-84）_files/Image.png" type="image/png" data-filename="Image.png"/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>IKILLED A LOT OF PEOPLE AND THE PEOPLE I</div><div>KILLED WILL BECOME SLAVES TO SERVE ME THIS</div><div>IS FLAG WUUHUU TAKE OFF I HOPE YOU CAN DECRYPT</div><div>IT AS SOON AS POSSIBLE OR I WILL CONTINUE</div><div>TO COMMIT THE CRIME</div></div><div>可以看到“THIS IS FLAG”字样，把与前后文无关的部分提取出来得到flag。</div><div><br/></div><div>flag：flag{WUUHUUTAKEOFF}</div><div><br/></div><div><span style="font-weight: bold;">83 [2021-MAR-DASCTF]简单的png隐写</span></div><div><br/></div><div>下载得到加密的zip格式压缩包。先尝试伪加密，ZipCenOp处理一下：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>D:\CTFToolkit-v1.1.0\暴力破解\ZipCenOp&gt;java -jar ZipCenOp.jar r png.zip</div><div>success 2 flag(s) found</div></div><div>解压得到flag.jpg和hint.png。</div><div><br/></div><div>先看hint.png，十六进制编辑器打开：</div><div><img src="BMZCTF Misc 16（81-84）_files/Image [1].png" type="image/png" data-filename="Image.png"/></div><div>注意到这个IDAT块，上一个块大小为0x910，相比更前面的块大小未满，而这个块本身的数据区开头为78 9C，是zlib压缩数据的文件头。猜测从该IDAT块开始，后续的块实际上是另一张PNG图片的内容。用TweakPNG删除前四个IDAT块，得到图片：</div><div><img src="BMZCTF Misc 16（81-84）_files/hint2.png" type="image/png" data-filename="hint2.png"/></div><div>虽然89 50 4E是PNG格式的文件头，但直接在flag.jpg中搜索这些字节是没有结果的。注意到guess out的用词，猜测可能使用了outguess隐写工具，且密码为89504E。尝试一下：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# outguess -k 89504E -r flag.jpg out.txt</div><div>Reading flag.jpg....</div><div>Extracting usable bits:   147535 bits</div><div>Steg retrieve: seed: 232, len: 185</div></div><div>解密结果：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>MUY4QjA4MDg5MTgwNzg1RTAwMDM2NjZDNjE2NzJFNzQ3ODc0MDA0QkNCNDk0Q0FGMzZCMDMwMzQ0RDM1NDlCNjRDMzMzNTMzMzRCMTQ4MzVCNzQ4NEEzNTMzNDg0OTMyMzU0QjRFMzUzMTQ5MzFCNUFDRTVFMjAyMDA0NjhCMjIzRjI4MDAwMDAw</div></div><div>显然是base64编码，解码：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>1F8B08089180785E0003666C61672E747874004BCB494CAF36B030344D3549B64C33353334B14835B7484A3533484932354B4E35314931B5ACE5E20200468B223F28000000</div></div><div>是十六进制数字，注意到1F 8B是gzip的文件头，将其在十六进制编辑器里保存为gz格式文件：</div><div><img src="BMZCTF Misc 16（81-84）_files/Image [2].png" type="image/png" data-filename="Image.png"/></div><div>解压得到flag。</div><div><br/></div><div>flag：flag{0815e4c9f56148e78be60db56ce44d59}</div><div><br/></div><div><span style="font-weight: bold;">84 [2021-红明谷]InputMonitor</span></div><div>题目：Akira在某次取证的过程中，在桌面找到了一个奇怪的文件，但是除此之外好像没有找到什么有价值的情报，很多的数据都被抹干净了，而且这个用户似乎根本就没装什么第三方的软件。Akira还粗心的只拷贝了C盘下的User目录，这下还有机会解开可疑文件吗？</div><div><br/></div><div>下载得到User文件夹，根据题目说明，这是目标用户的用户文件夹，且桌面上有奇怪的文件。那么先看桌面：</div><div><img src="BMZCTF Misc 16（81-84）_files/Image [3].png" type="image/png" data-filename="Image.png"/></div><div>三个文件中，64位7-Zip安装包不用管，flag.7z是个加密压缩包，暂时没有密码，txt文本内容如下：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>没事，我都删掉了，之前的聊天记录都被我清干净了。除非他们在监控我输入</div></div><div>猜测接下来需要寻找压缩包密码。</div><div><br/></div><div>还是老办法，列出目录下所有文件，按修改时间倒序排列：</div><div><img src="BMZCTF Misc 16（81-84）_files/Image [4].png" type="image/png" data-filename="Image.png"/></div><div>除了7-Zip安装包外，最显眼的几个文件都是ChsPinyin开头。搜索一下文件名ChsPinyinUDL.dat，会发现这与微软拼音输入法的词库有关。结合之前txt中提到的“监控输入”，猜测本题与输入法取证有关，很可能目标用户的输入历史中存在与压缩包密码有关的线索。</div><div><br/></div><div>搜索“微软拼音 词库 导出”找到<a href="https://github.com/studyzy/imewlconverter/commit/8b96908980da466be9a20b2a954e4aefe8c3c3a4">这个页面</a>，从而找到<a href="https://github.com/studyzy/imewlconverter">深蓝词库转换</a>这一工具的github库，然后在Issues里找到<a href="https://github.com/studyzy/imewlconverter/issues/58">这一条</a>，关于微软拼音自学习词库的导入导出算法。重点是这一条：</div><div><img src="BMZCTF Misc 16（81-84）_files/Image [5].png" type="image/png" data-filename="Image.png"/></div><div>换言之，使用UTF-16 LE编码就可以读取词库文件中的自学习词库。010Editor打开ChsPinyinUDL.dat，切换到Unicode编码：</div><div><img src="BMZCTF Misc 16（81-84）_files/Image [6].png" type="image/png" data-filename="Image.png"/></div><div>可以看到在0x2400左右开始的地方出现了大量可识别短语。大致上有这些：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>不成功便成仁</div><div>不过这样的话如果</div><div>成功便成</div><div>对的对的成功了</div><div>话如果</div><div>我们直接卸载软件就好了</div><div>奇怪</div><div>软件就好了</div><div>如果输入</div><div>就好了</div><div>如果输入的内容太多了咋办</div><div>如果别人</div><div>如果被监视了怎么办</div><div>视了怎么办</div><div>密码长度应</div><div>没事的实际上大家看不到的</div><div>虚假的故事比较奇怪</div><div>卸载软件</div><div>应该是六个字的密码</div><div>这个密码长度应该蛮长的</div></div><div><span style="color: rgb(51, 51, 51);">总结起来就是密码长度为六个字，这里面的备选项就是“不成功便成仁”，然而试了下发现不对。那就再看ChsPinyinIH.dat：</span></div><div><span style="color: rgb(51, 51, 51);"><img src="BMZCTF Misc 16（81-84）_files/Image [7].png" type="image/png" data-filename="Image.png"/></span></div><div><span style="color: rgb(51, 51, 51);">符合六个字条件的是“有志者事竟成”。再次尝试，这次密码是正确的。</span></div><div><br/></div><div><span style="color: rgb(51, 51, 51);">解压得到hidden.pdf：</span></div><div><span style="color: rgb(51, 51, 51);"><img src="BMZCTF Misc 16（81-84）_files/Image [8].png" type="image/png" data-filename="Image.png"/></span></div><div><span style="color: rgb(51, 51, 51);">只有一张图片，不过我们知道，PDF文档的白色文字、图片下面、背景水印等地方都能藏东西。逐个尝试，发现把图片移走后可以看到flag：</span></div><div><span style="color: rgb(51, 51, 51);"><img src="BMZCTF Misc 16（81-84）_files/Image [9].png" type="image/png" data-filename="Image.png"/></span></div><div><span style="color: rgb(51, 51, 51);">移走图片的方法很多，比如PDF编辑器。没有编辑器从字节数据下手亦可，参见</span><a href="evernote:///view/30668439/s39/a089fc3d-7a8d-4e8a-996a-1133054062db/a089fc3d-7a8d-4e8a-996a-1133054062db/" style="color: rgb(105, 170, 53);">BUUCTF Misc 14（101-104）</a>的103题。</div><div><br/></div><div><span style="color: rgb(51, 51, 51);">flag：</span><span style="color: rgb(51, 51, 51);">flag{Y0u_F1nd_h1dd3n_m3g}</span></div></span>
</div></body></html> 