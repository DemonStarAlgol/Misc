<html>
<head>
  <title>BMZCTF Misc 19（93-96）</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/605894 (zh-CN, DDL); Windows/6.1.1 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="6981"/>
<h1>BMZCTF Misc 19（93-96）</h1>
<h2><a href="https://DemonStarAlgol.github.io/Misc/">[无关链接]</a></h2>

<div>
<span><div><span style="font-weight: bold;">93 [2021年祥云杯]shuffle_code</span></div><div><br/></div><div>下载得到无扩展名的文件shuffle_code。十六进制编辑器打开：</div><div><img src="BMZCTF Misc 19（93-96）_files/Image.png" type="image/png" data-filename="Image.png"/></div><div>很明显是倒过来的PNG格式图像文件，用脚本倒个序：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>f = open('C:/Users/Administrator/Desktop/1.png', 'wb')</div><div>f.write(open('C:/Users/Administrator/Desktop/shuffle_code', 'rb').read()[::-1])</div></div><div>运行得到图片：</div><div><img src="BMZCTF Misc 19（93-96）_files/1.png" type="image/png" data-filename="1.png"/></div><div>扫码得到：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>col426327/1132122/1211132223/3113253/61531113/111312/5323125/2222/11122153/311111/14312121/11231211/2423211/262121/422221/622132/31121/221122111/5122311/2111221221/121692/12122111/232326/11142121/31253151/22111111123/111313121/1111111/2151371row31121113/12321133/13111112/13112221121/12112232/16113232/11311311/21111231/11111211/711111117/2124112211/611111241/1311371/131152131/13/2121111311/521(11)11/1311321131/1211211/11111111/14221262/3411131/161713/422141/7122117/1111112111/7111412/71111121/131112131</div></div><div>观察一下，col和row分别有29组以/分隔的数字串，说明这段内容描述的可能是某个29x29的方阵。某个数字串中出现了括号包裹的11，说明两位数11和两个一位数1需要明确区分，换言之每一串数字中的每一位都代表某种东西的数量。此外，将每一串数字的各位相加，总和均没有超过29。从这些特征来看，这很可能是一个picross游戏。</div><div><br/></div><div>Picross（ピクロス），最初原名お絵かきロジック，又名Nonograms、Hanjie、Paint by Numbers、Griddlers、Pic-a-Pix、数织、逻辑拼图，玩法参见<a href="https://zh.wikipedia.org/wiki/%E6%95%B8%E7%B9%94">维基百科</a>。最早的Picross电子游戏是任天堂在Gameboy和Super Famicom上推出的。目前Nintendo 3DS上有Picross e系列，Nintendo Switch上有Picross S系列。Nintendo DS和Nintendo 3DS上甚至各有一作超级好玩的3D Picross，把游戏从2D平面空间推向了3D立体空间，总之非常好玩，请大家都来玩玩看。</div><div><br/></div><div>回到题目，首先通过搜索找到一个<a href="https://scc-forge.lancaster.ac.uk/open/nonogram/auto">自动求解器</a>，然后按照其格式生成输入序列：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>s = 'col426327/1132122/1211132223/3113253/61531113/111312/5323125/2222/11122153/311111/14312121/11231211/2423211/262121/422221/622132/31121/221122111/5122311/2111221221/121692/12122111/232326/11142121/31253151/22111111123/111313121/1111111/2151371row31121113/12321133/13111112/13112221121/12112232/16113232/11311311/21111231/11111211/711111117/2124112211/611111241/1311371/131152131/13/2121111311/521(11)11/1311321131/1211211/11111111/14221262/3411131/161713/422141/7122117/1111112111/7111412/71111121/131112131'</div><div>s = s[3:].split('row')</div><div>s = [i.split('/') for i in s]</div><div>s = [[list(i) for i in j] for j in s]</div><div>s[1][16] = ['5', '2', '1', '11', '1', '1']</div><div><br/></div><div># 针对另一个求解器的代码 <a href="http://a.teall.info/nonogram/">http://a.teall.info/nonogram/</a></div><div># res = '{&quot;ver&quot;:['</div><div># for i in s[0]:</div><div>#     res += '[' + ','.join(i) + '],'</div><div># res = res[:-1] + '],&quot;hor&quot;:['</div><div># for i in s[1]:</div><div>#     res += '[' + ','.join(i) + '],'</div><div># res = res[:-1] + ']}'</div><div># print(res)</div><div><br/></div><div>res = 'width 29\nheight 29\n\nrows\n'</div><div>for i in s[1]:</div><div>    res += ','.join(i) + '\n'</div><div>res += '\ncolumns\n'</div><div>for i in s[0]:</div><div>    res += ','.join(i) + '\n'</div><div>print(res)</div></div><div>运行结果：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>width 29</div><div>height 29</div><div><br/></div><div>rows</div><div>3,1,1,2,1,1,1,3</div><div>1,2,3,2,1,1,3,3</div><div>1,3,1,1,1,1,1,2</div><div>1,3,1,1,2,2,2,1,1,2,1</div><div>1,2,1,1,2,2,3,2</div><div>1,6,1,1,3,2,3,2</div><div>1,1,3,1,1,3,1,1</div><div>2,1,1,1,1,2,3,1</div><div>1,1,1,1,1,2,1,1</div><div>7,1,1,1,1,1,1,1,7</div><div>2,1,2,4,1,1,2,2,1,1</div><div>6,1,1,1,1,1,2,4,1</div><div>1,3,1,1,3,7,1</div><div>1,3,1,1,5,2,1,3,1</div><div>1,3</div><div>2,1,2,1,1,1,1,3,1,1</div><div>5,2,1,11,1,1</div><div>1,3,1,1,3,2,1,1,3,1</div><div>1,2,1,1,2,1,1</div><div>1,1,1,1,1,1,1,1</div><div>1,4,2,2,1,2,6,2</div><div>3,4,1,1,1,3,1</div><div>1,6,1,7,1,3</div><div>4,2,2,1,4,1</div><div>7,1,2,2,1,1,7</div><div>1,1,1,1,1,1,2,1,1,1</div><div>7,1,1,1,4,1,2</div><div>7,1,1,1,1,1,2,1</div><div>1,3,1,1,1,2,1,3,1</div><div><br/></div><div>columns</div><div>4,2,6,3,2,7</div><div>1,1,3,2,1,2,2</div><div>1,2,1,1,1,3,2,2,2,3</div><div>3,1,1,3,2,5,3</div><div>6,1,5,3,1,1,1,3</div><div>1,1,1,3,1,2</div><div>5,3,2,3,1,2,5</div><div>2,2,2,2</div><div>1,1,1,2,2,1,5,3</div><div>3,1,1,1,1,1</div><div>1,4,3,1,2,1,2,1</div><div>1,1,2,3,1,2,1,1</div><div>2,4,2,3,2,1,1</div><div>2,6,2,1,2,1</div><div>4,2,2,2,2,1</div><div>6,2,2,1,3,2</div><div>3,1,1,2,1</div><div>2,2,1,1,2,2,1,1,1</div><div>5,1,2,2,3,1,1</div><div>2,1,1,1,2,2,1,2,2,1</div><div>1,2,1,6,9,2</div><div>1,2,1,2,2,1,1,1</div><div>2,3,2,3,2,6</div><div>1,1,1,4,2,1,2,1</div><div>3,1,2,5,3,1,5,1</div><div>2,2,1,1,1,1,1,1,1,2,3</div><div>1,1,1,3,1,3,1,2,1</div><div>1,1,1,1,1,1,1</div><div>2,1,5,1,3,7,1</div></div><div>在求解器里导入题目，然后点击Start求解：</div><div><img src="BMZCTF Misc 19（93-96）_files/solver.png" type="image/png" data-filename="solver.png"/></div><div>显而易见，什么都看不出来。不过可以注意到左下角出现了一个有点方的图案，其中7格，1-5-1格、1-1-3-1-1格等形状可以联想到QR码的定位符。同时29x29正好是version3的QR码边长，猜测这个图形是个打乱过的二维码。<span style="font-size: unset; color: unset; font-family: unset;">或者更确切地说，注意到仅有行部分出现了定位符特征，列却没有，因此题目给出的Picross行列值可能来自一张各行被打乱的QR码。</span></div><div><br/></div><div>那么首先要还原行列值，这是version3二维码的定位符部分：</div><div><img src="BMZCTF Misc 19（93-96）_files/Image [1].png" type="image/png" data-filename="Image.png"/></div><div>从而可以确定部分行的正确位置。把求解器切换到Text输出模式，将结果导入Excel：</div><div><img src="BMZCTF Misc 19（93-96）_files/Image [2].png" type="image/png" data-filename="Image.png"/></div><div>手动移动部分可以确定的行：（图片丢失，这是后来补的，所以界面和前后图片略有区别）</div><div><img src="BMZCTF Misc 19（93-96）_files/Image [3].png" type="image/png" data-filename="Image.png"/></div><div>注意，此时仅有第1、7-8和22-25、28-29行是确定正确的，2、6行可能放反，3-5行可能相互放错，26、27可能放反。然后手动筛选原图的第9行，其前9块和后8块应符合同一种Format Info Pattern格式。根据符合条件的行，判断纠错等级为M，掩码类型为6。从而进一步确定1-9、21-29行的正确位置：</div><div><img src="BMZCTF Misc 19（93-96）_files/Image [4].png" type="image/png" data-filename="Image.png"/></div><div>图中部分Format Info Pattern格式并不合理，这肯是因为初始Picross谜题的多解导致的，手动改一下。然后根据第7列10-20行的定位线，随便调整一下这些行，使定位线合理，从而在后续穷举时可以直接进行奇偶行内部交换，不需要另外判断定位线是否合理，同时也减少穷举次数：</div><div><img src="BMZCTF Misc 19（93-96）_files/Image [5].png" type="image/png" data-filename="Image.png"/></div><div>最后导出手工重排列结果，准备对10-20行开始穷举。</div><div><br/></div><div>穷举思路是，对10-20行中，对奇数行和偶数行分别全排列，生成QR码图像后尝试识别，若能够识别说明重排正确。脚本：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>import pyzbar.pyzbar as pyzbar</div><div>from itertools import permutations</div><div>from PIL import Image</div><div>from tqdm import tqdm</div><div><br/></div><div>d = '''#######-#-##-##--#--#-#######</div><div>#-----#-#-#---#----##-#-----#</div><div>#-###-#-#-#####----##-#-###-#</div><div>#-###-#--#--###--##-#-#-###-#</div><div>#-###-#-#----#----##--#-###-#</div><div>#-----#---#---#--#--#-#-----#</div><div>#######-#-#-#-#-#-#-#-#######</div><div>-----------###---------------</div><div>#--######-#----#######--#-###</div><div>###-#----#-##--#-#-#----###--</div><div>----#-##--#-#-##-##-###-##---</div><div>#--##---###-##-#-#-###-###---</div><div>#-######--#-#-###-##-###---##</div><div>-##-#-------#---#-#--##-###-#</div><div>##--#-##--####-#-#-##--##-#-#</div><div>######-#---#-#-#--#-##-####-#</div><div>##--#-##---#-#-#---#-###-#--#</div><div>#-####--##-##-#--##-######-##</div><div>-###-####--#-#-#--###-------#</div><div>####----##-----##---#-####--#</div><div>#####-##----#-###########-#-#</div><div>--------#-##-#-#---##---#-#--</div><div>#######-#--#---#-####-#-##---</div><div>#-----#-###-#-#-###-#---#----</div><div>#-###-#-##--###---#######--#-</div><div>#-###-#-#-##--##-##-#--#-##-#</div><div>#-###-#--#---#-#--------#--##</div><div>#-----#---#--#--#--#-##-#-#-#</div><div>#######-#-#-#--#----#-##-#---'''.splitlines()</div><div><br/></div><div>def drawQR(d):</div><div>    img = Image.new('1', (31, 31), 255)</div><div>    for y in range(29):</div><div>        for x in range(29):</div><div>            if d[y][x] == '#':</div><div>                img.putpixel((x + 1, y + 1), 0)</div><div>    return img</div><div><br/></div><div>with tqdm(total = 720 * 120) as pbar:</div><div>    for s1 in permutations([9, 11, 13, 15, 17, 19]):</div><div>        for s2 in permutations([10, 12, 14, 16, 18]):</div><div>            # 生成QR码数据</div><div>            data = d[:9]</div><div>            for i in range(5):</div><div>                data += [d[s1[i]]]</div><div>                data += [d[s2[i]]]</div><div>            data += [d[s1[5]]]</div><div>            data += d[20:]</div><div>            # 生成QR码图像</div><div>            QR = drawQR(data)</div><div>            # 尝试识别</div><div>            barcodes = pyzbar.decode(QR)</div><div>            pbar.update(1)</div><div>            if (len(barcodes) == 0):</div><div>                continue</div><div>            for barcode in barcodes:</div><div>                barcodeData = barcode.data.decode()</div><div>                print(barcodeData)</div><div>                QR.show()</div><div>                QR.save('C:/Users/Administrator/Desktop/QR.png')</div></div><div>运行得到QR码和flag：</div><div><img src="BMZCTF Misc 19（93-96）_files/Image [6].png" type="image/png" data-filename="Image.png"/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>29%|██▉       | 25376/86400 [00:30&lt;01:11, 849.26it/s]flag{f31861a9-a753-47d5-8660-a8cada6c599e}</div><div>100%|██████████| 86400/86400 [01:48&lt;00:00, 795.62it/s]</div></div><div><br/></div><div>flag：flag{f31861a9-a753-47d5-8660-a8cada6c599e}</div><div><br/></div><div><span style="font-weight: bold;">94 网鼎杯 2020 boom</span></div><div><br/></div><div>下载得到boom.exe，鼓起勇气尝试运行一下：</div><div><img src="BMZCTF Misc 19（93-96）_files/Image [7].png" type="image/png" data-filename="Image.png"/></div><div>然后就开始玩游戏。</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>first:this string md5:46e5efe6165a5afb361217446a2dbd01</div></div><div><a href="https://www.somd5.com/">在线工具</a>反查即可，答案：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>en5oy</div></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>This time:Here are have some formulas</div><div>3x-y+z=185</div><div>2x+3y-z=321</div><div>x+y+z=173</div><div>input: x =</div></div><div>用sympy库解方程组：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>from sympy import *</div><div>from sympy.abc import a, b, c</div><div><br/></div><div>res = solve([3 * a - b + c - 185, 2 * a + 3 * b - c - 321, a + b + c - 173], [a, b, c])</div><div>print(res)</div></div><div>运行结果：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>{a: 74, b: 68, c: 31}</div></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>Last time: Kill it</div><div>x*x+x-7943722218936282=0</div><div>input x:</div></div><div>同上：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>from sympy import *</div><div>from sympy.abc import a</div><div><br/></div><div>res = solve([a * a + a - 7943722218936282], [a])</div><div>print(res)</div></div><div>运行结果：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>[(-89127562,), (89127561,)]</div></div><div><br/></div><div>得到flag：</div><div><img src="BMZCTF Misc 19（93-96）_files/Image [8].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div>flag：flag{en5oy_746831_89127561}</div><div><br/></div><div><span style="font-weight: bold;">95 网鼎杯 2018 clip</span></div><div>题目：A strange filesystem is recovered from a damaged old hard disk.</div><div><br/></div><div>下载得到damaged.disk。根据题目内容，这是一个损坏硬盘中的奇特文件系统，因此很可能无法通过正常方式挂载。<span style="font-size: unset; color: unset; font-family: unset;">那么老规矩，试一下几个Linux命令行工具，发现binwalk会返回结果，但出现了大量被识别为zlib文件头的数据。用grep去掉包含zlib的行：</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# binwalk damaged.disk | grep -v &quot;Zlib&quot;</div><div><br/></div><div>DECIMAL       HEXADECIMAL     DESCRIPTION</div><div>--------------------------------------------------------------------------------</div><div>1663628       0x19628C        PNG image, 847 x 47, 8-bit grayscale, non-interlaced</div></div><div>剩下的唯一结果是识别到了PNG格式图像的文件头。</div><div><br/></div><div>十六进制编辑器打开damaged.disk，找到该文件头：</div><div><img src="BMZCTF Misc 19（93-96）_files/Image [9].png" type="image/png" data-filename="Image.png"/></div><div>可以看到完整的文件头、IHDR和IDAT的块头，但在镜像中查找IEND没有结果，说明IEND块可能缺失。尝试搜索IDAT找到下一个IDAT块：</div><div><img src="BMZCTF Misc 19（93-96）_files/Image [10].png" type="image/png" data-filename="Image.png"/></div><div>可以看到在该IDAT块附近也存在IHDR块和残缺的PNG格式文件头，说明这个IDAT块很可能不属于前一张PNG图像，而是来自另一张图像。换言之，镜像中还存在另一张PNG图像的数据，且文件头和文件尾均有缺失。因此两张PNG图像的文件尾都需要依靠IDAT块的长度位自行计算。</div><div><br/></div><div>首先是第一张，长度位为00 00 11 12即0x1112(=4386)，数据位从0x1962B5开始，数据位尾应为0x1973C6，再加4位CRC校验位为0x1973CA。然后是第二张，长度位相同，数据位从0x1988CB开始，数据位尾应为0x1999DC，再加4位CRC校验位为0x1999E0。方便起见，写脚本把数据提取出来：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>d = open('C:/Users/Administrator/Desktop/damaged.disk', 'rb').read()</div><div>with open('C:/Users/Administrator/Desktop/1.png', 'wb') as f1:</div><div>    f1.write(d[0x19628C:0x1973CB])</div><div>with open('C:/Users/Administrator/Desktop/2.png', 'wb') as f2:</div><div>    f2.write(b'\x89\x50\x4e' + d[0x1988A5:0x1999E1])</div></div><div>得到两张PNG格式图片，当然CRC校验位是错的，也缺少IEND块，不过Windows下仍然可以显示：</div><div><img src="BMZCTF Misc 19（93-96）_files/Image [11].png" type="image/png" data-filename="Image.png"/></div><div><img src="BMZCTF Misc 19（93-96）_files/Image [12].png" type="image/png" data-filename="Image.png"/></div><div>依稀可以看出类似flag的内容，如果用图像编辑工具也许可以手动修复到能够辨识的程度，但大概不是预期解法。</div><div><br/></div><div>回到镜像本身，十六进制编辑器看一下文件头：</div><div><img src="BMZCTF Misc 19（93-96）_files/Image [13].png" type="image/png" data-filename="Image.png"/></div><div>有ev、clo0P、$1.exit等字样。尝试加上关键字“disk image”搜索，找到<a href="https://en.wikipedia.org/wiki/Cloop">cloop</a>，这是一种与压缩设备有关的Linux模块。安装好cloop后，<span style="font-size: unset; color: unset; font-family: unset;">参考</span><a href="https://unix.stackexchange.com/questions/642616/fastest-way-to-create-a-filesystem-image-with-cloop-create-compressed-fs" style="font-size: unset; font-family: unset;">这个回答</a><span style="font-size: unset; color: unset; font-family: unset;">自行创建cloop镜像：</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# mkisofs -r test | create_compressed_fs - 65536 &gt; test</div><div>I: -input-charset not specified, using utf-8 (detected in locale settings)</div><div>4 processor core(s) detected</div><div>Warning, number as file string found. Assuming old command syntax and</div><div>choosing compatible parameters (-m -B 65536). See the usage info (-h)</div><div>for better/correct parameters.</div><div>Block size 65536, expected number of blocks: 2147483647</div><div>Total translation table size: 0</div><div>Total rockridge attributes bytes: 245</div><div>Total directory bytes: 0</div><div>Path table size(bytes): 10</div><div>[ 9] Blk#     0, [ratio/avg.   0%/  0%], avg.speed: 65536 b/s, ETA: 2147483646s</div><div>Max brk space used 0</div><div>175 extents written (0 MB)</div><div><br/></div><div>Statistics:</div><div>gzip(0):     0 (    0%)</div><div>gzip(1):     0 (    0%)</div><div>gzip(2):     0 (    0%)</div><div>gzip(3):     0 (    0%)</div><div>gzip(4):     0 (    0%)</div><div>gzip(5):     0 (    0%)</div><div>gzip(6):     0 (    0%)</div><div>gzip(7):     0 (    0%)</div><div>gzip(8):     0 (    0%)</div><div>gzip(9):     6 (1e+02%)</div><div>7zip:     0 (    0%)</div><div>Writing index for 6 block(s)...</div><div>Writing compressed data...</div></div><div>得到test文件，十六进制编辑器打开，查看头部：</div><div><img src="BMZCTF Misc 19（93-96）_files/Image [14].png" type="image/png" data-filename="Image.png"/></div><div>可以看出和damaged.disk的头部有相似之处，照此将damaged.disk文件头补完：</div><div><img src="BMZCTF Misc 19（93-96）_files/Image [15].png" type="image/png" data-filename="Image.png"/></div><div>然后尝试解压：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# extract_compressed_fs damaged.disk tmp</div><div>extract_compressed_fs: compressed input has 65536 blocks of size 1024.</div><div>[Current block:      0, In: 0kB, Out: 1kB, ratio 6023%, complete   0%]</div><div>[Current block:   6553, In: 112kB, Out: 6554kB, ratio 5821%, complete   9%]</div><div>[Current block:  13106, In: 1182kB, Out: 13107kB, ratio 1108%, complete  19%]</div><div>[Current block:  19659, In: 1294kB, Out: 19660kB, ratio 1518%, complete  29%]</div><div>[Current block:  26212, In: 1403kB, Out: 26213kB, ratio 1867%, complete  39%]</div><div>[Current block:  32765, In: 1512kB, Out: 32766kB, ratio 2166%, complete  49%]</div><div>[Current block:  39318, In: 1621kB, Out: 39319kB, ratio 2425%, complete  59%]</div><div>[Current block:  45871, In: 1730kB, Out: 45872kB, ratio 2650%, complete  69%]</div><div>[Current block:  52424, In: 1839kB, Out: 52425kB, ratio 2850%, complete  79%]</div><div>[Current block:  58977, In: 1948kB, Out: 58978kB, ratio 3027%, complete  89%]</div><div>[Current block:  65530, In: 2057kB, Out: 65531kB, ratio 3185%, complete  99%]</div><div>[Current block:  65535, In: 2057kB, Out: 65536kB, ratio 3185%, complete 100%]</div><div>root@kali:~/Desktop# file tmp</div><div>tmp: Linux rev 1.0 ext4 filesystem data, UUID=2984f160-de44-4eb6-9b98-c83bb3dcf46f (extents) (64bit) (large files) (huge files)</div></div><div>得到了一个ext4格式文件系统数据，挂载一下：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# mkdir ./mnt</div><div>root@kali:~/Desktop# mount tmp ./mnt</div><div>root@kali:~/Desktop# ls ./mnt</div><div>clip-clip.png  clip-clop.png  clop-clip.png  clop-clop.jpg  flag.png</div></div><div>但flag.png无法正确显示，十六进制编辑器打开：</div><div><img src="BMZCTF Misc 19（93-96）_files/Image [16].png" type="image/png" data-filename="Image.png"/></div><div>文件头被破坏，补上即可，从而<span style="font-size: unset; color: unset; font-family: unset;">得到flag：</span><img src="BMZCTF Misc 19（93-96）_files/flag.png" type="image/png" data-filename="flag.png" style="color: unset; font-family: unset; font-size: unset;"/></div><div><br/></div><div>flag：flag{0b008070-eb72-4b99-abed-092075d72a40}</div><div><br/></div><div><span style="font-weight: bold;">95 网鼎杯 2018 minified</span></div><div><br/></div><div>下载得到png格式文件：</div><div><img src="BMZCTF Misc 19（93-96）_files/flag_enc.png" type="image/png" data-filename="flag_enc.png"/></div><div>这是一张包含Alpha通道的PNG图像，Stegsolve看一下：</div><div><img src="BMZCTF Misc 19（93-96）_files/Image [17].png" type="image/png" data-filename="Image.png"/></div><div>发现大部分Plane均为无规律的黑白点，仅Red Plane 0是全黑的。可以判断图中像素的最低位是被处理过的，继续看一下另外三个通道的最低位：</div><div><img src="BMZCTF Misc 19（93-96）_files/Image [18].png" type="image/png" data-filename="Image.png"/></div><div><img src="BMZCTF Misc 19（93-96）_files/Image [19].png" type="image/png" data-filename="Image.png"/></div><div><img src="BMZCTF Misc 19（93-96）_files/Image [20].png" type="image/png" data-filename="Image.png"/></div><div>观察发现，Alpha Plane 0和Green Plane 0的左上角和左下角部分像素似乎是刚好相反的。如果两个通道是完全随机生成的，出现这种巧合的概率很低，因此有理由怀疑信息隐藏在这两个通道最低位中。考虑到相反像素XOR后会得到纯白色，尝试一下：</div><div><img src="BMZCTF Misc 19（93-96）_files/Image [21].png" type="image/png" data-filename="Image.png"/></div><div>得到flag。</div><div><br/></div><div>flag：flag{7bb6db9f-d2eb-4e69-8dee-0002ce1e07f9}</div></span>
</div></body></html> 