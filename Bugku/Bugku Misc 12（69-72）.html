<html>
<head>
  <title>Bugku Misc 12（69-72）</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/605894 (zh-CN, DDL); Windows/6.1.1 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="3456"/>
<h1>Bugku Misc 12（69-72）</h1>
<h2><a href="https://DemonStarAlgol.github.io/Misc/">[无关链接]</a></h2>

<div>
<span><div><span style="font-weight: bold;">69 baby_flag.txt</span></div><div><br/></div><div>下载得到txt格式文件，直接打开为乱码，但可以发现开头有JFIF字样。十六进制编辑器查看：</div><div><img src="Bugku Misc 12（69-72）_files/Image.png" type="image/png" data-filename="Image.png"/></div><div>很明显是jpg格式图片，修改文件扩展名，在文件尾后找到额外数据：</div><div><img src="Bugku Misc 12（69-72）_files/Image [1].png" type="image/png" data-filename="Image.png"/></div><div>很明显是文件头被修改过的RAR格式压缩包，提取后将文件头修复为52 61 72 21，得到加密的RAR压缩包：</div><div><img src="Bugku Misc 12（69-72）_files/Image [2].png" type="image/png" data-filename="Image.png"/></div><div>在十六进制编辑器中将jpg图片的高度为1000，得到解压密码：</div><div><img src="Bugku Misc 12（69-72）_files/Image [3].png" type="image/png" data-filename="Image.png"/></div><div>解压得到real flag haha.txt：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>真是一种丑陋的语言呢</div><div>oh!!!!!!!!!!!!!!ugly programming language!!!!!!!!!!!</div><div><br/></div><div>D'`r#?oJ[;|9Wx0/et?rqM(-9JI6(hEgeBc.x,&lt;;)yrZvo5mrkji/Plkjib(fedFE[!Y^]\[Tx;QuU7SRKo2NGLEDh+AFEDC&lt;;_?&gt;~}5Y987w5.R21qp('K+$j&quot;'~}${&quot;y?`_{tyrwp6tmUqj0nmleMib(fe^c\&quot;`_^@VUTxXWV8NSRKJn10LKJIHAe?'=&lt;;:9]76Z:981w543,P*)M-,%k)&quot;F&amp;}${zy?&gt;_{zyr8YXtmlk1onmlNMib(I_d]\&quot;`BA]\Uy&lt;;QPUTMLpJ2NMLKDhHA)E&gt;b%$@?8\}5Y981w543,P0/o-&amp;Jk)&quot;!~D1</div></div><div>前两行提示说明下方的疑似乱码是某种编程语言，这么丑的编程语言显然是某种<a href="https://esolangs.org/wiki/Esoteric_programming_language">Esolang</a>。根据对出题人的了解，首先尝试一下在 [V&amp;N2020 公开赛]Final Game 中用过的<a href="https://en.wikipedia.org/wiki/Malbolge">Malbolge</a>。用<a href="http://www.malbolge.doleczek.pl/">在线解释器</a>运行得到：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>bugku{what_An_U91y_pro9ramming_lAngUa9e}</div></div><div><br/></div><div>flag：bugku{what_An_U91y_pro9ramming_lAngUa9e}</div><div><br/></div><div><span style="font-weight: bold;">70 善用工具</span></div><div><br/></div><div>下载得到hint.png、real steg.zip和sapphire .jpg，其中前者实际是文本，内容为：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>hint: hint不在这</div><div><br/></div><div>8:V5Y:7,Y,3MU=$8D:D%11&amp;9O6BY .G,M</div></div><div>显然是uuencode，解码得到：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>keyis<font color="#FF0000">91;utF$jAQDfoZ.@:s-</font></div></div><div>对后半部分进行Ascii85解码：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>KEYisCamouflage</div></div><div><br/></div><div>用Free_File_Camouflage工具提取sapphire .jpg中的隐藏信息：</div><div><img src="Bugku Misc 12（69-72）_files/Image [4].png" type="image/png" data-filename="Image.png"/></div><div>得到zip passwd.docx，Microsoft Word打开，取消隐藏字体：</div><div><img src="Bugku Misc 12（69-72）_files/Image [5].png" type="image/png" data-filename="Image.png"/></div><div>得到解压密码：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>XiAo_1U</div></div><div><br/></div><div>打开real steg.zip，用以上密码解压得到csgo文件，同时在注释中得到提示webp：</div><div><img src="Bugku Misc 12（69-72）_files/Image [6].png" type="image/png" data-filename="Image.png"/></div><div>从webp格式联想到隐写工具stegpy，用该工具提取隐写信息：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# stegpy csgo.webp</div><div>bugku{rea1ly_miss_yoU}</div></div><div><br/></div><div>flag：bugku{rea1ly_miss_yoU}</div><div><br/></div><div><span style="font-weight: bold;">71 </span><span style="font-weight: bold;">花点流量听听歌</span></div><div><br/></div><div>下载得到mp3格式文件，十六进制编辑器打开，在文件尾后找到额外数据：</div><div><img src="Bugku Misc 12（69-72）_files/Image [7].png" type="image/png" data-filename="Image.png"/></div><div><img src="Bugku Misc 12（69-72）_files/Image [8].png" type="image/png" data-filename="Image.png"/></div><div>分离得到zip格式压缩包和一段文本：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>pay attention,After encryption is fsjcwymauudmwogqbdrsd</div></div><div><img src="Bugku Misc 12（69-72）_files/Image [9].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div>audacity打开mp3文件，切换到对数坐标频谱图：</div><div><img src="Bugku Misc 12（69-72）_files/Image [10].png" type="image/png" data-filename="Image.png"/></div><div>得到<a href="https://www.cnblogs.com/labster/p/13849720.html">Beaufort Cipher</a>，是一种类似于维吉尼亚密码的古典替换密码。显然文件尾部的字符串为密文，但博福特密码解密需要密钥。接下来开始寻找密钥。</div><div><br/></div><div>从zip压缩包中解压得到whereiskey.pcapng和flag.rar。后者是加密压缩包，先看前者，wireshark打开：</div><div><img src="Bugku Misc 12（69-72）_files/Image [11].png" type="image/png" data-filename="Image.png"/></div><div>从第31号流量包开始发现了明显的USB键盘输入流量，直接用脚本提取键盘输入信息：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# python UsbKeyboardDataHacker.py whereiskey.pcapng</div><div>Running as user &quot;root&quot; and group &quot;root&quot;. This could be dangerous.</div><div>[+] Found : thk&lt;DEL&gt;epe&lt;DEL&gt;asy&lt;DEL&gt;swoi&lt;DEL&gt;rds&lt;DEL&gt;notu&lt;DEL&gt;hes&lt;DEL&gt;reb&lt;DEL&gt;?6&lt;DEL&gt;</div></div><div>整理一下输入的内容：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font face="Monaco">实际输入的字符：thepasswordnothere?</font></div><div><span style="font-size: 9pt; color: rgb(51, 51, 51);"><font style="font-family: Monaco;">中途删除的字符：keyisusb6</font></span></div></div><div>虽然不知道为什么会有个6，但可以得到密钥为usb。</div><div><br/></div><div>以usb为博福特密码的密钥，解密密文fsjcwymauudmwogqbdrsd，得到：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>passwdishappyeveryday</div></div><div>以happyeveryday解压flag.rar得到flag。</div><div><br/></div><div>flag：bugku{What_a_enjoyable_music}</div><div><br/></div><div><span style="font-weight: bold;">72 开始也是结束</span></div><div><br/></div><div>下载得到jpg格式文件，十六进制编辑器打开，在文件尾后发现额外数据：</div><div><img src="Bugku Misc 12（69-72）_files/Image [12].png" type="image/png" data-filename="Image.png"/></div><div>提取得到加密的zip格式压缩包：</div><div><img src="Bugku Misc 12（69-72）_files/Image [13].png" type="image/png" data-filename="Image.png"/></div><div>根据提示，用rockyou.txt为字典进行爆破，得到密码为11549：</div><div><img src="Bugku Misc 12（69-72）_files/Image [14].png" type="image/png" data-filename="Image.png"/></div><div>解压得到11549.zip，也是一个加密压缩包：</div><div><img src="Bugku Misc 12（69-72）_files/Image [15].png" type="image/png" data-filename="Image.png"/></div><div>猜测其密码为33541，尝试解压，密码正确。</div><div><br/></div><div>猜测这一系列压缩包的密码均为其中文件的文件名，用Python循环解压：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>import zipfile</div><div><br/></div><div>path = 'C:/Users/Administrator/Desktop/zip/'</div><div>zipname = path + '1.zip'</div><div>while True:</div><div>    ts1 = zipfile.ZipFile(zipname)</div><div>    res = ts1.namelist()[0].split('.')[0]</div><div>    print(res)</div><div>    passwd = bytes(res, 'utf-8')</div><div>    ts1.extractall(path, pwd = passwd)</div><div>    zipname = path + ts1.namelist()[0]</div></div><div>运行到bugku.zip时报错。找到bugku.zip，其中包含加密的bugku.jpg文件。用rockyou.txt作为字典爆破：</div><div><img src="Bugku Misc 12（69-72）_files/Image [16].png" type="image/png" data-filename="Image.png"/></div><div>得到密码为letsgetiton，解压得到bugku.jpg，十六进制编辑器查看，文件尾后有额外数据：</div><div><img src="Bugku Misc 12（69-72）_files/Image [17].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div>flag：flag{miu_nian_da_ji}</div></span>
</div></body></html> 