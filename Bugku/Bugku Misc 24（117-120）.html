<html>
<head>
  <title>Bugku Misc 24（117-120）</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/605894 (zh-CN, DDL); Windows/6.1.1 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="7141"/>
<h1>Bugku Misc 24（117-120）</h1>
<h2><a href="https://DemonStarAlgol.github.io/Misc/">[无关链接]</a></h2>

<div>
<span><div><span style="font-weight: bold;">117 beautiful_sky</span></div><div>题目：难道真的会有人不喜欢baeutiful_sky么？？？？？ 我可太爱了</div><div><br/></div><div>啊，套娃题。小小菜鸡刚入门，一题做完套路深。初识不知套滋味，回首已是套中人。<span style="font-size: unset; color: unset; font-family: unset;">下载得到加密的zip格式压缩包，尝试后发现可以用题目给出的字符串baeutiful_sky解压，得到JPG格式图像，十六进制编辑器查看，文件尾后有额外数据：</span></div><div><img src="Bugku Misc 24（117-120）_files/Image.png" type="image/png" data-filename="Image.png"/></div><div>从文件头D0 CF 11可以判断是复合二进制文档Compound File Binary Format，换句话说就是2003及更旧版本的Microsoft Office产生的文档格式。将其提取后另存为1.doc，尝试打开发现需要密码：</div><div><img src="Bugku Misc 24（117-120）_files/Image [1].png" type="image/png" data-filename="Image.png"/></div><div>JPG图像的右上角提示docencode_by_we1：</div><div><img src="Bugku Misc 24（117-120）_files/Image [2].png" type="image/png" data-filename="Image.png"/></div><div>尝试密码we1，成功打开doc文档：</div><div><img src="Bugku Misc 24（117-120）_files/Image [3].png" type="image/png" data-filename="Image.png"/></div><div>注意到换行符在下方，说明有白色文字，全选后右键查看字体，发现不仅是白色还有隐藏：</div><div><img src="Bugku Misc 24（117-120）_files/Image [4].png" type="image/png" data-filename="Image.png"/></div><div>取消隐藏后全选复制得到字符串：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>2B1Cm63gXbs3wrQv8QExVfFte4zNW6nqNxWeQbm7NMNfDakJrao4JXoGQyp1JXuwVu9vgWjcwAmGQRDUdXC8BQPfQoSRqz3wgD67nHx3QYttZMxXfgYXsRf9YkK9LT2NaMWFbEkVaYtM2B4JxPAeYjwKLpimEHZLhfVzsw1tFVyozFmTe7YYenK9eQS2iM6rJMwSgyCHeBY9ZrjBr1t6hVvZvazph3i3Rbg2e8Vvjar3J8GVudASDC9WSbMhu8wGwRa2MKnPEFkMj4VquNWj7NxBqjiFHAPRGNg4Xktogp1WCoDyQ1nYSn3qEYdfPPAe5etmm8ugeFgWqXSgMJxZ7ijiaF8qrZhVxgEKsJY6PKq36KsUA5uRkwE6kr1oA5TzUG9k69coGxvurDp99hcDuRYMscu3aFscfm7nbZ3APWcLaDxwVTGMFjxTaV3VYozK2VuRPgHWsJZ7mFs18oRyD6thRWWFK2CETgE6CVUyqXgPowkun2tYELY48UhYs9zdbdWpvLBs28vTHSRRSD5rscDUFUE665R2zCVk9B5PbfaCWnWLry8FKGy9NpSGozwh8chuzmZzttPJYyCGAxt1vbsuYJ8BqUzGXyBTJNirueieq2qRsYzBR3fcyye59ez2ZXcaGZxrBREyt1gKLSDHTv1xhkyWFpLEz4Ycvbkum3hKcMU96ubVfN6w8dgVhTmPo1MBzmBAgLe4U8gXg9QZht2x6JrbJ8XrBVdZN8M1yN66vHaJv6qbg16gM5Bscx7sso9RbuifX4Jg9qFrgqyP58p7YLQrgwpD5EGGjSZ4SoUb3gBZFYRiCctT7giybEjtTKDDw2iUAuXJVASXZzpL1eypbyVLZeEvP51iHfdVXqvDigG5CCxot1Yp2em6TYCTjL5aayj4MeaZHAz2LeNJADgEUo8k2ADe9vZFwqz7dVTH9Mg5NpR9xRwbQEq1FnJJqo48DwhpYfJrB8Bu5t2pSL4D7rzNiA5gA9gKvvcx7R1rd7GChYKnbmqz6BjRxQv3NiVkv2Rj7GbuzhQmcCcR9JunpSi1bvJMs1fPGs1c5xvVzM2L3KQz4bKb2y6jfoqpFR4cNAjNkfJSE6XFaU7yUbCH8nSm7EgApEr2parf4Fxinagsh5CdzRkRMuLad183P3a5DiMhohznAQyjX9fWbJWTW1zCV2Nezq98EUyEqprg4y11jAvvDAMfiHnsmX3RiwRJRYUWHE54wYBxZQNAbvB8ALKXxqef1wwZ9fDS6jjqcWb9L1tx</div></div><div>尝试base解码，发现为base58:，解码得到：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>NTA0QjAzMDQxNDAwMDkwMDYzMDAxQUIxNDQ1M0M1NTYxRTBDOUYwMDAwMDAxNzAyMDAwMDA4MDAwQjAwNjY2QzYxNjcyRTc0Nzg3NDAxOTkwNzAwMDEwMDQxNDUwMzA4MDAyM0QxMDEyNjM1M0NGRTdDNjFEQ0VCMTBCQjkwQjI2Qjk2RkUyQ0IzQ0E4OURFRENGQjNEOUNEMDNDMTJCMzY4MzMzMTRBQkU5MTY0MjA0QTBDOThBNDZBMkJDNTkwMzQ4OUMwRkM5MTA2MzlCNENBMDIxN0FCMTE3RTdBQjI1NjFBMzJCNUNBRTVGOTlCQzc3Q0NEMDhFMzE5REVBOTM3QjI1OEYyN0Y2NThDNzBGNDMxMEUyMzM3Q0JCNDRERTFGOEU4QUE1MDA5MDMwNTE2ODQzRkYyM0QyOUE5QjIzNjIyQzI2NkM2NDQxQkJCQTkzNkRDODRDNTgyNjg1RDBCOENGQkQ2NjAxMUNCQTA5OTM0RUZGMURGRUJERjQ4MkZDOEVGRjlGQzE5ODMxMDdBOEI1MTlBOUU4REZCRTQ1MDRCMDcwOEM1NTYxRTBDOUYwMDAwMDAxNzAyMDAwMDUwNEIwMTAyMUYwMDE0MDAwOTAwNjMwMDFBQjE0NDUzQzU1NjFFMEM5RjAwMDAwMDE3MDIwMDAwMDgwMDJGMDAwMDAwMDAwMDAwMDAyMDAwMDAwMDAwMDAwMDAwNjY2QzYxNjcyRTc0Nzg3NDBBMDAyMDAwMDAwMDAwMDAwMTAwMTgwMDVFNEM1RTVDMjlCOUQ3MDE1RTRDNUU1QzI5QjlENzAxMTI1REZBMzUyOUI5RDcwMTAxOTkwNzAwMDEwMDQxNDUwMzA4MDA1MDRCMDUwNjAwMDAwMDAwMDEwMDAxMDA2NTAwMDAwMEUwMDAwMDAwMDAwMA==</div></div><div>显然是base64，解码得到：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>504B03041400090063001AB14453C5561E0C9F0000001702000008000B00666C61672E747874019907000100414503080023D10126353CFE7C61DCEB10BB90B26B96FE2CB3CA89DEDCFB3D9CD03C12B36833314ABE9164204A0C98A46A2BC5903489C0FC910639B4CA0217AB117E7AB2561A32B5CAE5F99BC77CCD08E319DEA937B258F27F658C70F4310E2337CBB44DE1F8E8AA5009030516843FF23D29A9B23622C266C6441BBBA936DC84C582685D0B8CFBD66011CBA09934EFF1DFEBDF482FC8EFF9FC1983107A8B519A9E8DFBE4504B0708C5561E0C9F00000017020000504B01021F001400090063001AB14453C5561E0C9F0000001702000008002F000000000000002000000000000000666C61672E7478740A00200000000000010018005E4C5E5C29B9D7015E4C5E5C29B9D701125DFA3529B9D7010199070001004145030800504B0506000000000100010065000000E00000000000</div></div><div>显然是zip格式压缩包的十六进制数据，得到加密压缩包：</div><div><img src="Bugku Misc 24（117-120）_files/Image [5].png" type="image/png" data-filename="Image.png"/></div><div>尝试常见方法均无结果，考虑寻找解压密码。</div><div><span style="font-size: unset; color: unset; font-family: unset;">注意到最初的JPG图像的十六进制里有个包含Exif头的APP1块，那么就看一下exif信息：</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# exiftool beautiful_sky.jpg</div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">……（其他略）</span></div><div>XP Comment                      : 拉满了拉满了00000beautiful</div></div><div>然而在Windows下却会得到另一种结果：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>C:\Users\Administrator\Desktop&gt;exiftool beautiful_sky.jpg</div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">……（中略）</span></div><div>XP Comment                      : 鈥屸€嬧仯鈥嬧€嬧€屸€嬧仯鈥嬧€嬧€屸€嬧仯鈥嬧€嬧</div><div>€屸€嬧仯鎷夋弧浜嗘媺婊′簡鈥嬧€嬧€屸€屸€屸€嬧€嬧€屸€屸仯鈥嬧€嬧€屸€嬧€屸€嬧€嬧€</div><div>屸€岋豢鈥嬧€嬧€屸€嬧€?0000鈥嬧€嬧€嬧€豢beautiful</div></div><div>即使考虑Windows命令行工具的编码问题，后者也明显过于长了，说明其中必定包含了零宽字符。从图片右键属性-备注中复制得到文本，丢进十六进制编辑器看一眼：</div><div><img src="Bugku Misc 24（117-120）_files/Image [6].png" type="image/png" data-filename="Image.png"/></div><div>确实存在零宽Unicode字符，并且从种类来看，至少有EF BB BF对应的U+FEFF、E2 81 A3对应的U+2063等。根据零宽字符的种类，容易判断是用<a href="http://330k.github.io/misc_tools/unicode_steganography.html">Unicode Steganography with Zero-Width Characters</a>工具生成的。但这样一来就存在一个问题，因为出题人用的零宽控制符实在是太多了，如果直接用exiftool等工具提取XPComment或者直接从右键属性中复制出来，零宽字符顺序会受零宽控制符影响被打乱，从而无法正常解密。例如使用exiftool直接以二进制形式提取XPComment数据得到的结果是这样的：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>C:\Users\Administrator\Desktop&gt;exiftool -b -XPComment beautiful_sky.jpg &gt; 1</div></div><div><img src="Bugku Misc 24（117-120）_files/Image [7].png" type="image/png" data-filename="Image.png"/></div><div>根据提示在工具里把所有零宽字符全部选中，解密结果是这样的：</div><div><img src="Bugku Misc 24（117-120）_files/Image [8].png" type="image/png" data-filename="Image.png"/></div><div>完全无法得到正确结果。</div><div><br/></div><div>那么只能手动重排零宽字符，工具中把10种零宽字符全部选中的情况下，密文每1位长度会被加密成5位。因此可以手动尝试把5的倍数位零宽字符进行解密，得到如下能够合理解密的对应关系：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>E2 80 8B E2 80 8B E2 80 8B E2 80 AA EF BB BF</div><div>1</div><div><br/></div><div>E2 80 8B E2 80 8B E2 80 8C E2 80 8C E2 80 8C E2</div><div>80 8B E2 80 8B E2 80 8C E2 80 8C E2 81 A3 E2 80</div><div>8B E2 80 8B E2 80 8C E2 80 8B E2 80 8C E2 80 8B</div><div>E2 80 8B E2 80 8C E2 80 8C EF BB BF E2 80 8B E2</div><div>80 8B E2 80 8C E2 80 8B E2 80 8C</div><div>ovewe</div><div><br/></div><div>E2 80 8B E2 80 8B E2 80 8C E2 80 8B E2 81 A3 E2</div><div>80 8B E2 80 8B E2 80 8C E2 80 8B E2 81 A3 E2 80</div><div>8B E2 80 8B E2 80 8C E2 80 8B E2 81 A3 E6 8B</div><div>lll</div></div><div>对照一下提取得到的XPComment的十六进制数据，显然数据中缺失了开头的E2 80 8B E2 80 8B，即两个零宽空格。这样一来开头部分组成E2 80 8B E2 80 8B E2 80 8C E2 80 8B E2 81 A3，对应明文为l。因此完整明文为：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>llllovewe1</div></div><div>尝试解压之前得到的zip压缩包，得到flag.txt：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>‌‍‌⁣﻿⁢flag‌‎‌‍‎‌‌﻿‌‌‪﻿﻿‬‌‌﻿﻿⁢‌‌‌‌‭‌‌‬﻿‬﻿⁢﻿‬{‌‎‌‬‌‌‪‌⁣‌‍this_‌‌‪‌‬is‌‌‌‌‌_‌‌a‌‌_‌‌‍‭fake‌‍‬_flag}</div></div><div>然而压缩包中显示其大小为535，相差过大，显然其中也隐藏了零宽字符。那么再来一次零宽解密，得到flag：</div><div><img src="Bugku Misc 24（117-120）_files/Image [9].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div>flag：flag{we1_wants_a_girlfriendddddd~}</div><div><br/></div><div><span style="font-weight: bold;">118 Steganography_concerto</span></div><div><br/></div><div>啊，套娃题。下载附件解压得到flag文件夹，内含四个文件，先看 注.txt：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>我这没有东西是没用的（本文除外）</div></div><div>是废话。剩下三个文件，先看1.png。010Editor打开报IHDR块的CRC错误，说明高度被修改过。爆破得到真实高度为1246，在十六进制编辑器里修改高度，在图片最下方得到：</div><div><img src="Bugku Misc 24（117-120）_files/Image [10].png" type="image/png" data-filename="Image.png"/></div><div>但这密码暂时找不到用处。</div><div><br/></div><div>然后看JuSt_a_moon.jpg，穷举一遍常见隐写手法和工具可以发现是Jsteg：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>D:\CTFToolkit-v1.1.0\信息隐藏\JSteg&gt;jsteg-windows-amd64.exe reveal JuSt_a_moon.jpg</div><div>but_now_is</div></div><div>翻译一下，大概是要把两段连起来才是完整密码的意思。</div><div><br/></div><div>再看I_need_a_password.mp3，这就很明显了，MP3Stego，需要密码：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>D:\CTFToolkit-v1.1.0\信息隐藏\MP3Stego_1_1_18\MP3Stego&gt;Decode.exe -X -P not_all_but_now_is I_need_a_password.mp3</div><div>MP3StegoEncoder 1.1.17</div><div>See README file for copyright info</div><div>Input file = 'I_need_a_password.mp3'  output file = 'I_need_a_password.mp3.pcm'</div><div>Will attempt to extract hidden information. Output: I_need_a_password.mp3.txt</div><div>the bit stream file I_need_a_password.mp3 is a BINARY file</div><div>HDR: s=FFF, id=1, l=3, ep=off, br=9, sf=0, pd=1, pr=0, m=0, js=0, c=0, o=0, e=0</div><div>alg.=MPEG-1, layer=III, tot bitrate=128, sfrq=44.1</div><div>mode=stereo, sblim=32, jsbd=32, ch=2</div><div>[Frame 9496]Avg slots/frame = 417.915; b/smp = 2.90; br = 127.987 kbps</div><div>Decoding of &quot;I_need_a_password.mp3&quot; is finished</div><div>The decoded PCM output file name is &quot;I_need_a_password.mp3.pcm&quot;</div></div><div>得到2.01KB大小的I_need_a_password.mp3.txt，但内容只有“flag in here”，很明显有零宽控制符。把已知的零宽字符隐写在线工具穷举一遍，确定为<a href="http://zero.rovelast.com/">http://zero.rovelast.com/</a>的Unicode模式：</div><div><img src="Bugku Misc 24（117-120）_files/Image [11].png" type="image/png" data-filename="Image.png"/></div><div>得到flag。</div><div><br/></div><div>flag：flag{Feel_it_with_your_heart}</div><div><br/></div><div><span style="font-weight: bold;">119 小美的秘密part2</span></div><div><br/></div><div>下载得到一堆文件，先看txt：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>[请自配音乐&quot;Sad! -XXXTENTACION&quot;]</div><div><br/></div><div>在被小美拒绝后的你伤心欲绝，没想到自己的女神这样玩弄自己的感情，心灰意冷的你决定结束这段舔狗的感情。</div><div>就当你准备删除她的好友时，她给你发消息了。</div><div><br/></div><div>“小明，今天公司发过来一个压缩包，能帮我解决下这个压缩包里的文本吗，我感觉处理起来好麻烦，你这么厉害，帮我看看呗”</div><div>”file.zip“</div><div>”帮我解开我就给你想要的“</div><div>    ——”嘿嘿，没问题“</div><div><br/></div><div>！！！今天她终于叫了我的名字 虽然叫错了，但是没关系 我马上就去改名</div></div><div>那么就来看一下压缩包，里面一共有200个txt文件：</div><div><img src="Bugku Misc 24（117-120）_files/Image [12].png" type="image/png" data-filename="Image.png"/></div><div>随便打开几个看一下：</div><div><img src="Bugku Misc 24（117-120）_files/Image [13].png" type="image/png" data-filename="Image.png"/></div><div>每个文本都包含一段32位的十六进制数字串，前124个文本开头还有一位空格或Tab。联想到124可以被8整除，尝试把空格和Tab转为0和1的二进制串，此外由于第一个文本开头为空格，暂时猜测空格对应0，Tab对应1：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>s = ''.join([{' ': '0', '\t': '1'}[open(f'C:/Users/Administrator/Desktop/file/公司_资料/XXX{str(i)}EEE.txt').read()[0]] for i in range(1, 125)])</div><div>print([chr(int(s[i: i+8], 2)) for i in range(0, 123, 8)])</div></div><div>输出结果：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>['\x10', 'q', '\x01', '\x12', '\x11', '#', 's', '\x10', 'q', '\x07', 'P', 'H', 'H', 'H', '\x12', '\x05']</div></div><div>这就很怪。再试了试发现转十六进制有如下结果：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>print(hex(int(s, 2)))</div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;"># </span>0x1071011211237310710750484848125</div><div><br/></div><div>print(''.join([chr(int(i)) for i in '107 101 121 123 73 107 107 50 48 48 48 125'.split(' ')]))</div><div># key{Ikk2000}</div></div><div>原来是要转十六进制后再当作十进制数字转ASCII码啊，出的不错，我去压一下数学家的棺材板，下次不要出了。</div><div><br/></div><div>再看bzzb.jpg，十六进制编辑器打开，文件尾后有额外数据：</div><div><img src="Bugku Misc 24（117-120）_files/Image [14].png" type="image/png" data-filename="Image.png"/></div><div>提取得到加密的zip格式压缩包，密码是Ikk2000。解压得到imageIN.png和thekey.txt，先看后者：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>Missing a part of ???(0,20,5)maybe?</div><div>[-&gt;++ +++++ +++++ +++&lt;] &gt;+.&lt;+ +++++ +++[- &gt;---- -----</div><div>&lt;]&gt;-- ----- ----- ----- .&lt;+++ [-&gt;++ +&lt;]&gt;+ ++.&lt;+ +++++ +++[- &gt;++++ +++++</div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">……（中略）</span></div><div>[-&gt;++ +++&lt;] &gt;++++ +++++ +.&lt;++ +++++ ++[-&gt; ----- ----&lt; ]&gt;--- ----- -----</div><div>----. &lt;+++[ -&gt;+++ &lt;]&gt;++ ++.&lt;</div></div><div>很明显是Brainfuck代码，但直接运行没有结果。注意到代码开头是[，含义为“如果指针指向的单元值为零，向后跳转到对应的]指令的次一指令处”。然而Brainfuck的数组初始状态全部为0，在代码开头即执行[会导致第一组[]内的内容全部被跳过，并不合理。因此开头部分很可能缺失了部分自增/自减运算符+或-，通常来说是+。第一行给出了关于缺失+个数的提示，但实际上因为整段代码是每60个字符一行排版好的，所以用肉眼就能看出缺失的+应为15个。顺带一提，这个手法感觉上可能是抄的 <span style="color: rgb(105, 170, 53);"><a href="evernote:///view/30668439/s39/fa9e9fef-19f8-4367-ab33-7fa421940dcc/fa9e9fef-19f8-4367-ab33-7fa421940dcc/">[羊城杯 2020]逃离东南亚</a> </span>其中某步。总之补全代码顺便去掉第一行后运行一下：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>C:\Users\Administrator\Desktop\file&gt;D:\CTFToolkit-v1.1.0\信息隐藏\bftools\bftools.exe run thekey.txt &gt; 1.txt</div></div><div>得到的txt内容为ImKey，但大小居然有557字节，说明有零宽控制符，同时也说明出题人出题像套神。在这个人人争当小套神的年代，往各种莫名其妙的地方塞零宽可以说已经成为了新的潮流。用<a href="http://330k.github.io/misc_tools/unicode_steganography.html">这个工具</a>的默认设置就可以得到隐写内容：</div><div><img src="Bugku Misc 24（117-120）_files/Image [15].png" type="image/png" data-filename="Image.png"/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>TheRealKeyIs{bugku233_}</div></div><div>但暂时还不知道这个key有什么用。</div><div><br/></div><div>继续看imageIN.png，从文件名就能看出用的是imageIN这个工具：</div><div><img src="Bugku Misc 24（117-120）_files/Image [16].png" type="image/png" data-filename="Image.png"/></div><div>打开得到一段密文：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>The Ciphertext：</div><div>⠃⡳⠃⡹⠃⡴⠃⡲⠃⡮⠃⡆⠃⠥⠃⡺⠃⡧⠃⡬⠃⡊⠃⡂⠃⡰⠃⡊⠃⡴⠃⡧⠃⡰⠃⡊⠃⡿⠃⡠⠃⡦⠃⡡⠃⡊⠃⡳⠃⡧⠃⡼⠃⡰⠃⡻⠃⡱⠃⡦⠃⡨==</div></div><div>显然是千千秀字的<a href="https://www.qqxiuzi.cn/bianma/wenbenjiami.php?s=mangwen">文本加密为盲文</a>，直接用上面得到的key作为密码解密：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>flag{S0ory_We_are_just_friends}</div></div><div><br/></div><div>flag：flag{S0ory_We_are_just_friends}</div><div><br/></div><div><span style="font-weight: bold;">120 简单取证1</span></div><div>题目：flag格式为flag{用户名_对应的密码} 例如flag{administrator_bugku}</div><div><br/></div><div>下载得到config文件夹：</div><div><img src="Bugku Misc 24（117-120）_files/Image [17].png" type="image/png" data-filename="Image.png"/></div><div>在本地搜索一下其中几个文件夹的名字，可以确定这是system32目录下的config文件夹：</div><div><img src="Bugku Misc 24（117-120）_files/Image [18].png" type="image/png" data-filename="Image.png"/></div><div>根据题目描述，需要找到用户名和密码，而Windows系统的登录用户名和密码加密后就储存在该目录的SAM文件中。有很多取证工具可以读取SAM文件中用户名和密码的哈希值，这里用mimikatz来试一下。首先把config文件夹下的SAM和SYSTEM两个文件复制到mimikatz目录下，然后运行：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>mimikatz(commandline) # lsadump::sam /sam:SAM /system:SYSTEM</div><div>Domain : DESKTOP-VBBTMVS</div><div>SysKey : 37f0b72b8ef4052d5a305281c2c8905c</div><div>Local SID : S-1-5-21-2468344919-3152572563-1510310172</div><div><br/></div><div>SAMKey : 6bbc5d51b8b9609e241bba9a2558048e</div><div><br/></div><div>RID  : 000001f4 (500)</div><div>User : Administrator</div><div><br/></div><div>RID  : 000001f5 (501)</div><div>User : Guest</div><div><br/></div><div>RID  : 000001f7 (503)</div><div>User : DefaultAccount</div><div><br/></div><div>RID  : 000001f8 (504)</div><div>User : WDAGUtilityAccount</div><div>  Hash NTLM: 8adf83b531e1cdadc8d16b206d87a4d5</div><div><br/></div><div>Supplemental Credentials:</div><div>* Primary:NTLM-Strong-NTOWF *</div><div>    Random Value : 58d06fcf956eb58ebd0869ec521014e6</div><div><br/></div><div>* Primary:Kerberos-Newer-Keys *</div><div>    Default Salt : WDAGUtilityAccount</div><div>    Default Iterations : 4096</div><div>    Credentials</div><div>      aes256_hmac       (4096) : 1faacace6af0e20c359b06724c78091e449bf47b89acc2038f04e4ba2d572831</div><div>      aes128_hmac       (4096) : 709124a7e0fa42ff205ba8e78185c294</div><div>      des_cbc_md5       (4096) : c8c2263e86f426d0</div><div><br/></div><div>* Packages *</div><div>    NTLM-Strong-NTOWF</div><div><br/></div><div>* Primary:Kerberos *</div><div>    Default Salt : WDAGUtilityAccount</div><div>    Credentials</div><div>      des_cbc_md5       : c8c2263e86f426d0</div><div><br/></div><div><font color="#FF0000">RID  : 000003e8 (1000)</font></div><div><font style="color: rgb(255, 0, 0);">User : administrator-QQAAzz</font></div><div><font style="color: rgb(255, 0, 0);">  Hash NTLM: 5f9469a1db6c8f0dfd98af5c0768e0cd</font></div><div><br/></div><div>Supplemental Credentials:</div><div>* Primary:NTLM-Strong-NTOWF *</div><div>    Random Value : ec93efdfb8a9278be59f7a1f4116a46e</div><div><br/></div><div>* Primary:Kerberos-Newer-Keys *</div><div>    Default Salt : DESKTOP-VBBTMVSadministrator-QQAAzz</div><div>    Default Iterations : 4096</div><div>    Credentials</div><div>      aes256_hmac       (4096) : 08da13a926b2b211cb0f1ba75ab191f72ed77469734eaf1f201199e553565005</div><div>      aes128_hmac       (4096) : 21f966b6130439e9675a028093241e31</div><div>      des_cbc_md5       (4096) : c8804662201043a2</div><div>    OldCredentials</div><div>      aes256_hmac       (4096) : cc294cf8db8838e1c973d8e868a4c32d7fd215162c9ae75a797493fd96cec3b7</div><div>      aes128_hmac       (4096) : d7230e305d7f9ab31247e9ed06da3e9f</div><div>      des_cbc_md5       (4096) : 62dfbf1c0dbc8685</div><div>    OlderCredentials</div><div>      aes256_hmac       (4096) : 11bc124de204c19f0f9305390aad0785f0bb5250eb0147a55d3ce95549bcc455</div><div>      aes128_hmac       (4096) : ac7b1df27906f24c8b9228e9e573f48f</div><div>      des_cbc_md5       (4096) : e6c7194a6eab4673</div><div><br/></div><div>* Packages *</div><div>    NTLM-Strong-NTOWF</div><div><br/></div><div>* Primary:Kerberos *</div><div>    Default Salt : DESKTOP-VBBTMVSadministrator-QQAAzz</div><div>    Credentials</div><div>      des_cbc_md5       : c8804662201043a2</div><div>    OldCredentials</div><div>      des_cbc_md5       : 62dfbf1c0dbc8685</div></div><div>得到了所有用户名及其密码对应的NTLM hash，依次进行hash反查，得到administrator-QQAAzz用户的密码：</div><div><img src="Bugku Misc 24（117-120）_files/Image [19].png" type="image/png" data-filename="Image.png"/></div><div>从而得到flag。</div><div><br/></div><div>flag：flag{administrator-QQAAzz_<span style="font-size: 12px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-family: verdana, arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">forensics</span>}</div></span>
</div></body></html> 