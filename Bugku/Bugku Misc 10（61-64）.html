<html>
<head>
  <title>Bugku Misc 10（61-64）</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/605894 (zh-CN, DDL); Windows/6.1.1 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="3074"/>
<h1>Bugku Misc 10（61-64）</h1>
<h2><a href="https://DemonStarAlgol.github.io/Misc/">[无关链接]</a></h2>

<div>
<span><div><span style="font-weight: bold;">61 ping</span></div><div><br/></div><div>下载得到pcap格式文件，wireshark打开，共有38个数据包，均为ICMP协议：</div><div><img src="Bugku Misc 10（61-64）_files/Image.png" type="image/png" data-filename="Image.png"/></div><div>每个包的数据长度均为1400，除第1字节外后续字节均为0a和大量00：</div><div><img src="Bugku Misc 10（61-64）_files/Image [1].png" type="image/png" data-filename="Image.png"/></div><div>依次查看每个数据包，数据段第1字节依次为f、l、a、g、{，显然拼接后就能得到flag。练习一下tshark命令：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# tshark -r ping.pcap -Y &quot;icmp&quot; -T fields -e data | cut -c1-2 | xargs</div><div>Running as user &quot;root&quot; and group &quot;root&quot;. This could be dangerous.</div><div>66 6c 61 67 7b 64 63 37 36 61 31 65 65 65 36 65 33 38 32 32 38 37 37 65 64 36 32 37 65 30 61 30 34 61 62 34 61 7d</div></div><div>十六进制ASCII转码得到flag。</div><div><br/></div><div>flag：flag{dc76a1eee6e3822877ed627e0a04ab4a}</div><div><br/></div><div><span style="font-weight: bold;">62 baby_misc</span></div><div><br/></div><div>下载得到zip格式文件，压缩包内含三个文件：</div><div><img src="Bugku Misc 10（61-64）_files/Image [2].png" type="image/png" data-filename="Image.png"/></div><div>其中zip是加密压缩包，txt是追加提示，先看jpg格式文件。十六进制编辑器打开：</div><div><img src="Bugku Misc 10（61-64）_files/Image [3].png" type="image/png" data-filename="Image.png"/></div><div>看到IHDR和IDAT等块头部标识，说明这是一个PNG格式图像，文件头被改成了JPG格式文件头。将其修复：</div><div><img src="Bugku Misc 10（61-64）_files/Image [4].png" type="image/png" data-filename="Image.png"/></div><div>同时发现文件尾后有额外数据，是另一张PNG格式图片：</div><div><img src="Bugku Misc 10（61-64）_files/Image [5].png" type="image/png" data-filename="Image.png"/></div><div>用foremost分离，得到两张PNG格式图片：</div><div><img src="Bugku Misc 10（61-64）_files/Image [6].png" type="image/png" data-filename="Image.png"/></div><div>用Stegsolve的Image Combiner功能比较两图，SUB模式的结果中有大量横向虚线样图案：</div><div><img src="Bugku Misc 10（61-64）_files/Image [7].png" type="image/png" data-filename="Image.png"/></div><div>说明是盲水印，根据提示，直接用盲水印工具处理：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop/blind-watermark-python3/BlindWaterMark# python3 bwmforpy3.py decode 00000000.png 00000657.png out.png</div></div><div><img src="Bugku Misc 10（61-64）_files/out.png" type="image/png" data-filename="out.png"/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>passwd:wowblind</div></div><div><br/></div><div>解压 看到flag了.zip ，得到flag.zip和password.txt，前者是加密压缩包，先看后者：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>萌新专属RSA：</div><div>已知R=65537</div><div>N=21321423135312411313</div><div>求出来十进制d就是解压密码</div></div><div>直接上工具吧，RSA-Tool 2：</div><div><img src="Bugku Misc 10（61-64）_files/Image [8].png" type="image/png" data-filename="Image.png"/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>1653347504416359113</div></div><div>解压flag.zip得到flag.txt：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>NGZlbmNl</div><div>eW91IG5lZWR+</div><div>VGhhbmsgeW91</div><div>Zm9yIGJlaW5n</div><div>YWJsZSB0b4++</div><div>ZG8gdGhpc5++</div><div>c3RlcC6+</div><div>VGhlIGRpZmZpY3VsdGllc3++</div><div>YWhlYWQgc2hvdWxk</div><div>bm90IGJlIGRpZmZpY3VsdH++</div><div>Zm9yIHRob3Nl</div><div>d2hvIGNhbk++</div><div>ZG8ndGhpcyBzdGVwLn++</div><div>Tm93IGl0J3MgSmFudWFyeV++</div><div>MTUgb2YgdGhl</div><div>MjFzdCB5ZWFyLn++</div><div>SWYgeW91IGFyZb++</div><div>bHVja3kgZW5vdWdo</div><div>dG8gc2VlIHRoZT++</div><div>d2hvbGUgcGFzc2FnZQ++</div><div>YmVmb3JlIHRoZW++</div><div>bmV3IHllYXIs</div><div>SSB3aXNoIHlvdT++</div><div>YSBoYXBweW++</div><div>bmV3JHllYXJ+</div><div>aW6gYWR2YW5jZS6+</div><div>SW4gYWRkaXRpb24s</div><div>SSB3aWxsIHdyaXRl</div><div>YSBxdWVzdGlvbiBhYm91dG++</div><div>c29jaWFsIGVuZ2luZWVyaW5n</div><div>b24nYnVna3Und2hlbn++</div><div>dGhlIG5ldyB5ZWFy</div><div>aXMnY29taW5nLn++</div><div>SSBob3BlIHlvdV++</div><div>aGF2ZSBh</div><div>Z29vZCB0aW1l</div><div>QnkgdGhlIHdheSx+</div><div>SSdtIGErbmV3IENURmVyLr++</div><div>SSBhbHNv</div><div>d2FudCB0b9++</div><div>d29yayBzaWRlIGJ5</div><div>c2lkZSB3aXRo</div><div>dGhlIGRhbGFvLn++</div><div>SSBjYW1lIGludG8g</div><div>Y29udGFjdCB3aXRo</div><div>c1RGIHdoZW4gSc++</div><div>d2VudCB0byB0aGX+</div><div>Q29sbGVnZSBpbiAyMDIwLj++</div><div>SSBob3BlIHdl</div><div>Y2FuIGFsbH++</div><div>d29yayB0b2dldGhlct++</div><div>SSB3b25kZXJ+</div><div>aWYgc29tZW9uZSB3aWxsIK++</div><div>cmVhbGx5IHRyYW5zbGF0ZSD+</div><div>dGhpcyBwYXNzYWdl</div><div>YW5kIGVpZ2h0IGdvZG++</div><div>dGhpbmsgaXQgaXN+</div><div>dGhlIGVhc2llc3Q+</div><div>bWlzYyBxdWVzdGlvbn++</div><div>Zm9yIGhl</div><div>YnVna3U2Ni++</div></div><div>尝试一下可以发现两条线索：</div><div>1、将所有+改为=后，每行都是base64编码；</div><div>2、上述末尾带=的行，base64解码后再次编码，末尾字符有所不同。</div><div>从而可以判定是base64隐写，用脚本提取隐写信息：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>import re</div><div>import base64</div><div><br/></div><div>b64chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'</div><div><br/></div><div>f = open('base!.txt','r')</div><div>base64str = f.readline()</div><div><br/></div><div>pattern2 = r'(\S)==$'</div><div>pattern1 = r'(\S)=$'</div><div><br/></div><div>binstring = ''</div><div><br/></div><div>while(base64str):</div><div>    if re.compile(pattern2).findall(base64str):</div><div>        mstr = re.compile(pattern2).findall(base64str)[0]</div><div>        mbin = bin(b64chars.find(mstr))</div><div>        mbin2 = mbin[0:2] + mbin[2:].zfill(6)</div><div>        stegobin = mbin2[-4:]</div><div>        binstring += stegobin</div><div>    elif re.compile(pattern1).findall(base64str):</div><div>        mstr = re.compile(pattern1).findall(base64str)[0]</div><div>        mbin = bin(b64chars.find(mstr))</div><div>        mbin2 = mbin[0:2] + mbin[2:].zfill(6)</div><div>        stegobin = mbin2[-2:]</div><div>        binstring += stegobin</div><div>    base64str = f.readline()</div><div>for i in range(0,len(binstring),8):</div><div>    print(chr(int(binstring[i:i+8],2)),end='')</div></div><div>运行结果：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>bgtu{0cfguo_3}kdr</div></div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">很明显是栅栏密码，W形栅栏解密，栏数为4，得到：</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>bugku{g0od_ctf3r}</div></div><div><br/></div><div>flag：Bugku{g0od_ctf3r}</div><div><br/></div><div><span style="font-weight: bold;">63 放松一下吧</span></div><div><br/></div><div>下载得到zip格式文件。逐层解压，得到加密压缩包 你需要刷新.zip 和文件夹 password，其中后者内含一个I wanna游戏：</div><div><img src="Bugku Misc 10（61-64）_files/Image [9].png" type="image/png" data-filename="Image.png"/></div><div>根据题意，需要玩游戏获取另一个压缩包的解压密码，那么就开始玩游戏。</div><div><br/></div><div>首先用十六进制编辑器打开这个exe文件，查找字符串“Game Maker”，逐个结果查看：</div><div><img src="Bugku Misc 10（61-64）_files/Image [10].png" type="image/png" data-filename="Image.png"/></div><div>从而确定制作时使用的Game Maker版本为GM8。然后掏出<a href="https://github.com/OpenGM8/GM8Decompiler">GM8Decompiler</a>将其反编译，得到gmk文件：</div><div><img src="Bugku Misc 10（61-64）_files/Image [11].png" type="image/png" data-filename="Image.png"/></div><div>最后用Game Maker 8打开gmk文件，依次查看所有Rooms，在room3找到密码：</div><div><img src="Bugku Misc 10（61-64）_files/Image [12].png" type="image/png" data-filename="Image.png"/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>PASSWD:happy_i_wanna</div></div><div>这样游戏就通关了。</div><div><br/></div><div>解压加密压缩包，得到 你需要刷新.jpg 和 passwd.txt。根据文件名提示，jpg图片可能用F5隐写工具隐藏了信息，提取隐写信息需要密码。先看txt文件，内容：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>password:🐭🐭🐭🐭🐭🐭🐭🐭</div><div>贝斯的老大也可以解这个问题</div><div>……（后略）</div></div><div>根据提示，用<a href="http://www.atoolbox.net/Tool.php?Id=936">base100在线工具</a>解码emoji串，得到密码：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>66666666</div></div><div>然后用F5隐写工具提取隐藏信息：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>D:\CTFToolkit-v1.1.0\信息隐藏\F5-steganography-master&gt;java Extract ./1.jpg -p 66666666</div><div>Huffman decoding starts</div><div>Permutation starts</div><div>393216 indices shuffled</div><div>Extraction starts</div><div>Length of embedded file: 33 bytes</div><div>(1, 127, 7) code used</div></div><div>提取结果在同一目录下的output.txt中：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>bugku{F5_and_i_wanna_is_so_cool}</div></div><div><br/></div><div>flag：bugku{F5_and_i_wanna_is_so_cool}</div><div><br/></div><div><b>64 赛博朋克</b></div><div><br/></div><div>下载得到zip格式文件，是加密压缩包，内含cyberpunk.txt：</div><div><img src="Bugku Misc 10（61-64）_files/Image [13].png" type="image/png" data-filename="Image.png"/></div><div>ZipCenOp处理后可以正常解压，说明是伪加密：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>D:\CTFToolkit-v1.1.0\暴力破解\ZipCenOp&gt;java -jar ZipCenOp.jar r file.zip</div><div>success 1 flag(s) found</div></div><div>查看cyberpunk.txt，很明显是修改了扩展名的PNG格式图片：</div><div><img src="Bugku Misc 10（61-64）_files/Image [14].png" type="image/png" data-filename="Image.png"/></div><div>修改扩展名，十六进制编辑器查看，文件尾部有额外数据，其中包括Image steganography assistant字样：</div><div><img src="Bugku Misc 10（61-64）_files/Image [15].png" type="image/png" data-filename="Image.png"/></div><div>Stegsolve查看图片，在R/G/B plane 0处能够明显看到左上角有LSB隐写痕迹：</div><div><img src="Bugku Misc 10（61-64）_files/Image [16].png" type="image/png" data-filename="Image.png"/></div><div>直接用Stegsolve的Data Extract功能，选项如下，得到flag：</div><div><img src="Bugku Misc 10（61-64）_files/Image [17].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div>当然用zsteg也可以：</div><div><img src="Bugku Misc 10（61-64）_files/Image [18].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div>flag：flag{Hel1o_Wor1e}</div></span>
</div></body></html> 