<html>
<head>
  <title>Bugku Misc 26（125-128）</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/605894 (zh-CN, DDL); Windows/6.1.1 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="7519"/>
<h1>Bugku Misc 26（125-128）</h1>
<h2><a href="https://DemonStarAlgol.github.io/Misc/">[无关链接]</a></h2>

<div>
<span><div><span style="font-weight: bold;">125 请叫我艺术家</span></div><div><br/></div><div>下载得到doc格式文件。打开看一下：</div><div><img src="Bugku Misc 26（125-128）_files/Image.png" type="image/png" data-filename="Image.png"/></div><div>有一张图和一段无法显示的字符。</div><div><br/></div><div>先看图，提取出来后稍微放大一点：</div><div><img src="Bugku Misc 26（125-128）_files/Image [1].png" type="image/png" data-filename="Image.png"/></div><div>可以看到这是在Bugku的Logo基础上画的像素图，且靠上区域有一些似乎存在一定规律的色块。先来看一下有什么颜色：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>from PIL import Image</div><div><br/></div><div>img = Image.open('C:/Users/Administrator/Desktop/1.png')</div><div>f = lambda x: '#' + ''.join([hex(i)[2:].upper().zfill(2) for i in x[:3]])</div><div>col = []</div><div>for x in range(img.size[0]):</div><div>    c = f(img.getpixel((x, 0)))</div><div>    if c not in col:</div><div>        col += [c]</div><div>        print(c)</div></div><div>输出结果：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>#00C0C0</div><div>#C0FFFF</div><div>#00FFFF</div><div>#C0C0FF</div><div>#C0FFC0</div><div>#C0C000</div><div>#FFFF00</div><div>#FFFFC0</div><div>#00C000</div><div>#FFC0C0</div><div>#FF0000</div><div>#C000C0</div><div>#0000FF</div><div>#0000C0</div><div>#00FF00</div><div>#C00000</div><div>#FFC0FF</div><div>#FF00FF</div><div>#000000</div><div>#575FD3</div><div>#3F48CC</div><div>#22B14C</div><div>#FF7F27</div></div><div>注意到大多数颜色的RGB通道值都是由FF C0 00组成的，联想到一种常见的非文本Esolang：<a href="https://esolangs.org/wiki/Piet">Piet</a>。这是它用到的颜色表：</div><div><img src="Bugku Misc 26（125-128）_files/Image [2].png" type="image/png" data-filename="Image.png"/></div><div>再加上黑(#0000000)和白(#FFFFFF)两色，完全一致，可能性非常大。<span style="font-size: unset; color: unset; font-family: unset;">那么尝试用</span><a href="http://www.bertnase.de/npiet/" style="font-size: unset; font-family: unset;">npiet</a><span style="font-size: unset; color: unset; font-family: unset;">来运行一下：</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>D:\CTFToolkit-v1.1.0\信息隐藏\npiet-1.3a-win32&gt;npiet.exe C:\Users\Administrator\Desktop\1.png</div><div>Bugku{2021_Bye_</div></div><div>得到了一半flag。</div><div><br/></div><div>回头看那串没有正常显示的字符，注意到Word文档最下方还有内容：</div><div><img src="Bugku Misc 26（125-128）_files/Image [3].png" type="image/png" data-filename="Image.png"/></div><div>而且字号是1，放大一点或者直接复制出来得到：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>todpole</div></div><div>意思是蝌蚪。搜索“蝌蚪 解密”等关键词找到<a href="http://www.megaemoji.com/cn/generators/tadpole/">蝌蚪文在线解密</a>，注意到工具对所谓“蝌蚪文”的描述与Word文档中的未正常显示字符串是相符的，即斜杠/后跟大量的Unicode特殊字符。尝试解一下：</div><div><img src="Bugku Misc 26（125-128）_files/Image [4].png" type="image/png" data-filename="Image.png"/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>2022_Welcome}</div></div><div>最后拼接得到flag。</div><div><br/></div><div>flag：Bugku{2021_Bye_2022_Welcome}</div><div><br/></div><div><span style="font-weight: bold;">126 easypicture</span></div><div><br/></div><div>下载得到jpg格式文件。十六进制编辑器查看，文件尾后有额外数据，分离得到zip格式压缩包：</div><div><img src="Bugku Misc 26（125-128）_files/Image [5].png" type="image/png" data-filename="Image.png"/></div><div>直接进行一个爆破：</div><div><img src="Bugku Misc 26（125-128）_files/Image [6].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div>解压得到又一个zip，继续解压得到三个文件：</div><div><img src="Bugku Misc 26（125-128）_files/Image [7].png" type="image/png" data-filename="Image.png"/></div><div>先看hint：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>hint:你喝过咖啡吗？你见过彩色的图片吗？</div></div><div>猜谜，就硬猜。总之先看ciphertext.png，文件尾后有段额外字符串：</div><div><img src="Bugku Misc 26（125-128）_files/Image [8].png" type="image/png" data-filename="Image.png"/></div><div>结合文件名，大概是png里有个密文，jpg里有个密钥，都找到之后用ECB模式的AES解密。</div><div><br/></div><div>那么先找密文，Stegsolve打开ciphertext.png，观察颜色通道，会发现R/G/B Plane 0的最左边一列像素是完全一致的，这对于一张显然由有损JPG图像转换来的图片显然非常可疑。有理由怀疑存在列优先的LSB隐写，zsteg梭一把：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# zsteg -o yx ciphertext.png</div><div>imagedata           .. text: &quot;zvz@?=#)+&quot;</div><div>b1,r,lsb,yx         .. text: &quot;<font color="#FF0000">rcPr04H36Qj+7vt9YFA2KbRyD0yEg+y7mTAQHC82CBM=</font>&quot;</div><div>b1,g,lsb,yx         .. text: &quot;<font color="#FF0000">rcPr04H36Qj+7vt9YFA2KbRyD0yEg+y7mTAQHC82CBM=</font>&quot;</div><div>b1,b,lsb,yx         .. text: &quot;<font style="color: rgb(255, 0, 0);">rcPr04H36Qj+7vt9YFA2KbRyD0yEg+y7mTAQHC82CBM=</font>&quot;</div><div>b2,r,lsb,yx         .. text: &quot;~a1s-z-cu&quot;</div><div>b4,g,lsb,yx         .. text: &quot;VBDEUU4VvBww&quot;</div><div>b4,b,lsb,yx         .. text: &quot;VBDEUU4VvBww&quot;</div><div>b4,rgb,lsb,yx       .. text: &quot;3UWwDDDUTDfi&quot;</div></div><div>得到了密文。</div><div><br/></div><div>再找密钥，如果hint里的彩色图片指的是LSB隐写，那么咖啡对应的就是key.jpg里的密钥。说到咖啡就想到Java，想到Java相关的隐写工具就想到Stegsolve——但是只有单图的情况下这个基本上只能解隐写——然后就是<a href="https://github.com/ww23/BlindWatermark">Java盲水印</a>。试一下：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>D:\CTFToolkit-v1.1.0\信息隐藏\JavaBlindWaterMark&gt;java -jar BlindWatermark.jar decode -c key.jpg keyout.png</div></div><div><img src="Bugku Misc 26（125-128）_files/keyout.png" type="image/png" data-filename="keyout.png"/></div><div>得到了密钥为shumu。最后解个密：</div><div><img src="Bugku Misc 26（125-128）_files/Image [9].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div>flag：flag{zQfWGuTLPxDvZplay2}</div><div><br/></div><div><span style="font-weight: bold;">127 canyoufindme</span></div><div>题目：如何分析蚁剑的流量包特征呢？</div><div>flag1.7z的解压密码:maao@####2334</div><div>s = &amp;quot;vwxrstuopq34567ABCDEFGHIJyz012PQRSTKLMNOZabcdUVWXYefghijklmn89+/&amp;quot;</div><div><br/></div><div>下载得到pcapng格式文件，wireshark打开，导出HTTP对象列表：</div><div><img src="Bugku Misc 26（125-128）_files/Image [10].png" type="image/png" data-filename="Image.png"/></div><div>注意到时间戳靠后的数据包基本上都在访问exp.php。搜索一下字符串exp.php，发现首次出现于10065号TCP流：</div><div><img src="Bugku Misc 26（125-128）_files/Image [11].png" type="image/png" data-filename="Image.png"/></div><div>内容是通过POST请求向服务器上传了一个包含一句话木马的exp.php文件，关键变量名为ant。显然后续的操作都是在通过这个一句话木马页面进行某种操作，例如10086号TCP流：</div><div><img src="Bugku Misc 26（125-128）_files/Image [12].png" type="image/png" data-filename="Image.png"/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>ant=df2cd04f80c41QGluaV9zZXQoImRpc3BsYXlfZXJyb3JzIiwgIjAiKTtAc2V0X3RpbWVfbGltaXQoMCk7ZnVuY3Rpb24gYXNlbmMoJG91dCl7cmV0dXJuICRvdXQ7fTtmdW5jdGlvbiBhc291dHB1dCgpeyRvdXRwdXQ9b2JfZ2V0X2NvbnRlbnRzKCk7b2JfZW5kX2NsZWFuKCk7ZWNobyAiYjFjZTEiO2VjaG8gQGFzZW5jKCRvdXRwdXQpO2VjaG8gImQ4ZDRlY2VmOGQiO31vYl9zdGFydCgpO3RyeXskRD1iYXNlNjRfZGVjb2RlKCRfUE9TVFsidmJmMTBhNTAwZGU0ZTEiXSk7JEY9QG9wZW5kaXIoJEQpO2lmKCRGPT1OVUxMKXtlY2hvKCJFUlJPUjovLyBQYXRoIE5vdCBGb3VuZCBPciBObyBQZXJtaXNzaW9uISIpO31lbHNleyRNPU5VTEw7JEw9TlVMTDt3aGlsZSgkTj1AcmVhZGRpcigkRikpeyRQPSRELiROOyRUPUBkYXRlKCJZLW0tZCBIOmk6cyIsQGZpbGVtdGltZSgkUCkpO0AkRT1zdWJzdHIoYmFzZV9jb252ZXJ0KEBmaWxlcGVybXMoJFApLDEwLDgpLC00KTskUj0iCSIuJFQuIgkiLkBmaWxlc2l6ZSgkUCkuIgkiLiRFLiIKIjtpZihAaXNfZGlyKCRQKSkkTS49JE4uIi8iLiRSO2Vsc2UgJEwuPSROLiRSO31lY2hvICRNLiRMO0BjbG9zZWRpcigkRik7fTt9Y2F0Y2goRXhjZXB0aW9uICRlKXtlY2hvICJFUlJPUjovLyIuJGUtPmdldE1lc3NhZ2UoKTt9O2Fzb3V0cHV0KCk7ZGllKCk7</div><div>&amp;vbf10a500de4e1=L3d3dy9SZWN5Y2xlX2Jpbi8%3D</div></div><div>可以发现除了ant参数外，还有一个额外的参数vbf10a500de4e1，对其值进行base64解码得到：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>/www/Recycle_bin/</div></div><div>能看出来是在访问服务器上的目录，筛选一下有这一参数的数据包，提取其key和value值：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# tshark -r server-gateway.pcapng -Y &quot;urlencoded-form.key eq vbf10a500de4e1&quot; -T fields -e urlencoded-form.key -e urlencoded-form.value &gt; 1.txt</div></div><div><img src="Bugku Misc 26（125-128）_files/Image [13].png" type="image/png" data-filename="Image.png"/></div><div>可以看到，有某个数据包中多出了q0f51198e0ec92这一参数，看一下它的值：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>ant,<font color="#FF0000">q0f51198e0ec92</font>,vbf10a500de4e1    656417755882dQGluaV9zZXQoImRpc3BsYXlfZXJyb3JzIiwgIjAiKTtAc2V0X3RpbWVfbGltaXQoMCk7ZnVuY3Rpb24gYXNlbmMoJG91dCl7cmV0dXJuICRvdXQ7fTtmdW5jdGlvbiBhc291dHB1dCgpeyRvdXRwdXQ9b2JfZ2V0X2NvbnRlbnRzKCk7b2JfZW5kX2NsZWFuKCk7ZWNobyAiNjJlOGI2NjkiO2VjaG8gQGFzZW5jKCRvdXRwdXQpO2VjaG8gImM1OTYyMjgxNzRkZCI7fW9iX3N0YXJ0KCk7dHJ5eyRmPWJhc2U2NF9kZWNvZGUoJF9QT1NUWyJ2YmYxMGE1MDBkZTRlMSJdKTskYz0kX1BPU1RbInEwZjUxMTk4ZTBlYzkyIl07JGM9c3RyX3JlcGxhY2UoIg0iLCIiLCRjKTskYz1zdHJfcmVwbGFjZSgiCiIsIiIsJGMpOyRidWY9IiI7Zm9yKCRpPTA7JGk8c3RybGVuKCRjKTskaSs9MikkYnVmLj11cmxkZWNvZGUoIiUiLnN1YnN0cigkYywkaSwyKSk7ZWNobyhAZndyaXRlKGZvcGVuKCRmLCJhIiksJGJ1Zik/IjEiOiIwIik7O31jYXRjaChFeGNlcHRpb24gJGUpe2VjaG8gIkVSUk9SOi8vIi4kZS0+Z2V0TWVzc2FnZSgpO307YXNvdXRwdXQoKTtkaWUoKTs=,<font style="color: rgb(255, 0, 0);">377ABCAF271C000352C2A0EC20010000000000003C00000000000000F3EC37C03917A0E5172D24908B0CB49DB123D8AA93EEE2892C83DE440745E9F4A1187FBEB1FC369BBACF1669F73D8717EFE856D5287181CC1A4702ECA2D10749B4FF65F26863BF294249EB93B11CED4B96ECFF967966D31C786A368BEFD8B217638CD8B5C798499B06872CA8327099027D0FFA90895C49510BF444245E7D7176B6AEB014501BD606694E59EF19C3369A89622103ABC80412A7E4BA48B6A8467483E2A04EE605A2D3F5F8C2624A289BB8B6DF93EEB1A70FA05679C048EBE7B98244B5C21C9E966698B6D78134D5B778FA736FB016C336FB89EAEAD23148E0E75BD875B033F88D8337B5F2597F7CBCFE6ADA366763DBBA9564D5CA96DA355F56F2D5F4860A3B9A9FF7B708953B5F86BAE3F4ACB608433FE78BE022FE37969894797CF0B33C170680B001097000070B0100022406F1070112530FB90068BFF8C5A0322D1804B6542470CE23030101055D0000100001000C6C6A0A01AB3A2AE70000</font>,L3d3dy93d3dyb290L2RlZmF1bHQvZmxhZzEuN3o=</div></div><div>从文件头可以看出这是一个7z压缩包的十六进制格式字节数据。</div><div><br/></div><div>在十六进制编辑器中生成这一压缩包，用题目给出的密码成功解压，得到flag1.txt：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>%c2%b7%2d%2d%c2%b7%2d%2d%c2%b7%2d%2d%2d%c2%b7%c2%b7%2d%2d%c2%b7%2d%2d%c2%b7%2d%2d%c2%b7%2d%2d%c2%b7%c2%b7%c2%b7%2d%c2%b7%2d%2d%c2%b7%2d%2d%c2%b7%2d%2d%c2%b7%2d%2d%2d%2d%2d%2d%c2%b7%c2%b7%2d%2d%c2%b7%c2%b7%c2%b7%c2%b7%2d%2d%c2%b7%c2%b7%c2%b7%c2%b7%2d%c2%b7%c2%b7%c2%b7%c2%b7%2d%2d%c2%b7%c2%b7%c2%b7%2d%2d%c2%b7%2d%2d%c2%b7%2d%2d%2d%c2%b7%c2%b7%2d%2d%c2%b7%2d%c2%b7%c2%b7%2d%c2%b7%c2%b7%c2%b7%c2%b7%2d%c2%b7%2d%2d%2d%2d%2d%c2%b7%c2%b7%c2%b7%2d%c2%b7%c2%b7%2d%c2%b7%c2%b7%c2%b7%2d%2d%2d%2d%2d%c2%b7%2d%2d%2d%c2%b7%c2%b7%c2%b7%c2%b7%2d%c2%b7%2d%2d%2d%2d%2d%c2%b7%c2%b7%c2%b7%2d%2d%c2%b7%c2%b7%c2%b7%2d%2d%2d%c2%b7%c2%b7%c2%b7%2d%c2%b7%c2%b7%2d%2d%2d%c2%b7%2d%c2%b7%c2%b7%2d%2d%c2%b7%2d%c2%b7%c2%b7%2d%c2%b7%c2%b7%c2%b7%2d%2d%2d%2d%2d%c2%b7%2d%2d%c2%b7%c2%b7%2d%2d%2d%c2%b7%c2%b7%2d%2d%2d%2d%2d%c2%b7%c2%b7%c2%b7%c2%b7%2d%2d%2d%2d%2d%c2%b7%c2%b7%2d%2d%c2%b7%c2%b7%2d%c2%b7%c2%b7%2d%2d%c2%b7%c2%b7%2d%2d%2d%c2%b7%c2%b7%2d%c2%b7%c2%b7%2d%c2%b7%c2%b7%c2%b7%2d%2d%2d%c2%b7%c2%b7%c2%b7%2d%2d%2d%2d%20%c2%b7%2d%20%2d%2d%2f%2d%c2%b7%20%2d%c2%b7%2f%2d%c2%b7%20%2d%2d%2f%2d%c2%b7%20%c2%b7%2d%2f%2d%2d%20%c2%b7%2d%20%2d%2d%2f%2d%2d%20%2d%2d%20%c2%b7%c2%b7%2f%2d%c2%b7%20%c2%b7%c2%b7%2f%2d%c2%b7%20%c2%b7%c2%b7%2f%2d%c2%b7%20%c2%b7%c2%b7%2f%2d%c2%b7%20%c2%b7%2d%2f%2d%2d%20%2d%2d%20%c2%b7%c2%b7%2f%2d%c2%b7%20%2d%c2%b7%2f%2d%c2%b7%20%c2%b7%2d%2f%2d%2d%20%2d%2d%20%c2%b7%c2%b7%2f%2d%c2%b7%20%2d%c2%b7%2f%2d%2d%20%2d%2d%20%c2%b7%2d%2f%2d%c2%b7%20%c2%b7%2d%2f%2d%2d%20%2d%2d%20%c2%b7%c2%b7%2f%2d%c2%b7%20%c2%b7%2d%2f%2d%c2%b7%20%c2%b7%2d%2f%c2%b7%c2%b7%20%2d%c2%b7%2f%2d%c2%b7%20%2d%c2%b7%2f%c2%b7%c2%b7%20%2d%c2%b7%2f%2d%2d%20%2d%2d%20%c2%b7%2d%2f%c2%b7%c2%b7%20%2d%c2%b7%2f%2d%2d%20%2d%2d%20%c2%b7%c2%b7%2f%2d%2d%20%2d%2d%20%c2%b7%c2%b7%2f%2d%c2%b7%20%2d%c2%b7%2f%2d%c2%b7%20%2d%2d%2f%c2%b7%c2%b7%20%c2%b7%c2%b7%2f%c2%b7%c2%b7%20%2d%2d%2f%c2%b7%c2%b7%20%2d%2d</div></div><div>URL解码：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>·--·--·---··--·--·--·--···-·--·--·--·------··--····--····-····--···--·--·---··--·-··-····-·-----···-··-···-----·---····-·-----···--···---···-··---·-··--·-··-···-----·--··---··-----····-----··--··-··--··---··-··-···---···---- ·- --/-· -·/-· --/-· ·-/-- ·- --/-- -- ··/-· ··/-· ··/-· ··/-· ·-/-- -- ··/-· -·/-· ·-/-- -- ··/-· -·/-- -- ·-/-· ·-/-- -- ··/-· ·-/-· ·-/·· -·/-· -·/·· -·/-- -- ·-/·· -·/-- -- ··/-- -- ··/-· -·/-· --/·· ··/·· --/·· --</div></div><div>很显然是摩斯电码，奇怪之处在于几乎所有的分隔符（斜杠与空格）都集中在后半段，且均匀地每隔两位出现一次，这是字符顺序被按照特定规律打乱过的痕迹。同时基于本平台Misc分类题目热衷在莫名其妙的地方对完全不适用的文本滥用不遵守基本规则的奇特在线栅栏密码工具的习性，找了几个在线栅栏密码工具尝试了一下，发现确实有部分工具可以在密钥为2时给出一个看起来合理的解密结果：</div><div><img src="Bugku Misc 26（125-128）_files/Image [14].png" type="image/png" data-filename="Image.png"/></div><div>硬栅，就硬栅：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>·---- ··--- ·----/--··· ---··/---·· ----·/---·· ···--/·---- ··--- ·----/·---- ----- -····/---·· ·····/---·· ·····/--··· ····-/--··· ··---/·---- ·---- -····/---·· --···/--··· ···--/·---- ----- ·····/--··· --···/·---- ----- ··---/--··· ···--/·---- ----- ·····/---·· ···--/---·· ···--/····- ---··/--··· ---··/-···· --···/·---- ----- ··---/····- ---··/·---- ----- ·····/·---- ----- ····-/--··· --···/---·· ·----/-···· -····/-···· ·----/-···· ·----</div></div><div>摩斯电码转码：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>121 78 89 83 121 106 85 85 74 72 116 87 73 105 77 102 73 105 83 83 48 78 67 102 48 105 104 77 81 66 61 61</div></div><div>十进制ASCII转码：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>yNYSyjUUJHtWIiMfIiSS0NCf0ihMQB==</div></div><div>显然是base64编码，但直接解码无法得到可打印字符串，考虑到题目还给出了一个字符表，可能是经过换表的base64编码。写个脚本解码：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>print((lambda d: ''.join([chr(int(d[j: j+8], 2)) for j in range(0, len(d)-8, 8)]))(''.join([bin('vwxrstuopq34567ABCDEFGHIJyz012PQRSTKLMNOZabcdUVWXYefghijklmn89+/'.index(i))[2:].zfill(6) for i in 'yNYSyjUUJHtWIiMfIiSS0NCf0ihMQB'])))</div></div><div>运行得到flag。</div><div><br/></div><div>flag：flag{maao_is_handsome}</div><div><br/></div><div><span style="font-weight: bold;">128 简单的二维码</span></div><div><br/></div><div>下载得到png格式文件。看一下，感觉是个QR码：</div><div><img src="Bugku Misc 26（125-128）_files/file.png" type="image/png" data-filename="file.png"/></div><div>仔细看一下会发现两个特征：</div><div>1、所有的黑白色块都是圆角；</div><div>2、上方部分的黑块右边缘处多出了一些像素点，并且看起来是按行区分而不是按色块区分的。</div><div><br/></div><div>圆角部分姑且当作QR码生成器的风格，但多出来的像素点必然和隐写有联系。尤其是更进一步观察可以发现，考虑到圆角处理的前提下，所有从黑色块右边缘“伸出”的多余黑色像素点，其长度均为1，不存在长度为2或更长的“延伸”像素点。而能够通过增加1个像素点或不增加像素点所携带的信息，容易想到的有两种可能性：</div><div>1、通过多出像素点或没有多出像素点携带二进制信息；</div><div>2、增加1个像素点是为了改变某方向上像素点数量的奇偶性，通过奇偶性携带二进制信息。</div><div>第一种可能性需要获取原始图像的信息，然而该QR码的圆角处理规则略微诡异，无法确定原图的具体像素排布，暂不考虑。对于第二种可能性，由于多出的像素点很明显是沿着行方向添加的，那么按行来读取一下同色连续像素点的数量：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>from PIL import Image</div><div><br/></div><div>img = Image.open('C:/Users/Administrator/Desktop/file.png')</div><div>w, h = img.size</div><div>gc = lambda x, y: img.getpixel((x, y)) // 255</div><div><br/></div><div>black, white, count = 0, 0, []</div><div>for y in range(h):</div><div>    for x in range(w):</div><div>        if gc(x, y):</div><div>            white += 1</div><div>            if black:</div><div>                count += [f'黑 {str(black)}']</div><div>                black = 0</div><div>        else:</div><div>            black += 1</div><div>            if white:</div><div>                count += [f'白 {str(white)}']</div><div>                white = 0</div><div>for i in count[:32]:</div><div>    print(i, end=', ')</div></div><div>输出前32组：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>白 2410, 黑 58, 白 11, 黑 5, 白 21, 黑 5, 白 12, 黑 14, 白 71, 黑 6, 白 20, 黑 57, 白 19, 黑 59, 白 9, 黑 10, 白 16, 黑 8, 白 9, 黑 17, 白 69, 黑 9, 白 17, 黑 60, 白 16, 黑 61, 白 8, 黑 9, 白 17, 黑 10, 白 7, 黑 18</div></div><div>考虑奇偶性与二进制信息的转换规则，由于可打印字符二进制ASCII码开头应为0，首先猜测偶数对应0，奇数对应1。颜色方面有多种可能：不考虑颜色，仅转换黑色或仅转换白色。分别口算一下：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>不考虑颜色 00111100 10011110</div><div>仅转换黑色 01100110 01101100</div><div>仅转换白色 01101011 01110011</div></div><div>不考虑颜色的情况可以排除，黑色的情况开头是fl，白色对应ks，看起来都不是完全没可能，那就都看看：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>from PIL import Image</div><div><br/></div><div>img = Image.open('C:/Users/Administrator/Desktop/file.png')</div><div>w, h = img.size</div><div>gc = lambda x, y: img.getpixel((x, y)) // 255</div><div><br/></div><div>black, white, tmpb, tmpw = '', '', 0, 0</div><div>for y in range(h):</div><div>    for x in range(w):</div><div>        if gc(x, y):</div><div>            tmpw += 1</div><div>            if tmpb:</div><div>                black += str(tmpb % 2)</div><div>                tmpb = 0</div><div>        else:</div><div>            tmpb += 1</div><div>            if tmpw:</div><div>                white += str(tmpw % 2)</div><div>                tmpw = 0</div><div><br/></div><div>for col in [black, white]:</div><div>    for i in range(0, len(col), 8):</div><div>        if int(col[i: i + 8], 2) &gt; 127:</div><div>            break</div><div>        else:</div><div>            print(chr(int(col[i: i + 8], 2)), end='')</div><div>    print()</div></div><div>输出结果：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>flag{d@y_d@y_up_h@_h@}</div><div>ksEd</div></div><div>果然黑色比白色好。</div><div><br/></div><div>以“二值图像 游程编码”为关键词可以搜索到关于这种隐写方法的一些实现，例如<a href="https://www.cnblogs.com/YKang/p/9250960.html">二值信息隐藏（分块和游程编码实现）</a>和<a href="https://github.com/0237/Binary-Image-Information-Hiding">github.com/0237/Binary-Image-Information-Hiding</a>。</div><div><br/></div><div>flag：flag{d@y_d@y_up_h@_h@}</div></span>
</div></body></html> 