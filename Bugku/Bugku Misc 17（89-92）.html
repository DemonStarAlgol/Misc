<html>
<head>
  <title>Bugku Misc 17（89-92）</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/605894 (zh-CN, DDL); Windows/6.1.1 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="3862"/>
<h1>Bugku Misc 17（89-92）</h1>
<h2><a href="https://DemonStarAlgol.github.io/Misc/">[无关链接]</a></h2>

<div>
<span><div><span style="font-weight: bold;">89 可爱的故事</span></div><div><br/></div><div>下载得到两个png格式文件和hint.txt，先看后者：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>一‌‍‍‎‍‎‍‌‌‎‌‎‍‌‏‍‏‌‎‌‏‏‍‌‎‍‍‌‎‏‎‍‌‏‎‍‏‏‌‎‍‎‍‌‌‌‎‍‌‌‍‍‌‎‏‍‍‌‏‌‎‍‌‍‌‌‍‌‌‍‌‌‍‌‎‍‍‌‎‌‎‏‍‏‏‌‌‎‌‍‏‎‌‌‍‍‍‌‎个可爱的故事</div><div>这‍‌‍‌‎‌‏‏‍‌‎‍‌‍‍‎‏‏‌‌‏‌‌‏‌‍‍‌‎‏‍‏‏‌‏‎‎‏‌‌‍‏‍‍‌‎‏‎‌‌‌‏‎‎‎‌‍‍‎‏‎‎‏‏‍‌‌‌‏‏‍‌‌‌‏‏‍‌‌‌是一种奇怪的文字写的故事</div><div>f‍‌‎‏‎‍‌‏‎‍‏‏‌‏‎‎‏‏‌‏‎‍‎‎‌‌‍‌‌‍‌‌‍‌‎‍‌‏‌‏‎‍‌‎‏‍‍‌‏‌‎‍‌‍lag就藏在其中</div><div>flag为大兔子说的一句带bugku的话</div><div>如‌‌‎‎‌‍‌‏‎‎‏‌‌‍‏‍‏‏‍‌‎‍‌‌‎‎‌‍‌‏‎‎‏‌‌‍‏‍‏‏‍‌‎‍‌‌‌‏‏‌‌‌‍‌‎‌‍‏‌‌‏‌‍‍‌‎‍‍‎‏‍‌‎‍‍‎‏‍‍‌‎‏‎‌‌‎‎‌‎‌‍‎‎‎‍‎‌‎‌‏‌‌‏‌‌‍‌‌‍‌‌‍‌‎‌‎‌‍‏‎‌‌‍‍‍‌‎‌‌‏‍‌‎‎‏‏‍‌‌‌果找到了</div><div>就‌‌‍‏‍‌‌‍‌‎‌‍‏‌‎‏‍‍‌‏‌‎‍‌‍‌‌‏‌‎‌‍‌‏‍‌‏‎‌‍‌‌‍‎‎‌‍‏‎‌‏‌‏‎‍‎‎‍‌‍‌‍‌‍‍‍‏‌‍‌‍‌‌‍‍‏‌‌‏‍‏‏‎‍‌‏‏‎‍‏‍‌‏‎‍‎‍‍‎‎‎‍‌‏‏‌‍‌‍‌‌‌‍‌‌‎‎‌‍‏‏‍‍‍‌把他全部变成小写然后包上bugku{}</div><div>谷歌翻译的句子为支付宝红包口令(带英文)</div></div><div><br/></div><div>两张png图片里都是大量这样的字符：</div><div><img src="Bugku Misc 17（89-92）_files/Image.png" type="image/png" data-filename="Image.png"/></div><div>这是国产游戏之光米某某社的完全原创开放世界二次元软〇情氪金大作《原神》里号称原创文字“提瓦特文”的字母。毕竟日本原神里也搞了一大堆XXX字母来故弄玄虚，作为原作当然也要有。字母对照表如下：</div><div><img src="Bugku Misc 17（89-92）_files/Image.jpg" type="image/jpeg" data-filename="Image.jpg"/></div><div>可以看出来基本是拉丁字母翻转或旋转后添加一些毫无意义的点构造而成，差不多就跟游戏本身一样是完全原创的，没有任何参考和借鉴对象。根据字符表可以判断图片中的文字开头为 the little rabbit is about to go to bed ，对应关系正确。那么根据提示，需要找到大兔子一句带有bugku的话即可。换言之，只需关注引号包裹的（没错这字体虽然拿来写书，然而连标点都没有）句子中，长度为5个字符的单词，找到bugku就行了。可以很快找到这一句：</div><div><img src="Bugku Misc 17（89-92）_files/Image [1].png" type="image/png" data-filename="Image.png"/></div><div>翻译一下：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>i am learning teyvat in bugku</div></div><div><br/></div><div>flag：flag{iamlearningteyvatinbugku}</div><div><br/></div><div><span style="font-weight: bold;">90 群友们的唠嗑</span></div><div><br/></div><div>套娃猜谜缝合题。下载得到flag.001和 mi MA.txt。先看后者：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>mounting password：</div><div>(128,128,128)(0,0,0)</div><div>(255,255,255)(0,0,0)</div><div>(128,128,128)(255,255,255)</div><div><br/></div><div>(128,128,128)(255,255,255)</div><div>(0,0,0)(0,0,0)</div><div>(128,128,128)(255,255,255)</div><div><br/></div><div>(128,128,128)(255,255,255)</div><div>(0,0,0)(128,128,128)</div><div>(0,0,0)(255,255,255)</div><div><br/></div><div>hint:hex @ hue</div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;"><br/></span></div><div>fk hint:no hint more happiness</div></div><div><br/></div><div>十六进制编辑器查看flag.001：</div><div><img src="Bugku Misc 17（89-92）_files/Image [2].png" type="image/png" data-filename="Image.png"/></div><div>可以看到ADCRYPT文件头，这是AD1加密镜像的特征。用FTK Image打开，发现需要密码：</div><div><img src="Bugku Misc 17（89-92）_files/Image [3].png" type="image/png" data-filename="Image.png"/></div><div>根据提示找到<a href="https://www.dcode.fr/hexahue-cipher">hexahue</a>，正好前几天的V&amp;NCTF上也有题目用到了<a href="https://www.dcode.fr/tools-list#symbols">dcode.fr的symbols分类</a>，非常巧合。得到替换表：</div><div><img src="Bugku Misc 17（89-92）_files/Image [4].png" type="image/png" data-filename="Image.png"/></div><div>将txt中的RGB颜色矩阵转为图形，再与上表对照，可以得到密码为123。<span style="font-size: unset; color: unset; font-family: unset;">进入镜像：</span></div><div><img src="Bugku Misc 17（89-92）_files/Image [5].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div>排除部分黑群友的图片不用管，整理一下镜像内的文件内容，有几个值得关注的线索。</div><div>1、\flag\here 目录下的加密压缩包encode.rar，内含图片encode.png：</div><div><img src="Bugku Misc 17（89-92）_files/Image [6].png" type="image/png" data-filename="Image.png"/></div><div>2、回收站内有一张gif图片：</div><div><img src="Bugku Misc 17（89-92）_files/Image [7].png" type="image/png" data-filename="Image.png"/></div><div>注意到上方的 $I3PC85G.gif 文件中有如下字符串：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>G:\password\only-a-gif.gif</div></div><div>说明该gif图片是从 password 目录被删除的，很可能与密码有关。</div><div><br/></div><div>导出该gif图片，根据对出题人的了解，筛选目前国内公开CTF平台上misc题中与gif格式隐写有关的考点。可以找到BUUCTF平台的<a href="https://app.yinxiang.com/shard/s39/nl/30668439/a089fc3d-7a8d-4e8a-996a-1133054062db">蜘蛛侠呀</a>一题中出现过的gif动画帧时长隐写。用Image Magick提取该gif的帧时长：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>C:\Users\Administrator\Desktop&gt;magick identify -format &quot;%T &quot; $R3PC85G.gif</div><div>5 5 5 4 4 4 4 4 5 5 4 4 4 4 5 4 5 5 5 4 4 5 5 4 5 5 5 4 4 5 5 4 5 5 4 5 4 4 5 4</div><div>5 5 5 4 4 5 5 4 5 4 5 4 5 5 5 4 5 4 5 4 5 4 4 4 5 4 4 4 4 4 4 4 5 5 4 4 5 5 5 4</div><div>5 5 4 5 4 4 5 4 5 4 4 4 5 5 4 3 3 3 3 3</div></div><div>排除末尾的3，前95帧出现了4和5两种时长，考虑将其转为二进制0和1，再进行下一步转码。但这里由于出题人不知道用了哪个莫名其妙的在线工具，以及用完不检查的原因，隐写写入时漏掉了开头的一位0。比较有趣的是当大家都因此卡在了这一步的时候，出题人以为大家都没见识过gif动画帧时长隐写，还在群里对大家进行了亲切的嘲讽，就很有意思。转码脚本如下：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>s = '5 5 5 4 4 4 4 4 5 5 4 4 4 4 5 4 5 5 5 4 4 5 5 4 5 5 5 4 4 5 5 4 5 5 4 5 4 4 5 4 5 5 5 4 4 5 5 4 5 4 5 4 5 5 5 4 5 4 5 4 5 4 4 4 5 4 4 4 4 4 4 4 5 5 4 4 5 5 5 4 5 5 4 5 4 4 5 4 5 4 4 4 5 5 4 3 3 3 3 3'.split(' ')</div><div><br/></div><div>tmp = '0'</div><div>for i in s[:-5]:</div><div>    tmp += str(int(i) - 4)</div><div>    if len(tmp) == 8:</div><div>        print(chr(int(tmp, 2)), end = '')</div><div>        tmp = ''</div></div><div>输出结果：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>passis<font style="color: rgb(255, 0, 0);">WT@giF</font></div></div><div><br/></div><div>解压encode.rar得到encode.png：</div><div><img src="Bugku Misc 17（89-92）_files/encode.png" type="image/png" data-filename="encode.png"/></div><div>大体能看出图像以及文字的痕迹，但严重偏斜。这是因为原图的像素被放置到了错误的宽度上导致的，图像呈右上-左下偏斜，说明正确宽度比当前宽度732要小。图像失真并没有到无法识别的程度，说明正确宽度和当前宽度之间的差距不会特别大，可以手动爆破。脚本如下：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>from PIL import Image</div><div><br/></div><div>img = Image.open('C:/Users/Administrator/Desktop/encode.png')</div><div>w, h = img.size</div><div><br/></div><div>def decodei(width):</div><div>    height = w * h // width + 1</div><div>    new = Image.new('RGB', (width, height))</div><div>    for i in range(w * h):</div><div>        new.putpixel((i % width, i // width), img.getpixel((i % w, i // w)))</div><div>    new.show()</div></div><div>调用函数即可输出像素重新排列后的结果，尝试手动爆破：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>decodei(720)</div><div># 变为左上-右下偏斜，说明过小了</div><div>decodei(726)</div><div># 略带左上-右下偏斜，实际上已经能够识别</div><div>decodei(727)</div><div># 完美</div></div><div>输出结果：</div><div><img src="Bugku Misc 17（89-92）_files/new.png" type="image/png" data-filename="new.png"/></div><div><br/></div><div>flag：flag{希望大家不要不识抬举}</div><div><br/></div><div><span style="font-weight: bold;">91 split_all</span></div><div><br/></div><div>下载得到png格式文件，十六进制编辑器查看：</div><div><img src="Bugku Misc 17（89-92）_files/Image [8].png" type="image/png" data-filename="Image.png"/></div><div>除文件头以外并不符合PNG格式规范，从89a以及文件末尾的3B字节可以判断实际为gif格式。修复文件头：</div><div><img src="Bugku Misc 17（89-92）_files/Image [9].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div>得到gif格式图片，图片大小为1x432，共有770帧：</div><div><img src="Bugku Misc 17（89-92）_files/Image [10].png" type="image/png" data-filename="Image.png"/></div><div>尝试提取每帧后横向拼合：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>from PIL import Image</div><div><br/></div><div>img = Image.open('C:/Users/Administrator/Desktop/file.gif')</div><div>new = Image.new('RGB', (770, img.size[1]))</div><div>for i in range(770):</div><div>    img.seek(i)</div><div>    new.paste(img, (i, 0))</div><div>new.save('C:/Users/Administrator/Desktop/new.png')</div></div><div>输出结果：</div><div><img src="Bugku Misc 17（89-92）_files/new [1].png" type="image/png" data-filename="new.png"/></div><div><br/></div><div>flag：flag{9f019c27eca746beb9c297cd70bf93ca}</div><div><br/></div><div><span style="font-weight: bold;">92 泡菜</span></div><div><br/></div><div>下载得到加密压缩包mz.rar和jpg格式文件。先看后者，十六进制编辑器打开，文件尾后有额外数据：</div><div><img src="Bugku Misc 17（89-92）_files/Image [11].png" type="image/png" data-filename="Image.png"/></div><div>从开头的42 50 47(BPG)字节可以看出是bpg格式图片。题外话，BUUCTF平台的<a href="https://buuoj.cn/challenges#Business%20Planning%20Group">Business Planning Group</a>这题已经至少是2019年10月份的事了，但不知为何最近bpg格式又开始广受部分出题人欢迎，大批量出现在各种套娃缝合题当中。总之将额外数据提取后保存，再用<a href="https://bellard.org/bpg/">bpg格式官方工具包</a>中的 bpgdec.exe 工具转为png格式图片：</div><div><img src="Bugku Misc 17（89-92）_files/out.png" type="image/png" data-filename="out.png"/></div><div>得到解压密码：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>QQ@93388</div></div><div><br/></div><div>解压mz.rar，得到又一个加密压缩包secret.rar和key.png。毕竟最高端的套娃往往使用最朴实的手法，看到一层又一层加密压缩包基本也应该有点心理准备了。先看key.png：</div><div><img src="Bugku Misc 17（89-92）_files/key.png" type="image/png" data-filename="key.png"/></div><div>传说中的“出题时<a href="https://www.dcode.fr/tools-list#symbols">https://www.dcode.fr/tools-list#symbols</a>随机找，做题时<a href="https://www.dcode.fr/tools-list#symbols">https://www.dcode.fr/tools-list#symbols</a>挨个翻”类型题目，可能是从<a href="https://buuoj.cn/challenges#[VNCTF%202021]HAPPYNEWYEAR">[VNCTF 2021]HAPPYNEWYEAR</a>得到的灵感吧。总之答案是<a href="https://www.dcode.fr/mary-stuart-code">Mary Stuart Code</a>，苏格兰女王玛丽·斯图亚特被当时的英格兰女王伊丽莎白一世软禁时，为了与外界通信使用了这种密码。替换表如下：</div><div><img src="Bugku Misc 17（89-92）_files/alphabet.png" type="image/png" data-filename="alphabet.png"/></div><div>对应替换：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>thekeyismumuzinbtql</div></div><div>然而原密码表里the和is这类常用词都是有特殊符号的，这不就完全用错了吗，大概也能看出的确是随机找的图形替换密码，连密码表都没认真研究就直接硬上了。无论如何得到解压密码，要大写：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>MUMUZINBTQL</div></div><div><br/></div><div>继续解压得到加密压缩包next.rar和key.txt，最高端的套娃往往使用（略）。先看后者：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>G21</div><div>G90</div><div>G92</div><div>M05</div><div>G1 X151.69 Y133.53 F3000</div><div>M03</div><div>G1 X149.77 Y131.56 F300</div><div>G1 X148.36 Y128.64 F300</div><div>……</div><div>G1 X142.11 Y123.17 F300</div><div>G1 X141.98 Y115.77 F300</div><div>M05</div><div>M05</div></div><div>大部分行以G1开头，后接X Y F三个参数，这是控制数控机床的G代码（G-code），参见<a href="https://buuoj.cn/challenges#[INSHack2019]gflag">[INSHack2019]gflag</a>一题，也算是终于缝合到国外题目了。把代码放进<a href="https://ncviewer.com/" style="font-size: unset; font-family: unset;">在线解释器</a>运行，调整角度和方位得到结果：</div><div><img src="Bugku Misc 17（89-92）_files/Image [12].png" type="image/png" data-filename="Image.png"/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>MUMUZIYYDS!@#</div></div><div><br/></div><div>继续解压得到fl.txt和hint.txt。先看后者：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>题目好像挺有意思的</div><div>不套了，解出来即为flag</div></div><div>前者直接打开为乱码，十六进制编辑器打开：</div><div><img src="Bugku Misc 17（89-92）_files/Image [13].png" type="image/png" data-filename="Image.png"/></div><div>结合提示和题目名称，可以知道这是Python序列化对象，用Pickle模块实现。具体可以参见BUUCTF的<a href="https://buuoj.cn/challenges#%E6%88%91%E7%88%B1Linux">我爱Linux</a>一题及相关的Writeup。用Python将其反序列化：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>import pickle</div><div><br/></div><div>file = open('C:/Users/Administrator/Desktop/fl.txt', 'rb').read()</div><div>print(pickle.loads(file))</div></div><div>输出结果：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>155887669915588766991558876699155887669915588766991558876699155887669915588766991558876699155887669915588766991558876699155887669915588766991558876699155887669915588766991558876699155887669915588766991558876699155887669915588766991558876699155887669915588766991558876699155887669915588766991558876699155887669915588766991558876699155887669915588766991558876699155887669915588766991558876699155887669915588766991558876699155887669915588766991558876699155887669915588766991558876699</div><div>（对，确实是同样的十个数字重复了48遍）</div></div><div>最后来到了本题的原创部分，把一直重复的十个数字拿出来包上flag格式就得到了最终flag。虽然没有任何提示，对于新手来说可能会感觉有点突兀，但可以说十分考验思维灵活性，要在完全没有任何信息的前提下准确地猜中出题人的哑谜。而且算一算发现，做这一题相当于做了别的四道题，是质量很棒的题目了。</div><div><br/></div><div>flag：bugku{1558876699}</div></span>
</div></body></html> 