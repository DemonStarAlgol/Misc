<html>
<head>
  <title>Bugku Misc 11（65-68）</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/605894 (zh-CN, DDL); Windows/6.1.1 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="3306"/>
<h1>Bugku Misc 11（65-68）</h1>
<h2><a href="https://DemonStarAlgol.github.io/Misc/">[无关链接]</a></h2>

<div>
<span><div><span style="font-weight: bold;">65 蜘蛛侠</span></div><div><br/></div><div>下载得到rar格式文件，查看压缩包：</div><div><img src="Bugku Misc 11（65-68）_files/Image.png" type="image/png" data-filename="Image.png"/></div><div>注释中包含一段苏州码子（从使用竖写的1来看，可能是受到了《神探夏洛克》中错误用法的误导）：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>〤〤〡十〦〩〩〨十〡</div></div><div>对应大写数字（Capital Num）为：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">肆肆壹拾陆玖玖捌拾壹</span></div></div><div>解压得到四个文件。<span style="font-size: unset; color: unset; font-family: unset;">先看hint.txt：</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>key.jpg数据被py加密啦！！！</div><div>解密还原成file.jpg吧</div></div><div><br/></div><div>查看encode.py：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>import os</div><div>data_jpg = open('key.jpg','wb')</div><div>def jpg_encode():</div><div>    with open('file.jpg','rb') as handle:</div><div>        size = os.path.getsize('file.jpg')</div><div>        print(size)</div><div>        i = 0</div><div>        while i&lt;size:</div><div>            bytedata = handle.read(1)</div><div>            process_data = data_encode(bytedata)</div><div>            data_write(process_data)</div><div>            i = i + 1</div><div><br/></div><div>def data_encode(bytedata):</div><div>    data = int.from_bytes(bytedata,byteorder='big')</div><div>    if (data % 2 == 0):</div><div>        data = (data + 1) ^ 128</div><div>    else:</div><div>        data = (data - 1) ^ 128</div><div>    data = bytes([data])</div><div>    return data</div><div><br/></div><div>def data_write(process_data):</div><div>    data_jpg.write(process_data)</div><div><br/></div><div>if __name__ == '__main__':</div><div>    jpg_encode()</div><div>    data_jpg.close()</div></div><div>可以看出加密过程为：逐字节读取原文件，每个字节若为偶数，则加1再与128异或，否则减1再与128异或。由于奇数与128异或结果为奇数，偶数与128异或结果为偶数，可以根据异或结果的奇偶性推断原始文件对应字节的奇偶性。解密脚本如下：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>f = open('C:/Users/Administrator/Desktop/spider-man/key.jpg', 'rb').read()</div><div>res = open('C:/Users/Administrator/Desktop/spider-man/file.jpg', 'ab')</div><div><br/></div><div>for i in range(len(f)):</div><div>    if f[i] % 2 == 1:</div><div>        b = (f[i] ^ 128) - 1</div><div>    else:</div><div>        b = (f[i] ^ 128) + 1</div><div>    res.write(b.to_bytes(1, 'big'))</div></div><div>还原得到file.jpg：</div><div><img src="Bugku Misc 11（65-68）_files/file.jpg" type="image/jpeg" data-filename="file.jpg"/></div><div>十六进制编辑器打开，文件尾发现额外数据：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>IQ2?kEcY/KK#ojDrHoR'seB</div></div><div>显然是base92编码，解码得到：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>password:SilentEye</div></div><div><br/></div><div>最后用SilentEye提取flag.jpg中的隐写信息得到flag：</div><div><img src="Bugku Misc 11（65-68）_files/Image [1].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div>flag：<span style="text-indent: 0px;">flag{spider-man_is_really_cool}</span></div><div><br/></div><div><span style="text-indent: 0px; font-weight: bold;">66 </span><span style="font-weight: bold;">Improve yourself</span></div><div><br/></div><div>下载得到zip格式文件，为一加密压缩包：</div><div><img src="Bugku Misc 11（65-68）_files/Image [2].png" type="image/png" data-filename="Image.png"/></div><div>注意到其中4个txt格式文件的大小均不大于6字节，尝试CRC32碰撞（已去掉无关结果）：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# python crc32.py reverse 0x8e234ae0</div><div>alternative 6 bytes:</div><div>alternative: bugku_ (OK)</div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;"><br/></span></div><div>root@kali:~/Desktop# python crc32.py reverse 0xb3a8622c</div><div>alternative 6 bytes:</div><div>alternative: youare (OK)</div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;"><br/></span></div><div>root@kali:~/Desktop# python crc32.py reverse 0x0478ad1a</div><div>alternative 6 bytes:</div><div>alternative: pretty (OK)</div><div><br/></div><div>root@kali:~/Desktop# python crc32.py reverse 0x6c844e92</div><div>4 bytes: {0x67, 0x6f, 0x6f, 0x64}</div><div>verification checksum: 0x6c844e92 (OK)</div><div>good</div></div><div>拼接得到压缩包密码：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>bugku_youareprettygood</div></div><div>解压得到另一个加密zip压缩包和一张png格式图片。</div><div><br/></div><div>先看图片：</div><div><img src="Bugku Misc 11（65-68）_files/next zip passwd.png" type="image/png" data-filename="next zip passwd.png"/></div><div>是John Horton Conway提出的元胞自动机规则Game of Life。用<a href="http://home.ustc.edu.cn/~zzzz/lifegame/lifegame.html">在线工具</a>按图片绘制后进行单步演化，例如：</div><div><img src="Bugku Misc 11（65-68）_files/Image [3].png" type="image/png" data-filename="Image.png"/><img src="Bugku Misc 11（65-68）_files/Image [4].png" type="image/png" data-filename="Image.png"/></div><div>即密码的第七位为数字8，重复操作得到密码为012369849。当然已知密码是9位数字的情况下爆破也是很快的：</div><div><img src="Bugku Misc 11（65-68）_files/Image [5].png" type="image/png" data-filename="Image.png"/></div><div>解压得到flag.exe和jpg格式图片。</div><div><br/></div><div>十六进制编辑器查看jpg格式图片，在文件尾后发现额外数据：</div><div><img src="Bugku Misc 11（65-68）_files/Image [6].png" type="image/png" data-filename="Image.png"/></div><div>将额外数据输入到浏览器地址栏中转为png格式图片，得到：</div><div><img src="Bugku Misc 11（65-68）_files/download.png" type="image/png" data-filename="download.png"/></div><div>补全二维码定位符后仍然无法扫描。注意到jpg文件的文件名mask=0，将该二维码的Format Info Pattern修改为Error Correction Level = L，Mask Pattern = 0：</div><div><img src="Bugku Misc 11（65-68）_files/Image [7].png" type="image/png" data-filename="Image.png"/></div><div>扫码得到：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>a1s2d3f4g5</div></div><div><br/></div><div>十六进制编辑器查看flag.exe，发现实际为zip格式压缩包，重命名后打开，用上述密码解压，得到flag.exe。再次十六进制编辑器打开，发现实际为文本：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>bugku{go0d_go0d_5tUdy_Day_D@y_Up}</div></div><div><br/></div><div>flag：bugku{go0d_go0d_5tUdy_Day_D@y_Up}</div><div><br/></div><div><span style="font-weight: bold;">67 神奇宝贝</span></div><div><br/></div><div>下载得到rar格式文件，直接解压报错，十六进制编辑器查看：</div><div><img src="Bugku Misc 11（65-68）_files/Image [8].png" type="image/png" data-filename="Image.png"/></div><div>发现实际是zip格式的文件头，将前四个字节改为50 4B 03 04,。解压得到另一个zip压缩包和jpg格式图片。</div><div><br/></div><div>先看图片：</div><div><img src="Bugku Misc 11（65-68）_files/神奇宝贝.jpg" type="image/jpeg" data-filename="神奇宝贝.jpg"/></div><div>这是《精灵宝可梦》系列中全国图鉴No.201的宝可梦<a href="https://wiki.52poke.com/wiki/%E6%9C%AA%E7%9F%A5%E5%9B%BE%E8%85%BE">未知图腾</a>，其外观像是古代文字，拥有28种不同形态，分别对应26种英文字母和问号、感叹号。对照得到上图文字为：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>whereisflag</div></div><div>用该密码解压zip压缩包，得到第三个zip压缩包和层层加密.txt。</div><div><br/></div><div>先看txt：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>00111 1010 00001 0 11110 00011 100 100 11100 00111 11111 1000 1010 01 01 1000 100 00000 00000 00111 0 11000 00001 00000 11000 1000 10000 11110 11111 11100 0010 10000</div><div><br/></div><div>国王把明文撒了盐之后交给士兵，士兵在途中经过了两个交叉的篱笆地才将密文传交给摩斯侦探。</div></div><div>首先摩斯电码解码：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>2C4E93DD820BCAABD552E7457B6908F6</div></div><div>然后普通形式的栅栏密码，栏数为2，解密两次，得到：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>298CDE70C32A57B84D0A546FEDBB2596</div></div><div>利用MD5<a href="https://www.somd5.com/">反查网站</a>，得到明文：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>PassW0rd</div></div><div><br/></div><div>用该密码解压zip压缩包，得到jpg格式图片：</div><div><img src="Bugku Misc 11（65-68）_files/美丽的风景.jpg" type="image/jpeg" data-filename="美丽的风景.jpg"/></div><div>文字部分为：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>MTM4NDAwMjE4MTYxNTg5Nzc2ODk2NzcxOTYyMTQzMTgzMzcwNjU0Njg0NDU1MTk4MzcwOTk3ODA3NDU1MDUzMjI1OTc5MTI2Mj</div><div>UxMDM4MjY3MDU5NzU4OTQ0MzAxNTQ2Nzg0OTU2MTY1NTUxMTQ4MDMxNzE4MDg4NzM4ODA1MzgyNDgyOTE0MTEwMTA5MzMxNTI4Mzg0OTI4OTM5MzgxMjg3MzA2MDE4NjExNDEyNTE2ODM4MzcyNjUzMzkz</div></div><div>base64转码得到：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>138400218161589776896771962143183370654684455198370997807455053225979126251038267059758944301546784956165551148031718088738805382482914110109331528384928939381287306018611412516838372653393</div></div><div>作为十进制数字，转二进制数字后位数正好为625，且开头有大量1，考虑将其转为黑白两色图片，1对应黑色，0对应白色：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>n = 138400218161589776896771962143183370654684455198370997807455053225979126251038267059758944301546784956165551148031718088738805382482914110109331528384928939381287306018611412516838372653393</div><div>s = str(bin(n))[2:]</div><div>print(len(s))</div><div><br/></div><div>from PIL import Image</div><div><br/></div><div>img = Image.new('1', (25, 25))</div><div>for i in range(len(s)):</div><div>    x = i % 25</div><div>    y = i // 25</div><div>    if s[i] == '1':</div><div>        img.putpixel((x, y), 0)</div><div>    elif s[i] == '0':</div><div>        img.putpixel((x, y), 255)</div><div>img.show()</div></div><div>得到二维码（已放大）：</div><div><img src="Bugku Misc 11（65-68）_files/Image [9].png" type="image/png" data-filename="Image.png"/></div><div>扫码得到flag。</div><div><br/></div><div>flag：bugku{wHat_a_iMagE_QR}</div><div><br/></div><div><b>68 贝斯手</b></div><div><br/></div><div>下载得到flag.zip、介绍.txt和一张jpg格式图片。先看txt：</div><div><img src="Bugku Misc 11（65-68）_files/Image [10].png" type="image/png" data-filename="Image.png"/></div><div>注意右边的滚动条，拖到最下方找到提示：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>密码我4不会告诉你的，除非你知道我的女神是哪一年出生的</div><div>给你个提示：申猴，闰年</div></div><div>最近的一个农历申猴年是2016年，正好也是闰年，上一个同为闰年的申猴年为24年前的1992年。</div><div><br/></div><div>以1992为密码解压flag.zip，得到flag.txt：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>5+58==327a6c4304ad5938eaf0efb6cc3e53dcCFmZknmK3SDEcMEue1wrsJdqqkt7dXLuS</div></div><div>其中的58容易联想到base58，尝试将出现大写字母的部分进行base58解码：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>CFmZknmK3SDEcMEue1wrsJdqqkt7dXLuS</div><div>{this_is_md5_and_base58}</div></div><div>从而前半部分应该是md5，通过在线网站进行反查，得到：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>327a6c4304ad5938eaf0efb6cc3e53dc</div><div>flag</div></div><div>拼接得到flag。</div><div><br/></div><div>flag：flag{this_is_md5_and_base58}</div></span>
</div></body></html> 