<html>
<head>
  <title>Bugku Misc 28（133-136）</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/605894 (zh-CN, DDL); Windows/6.1.1 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="8459"/>
<h1>Bugku Misc 28（133-136）</h1>
<h2><a href="https://DemonStarAlgol.github.io/Misc/">[无关链接]</a></h2>

<div>
<span><div><span style="font-weight: bold;">133 图片里的中文</span></div><div><br/></div><div>下载得到加密的zip格式压缩包和tip.txt。先看后者：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>腐烂了47天了</div></div><div>压缩包本身有注释：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>p55 ds 9@?6J E@ &gt;6</div></div><div>ROT47：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>Add 5D honey to me</div></div><div><br/></div><div>我翻开英汉字典一查，这句子没有语法，歪歪斜斜的每页上都写着“加5D蜜给我”几个字。我横竖睡不着，仔细看了半夜，才从字缝里看出字来，满本都写着三个字“打哑谜”。<span style="font-size: unset; color: unset; font-family: unset;">就很炫（此处炫字取本意，没有暗示出题人出题像某同名CTF大神的意思）。</span></div><div>猜了半天，最后发现原来是要计算原始注释字符串的32位MD5值，不愧是Musc分类的题：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>e950c89788db4042193830f49d273512</div></div><div><br/></div><div>然后用这段MD5值作为密码解压压缩包，得到key.png和password.txt。先看后者：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>AecvWpF9YinwVc7tvKfCGWt28oYiucpd5MEWhghGaaLWKfgTEywz5hmRREEi</div></div><div>这是什么呢，这是一段国内某些在线工具使用了不常见的base58字符表生成的base58编码。常用的base58编码字符表主要有两个：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>虚拟货币Bitcoin和Monero地址使用的字符表：</div><div>123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz</div><div>虚拟货币Ripple地址使用的字符表：</div><div>rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz</div></div><div>而本题使用的字符表则是：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>部分国内在线工具号称使用Bitcoin字符表实际上却使用的这个，通常只在Flickr短链接中使用的字符表：</div><div>123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ</div></div><div>字符表间的差异参见<a href="https://www.darklaunch.com/base58-encode-and-decode-using-php-with-example-base58-encode-base58-decode.html">这个链接</a>。根据我在Github的<a href="https://github.com/search?q=123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ&amp;type=code">搜索结果</a>，很多PHP项目都直接使用了这个页面上的范例函数，其中编码的正是Flickr字符表。不知道国内在线工具们是不是也同样直接引用了现成的函数，导致<a href="http://www.atoolbox.net/Tool.php?Id=932">部分工具</a>甚至出现了介绍中使用Bitcoin字符表，实际编解码使用Flickr字符表的情况。生动形象地体现了出题人瞎JB用工具，做题人查资料查断腿的中心思想。</div><div><br/></div><div>总之用大部分默认对应Bitcoin和Ripple字符表的工具例如Python库和Cyberchef等是解码不出这段base58编码的。要么用正好跟出题人一样的国产在线工具，要么自己改字符表：</div><div><img src="Bugku Misc 28（133-136）_files/Image.png" type="image/png" data-filename="Image.png"/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>iEeWwc2oGX/DzzdaM1/tdvaWGRodocuXoPMJpAUYMaI=</div></div><div>明显是base64编码，直接解码无法得到可打印字符串，根据对出题人风格的揣测，大概又是用哪个在线工具生成的某种现代密码的base64形式密文。那么还需要找到密钥，看key.png：</div><div><img src="Bugku Misc 28（133-136）_files/key.png" type="image/png" data-filename="key.png"/></div><div>根据题目名称提示，以图搜图找到该幕镜头对应的中文台词：</div><div><img src="Bugku Misc 28（133-136）_files/v2-6e0f4404c53f2fcfdc20f3ceb503a8c0_1440w.jpg" type="image/jpeg" data-filename="v2-6e0f4404c53f2fcfdc20f3ceb503a8c0_1440w.jpg"/></div><div>然后经过一番尝试终于找到了出题人用的<a href="http://tool.chacuo.net/cryptaes">在线工具</a>，解密得到flag：</div><div><img src="Bugku Misc 28（133-136）_files/Image [1].png" type="image/png" data-filename="Image.png"/></div><div>注意密码里的那个问号是半角字符，令人不禁疑心出题人对“中文”两个字的定义是否有什么创新。</div><div><br/></div><div>最后一个槽点，压缩包里的两个文件，key.png对应的是密钥，这没啥问题，但password.txt对应的是密文……</div><div>希望出题人了解一下，password是验证身份用的<span style="font-weight: bold;">密码</span>，加解密里的<span style="font-weight: bold;">密文</span>是ciphertext或cipher。写到这里，我终于也想明白题目开头那个英文哑谜为何如此炫了。</div><div><br/></div><div>flag：bugku{s@_rEn_Bi_xU_zhuxin_doge}</div><div>这题就不交了，不然被问“这么神奇的题目你怎么解出flag的？”还得解释半天，累了。出题人和一血二血同一个战队的自己人玩得开心就行。</div><div><br/></div><div><span style="font-weight: bold;">134 look</span></div><div><br/></div><div>下载得到bmp格式文件。直接打开报错，十六进制编辑器 看一下：</div><div><img src="Bugku Misc 28（133-136）_files/Image [2].png" type="image/png" data-filename="Image.png"/></div><div>是个zip。解压得到真正的look.bmp，Stegsolve看一下：</div><div><img src="Bugku Misc 28（133-136）_files/Image [3].png" type="image/png" data-filename="Image.png"/></div><div>R/G/B Plane 0左上角都有LSB隐写痕迹，zsteg一把梭即可：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# zsteg -a look.bmp</div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">……（前略）</span></div><div>b1,r,lsb,xy         .. text: &quot;'flag{3c15d07e-'&quot;</div><div>b1,g,lsb,xy         .. text: &quot;'5d9a-4ccb-b67c'&quot;</div><div>b1,b,lsb,xy         .. text: &quot;'-d2369eb2c1b9}'&quot;</div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">……（后略）</span></div></div><div><br/></div><div>flag：flag{3c15d07e-5d9a-4ccb-b67c-d2369eb2c1b9}</div><div><br/></div><div><span style="font-weight: bold;">135 黑客的照片</span></div><div><br/></div><div>下载得到png格式文件。十六进制编辑器查看，文件尾后有额外数据：</div><div><img src="Bugku Misc 28（133-136）_files/Image [4].png" type="image/png" data-filename="Image.png"/></div><div>得到字符串：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>flag{m1s</div></div><div>以及后面似乎还跟着zip格式压缩包。</div><div><br/></div><div>foremost分解得到两个zip格式压缩包，其中一个是加密压缩包，另一个内含this_is_passwd.txt：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>e = 65537</div><div>p = 164350308907712452504716893470938822086802561377251841485619431897833167640001783092159677313093192408910634151587217774530424780799210606788423235161145718338446278412594875577030585348241677399115351594884341730030967775904826577379710370821510596437921027155767780096652437826492144775541221209701657278949</div><div>q = 107494571486621948612091613779149137205875732174969005765729543731117585892506950289230919634697561179755186311617524660328836580868616958686987611614233013077705519528946490721065002342868403557070176752015767206263130391554820965931893485236727415230333736176351392882266005356897538286240946151616799180309</div><div>c = 17210571768112859512606763871602432030258009922654088989566328727381190849684513475124813364778051200650944085160387368205190094114248470795550466411940889923383014246698624524757431163133844451910049804985359021655893564081185136250014784383020061202277758202995568045817822133418748737332056585115499621035958182697568687907469775302076271824469564025505064692884524991123703791933906950170434627603154363327534790335960055199999942362152676240079134224911013272873561710522794163680938311720454325197279589918653386378743004464088071552860606302378595024909242096524840681786769068680666093033640022862042786586612</div><div>#longs_to_bytes(m) = passwd</div></div><div>显然是RSA，基础的解密脚本套一下：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>from gmpy2 import invert</div><div>from Crypto.Util.number import long_to_bytes</div><div><br/></div><div>n = p * q</div><div>phi = (p - 1) * (q - 1)</div><div>d = invert(e, phi)</div><div>m = pow(c, d, n)</div><div>print(long_to_bytes(m))</div></div><div>运行结果：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>b'passwd:I_1ove_mumuz1!'</div></div><div>解压另一个加密压缩包，得到flag2.jpg和flag3.png。</div><div><br/></div><div>接下来flag2.jpg改高度为1200以上可以得到另一段字符串：</div><div><img src="Bugku Misc 28（133-136）_files/flag2.jpg" type="image/jpeg" data-filename="flag2.jpg"/></div><div><br/></div><div>用Stegsolve打开flag3.png，在R/G/B Plane 1和0的左上角可以看见LSB隐写痕迹：</div><div><img src="Bugku Misc 28（133-136）_files/Image [5].png" type="image/png" data-filename="Image.png"/></div><div>尝试直接提取没有找到有意义内容，联想到隐写工具stegpy的默认设置即为隐写三个颜色通道的低2位（也可以设置参数改为最低1位或者低4位，参见stegpy的说明文档），尝试用stegpy提取隐写信息：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# stegpy flag3.png</div><div>sc_d0n't_love_me}</div></div><div>最后拼接得到flag。</div><div><br/></div><div>flag：flag{m1s3_1s_eas3_bu1_misc_d0n't_love_me}</div><div>必须严肃指出的是该flag使用的leetspeak正字法明显存在问题。</div><div><br/></div><div><span style="font-weight: bold;">136 学不会jvav我哭辽</span></div><div><br/></div><div>下载得到flag.pcapng和加密压缩包flag.rar，wireshark打开前者看一下：</div><div><img src="Bugku Misc 28（133-136）_files/Image [6].png" type="image/png" data-filename="Image.png"/></div><div>10565个数据包，甚至有OICQ协议，出题人真的是坦诚相待，把这段时间自己电脑的全部流量打包奉上了，完全没把做题的当外人……令人不禁想起一位出流量题出到百度网盘cookies被人拿了的大佬。</div><div><br/></div><div>总之先搜一波字符串：</div><div><img src="Bugku Misc 28（133-136）_files/Image [7].png" type="image/png" data-filename="Image.png"/></div><div>从6624和6633包都可以看出来MySQL流量比较可疑。过滤一下协议然后挨个排查，在TCP流32里找到：</div><div><img src="Bugku Misc 28（133-136）_files/Image [8].png" type="image/png" data-filename="Image.png"/></div><div>可以看到这部分返回数据里夹杂了一些数字：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>345 257 206 347 240 201 346 230 257 40 134 56 56 155 151 153 157 111 154 61 56 56 57</div></div><div>全程没有出现8和9，很显然是八进制数字，因为出现了345这种明显不在ASCII可打印字符范围内的，挨个转字节再UTF-8转码：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>s = '345 257 206 347 240 201 346 230 257 40 134 56 56 155 151 153 157 111 154 61 56 56 57'</div><div>s = bytes([int(i, 8) for i in s.split(' ')])</div><div>print(s.decode('UTF-8'))</div><div><br/></div><div># 密码是 \..mikoIl1../</div></div><div><br/></div><div>用这个密码解压flag.rar得到TnT.exe，直接运行，提示输入密码：</div><div><img src="Bugku Misc 28（133-136）_files/Image [9].png" type="image/png" data-filename="Image.png"/></div><div>nana和miko两个名字都在之前的MySQL流量里出现过：</div><div><img src="Bugku Misc 28（133-136）_files/Image [10].png" type="image/png" data-filename="Image.png"/></div><div>然后是猜谜时间，按nana和miko的顺序把两个密码连接一下：</div><div><img src="Bugku Misc 28（133-136）_files/Image [11].png" type="image/png" data-filename="Image.png"/></div><div>YYOS是什么啦YYOS。</div><div><br/></div><div>flag：flag{Jvav_1s_YYOS!}</div></span>
</div></body></html> 