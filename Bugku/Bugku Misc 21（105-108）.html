<html>
<head>
  <title>Bugku Misc 21（105-108）</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/605894 (zh-CN, DDL); Windows/6.1.1 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="4372"/>
<h1>Bugku Misc 21（105-108）</h1>
<h2><a href="https://DemonStarAlgol.github.io/Misc/">[无关链接]</a></h2>

<div>
<span><div><span style="font-weight: bold;">105 where is flag 3</span></div><div><br/></div><div>下载得到zip格式文件，内含18个txt文本和一张png格式图片：</div><div><img src="Bugku Misc 21（105-108）_files/Image.png" type="image/png" data-filename="Image.png"/></div><div>尝试常见的伪加密、爆破等方法均无效，联想到同一系列的其他题目，猜测隐藏的信息可能在18个txt文件的属性中。而出题人能够控制，且在加密压缩包中仍然能暴露出来的属性，仅有文件名、文件大小和修改时间三项。文件名是简单的fake0-fakf7组合，文件大小尝试后也无法得到有效线索，看一下文件的修改时间：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>import zipfile</div><div><br/></div><div>f = zipfile.ZipFile('C:/Users/Administrator/Desktop/where if flag3.zip')</div><div>for i in f.infolist():</div><div>    print(i.filename, i.date_time)</div></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>fake0.txt (2021, 5, 21, 8, 15, 12)</div><div>fake1.txt (2021, 5, 21, 8, 15, 20)</div><div>fake2.txt (2021, 5, 21, 8, 15, 0)</div><div>fake3.txt (2021, 5, 21, 8, 15, 6)</div><div>fake4.txt (2021, 5, 21, 8, 15, 16)</div><div>fake5.txt (2021, 5, 21, 8, 14, 26)</div><div>fake6.txt (2021, 5, 21, 8, 15, 8)</div><div>fake7.txt (2021, 5, 21, 8, 15, 16)</div><div>fake8.txt (2021, 5, 21, 8, 14, 10)</div><div>fake9.txt (2021, 5, 21, 8, 14, 10)</div><div>fakf0.txt (2021, 5, 21, 8, 14, 16)</div><div>fakf1.txt (2021, 5, 21, 8, 14, 16)</div><div>fakf2.txt (2021, 5, 21, 8, 14, 10)</div><div>fakf3.txt (2021, 5, 21, 8, 14, 10)</div><div>fakf4.txt (2021, 5, 21, 8, 14, 12)</div><div>fakf5.txt (2021, 5, 21, 8, 14, 8)</div><div>fakf6.txt (2021, 5, 21, 8, 14, 12)</div><div>fakf7.txt (2021, 5, 21, 8, 14, 12)</div><div>flag is here .png (2021, 5, 21, 9, 9, 10)</div></div><div>可以看到txt文件的修改时间确实存在轻微差异，可以携带信息，但给出的年-月-日-时-分-秒中难以看出规律，尝试将其格式进行转换，先转换为时间戳：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>import zipfile</div><div>import time</div><div><br/></div><div>f = zipfile.ZipFile('C:/Users/Administrator/Desktop/where if flag3.zip')</div><div>for i in f.infolist():</div><div>    print(i.filename, time.mktime(tuple(i.date_time + (0, 0, 0))))</div></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>fake0.txt 1621556112.0</div><div>fake1.txt 1621556120.0</div><div>fake2.txt 1621556100.0</div><div>fake3.txt 1621556106.0</div><div>fake4.txt 1621556116.0</div><div>fake5.txt 1621556066.0</div><div>fake6.txt 1621556108.0</div><div>fake7.txt 1621556116.0</div><div>fake8.txt 1621556050.0</div><div>fake9.txt 1621556050.0</div><div>fakf0.txt 1621556056.0</div><div>fakf1.txt 1621556056.0</div><div>fakf2.txt 1621556050.0</div><div>fakf3.txt 1621556050.0</div><div>fakf4.txt 1621556052.0</div><div>fakf5.txt 1621556048.0</div><div>fakf6.txt 1621556052.0</div><div>fakf7.txt 1621556052.0</div><div>flag is here .png 1621559350.0</div></div><div>可以看到时间戳整数部分的末三位出现了很明显的十进制ASCII码，尝试转码：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>import zipfile</div><div>import time</div><div><br/></div><div>f = zipfile.ZipFile('C:/Users/Administrator/Desktop/where if flag3.zip')</div><div>for i in f.infolist():</div><div>    if 'fak' in i.filename:</div><div>        print(chr(int(time.mktime(tuple(i.date_time + (0, 0, 0)))) % 1000), end = '')</div></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>pxdjtBlt2288224044</div></div><div>然而并不对……</div><div><br/></div><div>用7-Zip打开压缩包，查看一下文件属性：</div><div><img src="Bugku Misc 21（105-108）_files/Image [1].png" type="image/png" data-filename="Image.png"/></div><div>可以发现问题所在，fake1.txt的修改时间显示为08:15:19，而从zip压缩包中直接获得的数据则是08:15:20。进一步以十六进制模式查看zip压缩包会发现，其储存时间的方式导致对应字节（位于分文件头的第11-12字节，小端序）每增加1，时间中的秒数就增加2。这是因为DOS的FAT文件系统的时间戳解析度只有两秒钟，而zip压缩格式最初的设计中使用的就是DOS时间戳格式。更高分辨率的时间戳需要通过zip格式的可扩展性来实现，记录在预留的Extra段中。由于无法找到进一步的详细解析，从文件字节中直接获取高分辨率时间戳比较困难。不过本题涉及的文件数量不多，可以在7-Zip中手动查看属性并记录：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>fake0.txt (2021, 5, 21, 8, 15, 12)</div><div>fake1.txt (2021, 5, 21, 8, 15, 19)</div><div>fake2.txt (2021, 5, 21, 8, 15, 0)</div><div>fake3.txt (2021, 5, 21, 8, 15, 5)</div><div>fake4.txt (2021, 5, 21, 8, 15, 15)</div><div>fake5.txt (2021, 5, 21, 8, 14, 25)</div><div>fake6.txt (2021, 5, 21, 8, 15, 8)</div><div>fake7.txt (2021, 5, 21, 8, 15, 16)</div><div>fake8.txt (2021, 5, 21, 8, 14, 10)</div><div>fake9.txt (2021, 5, 21, 8, 14, 10)</div><div>fakf0.txt (2021, 5, 21, 8, 14, 16)</div><div>fakf1.txt (2021, 5, 21, 8, 14, 15)</div><div>fakf2.txt (2021, 5, 21, 8, 14, 9)</div><div>fakf3.txt (2021, 5, 21, 8, 14, 10)</div><div>fakf4.txt (2021, 5, 21, 8, 14, 11)</div><div>fakf5.txt (2021, 5, 21, 8, 14, 8)</div><div>fakf6.txt (2021, 5, 21, 8, 14, 12)</div><div>fakf7.txt (2021, 5, 21, 8, 14, 11)</div></div><div><br/></div><div>最后的脚本为：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>import time</div><div><br/></div><div>t = [(2021, 5, 21, 8, 15, 12), (2021, 5, 21, 8, 15, 19), (2021, 5, 21, 8, 15, 0), (2021, 5, 21, 8, 15, 5), (2021, 5, 21, 8, 15, 15), (2021, 5, 21, 8, 14, 25), (2021, 5, 21, 8, 15, 8), (2021, 5, 21, 8, 15, 16), (2021, 5, 21, 8, 14, 10), (2021, 5, 21, 8, 14, 10), (2021, 5, 21, 8, 14, 16), (2021, 5, 21, 8, 14, 15), (2021, 5, 21, 8, 14, 9), (2021, 5, 21, 8, 14, 10), (2021, 5, 21, 8, 14, 11), (2021, 5, 21, 8, 14, 8), (2021, 5, 21, 8, 14, 12), (2021, 5, 21, 8, 14, 11)]</div><div>for i in t:</div><div>    print(chr(int(time.mktime(tuple(i + (0, 0, 0)))) % 1000), end='')</div></div><div>输出结果：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>pwdisAlt2287123043</div></div><div>解压得到PNG格式图片：</div><div><img src="Bugku Misc 21（105-108）_files/flag is here .png" type="image/png" data-filename="flag is here .png"/></div><div><br/></div><div>flag：bugku{Timestamp_can_also_hide_information!}</div><div><br/></div><div><span style="font-weight: bold;">106 where is flag 番外篇</span></div><div><br/></div><div>下载得到两个rar格式文件。其中 出师表.rar 是加密压缩包，Key.rar 中包含13个txt文本：</div><div><img src="Bugku Misc 21（105-108）_files/Image [2].png" type="image/png" data-filename="Image.png"/></div><div>猜测其中隐藏着前者的压缩密码。</div><div><br/></div><div>观察Key.rar，其中出题人能够控制且暴露给解题人的信息包括文件名、文件内容、文件大小、修改时间和CRC32。首先可以排除文件名，因为压缩包没有加密，很可能也不是CRC32。尝试对文件大小和修改时间转换格式，均无法得到能解析的信息。文件内容中没有找到有效线索，但可以发现所有文本都来自《出师表》，且部分文本末尾处添加了数量不等的大写字母。这一做法可能有几种目的：</div><div>1、通过大写字母和数量本身来隐藏信息。但p3、p6、p9中均未添加大写字母，难以寻找规律，暂时不考虑；</div><div>2、通过改变文件内容来改变CRC32值。但仅通过不断添加同一个大写字母，在十次左右之内就能得到目标hash值的可能性非常低，可以排除；</div><div>3、改变文件大小。但无论文件大小还是压缩后大小单独来看都难以找到携带信息，尝试将两者结合来看。</div><div><br/></div><div>进行以下试验，将p1.txt解压后，删除末尾的1个大写字母A，重命名后添加进原压缩包：</div><div><img src="Bugku Misc 21（105-108）_files/Image [3].png" type="image/png" data-filename="Image.png"/></div><div>可以看到，发生改变的除了文件原始大小和压缩后大小，两者的差值也出现了变化。因此出题人在文本末尾添加大写字母很可能是为了得到目标差值。考虑到所有的原始大小-压缩后大小差值均在ASCII可打印字符范围内，尝试将其差值十进制ASCII转码：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>o = [353, 284, 315, 238, 331, 351, 316, 247, 246, 283, 283, 123, 125]</div><div>c = [278, 183, 194, 180, 241, 247, 199, 176, 170, 219, 219, 77, 77]</div><div>for i in range(len(o)):</div><div>    print(chr(o[i] - c[i]), end = '')</div></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>Key:ZhuGL@@.0</div></div><div><br/></div><div>解压另一个压缩包得到PNG格式图片，十六进制编辑器打开：</div><div><img src="Bugku Misc 21（105-108）_files/Image [4].png" type="image/png" data-filename="Image.png"/></div><div>最后一个IDAT块的长度是错误的，说明其中可能插入了部分额外字节，稍微网上翻一点：</div><div><img src="Bugku Misc 21（105-108）_files/Image [5].png" type="image/png" data-filename="Image.png"/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>flag in here {LjFWBuxFNTzEWv6t2NfxjNFSH1sQEwBt5wTTLD1fJ}</div></div><div>base58解码得到flag。</div><div><br/></div><div>flag：bugku{th1s_1s_chu_Sh1_B1A0!!@}</div><div><br/></div><div><span style="font-weight: bold;">107 random color</span></div><div><br/></div><div>下载得到png格式文件。十六进制编辑器查看，文件尾后有额外数据：</div><div><img src="Bugku Misc 21（105-108）_files/Image [6].png" type="image/png" data-filename="Image.png"/></div><div>提取得到另一张PNG格式图片，考虑双图隐写，用Stegsolve的Image Combiner功能，XOR模式发现二维码：</div><div><img src="Bugku Misc 21（105-108）_files/Image [7].png" type="image/png" data-filename="Image.png"/></div><div>扫码得到：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>flag{KJGvE9bzO3xCwF6UHLQjPq1ASVfR5moN}</div></div><div><br/></div><div>flag：flag{KJGvE9bzO3xCwF6UHLQjPq1ASVfR5moN}</div><div><br/></div><div><span style="font-weight: bold;">108 Pokergame</span></div><div><br/></div><div>下载得到加密压缩包Poke.zip和两张jpg图片。大量文件配加密压缩包，套娃的气息像鼻毛一样露出来了。十六进制编辑器查看两张图片，文件尾后均有额外数据：</div><div><img src="Bugku Misc 21（105-108）_files/Image [8].png" type="image/png" data-filename="Image.png"/></div><div>分别提取，得到一个zip格式压缩包和一张PNG格式图片。其中压缩包为伪加密，解压得到code.txt：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>data:image/png;base64,iVBORw0KGgoAAAA……（后略）</div></div><div>输入浏览器地址栏转为图片，和另一张PNG图片放一起：</div><div><img src="Bugku Misc 21（105-108）_files/1.png" type="image/png" data-filename="1.png"/><img src="Bugku Misc 21（105-108）_files/download.png" type="image/png" data-filename="download.png"/></div><div>缺少了左边两个定位符的二维码，用右上角的补全：</div><div><img src="Bugku Misc 21（105-108）_files/1 [1].png" type="image/png" data-filename="1.png"/></div><div>扫一下得到：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>key{P0ke_Paper}</div></div><div><br/></div><div>继续解压得到Poke文件夹：</div><div><img src="Bugku Misc 21（105-108）_files/Image [9].png" type="image/png" data-filename="Image.png"/></div><div>首先注意到K.jpg无法显示，十六进制编辑器查看文件头，实际为zip格式压缩包。重命名后发现是加密压缩包，先放着。</div><div><br/></div><div>再看David's words.txt：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>David, the father of King Solomon of Israel, played the harp well and was described as the most righteous of Kings.</div><div>King David was lost，and he loved the Weird Numbers.</div><div>Before he left, he said something odd and left the weird number: &quot;Only A is 1. Who will save me?&quot;</div><div>Cound you find him?</div><div><br/></div><div>2345678910A2345678910A23456789102345678910AA2345678910A234567891023456789102345678910AAA2345678910……</div><div>（后略）</div></div><div>有一大串数字，仔细观察可以发现，实际上是由A和2345678910两种单元组成的。根据提示A为1，那么猜测另一串对应0，尝试转码：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>s = ''</div><div>s = s.replace('2345678910', '0').replace('A', '1')</div><div>print(len(s))  # 448</div><div><br/></div><div>for i in range(0, len(s), 8):</div><div>    print(chr(int(s[i:i+8], 2)), end = '')</div></div><div>输出结果：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>SGFwcHkgdG8gdGVsbCB5b3Uga2V5IGlzIEtleXtPTUdfWW91ZG9pdH0=</div></div><div>base64转码：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>Happy to tell you key is Key{OMG_Youdoit}</div></div><div><br/></div><div>继续解压得到Ancient spells.txt和K.jpg，先看前者：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>As long as you help me to fix, I'll give you what you want.</div><div>(It Is Reverse Flag)</div></div><div>再查看图片，从图片内容可以看出高度可能被修改过，修改高度到1000后，Stegsolve查看，在R/G/B Palne 2下方可以看到倒过来的flag痕迹：</div><div><img src="Bugku Misc 21（105-108）_files/Image [10].png" type="image/png" data-filename="Image.png"/></div><div>就是看不太清楚。把原图倒转后写个脚本提取一下Plane 2：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>from PIL import Image</div><div><br/></div><div>img = Image.open('C:/Users/Administrator/Desktop/丬.png')</div><div>w = img.size[0]</div><div>new = Image.new('RGB', (w, 100))</div><div><br/></div><div>for y in range(100):</div><div>    for x in range(w):</div><div>        p = img.getpixel((x, y))</div><div>        col = []</div><div>        for i in range(3):</div><div>            t = bin(p[i])[2:].zfill(8)[-3]</div><div>            col += [int(t) * 64]</div><div>        new.putpixel((x, y), tuple(col))</div><div>new.save('C:/Users/Administrator/Desktop/f.png')</div></div><div>输出的结果再锐化一下：</div><div><img src="Bugku Misc 21（105-108）_files/Image [11].png" type="image/png" data-filename="Image.png"/></div><div>虽然还是不清晰，不过凑合了。除了最后这个0其实是个o以外，<span style="color: unset; font-family: unset; font-size: unset;">题目整体还是套娃，不过居然不猜谜，真是该平台最近难得的好题目——看，只要把标准放低一点，人生还是很快乐的。</span></div><div><br/></div><div>flag：flag{Poker_F@ce}</div></span>
</div></body></html> 