<html>
<head>
  <title>Bugku Misc 25（121-124）</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/605894 (zh-CN, DDL); Windows/6.1.1 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="7395"/>
<h1>Bugku Misc 25（121-124）</h1>
<h2><a href="https://DemonStarAlgol.github.io/Misc/">[无关链接]</a></h2>

<div>
<span><div><span style="font-weight: bold;">121 where is flag 4</span></div><div><br/></div><div>下载得到txt格式文件，内容：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>XQNGuAc9DEoRTAEFAygFDA6BDwz/DJSYbjpeOBBZCbg37dmLNYgNBA0JDAk/iQgC</div><div>AwEGBwaNDAoOAgQKbGJty24RbH8l73NOfIF/Q0y+wr9EkUHKq/oL4smYRouL38/0</div><div>w6Yv+yjdx6ZMuqfciszC/kD6jb3A/MCeyv3O887uychMv439SvPNvyn8hKov9Q0f</div><div>R62rUQEa0FHDT2hxHmXOdhR+q1oibuRm6khVT81ir3KUWuxgKp3fYggtCAhSBUm5</div><div>BxcOJBpHCQQcTQ4NCSMDDgqEBgbwBpCeZThQPh5YDLUz69yKM4AADQMEDg0+gAEL</div><div>AwEICwuGDQIjSAoMAg4HAAADDQwADQQLLgYNDg0JAwAODAQFAwoICm5ibsJrFmlw</div><div>KOx/TnmOckgLqQkMIQgDCAoIDQILBAMKCh4ODxuFDwc+K252vu4fwapI1wDXcgwf</div><div>px1pUVoBGtmvTN0M234FERj21DB42WyFrTjYCdB+BxpcCUeyAlIEbgQOBwkLAAsN</div><div>BxENAQMeDAZZqQoNDAAMDVzsCQsEBAcKAwMPDg==</div></div><div>很明显是base64编码，尝试解码，发现解码结果不为可打印字符串，将其作为十六进制形式输出：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>5D 03 46 B8 07 3D 0C 4A 11 4C 01 05 03 28 05 0C 0E 81 0F 0C FF 0C 94 98 6E 3A 5E 38 10 59 09 B8 37 ED D9 8B 35 88 0D 04 0D 09 0C 09 3F 89 08 02 03 01 06 07 06 8D 0C 0A 0E 02 04 0A 6C 62 6D CB 6E 11 6C 7F 25 EF 73 4E 7C 81 7F 43 4C BE C2 BF 44 91 41 CA AB FA 0B E2 C9 98 46 8B 8B DF CF F4 C3 A6 2F FB 28 DD C7 A6 4C BA A7 DC 8A CC C2 FE 40 FA 8D BD C0 FC C0 9E CA FD CE F3 CE EE C9 C8 4C BF 8D FD 4A F3 CD BF 29 FC 84 AA 2F F5 0D 1F 47 AD AB 51 01 1A D0 51 C3 4F 68 71 1E 65 CE 76 14 7E AB 5A 22 6E E4 66 EA 48 55 4F CD 62 AF 72 94 5A EC 60 2A 9D DF 62 08 2D 08 08 52 05 49 B9 07 17 0E 24 1A 47 09 04 1C 4D 0E 0D 09 23 03 0E 0A 84 06 06 F0 06 90 9E 65 38 50 3E 1E 58 0C B5 33 EB DC 8A 33 80 00 0D 03 04 0E 0D 3E 80 01 0B 03 01 08 0B 0B 86 0D 02 23 48 0A 0C 02 0E 07 00 00 03 0D 0C 00 0D 04 0B 2E 06 0D 0E 0D 09 03 00 0E 0C 04 05 03 0A 08 0A 6E 62 6E C2 6B 16 69 70 28 EC 7F 4E 79 8E 72 48 0B A9 09 0C 21 08 03 08 0A 08 0D 02 0B 04 03 0A 0A 1E 0E 0F 1B 85 0F 07 3E 2B 6E 76 BE EE 1F C1 AA 48 D7 00 D7 72 0C 1F A7 1D 69 51 5A 01 1A D9 AF 4C DD 0C DB 7E 05 11 18 F6 D4 30 78 D9 6C 85 AD 38 D8 09 D0 7E 07 1A 5C 09 47 B2 02 52 04 6E 04 0E 07 09 0B 00 0B 0D 07 11 0D 01 03 1E 0C 06 59 A9 0A 0D 0C 00 0C 0D 5C EC 09 0B 04 04 07 0A 03 03 0F 0E</div></div><div>结合提示“flag在压缩包里“，注意到输出数据每一字节的高位连起来，开头部分恰好是504B0304，是zip格式压缩包文件的文件头。尝试提取每一字节的高位并连接：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>import base64</div><div><br/></div><div>s = open('C:/Users/Administrator/Desktop/whereisflag4.txt', 'rb').read().replace(b'\n', b'')</div><div>for i in base64.b64decode(s):</div><div>    print(hex(i&gt;&gt;4)[2:].upper(), end='')</div></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>504B0304140002000800F0996353150B3ED8380000003800000008000000666C61672E7478744BCB494CAF0EC9488DCFCA2F2DCA4BAD8CCF4F8BCFC9CFCFCECC4B8F4FCB2F8A2F014AA501D5C46716C717A526E6E454C6A795E629D60200504B01021400140002000800F0996353150B3ED83800000038000000080024000000000000002000000000000000666C61672E7478740A00200000000000010018003267BE1CA4D0D701A165501DA4D0D7011FD37D68A3D0D701504B050600000000010001005A0000005E0000000000</div></div><div>在十六进制编辑器内保存为zip格式文件，解压得到flag。</div><div><br/></div><div>试一下用一行脚本直接输出flag：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>print((lambda x: x.read(x.namelist()[0]).decode())(__import__('zipfile').ZipFile(__import__('io').BytesIO(bytes.fromhex(''.join([hex(i&gt;&gt;4)[2:] for i in __import__('base64').b64decode(open('C:/Users/Administrator/Desktop/whereisflag4.txt', 'rb').read().replace(b'\n', b''))]))))))</div></div><div><br/></div><div>flag：flag{The_journey_of_looking_for_the_flag_is_really_fun!}</div><div><br/></div><div><span style="font-weight: bold;">122 清凉一夏</span></div><div><br/></div><div>下载得到png格式文件，内容为一个QR码，扫码得到：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>happyctf</div></div><div>十六进制编辑器打开图片，可以发现文件尾后有额外数据，提取得到加密的zip格式压缩包，用上述扫码结果作为密码解压，得到jpg格式文件。尝试打开发现报错，十六进制编辑器打开：</div><div><img src="Bugku Misc 25（121-124）_files/Image.png" type="image/png" data-filename="Image.png"/></div><div>显然是缺少文件头FF E8和APP1块标识符FF E1，修复后得到JPG格式图片。百度识图一下发现原图是有腿的：</div><div><img src="Bugku Misc 25（121-124）_files/Image [1].png" type="image/png" data-filename="Image.png"/></div><div>说明题目里的图被修改了高度，那么随便改个大一点的高度可以发现图片下方有字符串：</div><div><img src="Bugku Misc 25（121-124）_files/Image [2].png" type="image/png" data-filename="Image.png"/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>key:U2FsdGVkX1+/JVhJjnTXAwi5whdn+NuW</div></div><div>注意到U2Fs开头的base64形式密文，说明可能是加盐后的AES、DES、3DES、Rabbit等加密的密文。尝试后发现是Rabbit密码，解密得到明文为：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>ZmxhZw==</div></div><div>再进行一次base64解码：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>flag</div></div><div>所以这里给出了一个密钥flag，暗示接下来可能存在某种需要密钥的加密或隐写。尝试后发现是JPHS，以flag为密钥提取隐写信息得到文本，打开得到flag。</div><div><br/></div><div>flag：flag{happy_summer}</div><div><br/></div><div><span style="font-weight: bold;">123 超简单隐写</span></div><div><br/></div><div>下载得到zip格式压缩包，内含两个未加密压缩的图片和两个加密压缩的文本：</div><div><img src="Bugku Misc 25（121-124）_files/Image [3].png" type="image/png" data-filename="Image.png"/></div><div>解压得到两张JPG格式图片，内容看起来差不多，但文件大小差异非常大。用Stegsolve的Image Combiner功能，发现两图存在细微差异：</div><div><img src="Bugku Misc 25（121-124）_files/Image [4].png" type="image/png" data-filename="Image.png"/></div><div>SUB(RGB separate)模式下的蓝色横向虚线说明很可能与盲水印有关。试了一下，用到的盲水印工具是<a href="https://github.com/chishaxie/BlindWaterMark/">这个</a>：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop/blind-watermark-python3/BlindWaterMark# python3 bwmforpy3.py decode file.jpg file0.jpg out.png</div><div>image&lt;file.jpg&gt; + image(encoded)&lt;file0.jpg&gt; -&gt; watermark&lt;out.png&gt;</div></div><div><img src="Bugku Misc 25（121-124）_files/out.png" type="image/png" data-filename="out.png"/></div><div>得到水印内容：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>2s68cc3x0</div></div><div>然后以此为密码直接解压得到flag。</div><div><br/></div><div>多说一句，同样用这个密码解压还能得到password.txt，内含很多行base64编码：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>U3RlZ2Fub2dyYXBoeSBpcyB0aGUgYXJ0IGFuZCBzY2llbmNlIG9m</div><div>IHdyaXRpbmcgaGlkZGVuIG1lc3NhZ2VzIGluIHN1Y2ggYSB3YXkgdGhhdCBubyBvbmV=</div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">……（中略）</span></div><div>bGluZyBhbmQgY29tZm9ydGFibGUuDQoNCi0tDQpodHRwOi8vZW4ud2lraXBlZGlhLm9yZw==</div><div>L3dpa2kvU3RlZ2Fub2dyYXBoeQ0K</div></div><div>尝试对部分=结尾的行解码后再编码，会发现与开始的编码在结尾部分字符处出现差异，这是base64隐写特征。解隐写得到：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>Base_sixty_four_point_five</div></div><div>怀疑出题人想用这个作为flag.txt的解压密码，但大概是出题时搞错了吧。</div><div><br/></div><div>flag：bugku{wow_you_are_good_S}</div><div><br/></div><div><span style="font-weight: bold;">124 做题要细心-1</span></div><div><br/></div><div>下载得到gif格式文件。十六进制编辑器打开，文件尾后有额外数据：</div><div><img src="Bugku Misc 25（121-124）_files/Image [5].png" type="image/png" data-filename="Image.png"/></div><div>这段数据开头为39 61（9a），结尾为3B（;），猜测其可能为文件头被破坏的GIF格式图像。提取后补全文件头为47 49 46 38 39 61（GIF89a），得到另一张gif图片。</div><div><br/></div><div>GIFFrame打开第二张gif图片，逐帧查看，第19帧右下角有字符串：</div><div><img src="Bugku Misc 25（121-124）_files/Image [6].png" type="image/png" data-filename="Image.png"/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>fd6349c6e635a1d0</div></div><div>搜索一下发现这段字符串在bugku的convert一题的flag中出现过，该题的完整flag是：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>flag{01a25ea3<font color="#FF0000">fd6349c6e635a1d0</font>196e75fb}</div></div><div>那就很明显了，这是32位md5的中间16位，也就是16位md5，反查一下得到明文：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>bugku</div></div><div><br/></div><div>然后查看第二张gif图片的exif信息：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>C:\Users\Administrator\Desktop&gt;exiftool 1.gif</div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">……（中略）</span></div><div>Artist                          : <font style="color: rgb(255, 0, 0);">e0F4X1M=</font></div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">……（后略）</span></div></div><div>base64解码：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>{Ax_S</div></div><div><br/></div><div>观察gif文件结构，发现全局颜色表中有部分颜色RGB值很可疑：</div><div><img src="Bugku Misc 25（121-124）_files/Image [7].png" type="image/png" data-filename="Image.png"/></div><div>尤其是107号颜色FFFFFF，实际上在颜色表1号位置已经出现过了。接下来的颜色基本由0和1组成，从FFFFFF到AAAA，中间共有40个0或1，尝试将其提取后二进制ASCII转码：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>01 01 11 11 01 10 00 10 01 11 01 01 01 00 01 11 01 11 11 01</div><div>_buG}</div></div><div>但以上三条拼合后并非正确flag，说明中间可能还有一段或几段字符串。回到最开始的第一张gif图片，注意到全局颜色表：</div><div><img src="Bugku Misc 25（121-124）_files/Image [8].png" type="image/png" data-filename="Image.png"/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>01 00 11 10 01 10 11 10 01 10 00 10 00 11 01 11 00 11 01 11</div><div>Nnb77</div></div><div>最后拼接四段字符串得到flag。</div><div><br/></div><div>flag：bugku{Ax_SNnb77_buG}</div></span>
</div></body></html> 