<html>
<head>
  <title>Bugku Misc 20（101-104）</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/605894 (zh-CN, DDL); Windows/6.1.1 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="4318"/>
<h1>Bugku Misc 20（101-104）</h1>
<h2><a href="https://DemonStarAlgol.github.io/Misc/">[无关链接]</a></h2>

<div>
<span><div><span style="font-weight: bold;">101 where is flag 2</span></div><div><br/></div><div>下载得到zip格式文件，为加密压缩包，内含1-F.txt共15个文本文件，及whereisflag.png：</div><div><img src="Bugku Misc 20（101-104）_files/Image.png" type="image/png" data-filename="Image.png"/></div><div>所有文本文件长度均为6字节，可以进行CRC碰撞。</div><div><br/></div><div>先提取所有txt文件的CRC值，然后用脚本计算碰撞结果：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>import zipfile</div><div>import os</div><div><br/></div><div>zip = zipfile.ZipFile('whereisflag2.zip', 'r')</div><div>crc = []</div><div>for i in range(1, 16):</div><div>    crc += [zip.getinfo(hex(i)[2:].upper() + '.txt').CRC]</div><div><br/></div><div>f = open('result.txt', 'a')</div><div>for i in crc:</div><div>    cmd = 'python crc32.py reverse ' + str(i)</div><div>    r = os.popen(cmd)</div><div>    f.write(r.read())</div><div>    f.write('---------------------------------\n')</div></div><div>得到结果：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>4 bytes: {0xb3, 0xd5, 0x1d, 0xa2}</div><div>verification checksum: 0x6275676b (OK)</div><div><br/></div><div>alternative 5 bytes:</div><div><br/></div><div>alternative 6 bytes:</div><div>alternative: 0D6t3M (OK)</div><div>alternative: 2x3jjP (OK)</div><div>alternative: NwXA_C (OK)</div><div>alternative: QImRdO (OK)</div><div>alternative: S8EqPZ (OK)</div><div>alternative: VPjlNd (OK)</div><div>alternative: Y_4mis (OK)</div><div>alternative: _FrbXA (OK)</div><div>alternative: aw5yCQ (OK)</div><div>alternative: dR7Y0g (OK)</div><div>alternative: fn2Giz (OK)</div><div>alternative: gnsvrc (OK)</div><div>alternative: ialFNm (OK)</div><div>alternative: nxkxdF (OK)</div><div>alternative: r77ypF (OK)</div><div>alternative: s7vHk_ (OK)</div><div>alternative: v_YUua (OK)</div><div>alternative: wCW8ol (OK)</div><div>alternative: xPFeIo (OK)</div><div>---------------------------------</div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">……（后略）</span></div></div><div>没有找到任何有用的信息，就当练习脚本了吧……</div><div><br/></div><div>回过头来观察CRC32值，注意到E.txt的CRC32为 666C6167，即flag的十六进制ASCII值。尝试把这些CRC32值都按照十六进制ASCII码转码：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>import zipfile</div><div>from Crypto.Util.number import long_to_bytes</div><div><br/></div><div>zip = zipfile.ZipFile('C:/Users/Administrator/Desktop/whereisflag2.zip', 'r')</div><div>for i in range(1, 16):</div><div>    crc = [zip.getinfo(hex(i)[2:].upper() + '.txt').CRC]</div><div>    print(long_to_bytes(crc).decode(), end = '')</div></div><div>输出结果：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>bugku{You_can't_imagine_the_happiness_of_hiding_the_flag!!!}</div></div><div><br/></div><div>flag：bugku{You_can't_imagine_the_happiness_of_hiding_the_flag!!!}</div><div><br/></div><div><span style="font-weight: bold;">102 虎符</span></div><div><br/></div><div>下载得到wim格式文件，这是基于文件的Windows镜像格式，可以直接用7-Zip解压，得到两个文件夹：</div><div><img src="Bugku Misc 20（101-104）_files/Image [1].png" type="image/png" data-filename="Image.png"/></div><div>可以猜想是分别从左右两边得到半段flag再拼合的意思。</div><div><br/></div><div>先看左半边，有hint.txt和hufu_left.jpg，十六进制编辑器查看后者，文件尾后有额外数据：</div><div><img src="Bugku Misc 20（101-104）_files/Image [2].png" type="image/png" data-filename="Image.png"/></div><div>提取得到加密的RAR格式压缩包，然后看hint.txt：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>hint: password并不单一</div><div><br/></div><div>password: 王大 王井 王井</div></div><div>是当铺密码，对应关系如下：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>当铺密码：    王大 王井 王井</div><div>数字：        65   68   68</div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">十进制ASCII：    A      D       D</span></div></div><div>接下来又到了大家喜闻乐见的猜谜时间，请根据以上信息猜测压缩包的解压密码！</div><div>好，公布答案，解压密码是：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>ADD656868</div></div><div>你猜对了吗？</div><div>解压得到left.txt，内容为：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>\u63\u74\u66\u2e\u73\u73\u6c\u65\u79\u65</div><div><br/></div><div>flag_left: DUBU_JABS&amp;</div></div><div>第一行Unicode解码结果为：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>ctf.ssleye</div></div><div>指向<a href="http://ctf.ssleye.com/">http://ctf.ssleye.com/</a>，提供了多种在线加解密和编码工具。但目前还不知道到底有什么作用，放置待考。</div><div><br/></div><div>再看右半边，有hufu_right.png和加密压缩包flag_right.rar。十六进制编辑器或TweakPNG打开图片：</div><div><img src="Bugku Misc 20（101-104）_files/Image [3].png" type="image/png" data-filename="Image.png"/></div><div>注意到大量的私有块prVW、mkBF、mkTS、mkBS和mkBT，这些是Fireworks的私有块，用于保存预览图和图层信息等。用Fireworks打开图片，隐藏上方图层：</div><div><img src="Bugku Misc 20（101-104）_files/Image [4].png" type="image/png" data-filename="Image.png"/></div><div>得到解压密码：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>y0u_f1nd_me</div></div><div>解压得到文本：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>dGhpc19pc19yaWdodF9mbGFnOiZyZ2JfcmlnaHRfaHVmdQ==</div></div><div>base64解码：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>this_is_right_flag:&amp;rgb_right_hufu</div></div><div><br/></div><div>尝试拼接一下：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>DUBU_JABS&amp;&amp;rgb_right_hufu</div></div><div>提交发现不对，猜测读不通的左半段有问题。根据提示，可能需要到<a href="http://ctf.ssleye.com/">http://ctf.ssleye.com/</a>上用某个工具再进行一次解密。那么到底是哪个工具这么幸运呢？没错，又到了我们最喜欢的猜谜时间。</div><div>首先通过穷举尝试可以排除所有不需要密钥或密钥空间较小的加密方式，继续猜谜，最终发现题目页面上给出了提示“注意关键字”，所以答案是<a href="http://ctf.ssleye.com/keyword.html">关键字密码</a>：</div><div><img src="Bugku Misc 20（101-104）_files/Image [5].png" type="image/png" data-filename="Image.png"/></div><div>是的，密钥也需要猜。总之最后拼接得到flag。</div><div><br/></div><div>flag：bugku{HUFU_LEFT&amp;&amp;rgb_right_hufu}</div><div><br/></div><div><span style="font-weight: bold;">103 小美的秘密</span></div><div><br/></div><div>各种文件和文件夹特别多的一道套娃猜谜题。</div><div><br/></div><div>下载得到加密的 小美家.zip 和 fence.jpg，十六进制编辑器看一下后者，文件尾后有另一张图片：</div><div><img src="Bugku Misc 20（101-104）_files/Image [6].png" type="image/png" data-filename="Image.png"/></div><div>提取出来，根据exif信息里的提示“玫瑰花底下好像有东西?”，修改图片高度：</div><div><img src="Bugku Misc 20（101-104）_files/1.jpg" type="image/jpeg" data-filename="1.jpg"/></div><div>得到：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>K9e8y7I}s{$key2</div></div><div>按照提示，下一步显然是栅栏密码解密。按照栅栏密码的原理，密文长度为15，每栏字数可能是3或5，从密文本身来看，隔一位读一个字符可以看到KeyIs字样，从而每栏字数也可能为2。然而尝试后会发现，每栏字数2、3、5均无法得到正确的解压密码。这里涉及到一个问题，容我多说几句：</div><div>根据重排列密文→明文的阅读顺序，我们平时所说的栅栏密码可以分为普通型（传统型）和W型两种，亦有某种定义仅将W型称为栅栏/篱笆密码，而普通型的则称为Scytale。这个名字来源于公元前5世纪，斯巴达人用于传递信息的木棍。其加密方式是这样的：将细长的皮纸等书写介质螺旋形缠绕在木棍上，然后横向写下明文，解下书写介质后拉直，明文的顺序就被打乱形成密文。不难看出，这种加密方式实质就是我们用到的“栅栏密码”，而木棍的周长就相当于密钥。解密时将书写介质重新缠绕在同样直径的木棍上，就可以直接读出明文。</div><div>从这一起源和实际应用也可以看出，栅栏密码的栏数/每栏字数并不是随意选择的，至少应该保证各栏之间尽可能平均分布、不出现仅有单个字符的栏，否则就变成了未知规则、需要穷举的明文简单重排列。但现在各类在线/离线工具提供的栅栏密码加解密功能大多不进行栏数/每栏字数的验证，如果用这些工具来进行栅栏密码的加密，且使用了不合理的栏数/每栏字数，就会造成两方面的问题：</div><div>第一，有些工具输入的密钥是栏数，有些则是每栏字数，不合理的密钥设置会导致两者无法一一对应。举个例子，总字数15的情况下，栏数3和每栏字数5是一一对应的，但每栏字数11却没有完全对应的栏数，因为栏数1对应每栏字数15，栏数2对应每栏字数8，并不存在一个整数栏数对应每栏字数11。</div><div>第二，对于无法整除的栏数或每栏字数，不同工具采取了不同的处理方式，例如有些工具会将密文填充到可整除字数后再进行加解密处理，有些工具则单纯地减少靠后各栏的字数，很难保证不同的工具必定得出相同的结果。</div><div>可以看到，一旦采用这类工具以及不合理的密钥数字设置来进行栅栏密码加密，以上两方面问题将导致同一个结果：即必须找到和出题人使用的工具在规则处理上完全一致的工具，甚至必须找到出题人所使用的完全相同的工具，才能进行正确的解密，特别是在明文并没有特定含义的情况下更是如此。这样一来，一道古典密码题就变成了毫无意义且并不公平的找工具题。利用工具出题无可厚非，但在自己都没有完全理解原理的前提下，胡乱使用工具，对题目质量可能会造成影响。</div><div>那么回到正题，这里的栅栏密码必须使用每栏字数为密钥的工具才能进行正确解密，例如<a href="https://www.qqxiuzi.cn/bianma/zhalanmima.php">千千秀字</a>，穷举密钥得到明文：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>KeyIs{$key2987}</div></div><div>得到 小美家.zip 的解压密码。</div><div><br/></div><div>解压得到 储物间 和 卧室 两个加密压缩包，以及 客厅 文件夹。先看客厅，有两张jpg格式图片和 垃圾桶 文件夹，内含两个无扩展名的文件。十六进制编辑器查看：</div><div><img src="Bugku Misc 20（101-104）_files/Image [7].png" type="image/png" data-filename="Image.png"/></div><div><img src="Bugku Misc 20（101-104）_files/Image [8].png" type="image/png" data-filename="Image.png"/></div><div>都是jpg格式图片，修复文件头后重命名，得到：</div><div><img src="Bugku Misc 20（101-104）_files/神奇的字符串.jpg" type="image/jpeg" data-filename="神奇的字符串.jpg"/><img src="Bugku Misc 20（101-104）_files/repairhead.jpg" type="image/jpeg" data-filename="repairhead.jpg"/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>5oiR5omN5LiN5Lya5ZGK 6K+J5L2g5YKo54mp6Ze05</div><div>5qE5a+G56CB5piv</div></div><div>连起来base64解码：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>我才不会告诉你储物间的密码是</div></div><div>得到 储物间.zip 的密码。</div><div><br/></div><div>解压 储物间.zip，得到一张jpg格式图片，一段mp3音频和一个txt文本。从文本中得知卧室的密码是钢琴的密码加乐谱的密码，即分别对应图片和音频。先看图片，十六进制编辑器查看，文件尾有额外数据：</div><div><img src="Bugku Misc 20（101-104）_files/Image [9].png" type="image/png" data-filename="Image.png"/></div><div>提取得到RAR格式压缩包，解压得到二维码：</div><div><img src="Bugku Misc 20（101-104）_files/二维码.png" type="image/png" data-filename="二维码.png"/></div><div>扫码得到：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>roomkey</div></div><div>再看音频，audacity打开，末尾可以看到明显的摩斯电码：</div><div><img src="Bugku Misc 20（101-104）_files/Image [10].png" type="image/png" data-filename="Image.png"/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>----- --... ..--- .----</div><div>0721</div></div><div>拼接得到 卧室.zip 的解压密码。</div><div><br/></div><div>解压 卧室.zip，得到又一个加密压缩包 花盆.zip，两个txt文本和一张jpeg格式图片。从txt文本可以得到两段密文：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>U2FsdGVkX18qyg4WuEtWtfFwxKvgUnUdax /jQz3BAf/2IkCxIBDNBz94A==</div></div><div>同样从jpeg图片的exif信息中得到一段密文：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>/b4f2dLgl30Tqg4Q/TOhaucaZpwqP</div></div><div>按照文件名的顺序拼接起来：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>U2FsdGVkX18qyg4WuEtWtfFwxKvgUnUdax/b4f2dLgl30Tqg4Q/TOhaucaZpwqP/jQz3BAf/2IkCxIBDNBz94A==</div></div><div>U2Fs开头的base64编码很可能是AES、DES或Rabbit等现代密码的base64形式密文（实际上是因为加密后将密文与Salted__头一起编码，从而形成固定的头部字符串）。尝试解密后发现可能需要密钥，回头看 花盆.zip，实际上是伪加密，处理一下：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>D:\CTFToolkit-v1.1.0\暴力破解\ZipCenOp&gt;java -jar ZipCenOp.jar r 花盆.zip</div><div>success 1 flag(s) found</div></div><div>解压得到jpg格式图片，改一下高度：</div><div><img src="Bugku Misc 20（101-104）_files/花盆.jpg" type="image/jpeg" data-filename="花盆.jpg"/></div><div>AES解密，密钥为misc，得到：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>flag{My_secret_1s_Y0u_@re_x1@ng_peach}</div></div><div><br/></div><div>整体来说都是比较基础的隐写和加密手法，除了比较套娃以及开始的栅栏密码有一点可以商榷的地方，其他部分都还好。</div><div><br/></div><div>flag：flag{My_secret_1s_Y0u_@re_x1@ng_peach}</div></span>
</div></body></html> 