<html>
<head>
  <title>Bugku Misc 29（137-140）</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/605894 (zh-CN, DDL); Windows/6.1.1 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="8668"/>
<h1>Bugku Misc 29（137-140）</h1>
<h2><a href="https://DemonStarAlgol.github.io/Misc/">[无关链接]</a></h2>

<div>
<span><div><span style="font-weight: bold;">137 miko不会jvav啊</span></div><div><br/></div><div>下载得到加密压缩包TnT.rar和TnT.pcapng和一个提示：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>压缩包密码是192.168.1.123的机器名</div></div><div>wireshark打开流量包，过滤IP地址为192.168.1.123，UDP协议里会广播主机名：</div><div><img src="Bugku Misc 29（137-140）_files/Image.png" type="image/png" data-filename="Image.png"/></div><div>得到主机名：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>Latifa-Fleuranza</div></div><div><br/></div><div>解压rar，又得到一个TnT.exe，运行一下：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>C:\Users\Administrator\Desktop&gt;TnT.exe</div><div>1: I'll say &quot;what&quot;*91 in here.</div><div>Please enter my flag:</div></div><div>搜索flag等字符串没有结果，那么只能一个个数据包来看到底藏了什么了。考虑到本地IP已知为192.168.1.123，需要操纵流量内容的话另一端很可能也是本地局域网内主机，那么进行一个过滤：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>((ip.src == 192.168.1.123 &amp;&amp; ip.dst == 192.168.0.0/16) || (ip.dst == 192.168.1.123 &amp;&amp; ip.src == 192.168.0.0/16)) &amp;&amp; tcp</div></div><div>然后按长度排序，发现18049号数据包：</div><div><img src="Bugku Misc 29（137-140）_files/Image [1].png" type="image/png" data-filename="Image.png"/></div><div>从数据内容来看，pHYs、tEXt、IDAT等关键字说明该包很可能包含了一张PNG图像的数据，追踪流-Hex转储：</div><div><img src="Bugku Misc 29（137-140）_files/Image [2].png" type="image/png" data-filename="Image.png"/></div><div>很明显是文件头和IHDR块标识位被改了。提取之后修复文件，发现图像正常显示，但IHDR块的CRC报错。说明高度位被修改了，爆破得到正确高度为122（0x7A），再次修复后得到图像：</div><div><img src="Bugku Misc 29（137-140）_files/1.png" type="image/png" data-filename="1.png"/></div><div>但输入miscazhenhaowan提示错误：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>C:\Users\Administrator\Desktop&gt;TnT.exe</div><div>1: I'll say &quot;what&quot;*91 in here.</div><div>Please enter my flag: miscazhenhaowan</div><div>No! It not my flag! ni huai huai..</div></div><div>那么关键就在于问题里的那个91，又到了大家喜闻乐见的猜谜时间。猜了十六年，最后发现要把那段东西进行一个base91编码再输入：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>C:\Users\Administrator\Desktop&gt;TnT.exe</div><div>1: I'll say &quot;what&quot;*91 in here.</div><div>Please enter my flag: va8=s)#v;R?4E^&quot;ppoD</div><div>21: You are right, but it is just my flag!</div><div>3: I can tell you what is your flag.</div><div>8: Just is &quot;inzmierx&quot;. I'll watch you on the small mountain.</div><div>Okay, tell me what is your flag:</div></div><div>实在看不懂什么叫Just is，不过给了21 3 8三个数字，而且有“小山”的提示，那么大概就是希尔密码。并且可以发现密钥实际上是1 21 3 8：</div><div><img src="Bugku Misc 29（137-140）_files/Image [3].png" type="image/png" data-filename="Image.png"/></div><div>再次输入得到flag：</div><div><img src="Bugku Misc 29（137-140）_files/Image [4].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div>个人建议是拿到exe文件之后就直接逆向，可以节约猜谜用掉的四十七年时间。</div><div><br/></div><div>flag：flag{mikobuhuijvav}</div><div><br/></div><div><span style="font-weight: bold;">138 图片里的英文</span></div><div><br/></div><div>下载得到jpg格式文件。十六进制编辑器打开，文件尾后有额外数据：</div><div><img src="Bugku Misc 29（137-140）_files/Image [5].png" type="image/png" data-filename="Image.png"/></div><div>额外数据的开头部分是OurSecret隐藏数据的特征字节，但直接提取会提示密码无效，那么就需要先找到密码。</div><div><br/></div><div>那么就到了大家喜闻乐见的人肉穷举时间，（此处略去五十万字），最后发现是<a href="https://github.com/ww23/BlindWatermark">Java盲水印</a>：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>java -jar BlindWatermark.jar decode -f file.jpg cainima.png</div></div><div>得到：</div><div><img src="Bugku Misc 29（137-140）_files/Image [6].png" type="image/png" data-filename="Image.png"/></div><div>然后拿去OurSecret提取隐藏数据，注意密码里的第二个单词是L0V3，没错那是个数字0：</div><div><img src="Bugku Misc 29（137-140）_files/Image [7].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div>提取得到flag.zip，里面又有个加密压缩的flag.zip，以及key1-5共五个未加密的jpg图像。<span style="font-size: unset; color: unset; font-family: unset;">五张图分别是：</span></div><div><img src="Bugku Misc 29（137-140）_files/key1.jpg" type="image/jpeg" data-filename="key1.jpg"/><img src="Bugku Misc 29（137-140）_files/key2.jpg" type="image/jpeg" data-filename="key2.jpg"/><img src="Bugku Misc 29（137-140）_files/key3.jpg" type="image/jpeg" data-filename="key3.jpg"/><img src="Bugku Misc 29（137-140）_files/key4.jpg" type="image/jpeg" data-filename="key4.jpg"/><img src="Bugku Misc 29（137-140）_files/key5.jpg" type="image/jpeg" data-filename="key5.jpg" width="87"/></div><div>四五两个字很明显是小篆的义（義）和诚，由此类推，五个字分别是“人尊智义诚”，搜索一下发现这是游戏《sifu》中的五个属性（<a href="https://www.bilibili.com/read/cv15189811">1</a> <a href="https://www.zhihu.com/question/524115117/answer/2407505686">2</a>），还可以找到一张可能是游戏截图的图案：</div><div><img src="Bugku Misc 29（137-140）_files/v2-1b97358f88c2cdf4948c12b2c58f43ea_b.jpg" type="image/jpeg" data-filename="v2-1b97358f88c2cdf4948c12b2c58f43ea_b.jpg"/></div><div>我这辈子都没见过把乾摆到左上角的八卦.jpg。</div><div>但这五个字按顺序组合后并不是压缩包的密码。从知乎的回答里可以看出这五个属性似乎各对应一名BOSS，结合题目提示中的“仇人拥有5种不同能力”，继续搜索找到<a href="https://www.bilibili.com/read/cv15193216">这篇文章</a>，组合一下可以得到，按照属性-BOSS-能力的对应关系，五张图对应到能力应该是“木火水金土”。而这也是flag.zip的解压密码。</div><div>不过话说回来，虽然能搜到的地方都在吹这个游戏制作组多么了解中国文化，但这里不光八卦是歪的，仁义礼智信仿佛被Google翻译过来又翻译过去一样发生了微妙的变化，和五行的对应关系也完全没看到出处，仿佛就是随便臆造的。汉代郑玄注《中庸》“木神则仁金神则义火神则礼水神则信土神则智”，注《周易》“东方为仁南方为礼西方为义北方为信中央为智”，不管怎么看都有对不上的。就是说<span style="font-size: unset; color: unset; font-family: unset;">如果做题人有得罪的地方你可以报警抓他，没必要拿这种很可能不是全世界所有人都玩过的游戏里的臆造对应关系来折磨人对不对。</span></div><div><span style="font-size: unset;"><br/></span></div><div><span style="font-size: unset; color: unset; font-family: unset;">总之解压完又是一个flag.zip，内含key.bmp和加密压缩的flag.png。解压key.bmp，内容就是上面那张八卦错乱五德移转方位悖逆的奇妙关系图。对其使用wbStego可以提取出隐写信息：</span></div><div><img src="Bugku Misc 29（137-140）_files/Image [8].png" type="image/png" data-filename="Image.png"/></div><div>得到的隐写内容：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>key：虾仁猪心</div></div><div>用这个密码可以解压得到flag.png：</div><div><img src="Bugku Misc 29（137-140）_files/Image [9].png" type="image/png" data-filename="Image.png"/></div><div>Stegsolve打开，在R/G/B Plane 0左上角第一行可以找到一些不符合JPG编码规则的像素排列：</div><div><img src="Bugku Misc 29（137-140）_files/Image [10].png" type="image/png" data-filename="Image.png"/></div><div>而该图像很显然是从JPG图片转换得到的，因此这里很可能有LSB隐写。直接用Data Extract功能或zsteg没有得到有效结果，那么可能是某些基于LSB原理但带有密码，可以在隐写前先把payload加密的工具，例如cloacked-pixel和stegpy，这样一来就需要找到密钥。基于对出题人上一题的了解，猜测可能又是要找到图片对应的电影里这一幕的台词——就是说没活了可以去咬打火机——以图搜图一下：</div><div><img src="Bugku Misc 29（137-140）_files/Image [11].png" type="image/png" data-filename="Image.png"/></div><div>得到台词：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>You know you love me</div></div><div>然后又到了大家最喜欢的出题人不说就不可能做得出来步骤，当你拿这段台词不管怎么解都解不出隐写的时候，出题人才姗姗来迟地告诉你要把这段台词去掉空格然后改成全小写——恭喜你在《测测与出题人有多么心有灵犀》测试中得到了零分——最后试了试发现用的工具是cloacked-pixel：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop/lsb# python lsb.py extract flag.png out.txt youknowyouloveme</div><div>[+] Image size: 1885x849 pixels.</div><div>[+] Written extracted data to out.txt.</div></div><div>得到：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>bugku{Ni_You_dUi_xi@ng_m@_doge}</div></div><div><br/></div><div>全程猜谜，考点莫名，仿佛经历了一场脑筋急转弯的盛宴，我的评价是：</div><div><img src="Bugku Misc 29（137-140）_files/断气谜.PNG" type="image/png" data-filename="断气谜.PNG"/></div><div>只能说套神出题法后继有人。</div><div><br/></div><div>flag：bugku{Ni_You_dUi_xi@ng_m@_doge}</div><div><br/></div><div><span style="font-weight: bold;">139 奇怪的压缩包</span></div><div><br/></div><div>下载得到一个文件夹，内含三个图片文件：</div><div><img src="Bugku Misc 29（137-140）_files/Image [12].png" type="image/png" data-filename="Image.png"/></div><div>好，是自嗨题，光看这图脑子里的套神题雷达就疯狂报警了。</div><div><br/></div><div>先用Stegsolve全部看一遍，在PNG图片的Blue Plane 0处有个QR码：</div><div><img src="Bugku Misc 29（137-140）_files/Image [13].png" type="image/png" data-filename="Image.png"/></div><div>直接把这张截图拿去zbarimg：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# zbarimg -1 dahuoji.png</div><div>QR-Code:DDF639504B07089A272FD63500000029000000504B030414000000080057106354551AAC20060000000400000009000000666C6167332E747874730E71D30500504B0708551AAC200600000004000000504B03041400090063004F116354000000002C0000000E00000009000B00666C6167312E74787401990700020041450308005AAE9C824BBD3651D36B968CFBB79753A47E144C3EDC9EEF38BE4A6E29385D9711DF1A255E7E062FE4245016504B0708000000002C0000000E000000504B030414000900630032106354000000002B0000000D00000009000B00666C6167322E7478740199070002004145030800317729A462DF719F1B6B5BAE78125338067E964522CCD38F544D88F37D5539A7D6984B51CA47EA37ECB7B7504B0708000000002B0000000D000000504B01021F0014000900080049116354B51AB7362D0000001F000000090024000000000000002000000000000000666C6167342E7478740A00200000000000010018006CAFE3C6602ED8016CAFE3C6602ED80123F5876B222ED801504B01021F00140009000800911063549A272FD63500000029000000080024000000000000002000000064000000666C61672E7478740A002000000000000100180098A3AAF95F2ED801C3A05DE4602ED801D8802CE3602ED801504B01021F00</div><div>scanned 1 barcode symbols from 1 images in 0.09 seconds</div></div><div>丢进十六进制编辑器里看下：</div><div><img src="Bugku Misc 29（137-140）_files/Image [14].png" type="image/png" data-filename="Image.png"/></div><div>显然是某个zip压缩包的一部分。</div><div><br/></div><div>然后看其他两张图，基于对出题人的了解，先把所有能找到的工具都试一遍。结果BMP图片是SilentEye：</div><div><img src="Bugku Misc 29（137-140）_files/Image [15].png" type="image/png" data-filename="Image.png"/></div><div>需要把图像质量调到best，当然这里没有任何提示信息（或者是我没发现），不管工具还是选项都只能手动夏姬霸试。这段隐写信息以504B0304开头，很明显是zip压缩包的前半段：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>504B030414000900080049116354B51AB7362D0000001F00000009000000666C6167342E747874BE961165536C355ADF453455376C70EE4419E7D003FA7B28D27153AE8EF1F6E169093FC30CEF0C30D0BCD52799504B0708B51AB7362D0000001F000000504B0304140009000800911063549A272FD6350000002900000008000000666C61672E747874D870A8592EDDDBDD41C766912B0CF743958DE2D810573E56A048A2B0B9C903FE730997659FBBA53ED67FC33C660F0C990015</div></div><div><br/></div><div>JPG图片的exif信息里有密码：</div><div><img src="Bugku Misc 29（137-140）_files/Image [16].png" type="image/png" data-filename="Image.png"/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>pwd：0/f2z0HNbBQAEhR0//4v6w==</div></div><div>然后夏姬霸试发现是Jphs:</div><div><img src="Bugku Misc 29（137-140）_files/Image [17].png" type="image/png" data-filename="Image.png"/></div><div>提取得到：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>14000900080057106354551AAC2006000000040000000900240000000000000020000000CF000000666C6167332E7478740A00200000000000010018008E6351B95F2ED8018E6351B95F2ED80153B54D05222ED801504B01021F001400090063004F116354000000002C0000000E00000009002F00000000000000200000000C010000666C6167312E7478740A00200000000000010018005FEC34CD602ED8015FEC34CD602ED80106AF7C64602ED8010199070002004145030800504B01021F0014000900630032106354000000002B0000000D00000009002F00000000000000200000007A010000666C6167322E7478740A0020000000000001001800F9DA6D8F5F2ED8014B186B33602ED80161F98232602ED8010199070002004145030800504B05060000000005000500DC010000E70100000000</div></div><div>有504B0506，可能是zip文件的末尾一段。</div><div><br/></div><div>全部三段拼起来得到zip格式压缩包：</div><div><img src="Bugku Misc 29（137-140）_files/Image [18].png" type="image/png" data-filename="Image.png"/></div><div>可以看到五个被压缩的txt文件存在多种加密算法，所以这很可能是多个不同的加密压缩包组合起来的。虽然没有提示，不过先尝试爆破一下纯数字密码：</div><div><img src="Bugku Misc 29（137-140）_files/Image [19].png" type="image/png" data-filename="Image.png"/></div><div>尝试解压，发现这是flag2.txt的密码。解压后从原压缩包里删掉flag2.txt，再爆破一次：</div><div><img src="Bugku Misc 29（137-140）_files/Image [20].png" type="image/png" data-filename="Image.png"/></div><div>这是flag1.txt的密码。剩下3个txt的密码无法在短时间内爆破出来，不过flag3.txt只有4字节，可以爆破CRC32得到内容：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>4 bytes: {0x43, 0x54, 0x46, 0x2d}</div><div>verification checksum: 0x20ac1a55 (OK)</div></div><div><br/></div><div>这样一来已经得到了其中3个txt文件的内容：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>flag1 flag{Bugku-is-</div><div>flag2 an-excellent-</div><div>flag3 CTF-</div></div><div>注意到这三段连起来长度恰好是31，且连接后字符串的CRC32值36B71AB5与flag4.txt完全一致，考虑明文攻击。原压缩包仅保留flag.txt和flag4.txt，然后构造明文包进行攻击：</div><div><img src="Bugku Misc 29（137-140）_files/Image [21].png" type="image/png" data-filename="Image.png"/></div><div>得到flag.txt：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>bugku{BUgku iS @n eXceIlent CTF pl@tform}</div></div><div><br/></div><div>flag：bugku{BUgku iS @n eXceIlent CTF pl@tform}</div><div><br/></div><div><span style="font-weight: bold;">140 TLS</span></div><div><br/></div><div>下载得到client.pcap和server.key，wireshark打开前者：</div><div><img src="Bugku Misc 29（137-140）_files/Image [22].png" type="image/png" data-filename="Image.png"/></div><div>可以看到总共只有一个流，且有大量TLS协议数据包，需要解密才能看到内容。</div><div><br/></div><div>由于题目已经提供了key文件，直接导入即可。编辑-首选项-Protocols-TLS：</div><div><img src="Bugku Misc 29（137-140）_files/Image [23].png" type="image/png" data-filename="Image.png"/></div><div>RSA keys list，导入题目提供的key文件：</div><div><img src="Bugku Misc 29（137-140）_files/Image [24].png" type="image/png" data-filename="Image.png"/></div><div>一路确定，回去会发现出现了两个已经解密的HTTP协议数据包：</div><div><img src="Bugku Misc 29（137-140）_files/Image [25].png" type="image/png" data-filename="Image.png"/></div><div>追踪流得到flag：</div><div><img src="Bugku Misc 29（137-140）_files/Image [26].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div>flag：flag{39u7v25n1jxkl123}</div></span>
</div></body></html> 