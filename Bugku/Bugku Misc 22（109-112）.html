<html>
<head>
  <title>Bugku Misc 22（109-112）</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/605894 (zh-CN, DDL); Windows/6.1.1 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="4404"/>
<h1>Bugku Misc 22（109-112）</h1>
<h2><a href="https://DemonStarAlgol.github.io/Misc/">[无关链接]</a></h2>

<div>
<span><div><span style="font-weight: bold;">109 出其不意</span></div><div><br/></div><div>下载得到加密的zip格式压缩包和key文件。先看后者，十六进制编辑器打开：</div><div><img src="Bugku Misc 22（109-112）_files/Image.png" type="image/png" data-filename="Image.png"/></div><div>是JPG格式图片，此外文件尾后还有额外数据：</div><div><img src="Bugku Misc 22（109-112）_files/Image [1].png" type="image/png" data-filename="Image.png"/></div><div>提取得到RAR格式压缩包，解压得到文本：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>有一天，</div><div>哥哥对弟弟说，让他学贝斯。</div><div>他就是不学，哎，就是玩。</div><div><br/></div><div>又有一天，</div><div>哥哥对弟弟说，让他加点蜂蜜。</div><div>他就是不加，哎，就是玩。</div></div><div>太谜语人了，懒得猜。</div><div><br/></div><div>回头看key文件，重命名为key.jpg后exiftool查看exif信息：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# exiftool key.jpg</div><div>ExifTool Version Number         : 11.98</div><div>File Name                       : key.jpg</div><div>Directory                       : .</div><div>File Size                       : 41 kB</div><div>File Modification Date/Time     : 2021:06:07 02:35:45+00:00</div><div>File Access Date/Time           : 2021:06:07 03:18:48+00:00</div><div>File Inode Change Date/Time     : 2021:06:07 03:18:48+00:00</div><div>File Permissions                : rwxrw-rw-</div><div>File Type                       : JPEG</div><div>File Type Extension             : jpg</div><div>MIME Type                       : image/jpeg</div><div>JFIF Version                    : 1.01</div><div>Resolution Unit                 : inches</div><div>X Resolution                    : 72</div><div>Y Resolution                    : 72</div><div>Exif Byte Order                 : Big-endian (Motorola, MM)</div><div>XP Title                        : 我的贝斯好像掉了6颗螺丝</div><div>Padding                         : (Binary data 2072 bytes, use -b option to extract)</div><div>About                           : uuid:faf5bdd5-ba3d-11da-ad31-d33d75182f1b</div><div>Title                           : 我的贝斯好像掉了6颗螺丝</div><div>Description                     : 我的贝斯好像掉了6颗螺丝</div><div>Warning                         : [minor] Fixed incorrect URI for xmlns:MicrosoftPhoto</div><div>Flash Manufacturer              : 4FtePACF7FySmzhy41Zda</div><div>Image Width                     : 500</div><div>Image Height                    : 498</div><div>Encoding Process                : Baseline DCT, Huffman coding</div><div>Bits Per Sample                 : 8</div><div>Color Components                : 3</div><div>Y Cb Cr Sub Sampling            : YCbCr4:2:0 (2 2)</div><div>Image Size                      : 500x498</div><div>Megapixels                      : 0.249</div></div><div>然后发现并没有藏什么，Windows下右键属性也能看到两段信息：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>我的贝斯好像掉了6颗螺丝</div><div>4FtePACF7FySmzhy41Zda</div></div><div>base58解码可得：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>thisisawrongkey</div></div><div>它确实也不是解压密码。</div><div><br/></div><div>这就很谜语人，快去请蝙蝠侠。总之猜完谜发现，正确的解压密码是把这段base58编码再<span style="font-weight: bold;">加密</span>一次：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>4DSXTA3yFHGib83QejmSdsnLRNDfn</div></div><div>解压得到PNG格式图片：</div><div><img src="Bugku Misc 22（109-112）_files/画X的既不是黑也不是白.png" type="image/png" data-filename="画X的既不是黑也不是白.png"/></div><div>猜测需要把黑白色块转为0和1。根据压缩包文件名提示，打X的块不算黑也不算白，因此有效色块为18x7-4=122块。这个数的质因子为2和61，难以找到均匀分段的线索。但另一方面，注意到每行的开头均为黑色方块，且第一行“黑黑白白黑黑白”正好对应字符f的8-bit ASCII码“01100110”的后7位，第二至四行也正好对应字符lag。猜测转换关系如下：对每一行，黑块和白块分别对应1和0，转二进制数字后ASCII转码。因为部分字符的二进制ASCII码开头有两个0，因此部分行仅有6个色块。</div><div><br/></div><div>写出脚本：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>from PIL import Image</div><div><br/></div><div>img = Image.open('C:/Users/Administrator/Desktop/caimitigoudoubuzuo.png')</div><div>res = [''] * 18</div><div>for y in range(18):</div><div>    for x in range(7):</div><div>        axis = (x * 25 + 10, y * 25 + 15)</div><div>        p = img.getpixel(axis)</div><div>        if p == (255, 255, 255, 255):</div><div>            res[y] += '0'</div><div>        elif p == (22, 22, 22, 255):</div><div>            res[y] += '1'</div><div>for i in res:</div><div>    print(chr(int(i, 2)), end = '')</div></div><div>输出结果：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>flag{A1_9_5h1_wan}</div></div><div><br/></div><div>flag：flag{A1_9_5h1_wan}</div><div><br/></div><div><span style="font-weight: bold;">110 攻其不备</span></div><div><br/></div><div>下载得到pdf格式文件和加密的rar格式压缩包。先看前者，根据文件名提示，foremost分解：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# foremost biezaiyongzhongwenmingle.pdf</div><div>Processing: biezaiyongzhongwenmingle.pdf</div><div>|*|</div></div><div>可以得到两张jpg格式图片，其中一张可以直接打开pdf看到，另一张为：</div><div><img src="Bugku Misc 22（109-112）_files/00000008.jpg" type="image/jpeg" data-filename="00000008.jpg"/></div><div>图片中没有找到隐写痕迹，用十六进制编辑器将PDF中两张图片对应的字节删掉（更简单的办法是用Adobe Acrobat等PDF编辑器，但我懒得装），再打开PDF文件：</div><div><img src="Bugku Misc 22（109-112）_files/Image [2].png" type="image/png" data-filename="Image.png"/></div><div>是熟悉的套娃谜语人贴贴环节。对于emoji密文，结合之前得到的“100”提示，尝试<a href="http://www.atoolbox.net/Tool.php?Id=936">base100解码</a>：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>👤👬👤👬👱👠👰👰👛👪</div><div>mumuziyyds</div></div><div><br/></div><div>解压得到zip和rar两个加密压缩包。先看zip，十六进制编辑器查看：</div><div><img src="Bugku Misc 22（109-112）_files/Image [3].png" type="image/png" data-filename="Image.png"/></div><div>实际是一张PNG格式图片后附加了加密RAR压缩包的字节。将其重命名后开始寻找隐写信息，根据对套娃谜语人们的了解，先尝试各种能加密码且不需要知道原理就能用的隐写工具，最后确认为<a href="https://sekao.net/pixeljihad/">PixelJihad</a>：</div><div><img src="Bugku Misc 22（109-112）_files/Image [4].png" type="image/png" data-filename="Image.png"/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>the key is：</div><div>你信吗？</div></div><div>检查网页源代码可以发现，第一行文字最后其实还有个空格：</div><div><img src="Bugku Misc 22（109-112）_files/Image [5].png" type="image/png" data-filename="Image.png"/></div><div>当然直接爆破也行：</div><div><img src="Bugku Misc 22（109-112）_files/Image [6].png" type="image/png" data-filename="Image.png"/></div><div>总之密码就是一个空格。</div><div><br/></div><div>继续解压得到doc格式文件。打开后按惯例直接全选-右键-字体-取消隐藏：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>我说这就是一个word，你信吗？</div><div>‖♬♩‖¶♯‖♬♭‖♬♫‖♫♪♭♭♪‖♬♬‖♩¶♭♭♭‖‖♫♭♭♭♭♭∮‖♩¶♭♭♭‖‖♭♭♭♭‖‖¶‖‖‖‖¶∮‖‖¶♭♭♭‖‖♫♭♭♭♭♭∮‖♩¶♭♭♭♭♭∮‖♬♪‖‖♭‖♫♫§=</div></div><div>非常眼熟的<a href="https://www.qqxiuzi.cn/bianma/wenbenjiami.php?s=yinyue">千千秀字音符加解密</a>，就是万一在线工具网站挂了就再也没法做了的那种题目。总之解密得到：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>flag{Chu_7_Bu_1_90n9_7_Bu_Be1}</div></div><div><br/></div><div>flag：flag{Chu_7_Bu_1_90n9_7_Bu_Be1}</div><div><br/></div><div><span style="font-weight: bold;">111 答案</span></div><div><br/></div><div>下载得到无扩展名文件，十六进制编辑器查看：</div><div><img src="Bugku Misc 22（109-112）_files/Image [7].png" type="image/png" data-filename="Image.png"/></div><div>是JPG格式图片，同时还可以发现文件尾后有额外数据：</div><div><img src="Bugku Misc 22（109-112）_files/Image [8].png" type="image/png" data-filename="Image.png"/></div><div>提取得到加密的zip格式压缩包。</div><div><br/></div><div>重命名图片，exiftool查看exif信息（直接在Windows下右键属性也可以看到）：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# exiftool mingbaigejier.jpg</div><div>ExifTool Version Number         : 11.98</div><div>File Name                       : mingbaigejier.jpg</div><div>Directory                       : .</div><div>File Size                       : 66 kB</div><div>File Modification Date/Time     : 2021:06:09 01:34:35+00:00</div><div>File Access Date/Time           : 2021:06:09 01:36:16+00:00</div><div>File Inode Change Date/Time     : 2021:06:09 01:36:29+00:00</div><div>File Permissions                : rwxrw-rw-</div><div>File Type                       : JPEG</div><div>File Type Extension             : jpg</div><div>MIME Type                       : image/jpeg</div><div>JFIF Version                    : 1.01</div><div>Resolution Unit                 : inches</div><div>X Resolution                    : 96</div><div>Y Resolution                    : 96</div><div>Exif Byte Order                 : Big-endian (Motorola, MM)</div><div>Orientation                     : Horizontal (normal)</div><div>XP Comment                      : 佛曰：等皤有娑利皤栗梵迦智夜奢倒怖亦罰大俱羅漫呐以哆利奢波諳悉逝哆訶罰彌呐羅諳姪哆大諳室諳悉怯等皤死侄想侄特侄耶侄集奢呼俱藐漫死沙蘇實明俱楞俱沙逝梵特羯怯彌皤密以</div><div>Padding                         : (Binary data 1932 bytes, use -b option to extract)</div><div>Profile CMM Type                :</div><div>Profile Version                 : 2.1.0</div><div>Profile Class                   : Display Device Profile</div><div>Color Space Data                : RGB</div><div>Profile Connection Space        : XYZ</div><div>Profile Date Time               : 0000:00:00 00:00:00</div><div>Profile File Signature          : acsp</div><div>Primary Platform                : Unknown ()</div><div>CMM Flags                       : Not Embedded, Independent</div><div>Device Manufacturer             :</div><div>Device Model                    :</div><div>Device Attributes               : Reflective, Glossy, Positive, Color</div><div>Rendering Intent                : Media-Relative Colorimetric</div><div>Connection Space Illuminant     : 0.9642 1 0.82491</div><div>Profile Creator                 :</div><div>Profile ID                      : 0</div><div>Profile Description             : sRGB</div><div>Red Matrix Column               : 0.43607 0.22249 0.01392</div><div>Green Matrix Column             : 0.38515 0.71687 0.09708</div><div>Blue Matrix Column              : 0.14307 0.06061 0.7141</div><div>Red Tone Reproduction Curve     : (Binary data 40 bytes, use -b option to extract)</div><div>Green Tone Reproduction Curve   : (Binary data 40 bytes, use -b option to extract)</div><div>Blue Tone Reproduction Curve    : (Binary data 40 bytes, use -b option to extract)</div><div>Media White Point               : 0.9642 1 0.82491</div><div>Profile Copyright               : Google Inc. 2016</div><div>About                           : uuid:faf5bdd5-ba3d-11da-ad31-d33d75182f1b</div><div>Warning                         : [minor] Fixed incorrect URI for xmlns:MicrosoftPhoto</div><div>Image Width                     : 641</div><div>Image Height                    : 641</div><div>Encoding Process                : Baseline DCT, Huffman coding</div><div>Bits Per Sample                 : 8</div><div>Color Components                : 3</div><div>Y Cb Cr Sub Sampling            : YCbCr4:2:0 (2 2)</div><div>Image Size                      : 641x641</div><div>Megapixels                      : 0.411</div></div><div>但尝试<a href="https://www.keyfc.net/bbs/tools/tudoucode.aspx">与佛论禅</a>和<a href="http://hi.pcmoe.net/buddha.html">新约佛论禅</a>均无法正确解密，尝试后发现需要使用Bugku提供的<a href="https://ctf.bugku.com/tool/todousharp">与佛论禅密码</a>在线工具解密：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>美乐蒂卡哇伊</div></div><div><br/></div><div>解压得到加密压缩包 答案.zip 和password.txt，先看后者：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>1    1</div><div>2    4</div><div>3    3</div><div>4    7</div><div>5    1</div><div>6    4</div><div>7    8</div><div>8    7</div><div>9    4</div><div>10  5   </div><div>11  1   </div><div>12  3   </div><div>13  2   </div><div>14  4   </div><div>15  5   </div><div>16  2   </div><div>17  5   </div><div>18  3   </div><div>36  1  </div><div>38  3  </div><div>40  5  </div><div>42  7</div><div>44  9</div><div><br/></div><div>tip:</div><div>####################</div><div>###你听过《青花》吗？###</div><div>####################</div></div><div>观察上方给出的数字组密文，后一位数字均在1-9之间，前一位数字则从1一直增大到44。根据提示，搜索《青花》这首歌，注意到其歌词正好为44行。<span style="font-size: unset; color: unset; font-family: unset;">猜测可能为密码本密码：</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>w = '''三月走过 柳絮散落</div><div>恋人们匆匆</div><div>我的爱情 闻风不动</div><div>翻阅昨日 仍有温度</div><div>蒙尘的心事</div><div>恍恍惚惚 已经隔世</div><div>遗憾无法说 惊觉心一缩</div><div>紧紧握着 青花信物</div><div>信守着承诺</div><div>离别总在 失意中度过</div><div>记忆油膏 反复涂抹</div><div>无法愈合的伤口</div><div>你的回头 划伤了沉默</div><div>那夜重逢 停止漂泊</div><div>你曾回来过</div><div>相濡相忘 都是疼痛</div><div>只因昨日 善良固执</div><div>委屈着彼此</div><div>打碎信物 取消来世</div><div>遗憾无法说 惊觉心一缩</div><div>紧紧握着 青花信物</div><div>信守着承诺</div><div>离别总在 失意中度过</div><div>记忆油膏 反复涂抹</div><div>无法愈合的伤口</div><div>你的回头 划伤了沉默</div><div>紧紧握着 青花信物</div><div>雕刻着寂寞</div><div>就好像我 无主的魂魄</div><div>纠缠过往 无端神伤</div><div>摔碎谁也带不走</div><div>你我一场 唤不醒的梦</div><div>紧紧握着 青花信物</div><div>信守着承诺</div><div>离别总在 失意中度过</div><div>记忆油膏 反复涂抹</div><div>无法愈合的伤口</div><div>你的回头 划伤了沉默</div><div>紧紧握着 青花信物</div><div>雕刻着寂寞</div><div>就好像我 无主的魂魄</div><div>纠缠过往 无端神伤</div><div>摔碎谁也带不走</div><div>你我一场 唤不醒的梦'''</div><div>w = w.replace(' ', '').split('\n')</div><div><br/></div><div>c = open('C:/Users/Administrator/Desktop/password.txt', 'rb').readlines()[:22]</div><div>m = ''</div><div>for i in c:</div><div>    t = i.decode()</div><div>    for j in range(5):</div><div>        t = t.replace('  ', ' ')</div><div>    t = t.split(' ')</div><div>    m += w[int(t[0]) - 1][int(t[1]) - 1]</div><div>print(m)</div></div><div>得到解压密码：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>三匆爱温蒙惚心信承失记愈的逢过濡善着记回寞神梦</div></div><div>再次解压得到2.jpg，十六进制编辑器查看：</div><div><img src="Bugku Misc 22（109-112）_files/Image [9].png" type="image/png" data-filename="Image.png"/></div><div>文件尾FF D9缺失，但尾部有一段类似base64编码的字符串：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>YnVna3V7TWF5X3kwdV9CZV9IYXBweX0=</div></div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">base64解码：</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>bugku{May_y0u_Be_Happy}</div></div><div><br/></div><div>flag：<span style="text-indent: 0px;">bugku{May_y0u_Be_Happy}</span></div><div><br/></div><div><span style="text-indent: 0px;"><span style="font-weight: bold;">112 聊天</span></span></div><div><br/></div><div><span style="text-indent: 0px;">下载到win7.vmem文件。从文件名可以判断是VMware Windows7虚拟机的内存文件，用volatility取证。</span></div><div><br/></div><div>分析内存镜像信息：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# volatility imageinfo -f win7.vmem</div><div>Volatility Foundation Volatility Framework 2.6</div><div>INFO    : volatility.debug    : Determining profile based on KDBG search...</div><div>          Suggested Profile(s) : Win7SP1x64, Win7SP0x64, Win2008R2SP0x64, Win2008R2SP1x64_24000, Win2008R2SP1x64_23418, Win2008R2SP1x64, Win7SP1x64_24000, Win7SP1x64_23418</div><div>                     AS Layer1 : WindowsAMD64PagedMemory (Kernel AS)</div><div>                     AS Layer2 : FileAddressSpace (/root/Desktop/win7.vmem)</div><div>                      PAE type : No PAE</div><div>                           DTB : 0x187000L</div><div>                          KDBG : 0xf800029f3110L</div><div>          Number of Processors : 1</div><div>     Image Type (Service Pack) : 1</div><div>                KPCR for CPU 0 : 0xfffff800029f4d00L</div><div>             KUSER_SHARED_DATA : 0xfffff78000000000L</div><div>           Image date and time : 2021-06-17 03:01:06 UTC+0000</div><div>     Image local date and time : 2021-06-16 20:01:06 -0700</div></div><div>是64位Windows7，不过从文件名已经判断出来了。</div><div><br/></div><div>扫描文件列表：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# volatility filescan -f win7.vmem --profile=Win7SP1x64 &gt; filelist.txt</div></div><div>然后得到了一个2963条文件的列表……但大部分都是dll等系统文件。筛选txt、bmp/jpg/png、zip/rar等常见扩展名，发现较为可疑的文件：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>0x00000000233b54c0     16      0 R--rw- \Device\HarddiskVolume1\Users\IEUser\Documents\Tencent Files\54297198\FileRecv\f16g.rar</div></div><div>从路径可以看出这是QQ号54297198在聊天中接收到的压缩包。将其dump：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# volatility -f win7.vmem --profile=Win7SP1x64 dumpfiles -Q 0x00000000233b54c0 -D ./</div></div><div>然而不知为何竟dump不出来，改用foremost得到了一个加密的RAR格式压缩包：</div><div><img src="Bugku Misc 22（109-112）_files/Image [10].png" type="image/png" data-filename="Image.png"/></div><div>也就是说解压密码在微信发送的文件里。</div><div><br/></div><div>回到刚才2963条文件列表，搜索WeChat Files。排除数据库文件和配置文件等，比较可疑的是这两个：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>0x0000000004de44d0     16      0 RWD--- \Device\HarddiskVolume1\Users\IEUser\Documents\WeChat Files\wxid_0fznezm6rnkd22\FileStorage\Temp\f766e25cea15ddfad6d54caa4e1bd180.dat</div><div>0x000000001c1748a0     16      0 RWD--- \Device\HarddiskVolume1\Users\IEUser\Documents\WeChat Files\wxid_0fznezm6rnkd22\FileStorage\Temp\e1fb6b005dcb9bf590c764ba62f43efb.dat</div></div><div>仍旧将其dump出来：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# volatility -f win7.vmem --profile=Win7SP1x64 dumpfiles -Q 0x0000000004de44d0 -D ./</div><div>Volatility Foundation Volatility Framework 2.6</div><div>DataSectionObject 0x04de44d0   None   \Device\HarddiskVolume1\Users\IEUser\Documents\WeChat Files\wxid_0fznezm6rnkd22\FileStorage\Temp\f766e25cea15ddfad6d54caa4e1bd180.dat</div><div><br/></div><div>root@kali:~/Desktop# volatility -f win7.vmem --profile=Win7SP1x64 dumpfiles -Q 0x000000001c1748a0 -D ./</div><div>Volatility Foundation Volatility Framework 2.6</div><div>DataSectionObject 0x1c1748a0   None   \Device\HarddiskVolume1\Users\IEUser\Documents\WeChat Files\wxid_0fznezm6rnkd22\FileStorage\Temp\e1fb6b005dcb9bf590c764ba62f43efb.dat</div></div><div>得到的文件是一样的，且在Kali下可以直接看出其为图片。实际上这个文件是PNG格式图片：</div><div><img src="Bugku Misc 22（109-112）_files/Image [11].png" type="image/png" data-filename="Image.png"/></div><div>得到解压密码：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>Q1Da1A1qINgDeT0KeI1</div></div><div>解压得到flag.txt：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>bugku{s1mple_D1gital_f0rens1cs_%s_%s_%s}(qqnumber,qqname,wechatpicxorvalue(HEX,lowercase))</div></div><div><br/></div><div>还需要找到三段信息：QQ号，QQ名称，微信图片XOR加密密钥。其中QQ号在RAR格式压缩包路径中，为54297198。QQ名可以从QQ空间（<a href="https://54297198.qzone.qq.com/">https://54297198.qzone.qq.com/</a>）获取：</div><div><img src="Bugku Misc 22（109-112）_files/Image [12].png" type="image/png" data-filename="Image.png"/></div><div>微信图片XOR加密密钥，由于dump得到的dat文件实际就是PNG格式图片，说明并没有被异或加密，因此密钥是00。</div><div>最后拼接一下得到flag。</div><div><br/></div><div>flag：bugku{s1mple_D1gital_f0rens1cs_54297198_Xhelwer_00}</div></span>
</div></body></html> 