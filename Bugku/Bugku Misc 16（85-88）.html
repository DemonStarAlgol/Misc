<html>
<head>
  <title>Bugku Misc 16（85-88）</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/605894 (zh-CN, DDL); Windows/6.1.1 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="3832"/>
<h1>Bugku Misc 16（85-88）</h1>
<h2><a href="https://DemonStarAlgol.github.io/Misc/">[无关链接]</a></h2>

<div>
<span><div><span style="font-weight: bold;">85 北有楠木</span></div><div><br/></div><div>猜谜套娃工具题。下载得到jpg格式文件，十六进制编辑器查看，文件尾后有额外数据：</div><div><img src="Bugku Misc 16（85-88）_files/Image.png" type="image/png" data-filename="Image.png"/></div><div>注意到37 7A是7z格式压缩包的文件头，但后续的03 04 14 00则是zip格式压缩包文件头的特征。猜测可能是zip格式压缩包的文件头50 4B被替换成了37 7A。进一步观察发现，实际是zip格式压缩包的几个文件块标志50 4B 03 04/01 02/05 06中的50 4B被替换成了37 7A。将额外数据提取后按此规则修复，得到zip格式压缩包：</div><div><img src="Bugku Misc 16（85-88）_files/Image [1].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div>解压得到key.png、hint.txt和加密压缩包ahu.rar，先看txt：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>5Y+k6ICB55qE5paH5a2X</div></div><div>base64解码：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>古老的文字</div></div><div>再看key.png：</div><div><img src="Bugku Misc 16（85-88）_files/key.png" type="image/png" data-filename="key.png"/></div><div>对应甲骨文数字：</div><div><img src="Bugku Misc 16（85-88）_files/Image.jpg" type="image/jpeg" data-filename="Image.jpg"/></div><div>得到密码：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>14582978</div></div><div>解压aha.rar得到ahu.bmp和加密压缩包last.rar。</div><div><br/></div><div>接下来是猜工具部分。尝试后发现对ahu.bmp用wbStego，无密码，可以提取出隐写信息：</div><div><img src="Bugku Misc 16（85-88）_files/Image [2].png" type="image/png" data-filename="Image.png"/></div><div>但提取结果为大量乱码，继续猜谜，用strings命令提取可打印字符串，指定输出最小长度为10字符：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# strings 1 -n 10</div><div>CoY??sOwj^</div><div>fOz){?,\'RG</div><div>?uiQ?SMx?GcG</div><div><font style="color: rgb(255, 0, 0);">0  key:988%^&amp;*cool    O</font></div></div><div>得到解压密码：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>988%^&amp;*cool</div></div><div><br/></div><div>再次解压得到fl@g.txt和hint.txt，先看后者：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>aes256</div><div>key:99633</div></div><div>前者则是大量类似AES密文的乱码字符，需要解密。但直接使用给出的密钥进行EBC模式的AES256解密无法得到任何结果，若使用其他模式，题目又没有给出iv参数。事实上这一步并不是现代密码，而是又一层工具猜谜，用到的工具是Openssl：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# openssl enc -aes-256-cbc -d -in fl@g.txt -out out.txt</div><div>enter aes-256-cbc decryption password:<font color="#FF0000">（输入密码99633）</font></div><div>*** WARNING : deprecated key derivation used.</div><div>Using -iter or -pbkdf2 would be better.</div></div><div>输出结果：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>∮♩§∮♫♯∮♪♬∮♪∮∮♫♯∮♫‖∮♩‖∮♪♩∮♫♬∮♫♬∮¶♬∮♫♬∮♭§∮¶♬∮♩§∮♪♩∮¶§∮♫♯∮♫§∮♪♯∮¶♭♪‖∮∮∮¶∮¶♬§¶♬∮♪♭∮♪♫∮¶♬∮♭♯∮♪♭∮♫§∮♪♩∮♫¶∮♪♩∮♫♬♪‖♪§¶♯∮♪♭∮♪♬∮♩∮§==</div><div>♬§¶♪¶♪¶♯♯=</div></div><div>很明显是千千秀字的<a href="https://www.qqxiuzi.cn/bianma/wenbenjiami.php?s=yinyue">文本加密</a>。两行分别解密，第一行结果是乱码，很可能需要密码，第二行解密结果：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>cool</div></div><div>以此为密码解密第一行：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>bugku{aess_s0_be@utiFUl_#nd_1nteresT%ng}</div></div><div>建议改名叫《★☆测测看☆★～你和出题人的心灵同步有多少～》。</div><div><br/></div><div>flag：bugku{aess_s0_be@utiFUl_#nd_1nteresT%ng}</div><div><br/></div><div><span style="font-weight: bold;">86 MuMuMisc的简单题</span></div><div><br/></div><div>下载得到mumumisc.png、private.key和ヒント.txt。先看后者：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>连续加了两天班又经历了2021.3.14 AWD线上赛的后MuMuMisc内心黑化程度到达了100%，他决定出一个套娃题目来与大家进行较♂量。</div><div>MuMuMisc先是构造了一串flag，然后在他的外国网友霍夫曼的指导下进行了最原始的编码加密，最后层层套娃将其藏进了一张图片里。</div><div>霍夫曼在完成工♂作后靠在树上与MuMuMisc进行了视频对话，他说MuMuMisc出的题目也就有他指导的那一层还有点意思，但整体还是简单得不能看。钥匙都给你了，聪明的你最后一定能够得到flag。</div></div><div>private.key实际上是jpg格式图片：</div><div><img src="Bugku Misc 16（85-88）_files/Image [3].png" type="image/png" data-filename="Image.png"/></div><div>是一个霍夫曼树。</div><div><br/></div><div>然后看mumumisc.png：</div><div><img src="Bugku Misc 16（85-88）_files/mumumisc.png" type="image/png" data-filename="mumumisc.png"/></div><div>显然左边的黑白点以列优先编码了某种数据，写Python脚本尝试将其提取：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>from PIL import Image</div><div><br/></div><div>img = Image.open('C:/Users/Administrator/Desktop/mumumisc/mumumisc.png')</div><div>(w, h) = img.size</div><div><br/></div><div>res = ''</div><div>for x in range(w):</div><div>    for y in range(h):</div><div>        p = img.getpixel((x, y))</div><div>        if p == (0, 0, 0):</div><div>            res += '1'</div><div>        elif p == (255, 255, 255):</div><div>            res += '0'</div><div><br/></div><div>out = ''</div><div>for i in range(0, len(res), 8):</div><div>    out += str(hex(int(res[i:i+8], 2)))[2:].zfill(2)</div><div>print(out)</div></div><div>输出结果：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>4d5445774d444178494441774d4441……（后略）</div></div><div>显然是十六进制的ASCII编码，且转码后明显为base64编码。将其转码两次：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>import base64</div><div><br/></div><div>out = ''</div><div>for i in range(0, len(res), 8):</div><div>    out += chr(int(res[i:i+8], 2))</div><div>print(base64.b64decode(out.encode()).decode())</div></div><div>输出结果：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>110001 000000 010 0110 11001 101 0111 101 0111 101 0001 001 110000 100 0001 001 100 0110 1111 1111 1101 100 010 11101 1101 100 000001 010 11101 1101 001 1111 101 111001 111000</div></div><div>从形式上来看很可能是霍夫曼编码。假设第一段 110001 对应字母 f ，显然1对应霍夫曼树的右子节点，0对应霍夫曼树的左子节点。写脚本将其解码：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>ss = '110001 000000 010 0110 11001 101 0111 101 0111 101 0001 001 110000 100 0001 001 100 0110 1111 1111 1101 100 010 11101 1101 100 000001 010 11101 1101 001 1111 101 111001 111000'.split(' ')</div><div>h = [[[[['l', 'h'], 'i'], 's'], ['a', ['g', 'u']]],</div><div>     [['_', 'm'], [[[['c', 'f'], '{'], 'd'], [[['}', 'e'], 'n'], 'o']]]]</div><div><br/></div><div>def decode(s):</div><div>    m = h</div><div>    for i in s:</div><div>        try:</div><div>            m = m[int(i)]</div><div>        except:</div><div>            pass</div><div>    return m</div><div><br/></div><div>for i in ss:</div><div>    print(decode(i), end = '')</div></div><div>加入try语句是因为有部分字符的编码写错了，不加会报错。具体来说，第2个字符和倒数第9个字符都多了一个0。所以输出结果也有点问题，倒数第9个 l 应为 h。输出结果：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>flag{mumumisc_is_good_and_<font color="#FF0000">l</font>andsome}</div></div><div><br/></div><div>flag：flag{mumumisc_is_good_and_handsome}</div><div><br/></div><div><span style="font-weight: bold;">87 1和0的故事</span></div><div><br/></div><div>下载得到txt格式文件，内容：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>0000000001110010000000000</div><div>0000000000011110100000000</div><div>0000000001110001000000000</div><div>0000000010111100000000000</div><div>0000000010101010000000000</div><div>0000000001100010100000000</div><div>0000000010101010100000000</div><div>0000000001000001100000000</div><div>1100011101110110100011000</div><div>0001000010110010010010100</div><div>0100111101000011101110011</div><div>0011110100101011001001001</div><div>1000001001100001001101000</div><div>1111000111111011100101000</div><div>1011011111001101111110111</div><div>1000110110010010101101100</div><div>1000111100111111111110111</div><div>0000000010110001100010100</div><div>0000000010010100101010001</div><div>0000000010101010100011001</div><div>0000000000100111111110010</div><div>0000000000011001011110111</div><div>0000000001001100100100001</div><div>0000000011000011011011001</div><div>0000000011010000101110101</div></div><div>可以看出是个缺少了定位符的二维码。写Python脚本绘图：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>from PIL import Image</div><div><br/></div><div>s = open('C:/Users/Administrator/Desktop/10.txt').readlines()</div><div>l = len(s)</div><div><br/></div><div>img = Image.new('1', (l, l), 255)</div><div>for y in range(l):</div><div>    for x in range(l):</div><div>        if s[y][x] == '1':</div><div>            img.putpixel((x, y), 0)</div><div><br/></div><div>pdp = Image.new('1', (7, 7), 0)</div><div>pdp.paste(Image.new('1', (5, 5), 255), (1, 1))</div><div>pdp.paste(Image.new('1', (3, 3), 0), (2, 2))</div><div><br/></div><div>for i in [(0, 0), (l-7, 0), (0, l-7)]:</div><div>    img.paste(pdp, i)</div><div>img.show()</div></div><div>输出结果（已放大）：</div><div><img src="Bugku Misc 16（85-88）_files/Image [4].png" type="image/png" data-filename="Image.png"/></div><div>扫描得到flag。</div><div><br/></div><div>flag：flag{QR_c0de_1s_1nterest1n9}</div><div><br/></div><div><span style="font-weight: bold;">88 easy_nbt</span></div><div><br/></div><div>下载得到文件夹New World，是Minecraft的世界数据：</div><div><img src="Bugku Misc 16（85-88）_files/Image [5].png" type="image/png" data-filename="Image.png"/></div><div>结合题目名称，猜测本题与NBT有关。NBT（二进制命名标签，Named Binary Tags） 格式为Minecraft中用于向文件中存储数据的一种存储格式。NBT格式以树形结构并配以许多标签的形式存储数据，所有的标签都有一个独立的ID和名称。<span style="font-size: unset; color: unset; font-family: unset;">另一种玩家更熟悉的NBT是纯文本形式的，通常在命令里使用。这种格式常被称为SNBT（字符串化的二进制命名标签，String NBT）。</span></div><div><span style="font-size: unset;"><br/></span></div><div><span style="color: unset; font-family: unset; font-size: unset;">总之先掏出Misc手家中常备的</span><a href="https://github.com/jaquadro/NBTExplorer" style="font-family: unset; font-size: unset;">NBTExplorer</a><span style="color: unset; font-family: unset; font-size: unset;">，定位到题目附件给出的文件夹：</span></div><div><img src="Bugku Misc 16（85-88）_files/Image [6].png" type="image/png" data-filename="Image.png"/></div><div>然后playerdata-Inventory-tag-pages：</div><div><img src="Bugku Misc 16（85-88）_files/Image [7].png" type="image/png" data-filename="Image.png"/></div><div>翻到最后一页：</div><div><img src="Bugku Misc 16（85-88）_files/Image [8].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div>flag：flag{Do_u_kN0w_nbt?}</div></span>
</div></body></html> 